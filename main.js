/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Nh=Object.create;var Hi=Object.defineProperty;var Dh=Object.getOwnPropertyDescriptor;var $h=Object.getOwnPropertyNames;var Bh=Object.getPrototypeOf,Uh=Object.prototype.hasOwnProperty;var ll=(n,e)=>()=>(n&&(e=n(n=0)),e);var dl=(n,e)=>{for(var t in e)Hi(n,t,{get:e[t],enumerable:!0})},uu=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of $h(e))!Uh.call(n,s)&&s!==t&&Hi(n,s,{get:()=>e[s],enumerable:!(r=Dh(e,s))||r.enumerable});return n};var jh=(n,e,t)=>(t=n!=null?Nh(Bh(n)):{},uu(e||!n||!n.__esModule?Hi(t,"default",{value:n,enumerable:!0}):t,n)),Hh=n=>uu(Hi({},"__esModule",{value:!0}),n);function ul(n){let e=fu[n];if(!e)return"Tutorials/00-Index.md";let t=e.anchor?`#${e.anchor.replace("#","")}`:"";return`Tutorials/${e.file}${t}`}async function pl(n,e){let t=ul(e),r=fu[e],s=[t,t.replace("Tutorials/","tutorials/"),`Ideatr/${t}`,`Ideatr/${t.replace("Tutorials/","tutorials/")}`,`Ideatr/Tutorials/${r.file}`,`Ideatr/tutorials/${r.file}`];for(let a of s){let o=n.vault.getAbstractFileByPath(a);if(o&&o instanceof vn.TFile){await n.workspace.openLinkText(a,"",!0);return}}let i=["Tutorials/00-Index.md","tutorials/00-Index.md","Ideatr/Tutorials/00-Index.md","Ideatr/tutorials/00-Index.md"];for(let a of i){let o=n.vault.getAbstractFileByPath(a);if(o&&o instanceof vn.TFile){await n.workspace.openLinkText(o.path,"",!0);return}}new vn.Notice("Tutorial file not found. Please ensure tutorials are available in your vault.")}function ue(n,e,t){let r=document.createElement("span");return r.addClass("ideatr-help-icon"),r.setAttribute("aria-label",t??"Get help"),r.textContent="?",r.setCssProps({cursor:"pointer",display:"inline-flex","align-items":"center","justify-content":"center",width:"16px",height:"16px","border-radius":"50%","background-color":"var(--background-modifier-border)",color:"var(--text-muted)","font-size":"12px","font-weight":"bold","margin-left":"4px","vertical-align":"middle","line-height":"1"}),r.addEventListener("mouseenter",()=>{r.setCssProps({"background-color":"var(--interactive-accent)",color:"var(--text-on-accent)"})}),r.addEventListener("mouseleave",()=>{r.setCssProps({"background-color":"var(--background-modifier-border)",color:"var(--text-muted)"})}),r.addEventListener("click",s=>{s.stopPropagation(),pl(n,e)}),t&&r.setAttribute("title",t),r}var vn,fu,Wt=ll(()=>{"use strict";vn=require("obsidian"),fu={"getting-started":{file:"01-Getting-Started.md"},"capture-workflows":{file:"02-Capture-Workflows.md"},validation:{file:"03-Validation-Guide.md"},transformation:{file:"04-Transformation-Tools.md"},lifecycle:{file:"05-Lifecycle-Management.md"},dashboard:{file:"06-Dashboard-Guide.md"},"graph-view":{file:"07-Graph-View-Guide.md"},"batch-operations":{file:"08-Batch-Operations.md"},"advanced-features":{file:"09-Advanced-Features.md"},"ideate-button":{file:"02-Capture-Workflows.md"},"save-button":{file:"02-Capture-Workflows.md"},"triage-inbox":{file:"06-Dashboard-Guide.md",anchor:"#triage-inbox"},clusters:{file:"06-Dashboard-Guide.md",anchor:"#clusters-panel"},resurfacing:{file:"06-Dashboard-Guide.md",anchor:"#resurfacing-panel"},filters:{file:"06-Dashboard-Guide.md",anchor:"#filtering"},"status-management":{file:"05-Lifecycle-Management.md",anchor:"#status-management"},"domain-checking":{file:"03-Validation-Guide.md",anchor:"#domain-checking"},"existence-search":{file:"03-Validation-Guide.md",anchor:"#existence-search"},"duplicate-detection":{file:"03-Validation-Guide.md",anchor:"#duplicate-detection"},"related-notes":{file:"03-Validation-Guide.md",anchor:"#related-notes-discovery"},"name-variants":{file:"04-Transformation-Tools.md",anchor:"#name-variants"},scaffolds:{file:"04-Transformation-Tools.md",anchor:"#scaffolds"},mutations:{file:"04-Transformation-Tools.md",anchor:"#mutations"},expansion:{file:"04-Transformation-Tools.md",anchor:"#expansion"},reorganization:{file:"04-Transformation-Tools.md",anchor:"#reorganization"},archiving:{file:"05-Lifecycle-Management.md",anchor:"#archiving-ideas"},codename:{file:"05-Lifecycle-Management.md",anchor:"#codename-generation"},"project-elevation":{file:"05-Lifecycle-Management.md",anchor:"#project-elevation"}}});var nh={};dl(nh,{TutorialService:()=>Li});var Mi,Li,Kd=ll(()=>{"use strict";Mi=require("obsidian");Wt();Li=class{constructor(e){this.app=e}async openIndex(){let e=["Tutorials/00-Index.md","tutorials/00-Index.md","Ideatr/Tutorials/00-Index.md","Ideatr/tutorials/00-Index.md"];for(let t of e){let r=this.app.vault.getAbstractFileByPath(t);if(r&&r instanceof Mi.TFile){await this.app.workspace.openLinkText(t,"",!0);return}}new Mi.Notice("Tutorial files not found. Please ensure tutorials are available in your vault.")}async openTopic(e){await pl(this.app,e)}getTutorialPath(e){return ul(e)}areTutorialsAvailable(){let e=["Tutorials/00-Index.md","tutorials/00-Index.md","Ideatr/Tutorials/00-Index.md","Ideatr/tutorials/00-Index.md"];for(let t of e){let r=this.app.vault.getAbstractFileByPath(t);if(r&&r instanceof Mi.TFile)return!0}return!1}}});var vh={};dl(vh,{MutationErrorModal:()=>eu});var Oi,eu,wh=ll(()=>{"use strict";Oi=require("obsidian"),eu=class extends Oi.Modal{errorDetails;onRetry;constructor(e,t,r){super(e),this.errorDetails=t,this.onRetry=r}onOpen(){let{contentEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Failed to generate mutations"}),e.addClass("ideatr-error-modal"),e.createDiv("ideatr-error-message").createEl("p",{text:this.errorDetails.message,cls:"ideatr-error-text"}),this.errorDetails.responseLength!==void 0){let o=e.createDiv("ideatr-error-details");o.createEl("p",{text:`Response length: ${this.errorDetails.responseLength} characters`,cls:"ideatr-error-detail"}),this.errorDetails.responsePreview&&(o.createEl("strong",{text:"Response preview:"}).setCssProps({display:"block","margin-top":"10px","margin-bottom":"5px"}),o.createEl("pre",{text:this.errorDetails.responsePreview,cls:"ideatr-error-preview"}).setCssProps({"font-size":"0.9em","max-height":"200px",overflow:"auto",padding:"10px","background-color":"var(--background-secondary)","border-radius":"4px","white-space":"pre-wrap","word-break":"break-word"}))}let r=e.createDiv("ideatr-error-causes");r.createEl("strong",{text:"Possible causes:",cls:"ideatr-error-causes-title"});let s=r.createEl("ul",{cls:"ideatr-error-causes-list"});this.errorDetails.responseLength===0?(s.createEl("li",{text:"The AI model stopped generating or returned an empty response"}),s.createEl("li",{text:"The model may have hit a token limit or encountered an error"}),s.createEl("li",{text:"Try reducing the number of mutations requested or using a different model"})):(s.createEl("li",{text:"The AI model returned malformed JSON that could not be parsed"}),s.createEl("li",{text:"The response may have been cut off mid-generation"}),s.createEl("li",{text:"Try again - the model may generate valid JSON on retry"}));let i=e.createDiv("ideatr-modal-buttons");i.setCssProps({"margin-top":"20px"}),this.errorDetails.canRetry&&this.onRetry&&i.createEl("button",{text:"Retry",cls:"mod-cta"}).addEventListener("click",()=>{(async()=>{this.close(),new Oi.Notice("Retrying mutation generation...");try{await this.onRetry()}catch(c){new Oi.Notice(`Retry failed: ${c instanceof Error?c.message:"Unknown error"}`)}})()}),i.createEl("button",{text:"Close"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}}});var vb={};dl(vb,{default:()=>cl});module.exports=Hh(vb);var Ie=require("obsidian");var Fe=require("obsidian");function qi(n){let e=n.trim();return e.length===0?{valid:!1,error:"Idea cannot be empty"}:e.length<3?{valid:!1,error:"Idea must be at least 3 characters"}:e.length>5e3?{valid:!1,error:"Idea must be less than 5000 characters"}:{valid:!0,sanitizedText:qh(e)}}function qh(n){return n.trim().replace(/\0/g,"").replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\n{3,}/g,`

`)}var h=class n{static app=null;static debugMode=!0;static debugFileChecked=!1;static debugFileExists=!1;static DEBUG_FILE_NAMES=[".ideatr-debug",".ideatr-debug.md"];static checkPromise=null;static async initialize(e,t=!0){n.app=e,n.debugMode=t,n.debugFileChecked=!1,n.debugFileExists=!1,e?.vault&&await n.checkDebugFile(e.vault),n.isDebugEnabled()&&console.debug("[Ideatr] Logger initialized in DEBUG mode"),n.logDeployTimestamp().catch(()=>{})}static async logDeployTimestamp(){try{if(!n.app?.vault)return;let t=`${n.app.vault.configDir}/plugins/ideatr/deploy-timestamp.json`;if(!await n.app.vault.adapter.exists(t)){n.debug("Deploy timestamp file not found (this is normal for first deploy)");return}let s=await n.app.vault.adapter.read(t),i=JSON.parse(s),a=i.deployedAtReadable??i.deployedAt;console.debug(`[Ideatr] Last deployed: ${a}`),n.info(`Last deployed: ${a}`)}catch(e){n.debug("Could not read deploy timestamp:",e)}}static forceRecheckDebugFile(){n.app?.vault&&(n.debugFileChecked=!1,n.debugFileExists=!1,n.checkDebugFile(n.app.vault).catch(()=>{}))}static async checkDebugFile(e){if(n.debugFileChecked&&n.checkPromise){await n.checkPromise;return}n.debugFileChecked||(n.checkPromise=(async()=>{try{for(let t of n.DEBUG_FILE_NAMES)if(await e.adapter.exists(t)){n.debugFileExists=!0,n.debugFileChecked=!0,n.checkPromise=null;return}n.debugFileExists=!1}catch{n.debugFileExists=!1}finally{n.debugFileChecked=!0,n.checkPromise=null}})(),await n.checkPromise)}static isDebugEnabled(){return n.debugMode?!0:n.debugFileExists}static debug(...e){n.isDebugEnabled()&&console.debug("[Ideatr Debug]",...e)}static info(...e){n.isDebugEnabled()&&console.debug("[Ideatr]",...e)}static warn(...e){n.isDebugEnabled()&&console.warn("[Ideatr]",...e)}static error(...e){n.isDebugEnabled()&&console.error("[Ideatr]",...e)}static log(e,...t){n.isDebugEnabled()&&console.debug(`[Ideatr:${e}]`,...t)}};function ie(n){if(!n||n.trim().length===0)return"";let t=n.split(`
`)[0].trim().substring(0,50).trim();return t=t.replace(/[^a-zA-Z0-9\s-]/g,""),t.length<3&&(t=n.substring(0,50).trim(),t=t.replace(/[^a-zA-Z0-9\s-]/g,"")),t}async function pu(n,e){if(!e?.complete||e.isAvailable&&!e.isAvailable())return ie(n);try{let t=`Extract a concise, descriptive name or title for this idea.

Idea: "${n}"

CRITICAL REQUIREMENTS:
- Extract the CORE CONCEPT, not just the first words
- Focus on what makes this idea unique or identifiable
- Create a title that someone could use to quickly understand what this is about

Rules:
- Return ONLY the name/title (3-50 characters)
- No quotes, no explanation, no prefixes like "Title:" or "Name:"
- If the idea is a long description, extract the key concept (e.g., "AI puzzle game with monkeys" \u2192 "Monkey Puzzle Game" or "AI Monkey Puzzle")
- If the first line is already a good title, use it
- Make it descriptive but concise - should capture the essence in a few words

Examples:
- "AI generated puzzle full of interlinked monkeys that look similar, sort of a where's waldo of monkeys" \u2192 "Monkey Puzzle Game" or "AI Monkey Find"
- "notification app that sends alerts" \u2192 "Notification App" or "Alert System"
- "task manager for teams" \u2192 "Team Task Manager"

Name:`,s=(await e.complete(t,{temperature:.3,n_predict:50,stop:[`
`,".","!","?"]})).trim();return s=s.replace(/^["']|["']$/g,""),s=s.substring(0,50).trim(),s=s.replace(/[^a-zA-Z0-9\s-]/g,""),s.length<3?ie(n):s}catch(t){return h.warn("LLM name extraction failed, using rule-based fallback:",t),ie(n)}}var Gi=class{generateQuery(e,t,r){if(!e||e.trim().length===0)return"";let s=e.trim(),i=this.extractKeyTerms(s),a=r??ie(e);if(a&&a.trim().length>0&&a.length>=3){let o=a.trim();i.toLowerCase().includes(o.toLowerCase())||(i=`${o} ${i}`)}if(!t)return i;switch(t){case"saas":case"tool":case"ux":return`${i} app`;case"game":case"mechanic":return`${i} game`;case"hardware":case"brand":return`${i} product`;case"story":case"ip":return`${i} book`;default:return i}}generateQueryVariations(e,t,r){if(!e||e.trim().length===0)return[];let s=e.trim(),i=this.extractKeyTerms(s),a=r??ie(e);if(a&&a.trim().length>0&&a.length>=3){let c=a.trim();i.toLowerCase().includes(c.toLowerCase())||(i=`${c} ${i}`)}let o=[];if(!t)return o.push(i),o.push(`${i} product`),o.push(`${i} service`),o;switch(t){case"saas":case"tool":case"ux":o.push(`${i} app`),o.push(`${i} software`),o.push(`${i} tool`);break;case"game":case"mechanic":o.push(`${i} game`),o.push(`${i} gameplay`),o.push(`${i} game mechanic`);break;case"hardware":case"brand":o.push(`${i} product`),o.push(`${i} hardware`),o.push(`${i} device`);break;case"story":case"ip":o.push(`${i} book`),o.push(`${i} novel`),o.push(`${i} story`);break;default:o.push(i),o.push(`${i} product`)}return o}extractKeyTerms(e){return e.split(/\s+/).filter(r=>{let s=r.toLowerCase();return!["a","an","the","is","are","was","were","to","of","in","on","at","for","with"].includes(s)}).slice(0,5).join(" ")||e.split(/\s+/).slice(0,3).join(" ")}};function Gh(n){switch(n){case"game":case"mechanic":return"game";case"story":case"ip":return"story";case"saas":case"tool":case"ux":return"app";case"hardware":case"brand":return"product";case"personal":case"":default:return"similar"}}function mu(n,e,t){if(n.length===0)return[];let r=e??n.length,s=n.slice(0,r),i=t!==void 0?Gh(t):"product",a=i==="similar"?"Found similar:":`Found similar ${i}:`;return s.map(o=>{let c=[],l=o.title.length>100?o.title.substring(0,100)+"...":o.title;return c.push(`${a} ${l}`),c.push(`URL: ${o.url}`),o.date&&c.push(`Date: ${o.date}`),c.join(" | ")})}var hu=require("obsidian"),Vi=class extends hu.Modal{results;onAccept;onEdit;onRetry;editedTags=[];constructor(e,t,r,s,i){super(e),this.results=t,this.onAccept=r,this.onEdit=s,this.onRetry=i,this.editedTags=[...t.tags]}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-classification-results-modal"),e.createEl("h2",{text:"Classification results"});let t=e.createEl("div",{cls:"ideatr-setting-item"});t.createEl("label",{text:"Category:",attr:{for:"ideatr-category-display"}});let r=t.createEl("div",{cls:"ideatr-category",text:this.results.category||"(none)"});this.results.category||r.addClass("ideatr-empty");let s=e.createEl("div",{cls:"ideatr-setting-item"});s.createEl("label",{text:"Tags:"});let i=s.createEl("div",{cls:"ideatr-tags-list"});if(this.editedTags.forEach((m,p)=>{let y=i.createEl("div",{cls:"ideatr-tag-item"});y.createEl("input",{attr:{type:"text",value:m,placeholder:"Tag name"},cls:"ideatr-tag-input"}).addEventListener("input",A=>{let f=A.target;this.editedTags[p]=f.value.trim()}),y.createEl("button",{text:"\xD7",cls:"ideatr-remove-tag"}).addEventListener("click",()=>{this.editedTags.splice(p,1),this.renderTags(i)})}),i.createEl("button",{text:"+ add tag",cls:"ideatr-add-tag"}).addEventListener("click",()=>{this.editedTags.push(""),this.renderTags(i)}),this.results.confidence!==void 0){let m=e.createEl("div",{cls:"ideatr-setting-item"});m.createEl("label",{text:"Confidence:"}),m.createEl("div",{cls:"ideatr-confidence-bar"}).createEl("div",{cls:"ideatr-confidence-fill",attr:{style:`width: ${(this.results.confidence*100).toFixed(0)}%`}}),m.createEl("span",{cls:"ideatr-confidence-text",text:`${(this.results.confidence*100).toFixed(0)}%`})}let o=e.createEl("div",{cls:"ideatr-button-container"});o.createEl("button",{text:"Accept",cls:"mod-cta"}).addEventListener("click",()=>void this.handleAccept()),o.createEl("button",{text:"Edit in note"}).addEventListener("click",()=>void this.handleEdit()),o.createEl("button",{text:"Retry"}).addEventListener("click",()=>void this.handleRetry()),o.createEl("button",{text:"Cancel",cls:"mod-cancel"}).addEventListener("click",()=>this.close())}renderTags(e){e.empty(),this.editedTags.forEach((r,s)=>{let i=e.createEl("div",{cls:"ideatr-tag-item"});i.createEl("input",{attr:{type:"text",value:r,placeholder:"Tag name"},cls:"ideatr-tag-input"}).addEventListener("input",c=>{let l=c.target;this.editedTags[s]=l.value.trim()}),i.createEl("button",{text:"\xD7",cls:"ideatr-remove-tag"}).addEventListener("click",()=>{this.editedTags.splice(s,1),this.renderTags(e)})}),e.createEl("button",{text:"+ Add Tag",cls:"ideatr-add-tag"}).addEventListener("click",()=>{this.editedTags.push(""),this.renderTags(e)})}handleAccept(){let e=this.editedTags.filter(r=>r.trim().length>0),t={...this.results,tags:e};this.onAccept(t),this.close()}handleEdit(){this.close(),this.onEdit()}handleRetry(){this.close(),this.onRetry()}onClose(){let{contentEl:e}=this;e.empty()}};Wt();var ml=require("obsidian"),wn="ideatr-icon-purple",hl="ideatr-icon-green",fl="ideatr-icon-yellow",gl="ideatr-icon-red";function xn(n){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <image href="${n}" width="24" height="24"/>
    </svg>`}function Vh(n){switch(n){case"connected":return hl;case"loading":return fl;case"not-connected":case"error":return gl;default:return wn}}function gu(n){let e=document.createElement("span");return n&&(e.className=n),(0,ml.setIcon)(e,wn),e}function yu(n,e){let t=document.createElement("span");return e&&(t.className=e),(0,ml.setIcon)(t,Vh(n)),t}function zh(n,e){return n?n.isAvailable()?Wh(e):{status:"not-connected",modelName:"AI not available",provider:"none",details:"AI service is not configured or enabled"}:{status:"not-connected",modelName:"No AI configured",provider:"none",details:"Please configure AI in settings"}}function Wh(n){if(n.cloudProvider==="none")return{status:"not-connected",modelName:"Cloud AI not configured",provider:"cloud",details:"Please configure cloud AI in settings"};if(!(n.cloudProvider==="custom"?n.customEndpointUrl&&n.customEndpointUrl.trim().length>0:n.cloudProvider==="custom-model"?n.customModelProvider&&n.cloudApiKeys&&n.customModelProvider in n.cloudApiKeys&&(n.cloudApiKeys[n.customModelProvider]??"").trim().length>0:n.cloudApiKeys&&n.cloudProvider in n.cloudApiKeys&&(n.cloudApiKeys[n.cloudProvider]??"").trim().length>0))return{status:"not-connected",modelName:"Cloud AI not configured",provider:"cloud",details:"Please configure cloud AI in settings"};let t=n.cloudProvider;return n.cloudProvider==="openrouter"&&n.openRouterModel?t=`OpenRouter: ${n.openRouterModel}`:n.cloudProvider==="custom"&&n.customEndpointUrl?t=`Custom: ${n.customEndpointUrl}`:n.cloudProvider==="custom-model"&&n.customModelProvider&&n.customModel&&(t=`${n.customModelProvider}: ${n.customModel}`),{status:"connected",modelName:t.charAt(0).toUpperCase()+t.slice(1),provider:"cloud",details:"Cloud AI ready"}}function zi(n,e,t){let r=zh(n,e),s=document.createElement("div");s.className="ideatr-model-status-indicator";let i=yu(r.status,`ideatr-model-status-icon ideatr-model-status-${r.status}`);s.appendChild(i);let a=document.createElement("div");return a.className="ideatr-model-status-tooltip",a.textContent=`${r.modelName}${r.details?` - ${r.details}`:""}`,s.appendChild(a),s.setAttribute("title",`${r.modelName}${r.details?` - ${r.details}`:""}`),s}var U=class{ideaRepository;pathToIdCache=null;idToPathCache=null;idToTitleCache=null;constructor(e){this.ideaRepository=e}async buildCache(){if(!(this.pathToIdCache&&this.idToPathCache&&this.idToTitleCache)){this.pathToIdCache=new Map,this.idToPathCache=new Map,this.idToTitleCache=new Map;try{let e=await this.ideaRepository.getAllIdeas();for(let t of e){let r=`Ideas/${t.filename}`;if(t.frontmatter.id&&t.frontmatter.id!==0){this.pathToIdCache.set(r,t.frontmatter.id),this.idToPathCache.set(t.frontmatter.id,r);let s=t.filename.replace(/\.md$/,"");this.idToTitleCache.set(t.frontmatter.id,s)}}}catch(e){h.warn("Failed to build path-to-ID cache:",e)}}}async pathsToIds(e){await this.buildCache();let t=[];for(let r of e){let s=this.pathToIdCache?.get(r);s?t.push(s):h.warn(`Could not find ID for path: ${r}`)}return t}async idsToPaths(e){await this.buildCache();let t=[];for(let r of e){let s=this.idToPathCache?.get(r);s?t.push(s):h.warn(`Could not find path for ID: ${r}`)}return t}async idToTitle(e){return await this.buildCache(),this.idToTitleCache?.get(e)??null}async idsToTitles(e){await this.buildCache();let t=new Map;for(let r of e){let s=this.idToTitleCache?.get(r);s&&t.set(r,s)}return t}clearCache(){this.pathToIdCache=null,this.idToPathCache=null,this.idToTitleCache=null}};function bu(n){return n.split("+").map(e=>{let t=e.trim().toLowerCase();return t==="cmd"||t==="meta"?"\u2318":t==="ctrl"?"\u2303":t==="alt"?"\u2325":t==="shift"?"\u21E7":t.charAt(0).toUpperCase()+t.slice(1)}).join(" ")}function vu(n,e){let t=e.toLowerCase().split("+").map(l=>l.trim()),r=n.key.toLowerCase(),s=t.includes("cmd")||t.includes("meta"),i=t.includes("ctrl"),a=t.includes("alt"),o=t.includes("shift");if(s&&!n.metaKey||i&&!n.ctrlKey||a&&!n.altKey||o&&!n.shiftKey||!s&&n.metaKey||!i&&n.ctrlKey||!a&&n.altKey||!o&&n.shiftKey)return!1;let c=t.find(l=>!["cmd","meta","ctrl","alt","shift"].includes(l));if(c){if(c==="enter"&&r!=="enter"||c==="space"&&r!==" "||c==="escape"&&r!=="escape")return!1;if(c!=="enter"&&c!=="space"&&c!=="escape"){let l=r.toLowerCase(),d=c.toLowerCase();if(l!==d)return!1}}else return!1;return!0}var $r=class extends Fe.Modal{inputEl;errorEl;classificationEl;saveButton;ideateButton;fileManager;classificationService;duplicateDetector;webSearchService;searchQueryGenerator;nameVariantService;llmService;settings;ideaRepository;idConverter;onSuccess;isWarningShown=!1;duplicatePaths=[];classificationAbortController=null;isFirstClassification=!0;constructor(e,t,r,s,i,a,o,c,l,d,u){super(e),this.fileManager=t,this.classificationService=r,this.duplicateDetector=s,this.webSearchService=o,this.searchQueryGenerator=new Gi,this.nameVariantService=c,this.llmService=l,this.settings=i,this.ideaRepository=d,this.idConverter=new U(this.ideaRepository),this.onSuccess=u}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-capture-modal");let t=e.createDiv({cls:"ideatr-capture-title-container"});t.createEl("h2",{text:"Capture idea"});let r=zi(this.llmService,this.settings,this.app);t.appendChild(r),this.inputEl=e.createEl("textarea",{attr:{placeholder:"Type your idea here...",rows:"6"}}),this.inputEl.addClass("ideatr-input"),this.errorEl=e.createEl("div",{cls:"ideatr-error ideatr-hidden"}),this.classificationEl=e.createEl("div",{cls:"ideatr-classification ideatr-hidden"});let s=e.createEl("div",{cls:"ideatr-button-container"}),a=s.createEl("div",{cls:"ideatr-help-text"}).createEl("p",{attr:{style:"font-size: 0.85em; color: var(--text-muted); margin: 0; display: flex; align-items: center; gap: 0.4em;"}}),o=gu();o.addClass("ideatr-icon-muted"),a.appendChild(o),a.appendText(' Tip: Access other Ideatr features via Command Palette (search "Ideatr")');let c=s.createEl("div",{cls:"ideatr-button-group"});!this.settings.setupCompleted&&!this.classificationService.isAvailable()&&c.createEl("button",{text:"Classify now",cls:"mod-cta"}).addEventListener("click",()=>void this.handleClassifyNow());let l=c.createDiv({cls:"ideatr-button-with-help"}),d=this.llmService?.isAvailable()??!1;if(this.ideateButton=l.createEl("button",{text:"Ideate",cls:"mod-cta ideatr-ideate-button"}),!d)this.ideateButton.disabled=!0,this.ideateButton.addClass("ideatr-ideate-button-disabled"),this.ideateButton.setAttribute("title","Ideate (AI service not available. Please configure AI in settings.)");else{let v=bu(this.settings.captureIdeateShortcut||"cmd+enter");this.ideateButton.setAttribute("title",`Ideate (${v})`),this.ideateButton.addEventListener("click",()=>void this.handleIdeate())}let u=ue(this.app,"ideate-button","Learn about the Ideate button");l.appendChild(u);let m=c.createDiv({cls:"ideatr-button-with-help"});this.saveButton=m.createEl("button",{text:"Save",cls:"mod-cta"});let p=bu(this.settings.captureSaveShortcut||"alt+enter");this.saveButton.setAttribute("title",`Save (${p})`),this.saveButton.addEventListener("click",()=>void this.handleSubmit());let y=ue(this.app,"save-button","Learn about the Save button");m.appendChild(y),this.inputEl.focus(),this.inputEl.addEventListener("keydown",v=>{let E=this.settings.captureIdeateShortcut||"cmd+enter";if(vu(v,E)){v.preventDefault(),this.llmService?.isAvailable()&&this.ideateButton&&!this.ideateButton.disabled&&this.handleIdeate();return}let A=this.settings.captureSaveShortcut||"alt+enter";if(vu(v,A)){v.preventDefault(),this.handleSubmit();return}this.isWarningShown&&(this.hideError(),this.isWarningShown=!1,this.saveButton.setText("Save"),this.ideateButton&&(this.ideateButton.textContent="Ideate"))})}async handleClassifyNow(){let e=this.inputEl.value,t=qi(e);if(!t.valid){this.showError(t.error??"Invalid input");return}this.classificationAbortController=new AbortController,this.showClassificationInProgress(this.isFirstClassification),this.isFirstClassification=!1;try{let r=await this.classificationService.classifyIdea(t.sanitizedText??e);if(this.classificationAbortController?.signal.aborted)return;this.showClassificationResults(r,null)}catch(r){if(this.classificationAbortController?.signal.aborted)return;console.error("Classification failed:",r),this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden");let s="Classification unavailable. Please configure AI in settings.";if(r instanceof Error){let a=r.message.toLowerCase();a.includes("invalid api key")||a.includes("unauthorized")?s="Invalid API key. Please check your AI settings.":a.includes("rate limit")?s="Rate limit exceeded. Please try again later.":(a.includes("connection_refused")||a.includes("server not available"))&&(s="AI server not available. Please configure AI in settings.")}this.classificationEl.createEl("p",{text:s,cls:"ideatr-classification-error"}),this.classificationEl.createEl("button",{text:"Retry",cls:"mod-cta"}).addEventListener("click",()=>{this.handleClassifyNow()})}}async handleSubmit(){let e=this.inputEl.value,t=qi(e);if(!t.valid){this.showError(t.error??"Invalid input");return}if(!this.isWarningShown)try{let r=await this.duplicateDetector.checkDuplicate(e);if(r.isDuplicate){let s=r.duplicates.length,i=`Found ${s} similar idea${s>1?"s":""}. Press Save again to confirm.`;this.showError(i,!0),this.isWarningShown=!0,this.duplicatePaths=r.duplicates.map(a=>a.path),this.saveButton.textContent="Save anyway";return}}catch(r){h.warn("Duplicate check failed:",r)}try{let r={text:t.sanitizedText??e,timestamp:new Date},s=await this.fileManager.createIdeaFile(r);new Fe.Notice("Idea captured!"),this.close(),this.onSuccess&&this.onSuccess(),this.processBackgroundTasks(s,r.text).catch(i=>{h.warn("Background processing failed:",i)})}catch(r){this.showError("Failed to save idea. Please try again."),console.error("Error creating idea file:",r)}}async handleIdeate(){let e=this.inputEl.value,t=qi(e);if(!t.valid){this.showError(t.error??"Invalid input");return}if(!this.llmService?.isAvailable()){this.showError("AI service is not available. Please configure AI in settings.");return}if(!this.isWarningShown)try{let s=await this.duplicateDetector.checkDuplicate(e);if(s.isDuplicate){let i=s.duplicates.length,a=`Found ${i} similar idea${i>1?"s":""}. Press Ideate again to confirm.`;this.showError(a,!0),this.isWarningShown=!0,this.duplicatePaths=s.duplicates.map(o=>o.path),this.ideateButton&&(this.ideateButton.textContent="Ideate anyway");return}}catch(s){h.warn("Duplicate check failed:",s)}let r=null;try{this.showClassificationInProgress(!0),this.classificationAbortController=new AbortController;let s={text:t.sanitizedText??e,timestamp:new Date};r=await this.fileManager.createIdeaFile(s);let i=await this.classificationService.classifyIdea(s.text);if(this.classificationAbortController?.signal.aborted)return;let a="";if(this.llmService.complete)try{let d=`Generate a concise, descriptive title for this idea.

Idea: "${s.text}"

Requirements:
- 2-8 words maximum
- Descriptive and clear (captures the core concept)
- Not overly creative or abstract
- Should help someone quickly understand what this idea is about
- Extract the key concept, not just use the first words

Examples:
- "AI generated puzzle full of interlinked monkeys" \u2192 "AI Monkey Puzzle Game"
- "notification app that sends alerts" \u2192 "Notification App"
- "task manager for remote teams" \u2192 "Team Task Manager"

Title:`;a=(await this.llmService.complete(d,{temperature:.3,n_predict:50,stop:[`
`,".","!","?"]})).trim().replace(/^["']|["']$/g,"").substring(0,100)}catch(d){h.warn("Title generation failed, using fallback:",d),a=ie(s.text)}else a=ie(s.text);let o="";if(this.llmService.expandIdea)try{let d=`Expand this idea with related concepts, questions, and next steps.

Original Idea:
${s.text}

Category: ${i.category||"general"}
Tags: ${i.tags.join(", ")||"none"}

Generate a structured expansion with:

## Related Ideas
2-3 variations or related concepts that explore different angles or implementations. Each should be:
- Distinct from the original but clearly related
- Brief (1-2 sentences each)
- Practical and actionable

## Key Questions
3-4 important questions to explore. Focus on:
- Validation questions (who needs this? what problem does it solve?)
- Implementation questions (how would this work? what's needed?)
- Strategic questions (what are the risks? what's the market?)

## Next Steps
1-2 concrete, actionable next steps to move forward. Be specific and practical.

Format as markdown with the sections above. Keep it concise and actionable - each item should be brief but meaningful.

Response:`;this.llmService.complete&&(o=await this.llmService.complete(d,{temperature:.7,n_predict:800}))}catch(d){h.warn("Expansion generation failed:",d),o=""}if(this.classificationAbortController?.signal.aborted)return;let c=[...new Set([...i.related,...this.duplicatePaths])],l=await this.idConverter.pathsToIds(c);await this.fileManager.updateIdeaFrontmatter(r,{category:i.category,tags:i.tags,related:l}),await this.app.vault.process(r,d=>{let u=/^---\n[\s\S]*?\n---(\n\n?|\n?)/,m=d.match(u),p=m?d.substring(m[0].length):d,y="";return a&&(y+=`# ${a}

`),y+=p.trim(),o&&(y+=`

---

## Ideas & Questions

`+o.trim()),(m?d.substring(0,m[0].length):"")+y}),this.triggerValidation(r,s.text,i.category).catch(d=>{h.warn("Background validation failed:",d)}),new Fe.Notice("Idea processed with AI!"),this.close(),this.onSuccess&&this.onSuccess()}catch(s){if(this.classificationAbortController?.signal.aborted)return;r&&new Fe.Notice("Ideate command failed, but your idea has been saved to your list of ideas."),this.showError("Failed to process idea. Please try again."),console.error("Error processing idea:",s),this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden"),this.classificationEl.createEl("p",{text:"Processing failed. Idea may have been saved without AI processing.",cls:"ideatr-classification-error"}),this.classificationEl.createEl("button",{text:"Continue",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.onSuccess&&this.onSuccess()})}}showError(e,t=!1){this.errorEl.empty(),this.errorEl.setText(e),this.errorEl.addClass("ideatr-visible"),this.errorEl.removeClass("ideatr-hidden","ideatr-invisible"),t?(this.errorEl.addClass("ideatr-warning"),this.errorEl.removeClass("ideatr-error")):(this.errorEl.addClass("ideatr-error"),this.errorEl.removeClass("ideatr-warning"))}hideError(){this.errorEl.addClass("ideatr-hidden","ideatr-invisible"),this.errorEl.removeClass("ideatr-visible"),this.errorEl.removeClass("ideatr-warning"),this.errorEl.removeClass("ideatr-error")}showClassificationInProgress(e=!1){this.inputEl.addClass("ideatr-hidden"),this.inputEl.removeClass("ideatr-visible");let t=this.contentEl.querySelector(".ideatr-button-container");t&&(t.addClass("ideatr-hidden"),t.removeClass("ideatr-visible")),this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden");let r=e?"Loading AI model (first use)... ~10 seconds":"Classifying idea... ~2-3 seconds";this.classificationEl.createEl("p",{text:r}).addClass("ideatr-classification-status"),this.classificationEl.createEl("button",{text:"Cancel",cls:"ideatr-cancel-classification"}).addEventListener("click",()=>{this.cancelClassification()})}cancelClassification(){this.classificationAbortController&&(this.classificationAbortController.abort(),this.classificationAbortController=null),this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden"),this.classificationEl.createEl("p",{text:"Classification cancelled. Idea saved without classification.",cls:"ideatr-classification-status"}),this.classificationEl.createEl("button",{text:"Continue",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.onSuccess&&this.onSuccess()})}handleClassificationError(e,t,r){let s="Classification unavailable. Idea saved without classification.",i=!0;if(e instanceof Error){let a=e.message.toLowerCase();a.includes("connection_refused")||a.includes("server not available")?s="AI server not available. Idea saved without classification.":a.includes("invalid api key")||a.includes("unauthorized")?(s="Invalid API key. Please check your AI settings. Idea saved without classification.",i=!0):a.includes("rate limit")?s="Rate limit exceeded. Please try again later. Idea saved without classification.":a.includes("timeout")?s="Classification timed out. Idea saved without classification.":(a.includes("network")||a.includes("fetch"))&&(s="Network error. Idea saved without classification.")}this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden"),this.classificationEl.createEl("p",{text:s,cls:"ideatr-classification-error"}),i?this.classificationEl.createEl("button",{text:"Continue",cls:"mod-cta"}).addEventListener("click",()=>{this.triggerValidation(t,r,"").catch(o=>{h.warn("Background validation failed:",o)}),this.close(),this.onSuccess&&this.onSuccess()}):setTimeout(()=>{this.triggerValidation(t,r,"").catch(a=>{h.warn("Background validation failed:",a)}),this.close(),this.onSuccess&&this.onSuccess()},2e3)}showClassificationResults(e,t){let r={category:e.category,tags:e.tags},s=[...e.related],i=[...this.duplicatePaths],a=new Vi(this.app,r,o=>{(async()=>{let c=[...new Set([...s,...i])],l={category:o.category,tags:o.tags,related:c};t?await this.acceptClassification(l,t):(new Fe.Notice("Classification complete. Save the idea to apply results."),a.close())})()},()=>{(async()=>{let o=[...new Set([...s,...i])],c={category:r.category,tags:r.tags,related:o};t?await this.acceptClassification(c,t):(new Fe.Notice("Classification complete. Save the idea to apply results."),a.close())})()},()=>{(async()=>{try{let o=this.inputEl.value,c=await this.classificationService.classifyIdea(o);a.close(),this.showClassificationResults(c,t)}catch(o){console.error("Retry classification failed:",o),new Fe.Notice("Failed to retry classification. Please try again.")}})()});a.open()}async acceptClassification(e,t){if(!t)return;let r=[...new Set([...e.related,...this.duplicatePaths])],s=await this.idConverter.pathsToIds(r);await this.fileManager.updateIdeaFrontmatter(t,{category:e.category,tags:e.tags,related:s}),new Fe.Notice("Classification applied"),this.close(),this.onSuccess&&this.onSuccess()}rejectClassification(){this.close(),this.onSuccess&&this.onSuccess()}async processBackgroundTasks(e,t){let r="";if(this.settings.autoClassify&&this.classificationService.isAvailable())try{let s=await this.classificationService.classifyIdea(t);r=s.category;let i=[...new Set([...s.related,...this.duplicatePaths])],a=await this.idConverter.pathsToIds(i);await this.fileManager.updateIdeaFrontmatter(e,{category:s.category,tags:s.tags,related:a})}catch(s){h.warn("Background classification failed:",s)}await this.triggerValidation(e,t,r)}async triggerValidation(e,t,r){let s=ie(t),i=this.settings.enableWebSearch&&this.settings.autoSearchExistence,a=this.settings.enableNameVariants&&this.settings.autoGenerateVariants&&this.nameVariantService?.isAvailable();if(!i&&!a)return;let o=i?this.performWebSearch(t,r,s).catch(l=>(h.warn("Web search failed:",l),null)):Promise.resolve(null),c=a&&this.nameVariantService?this.nameVariantService.generateVariants(t).then(l=>{if(l.length>0){let d=this.nameVariantService.formatVariantsForMarkdown(l);return this.fileManager.appendToFileBody(e,"Name Variants",d)}return Promise.resolve()}).catch(l=>{h.warn("Name variant generation failed:",l)}):Promise.resolve(null);try{let[l]=await Promise.all([o,c]),d={};i&&(l===null?d["existence-check"]=["Search error: Validation failed"]:l.length>0&&(d["existence-check"]=mu(l,this.settings.maxSearchResults,r))),Object.keys(d).length>0&&await this.fileManager.updateIdeaFrontmatter(e,d)}catch(l){h.warn("Validation orchestration failed:",l);let d={};i&&(d["existence-check"]=["Search error: Validation failed"]),Object.keys(d).length>0&&this.fileManager.updateIdeaFrontmatter(e,d).catch(u=>{h.error("Failed to store validation error state:",u)})}}async performWebSearch(e,t,r){if(!this.webSearchService.isAvailable())return[];try{let s=this.searchQueryGenerator.generateQuery(e,t,r);return!s||s.trim().length===0?[]:await this.webSearchService.search(s,t,this.settings.maxSearchResults)}catch(s){return h.warn("Web search failed:",s),[]}}onClose(){let{contentEl:e}=this;e.empty()}};var Re=require("obsidian");var Pe=class extends Error{constructor(t,r){super(t);this.code=r;this.name="ManagementError"}};function En(n){switch(n){case"FILE_READ_ERROR":return"Failed to load ideas: some files could not be read. Please check your vault permissions.";case"FRONTMATTER_PARSE_ERROR":case"INVALID_FRONTMATTER":return"Some ideas have invalid frontmatter and were skipped. Check your idea metadata and try again.";case"VAULT_ACCESS_ERROR":return"Could not access the vault to load ideas. Please try again or restart Obsidian.";case"EMBEDDING_GENERATION_ERROR":case"EMBEDDING_TIMEOUT":case"EMBEDDING_UNAVAILABLE":return"Clustering is temporarily unavailable due to embedding errors. You can still use the dashboard table.";case"CLUSTERING_INSUFFICIENT_DATA":return"Not enough ideas to generate clusters yet. Capture a few more ideas and try again.";case"CLUSTERING_ALGORITHM_ERROR":return"Clustering failed due to an internal error. Try narrowing your idea set or disabling clustering in settings.";case"CLUSTERING_TOO_MANY_IDEAS":return"Too many ideas to cluster efficiently. Please filter to fewer ideas and try again.";case"VIEW_RENDERING_ERROR":case"GRAPH_RENDERING_ERROR":return"Failed to render the management view. Try closing and reopening the view.";case"VIEW_MEMORY_ERROR":return"Rendering the graph used too much memory. Try filtering to fewer ideas.";case"DIGEST_GENERATION_ERROR":return"Digest generation failed. Please try again or check your resurfacing settings.";case"DATE_PARSE_ERROR":return"Some ideas have invalid or missing created dates and were skipped. Check your idea frontmatter.";case"ELEVATION_VALIDATION_ERROR":return"Idea cannot be elevated. Please check that the idea is valid and not already elevated.";case"ELEVATION_FILE_MOVE_ERROR":return"Failed to move idea file to project folder. Please check vault permissions.";case"ELEVATION_FOLDER_CREATION_ERROR":return"Failed to create project folder structure. Please check vault permissions.";case"ELEVATION_FRONTMATTER_UPDATE_ERROR":return"Failed to update idea frontmatter during elevation. The project may have been created but metadata may be incomplete.";case"ELEVATION_PROJECT_NAME_COLLISION":return"A project with this name already exists. Please choose a different name.";default:return"An unexpected management error occurred. Please check the console for details."}}function wu(n){return n.split(",").map(e=>e.trim()).filter(e=>e.length>0)}function xu(n,e){if(!n||!e)return;let t=new Date(n),r=new Date(e);if(!(isNaN(t.getTime())||isNaN(r.getTime())))return{start:t,end:r}}function Eu(n,e,t){let r=t>0?t:n.length||1,s=Math.max(1,Math.ceil(n.length/r)),a=(Math.min(Math.max(1,e),s)-1)*r,o=a+r;return{pageItems:n.slice(a,o),totalPages:s}}function Kh(n){let e=0;for(let i=0;i<n.length;i++)e=e*31+n.charCodeAt(i)>>>0;return`hsl(${e%360}, 60%, 55%)`}function Au(n){let e=n.nodes.map(r=>({id:r.id,x:r.x,y:r.y,clusterId:r.clusterId,color:Kh(r.clusterId),title:Jh(r),idea:r.idea})),t=n.edges.map(r=>({from:r.from,to:r.to,weight:r.weight}));return{nodes:e,edges:t,width:n.width,height:n.height}}function Jh(n){let e=n.idea.filename.replace(/\.md$/,""),t=n.idea.frontmatter.category||"Uncategorized";return`${e} [${t}]`}function Wi(n,e,t={}){let{nodes:r,edges:s,width:i,height:a}=Au(e),o=e;n.empty();let c=n.createDiv({cls:"ideatr-graph-wrapper"}),l="http://www.w3.org/2000/svg",d=document.createElementNS(l,"svg");d.setAttribute("viewBox",`0 0 ${i} ${a}`),d.setAttribute("width",t.mini?"220":String(i)),d.setAttribute("height",t.mini?"180":String(a)),d.classList.add("ideatr-graph-svg"),c.appendChild(d);for(let p of s){let y=r.find(A=>A.id===p.from),v=r.find(A=>A.id===p.to);if(!y||!v)continue;let E=document.createElementNS(l,"line");E.setAttribute("x1",String(y.x)),E.setAttribute("y1",String(y.y)),E.setAttribute("x2",String(v.x)),E.setAttribute("y2",String(v.y)),E.setAttribute("stroke","var(--text-muted)"),E.setAttribute("stroke-width",String(1+p.weight)),E.setAttribute("stroke-opacity","0.4"),d.appendChild(E)}let u=document.createElement("div");u.classList.add("ideatr-graph-tooltip"),u.setCssProps({display:"none",position:"absolute","pointer-events":"none","z-index":"1000"}),c.appendChild(u);let m=null;for(let p of r){let y=document.createElementNS(l,"g");y.setAttribute("transform",`translate(${p.x}, ${p.y})`),y.classList.add("ideatr-graph-node");let v=document.createElementNS(l,"circle");if(v.setAttribute("r",t.mini?"8":"10"),v.setAttribute("fill",p.color),v.setAttribute("stroke","var(--background-primary-alt)"),v.setAttribute("stroke-width","1"),y.appendChild(v),!t.mini){let E=document.createElementNS(l,"text");E.textContent=p.title,E.setAttribute("x","12"),E.setAttribute("y","4"),E.classList.add("ideatr-graph-label"),y.appendChild(E)}if(t.onNodeClick&&(y.classList.add("ideatr-graph-node-clickable"),y.addEventListener("click",()=>{t.onNodeClick?.(p.id)})),t.onNodeContextMenu&&y.addEventListener("contextmenu",E=>{E.preventDefault(),t.onNodeContextMenu?.(p.id,E)}),t.onNodeHover&&p.idea){let E=o.nodes.find(A=>A.id===p.id);y.addEventListener("mouseenter",A=>{m=p.id,E&&t.onNodeHover?.(E),u.setCssProps({display:"block"}),Xh(u,p.idea),Iu(u,A,c)}),y.addEventListener("mousemove",A=>{m===p.id&&Iu(u,A,c)}),y.addEventListener("mouseleave",()=>{m=null,u.setCssProps({display:"none"}),t.onNodeHover?.(null)})}d.appendChild(y)}}function Xh(n,e){let t=e.filename.replace(/\.md$/,""),r=e.frontmatter.category||"Uncategorized",s=e.frontmatter.tags.length>0?e.frontmatter.tags.join(", "):"No tags",i=e.body.length>150?e.body.substring(0,150)+"...":e.body,a=e.frontmatter.created;n.empty(),n.createDiv("ideatr-tooltip-header").createEl("strong",{text:t});let c=n.createDiv("ideatr-tooltip-meta");c.createEl("span",{text:`Category: ${r}`}),c.createEl("span",{text:`Created: ${a}`});let l=n.createDiv("ideatr-tooltip-tags");l.textContent=`Tags: ${s}`;let d=n.createDiv("ideatr-tooltip-preview");d.textContent=i||"(No content)"}function Iu(n,e,t){let r=t.getBoundingClientRect(),s=n.getBoundingClientRect(),i=e.clientX-r.left+15,a=e.clientY-r.top-10,o=r.width-s.width-10,c=r.height-s.height-10;n.setCssProps({left:`${Math.min(i,o)}px`,top:`${Math.max(10,Math.min(a,c))}px`})}Wt();var Su=require("obsidian"),yl=class extends Su.Modal{message;resolve;constructor(e,t,r){super(e),this.message=t,this.resolve=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Confirm"}),e.createEl("p",{text:this.message});let t=e.createDiv({cls:"modal-button-container"}),r=t.createEl("button",{text:"Confirm",cls:"mod-cta"});r.onclick=()=>{this.resolve(!0),this.close()};let s=t.createEl("button",{text:"Cancel"});s.onclick=()=>{this.resolve(!1),this.close()}}onClose(){let{contentEl:e}=this;e.empty(),this.resolve(!1)}};async function mt(n,e){return new Promise(t=>{new yl(n,e,t).open()})}var Ki=class extends Re.ItemView{ideaRepository;clusteringService;resurfacingService;projectElevationService;ideas=[];filteredIdeas=[];filters={};sortColumn=null;sortDirection="asc";isLoading=!1;currentPage=1;itemsPerPage;persistFilters;constructor(e,t,r,s,i,a=50,o=!1){super(e),this.ideaRepository=t,this.clusteringService=r,this.resurfacingService=s,this.projectElevationService=i,this.itemsPerPage=a,this.persistFilters=o}getViewType(){return"ideatr-dashboard"}getDisplayText(){return"Ideatr dashboard"}getIcon(){return"lightbulb"}async onOpen(){let e=this.contentEl;e.empty(),this.persistFilters&&this.loadFilterState();let t=e.createDiv("dashboard-header"),r=t.createDiv({cls:"dashboard-title-container"});r.createEl("h2",{text:"Ideatr dashboard"});let s=ue(this.app,"dashboard","Learn about the Dashboard");r.appendChild(s),t.createDiv("dashboard-toolbar").createEl("button",{text:"Refresh"}).addEventListener("click",()=>void this.refresh());let o=e.createDiv("dashboard-filters"),c=o.createDiv({cls:"dashboard-filters-title"});c.createEl("h3",{text:"Filters"});let l=ue(this.app,"filters","Learn about Dashboard Filters");c.appendChild(l),this.createFilterUI(o);let d=e.createDiv("dashboard-side-panels");if(this.clusteringService){let v=d.createDiv("dashboard-panel clusters-panel"),E=v.createDiv({cls:"dashboard-panel-title"});E.createEl("h3",{text:"Clusters"});let A=ue(this.app,"clusters","Learn about Clusters");E.appendChild(A),this.renderClustersMiniGraph(v)}if(this.resurfacingService){let v=d.createDiv("dashboard-panel resurfacing-panel"),E=v.createDiv({cls:"dashboard-panel-title"});E.createEl("h3",{text:"Old ideas"});let A=ue(this.app,"resurfacing","Learn about Resurfacing");E.appendChild(A),this.renderResurfacingPanel(v)}let u=d.createDiv("dashboard-panel triage-panel"),m=u.createDiv({cls:"dashboard-panel-title"});m.createEl("h3",{text:"Triage inbox"});let p=ue(this.app,"triage-inbox","Learn about Triage Inbox");m.appendChild(p),this.renderTriageInbox(u);let y=e.createDiv("dashboard-table-container");this.renderTable(y),await this.loadIdeas()}async onClose(){}createFilterUI(e){let t=e.createDiv("filter-item");t.createEl("label",{text:"Search:",attr:{for:"dashboard-search"}});let r=t.createEl("input",{type:"text",attr:{id:"dashboard-search"},placeholder:"Search ideas..."});r.addEventListener("input",f=>{let S=f.target.value;this.filters.searchText=S||void 0,this.applyFilters()});let s=e.createDiv("filter-item");s.createEl("label",{text:"Category:"});let i=s.createEl("input",{type:"text",placeholder:"Filter by category (comma-separated)..."});i.addEventListener("input",f=>{let P=f.target.value.split(",").map(k=>k.trim()).filter(k=>k.length>0);this.filters.categories=P.length>0?P:void 0,this.applyFilters()});let a=e.createDiv("filter-item");a.createEl("label",{text:"Tags:"});let o=a.createEl("input",{type:"text",placeholder:"Filter by tags (comma-separated)..."});o.addEventListener("input",f=>{let S=f.target.value,P=wu(S);this.filters.tags=P.length>0?P:void 0,this.applyFilters()});let c=e.createDiv("filter-item");c.createEl("label",{text:"Status:"});let l=c.createEl("input",{type:"text",placeholder:"Filter by status..."});l.addEventListener("input",f=>{let S=f.target.value.trim();this.filters.status=S||void 0,this.applyFilters()});let d=e.createDiv("filter-item date-range");d.createEl("label",{text:"Created between:"});let u=d.createEl("input",{type:"date"}),m=d.createEl("input",{type:"date"}),p=()=>{this.filters.dateRange=xu(u.value||void 0,m.value||void 0),this.applyFilters()};u.addEventListener("change",p),m.addEventListener("change",p);let v=e.createDiv("filter-item").createEl("label"),E=v.createEl("input",{type:"checkbox"});v.appendText(" Show only uncategorized ideas"),E.addEventListener("change",f=>{let S=f.target.checked;this.filters.uncategorized=S||void 0,this.applyFilters()}),e.createEl("button",{text:"Clear filters"}).addEventListener("click",()=>{this.filters={},r.value="",i.value="",o.value="",l.value="",u.value="",m.value="",E.checked=!1,this.applyFilters()}),this.persistFilters&&this.restoreFilterUIValues(r,i,o,l,u,m,E)}restoreFilterUIValues(e,t,r,s,i,a,o){this.filters.searchText&&(e.value=this.filters.searchText),this.filters.categories&&this.filters.categories.length>0&&(t.value=this.filters.categories.join(", ")),this.filters.tags&&this.filters.tags.length>0&&(r.value=this.filters.tags.join(", ")),this.filters.status&&(s.value=this.filters.status),this.filters.dateRange&&(i.value=this.filters.dateRange.start.toISOString().split("T")[0],a.value=this.filters.dateRange.end.toISOString().split("T")[0]),this.filters.uncategorized&&(o.checked=!0)}renderTable(e){if(e.empty(),this.isLoading){e.createEl("div",{text:"Loading ideas..."});return}if(this.filteredIdeas.length===0){e.createEl("div",{text:"No ideas found."});return}let t=e.createEl("table",{cls:"dashboard-table"}),s=t.createEl("thead").createEl("tr");this.createTableHeader(s,"Date","created"),this.createTableHeader(s,"Category","category"),this.createTableHeader(s,"Tags","tags"),this.createTableHeader(s,"Status","status"),this.createTableHeader(s,"Title","title"),this.projectElevationService&&s.createEl("th",{text:"Actions"});let i=t.createEl("tbody"),{pageItems:a,totalPages:o}=Eu(this.filteredIdeas,this.currentPage,this.itemsPerPage);for(let d of a){let u=i.createEl("tr");u.addEventListener("click",()=>void this.openIdea(d));let m=u.createEl("td");m.textContent=d.frontmatter.created;let p=u.createEl("td");p.textContent=d.frontmatter.category??"Uncategorized";let y=u.createEl("td");y.textContent=d.frontmatter.tags.join(", ")||"";let v=u.createEl("td");v.textContent=d.frontmatter.status;let E=u.createEl("td"),A=d.body.substring(0,50);if(E.textContent=A||d.filename,d.body.length>50&&(E.textContent+="..."),this.projectElevationService){let f=u.createEl("td",{cls:"actions-cell"});this.projectElevationService.canElevate(d)?f.createEl("button",{text:"Elevate",cls:"elevate-btn"}).addEventListener("click",P=>{P.stopPropagation(),this.elevateIdea(d)}):f.textContent="-"}}let c=e.createDiv("dashboard-pagination");c.createSpan({text:`Page ${this.currentPage} of ${o}`});let l=(d,u)=>{let m=c.createEl("button",{text:d});return m.addEventListener("click",()=>{let p=this.currentPage+u,y=Math.min(Math.max(1,p),o);y!==this.currentPage&&(this.currentPage=y,this.renderTable(e))}),m};l("Prev",-1),l("Next",1)}createTableHeader(e,t,r){let s=e.createEl("th");s.textContent=t,s.addClass("ideatr-cursor-pointer"),s.addEventListener("click",()=>this.sortBy(r)),this.sortColumn===r&&(s.textContent+=this.sortDirection==="asc"?" \u2191":" \u2193")}sortBy(e){this.sortColumn===e?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=e,this.sortDirection="asc"),this.filteredIdeas.sort((t,r)=>{let s,i;switch(e){case"created":s=new Date(t.frontmatter.created).getTime(),i=new Date(r.frontmatter.created).getTime();break;case"category":s=t.frontmatter.category??"",i=r.frontmatter.category??"";break;case"status":s=t.frontmatter.status,i=r.frontmatter.status;break;case"title":s=t.body??t.filename,i=r.body??r.filename;break;default:return 0}return s<i?this.sortDirection==="asc"?-1:1:s>i?this.sortDirection==="asc"?1:-1:0}),this.renderTable(this.contentEl.querySelector(".dashboard-table-container"))}async loadIdeas(){this.isLoading=!0,this.renderTable(this.contentEl.querySelector(".dashboard-table-container"));try{if(this.ideas=await this.ideaRepository.getAllIdeas(),this.applyFilters(),this.clusteringService){let t=this.contentEl.querySelector(".clusters-panel");t&&this.renderClustersMiniGraph(t)}if(this.resurfacingService){let t=this.contentEl.querySelector(".resurfacing-panel");t&&this.renderResurfacingPanel(t)}let e=this.contentEl.querySelector(".triage-panel");e&&this.renderTriageInbox(e)}catch(e){console.error("Failed to load ideas:",e);let t=this.contentEl.querySelector(".dashboard-table-container");t.empty();let r="Failed to load ideas. Please try again.";e instanceof Pe&&(r=En(e.code),new Re.Notice(r)),t.createEl("div",{text:r})}finally{this.isLoading=!1}}async applyFilters(){try{this.filteredIdeas=await this.ideaRepository.getIdeasByFilter(this.filters),this.currentPage=1,this.renderTable(this.contentEl.querySelector(".dashboard-table-container")),this.persistFilters&&await this.saveFilterState()}catch(e){console.error("Failed to apply filters:",e);let t=this.contentEl.querySelector(".dashboard-table-container");t.empty();let r="Failed to apply dashboard filters.";e instanceof Pe&&(r=En(e.code),new Re.Notice(r)),t.createEl("div",{text:r})}}loadFilterState(){try{let e=this.leaf.getViewState();e.state?.filters&&(this.filters=e.state.filters)}catch(e){h.warn("Failed to load persisted filter state:",e)}}async saveFilterState(){try{await this.leaf.setViewState({type:"ideatr-dashboard",state:{filters:this.filters}})}catch(e){h.warn("Failed to save filter state:",e)}}async refresh(){await this.ideaRepository.refresh(),await this.loadIdeas()}openIdea(e){this.app.vault.getAbstractFileByPath(`Ideas/${e.filename}`)&&this.app.workspace.openLinkText(`Ideas/${e.filename}`,"",!1)}async renderClustersMiniGraph(e){e.empty(),e.createEl("div",{text:"Loading clusters...",cls:"loading"});try{if(this.ideas.length<2){e.empty(),e.createEl("div",{text:"Need at least 2 ideas for clustering."});return}let t=await this.clusteringService.clusterIdeas(this.ideas),r=this.app,s=r.plugins?r.plugins.getPlugin("ideatr")?.graphLayoutService?.layoutGraph(t,220,180):void 0;if(e.empty(),e.createEl("div",{text:`${t.length} clusters found`,cls:"cluster-summary"}),s){let a=e.createDiv("clusters-mini-graph");Wi(a,s,{mini:!0,onNodeClick:o=>{let c=s.nodes.find(l=>l.id===o);c&&this.openIdea(c.idea)},onNodeHover:o=>{}})}e.createEl("button",{text:"Open full graph"}).addEventListener("click",()=>{this.app.workspace.getLeaf(!1).setViewState({type:"ideatr-graph",active:!0})})}catch(t){console.error("Failed to load clusters:",t),e.empty(),e.createEl("div",{text:"Failed to load clusters."})}}async renderResurfacingPanel(e){e.empty(),e.createEl("div",{text:"Loading old ideas...",cls:"loading"});try{let t=await this.resurfacingService.identifyOldIdeas();if(e.empty(),t.length===0){e.createEl("div",{text:"No old ideas found."});return}e.createEl("div",{text:`${t.length} old ideas need attention`,cls:"resurfacing-summary"});let r=e.createEl("ul",{cls:"resurfacing-list"});for(let i of t.slice(0,5)){let a=r.createEl("li"),o=this.calculateAge(i.frontmatter.created);a.textContent=`${i.filename.replace(".md","")} (${o} days old)`,a.addClass("ideatr-cursor-pointer"),a.addEventListener("click",()=>void this.openIdea(i))}t.length>5&&r.createEl("li",{text:`... and ${t.length-5} more`}),e.createEl("button",{text:"Generate digest"}).addEventListener("click",()=>{(async()=>{try{let i=await this.resurfacingService.generateDigest(),a=`Ideas/.ideatr-digest-${Date.now()}.md`;await this.app.vault.create(a,i.summary),this.app.vault.getAbstractFileByPath(a)&&await this.app.workspace.openLinkText(a,"",!1)}catch(i){console.error("Failed to generate digest:",i)}})()})}catch(t){console.error("Failed to load resurfacing panel:",t),e.empty(),e.createEl("div",{text:"Failed to load old ideas."})}}renderTriageInbox(e){e.empty();let t=this.filteredIdeas.filter(s=>!s.frontmatter.category||s.frontmatter.category==="");if(t.length===0){e.createEl("div",{text:"All ideas are categorized!"});return}e.createEl("div",{text:`${t.length} uncategorized ideas`,cls:"triage-summary"});let r=e.createEl("ul",{cls:"triage-list"});for(let s of t.slice(0,10)){let i=r.createEl("li");i.textContent=s.filename.replace(".md",""),i.addClass("ideatr-cursor-pointer"),i.addEventListener("click",()=>void this.openIdea(s))}t.length>10&&r.createEl("li",{text:`... and ${t.length-10} more`})}calculateAge(e){try{let t=new Date(e),s=Math.abs(new Date().getTime()-t.getTime());return Math.ceil(s/(1e3*60*60*24))}catch{return 0}}async elevateIdea(e){if(!this.projectElevationService){new Re.Notice("Elevation service not available.");return}if(!this.projectElevationService.canElevate(e)){new Re.Notice("This idea cannot be elevated. It may already be elevated or have invalid frontmatter.");return}let t=this.projectElevationService.generateProjectName(e);if(await mt(this.app,`Elevate idea to project?

Project name: ${t}

The idea file will be moved to Projects/${t}/README.md
Original file will be deleted.`))try{new Re.Notice("Elevating idea to project...");let s=await this.projectElevationService.elevateIdea(e);s.success?(new Re.Notice(`Idea elevated to project: ${s.projectPath}`),await this.ideaRepository.refresh(),await this.loadIdeas(),s.warnings&&s.warnings.length>0&&h.warn("Elevation warnings:",s.warnings)):(new Re.Notice(`Failed to elevate idea: ${s.error??"Unknown error"}`),s.warnings&&s.warnings.length>0&&h.warn("Elevation warnings:",s.warnings))}catch(s){console.error("Failed to elevate idea:",s),new Re.Notice("Failed to elevate idea. Please try again.")}}};var Oe=require("obsidian");Wt();var Ji=class extends Oe.ItemView{clusteringService;graphLayoutService;ideaRepository;projectElevationService;ideas=[];isLoading=!1;currentLayout=null;constructor(e,t,r,s,i){super(e),this.clusteringService=t,this.graphLayoutService=r,this.ideaRepository=s,this.projectElevationService=i}getViewType(){return"ideatr-graph"}getDisplayText(){return"Ideatr graph"}getIcon(){return"git-branch"}async onOpen(){let e=this.contentEl;e.empty();let t=e.createDiv("graph-header"),r=t.createDiv({cls:"graph-title-container"});r.createEl("h2",{text:"Idea clusters"});let s=ue(this.app,"graph-view","Learn about Graph View");r.appendChild(s),t.createDiv("graph-toolbar").createEl("button",{text:"Refresh"}).addEventListener("click",()=>void this.refresh());let o=e.createDiv("graph-container");this.renderGraph(o),await this.loadGraph()}async onClose(){}renderGraph(e){if(e.empty(),this.isLoading){e.createEl("div",{text:"Generating clusters..."});return}if(this.ideas.length===0){e.createEl("div",{text:"No ideas found."});return}if(this.ideas.length<2){e.createEl("div",{text:"Need at least 2 ideas to create clusters."});return}}async loadGraph(){this.isLoading=!0;let e=this.contentEl.querySelector(".graph-container");this.renderGraph(e);try{if(this.ideas=await this.ideaRepository.getAllIdeas(),this.ideas.length>=2){let t=await this.clusteringService.clusterIdeas(this.ideas),r=this.graphLayoutService.layoutGraph(t,800,600);this.currentLayout=r,Wi(e,r,{onNodeClick:s=>{let i=r.nodes.find(a=>a.id===s);i&&this.openIdea(i.idea)},onNodeHover:s=>{},onNodeContextMenu:(s,i)=>{this.showNodeContextMenu(s,i)},mini:!1})}else this.renderGraph(e)}catch(t){console.error("Failed to load graph:",t),e.empty();let r="Failed to load graph. Please try again.";t instanceof Pe&&(r=En(t.code),new Oe.Notice(r)),e.createEl("div",{text:r})}finally{this.isLoading=!1}}async refresh(){await this.ideaRepository.refresh(),await this.loadGraph()}openIdea(e){this.app.vault.getAbstractFileByPath(`Ideas/${e.filename}`)&&this.app.workspace.openLinkText(`Ideas/${e.filename}`,"",!1)}showNodeContextMenu(e,t){if(!this.currentLayout)return;let r=this.currentLayout.nodes.find(c=>c.id===e);if(!r)return;let s=document.querySelector(".ideatr-graph-context-menu");s&&s.remove();let i=document.createElement("div");i.classList.add("ideatr-graph-context-menu"),i.setCssProps({left:`${t.clientX}px`,top:`${t.clientY}px`}),i.createEl("button",{text:"Open idea",cls:"context-menu-item"}).addEventListener("click",()=>{this.openIdea(r.idea),i.remove()}),this.projectElevationService?.canElevate(r.idea)&&i.createEl("button",{text:"Elevate to project",cls:"context-menu-item"}).addEventListener("click",()=>{this.elevateIdea(r.idea),i.remove()}),document.body.appendChild(i);let o=c=>{i.contains(c.target)||(i.remove(),document.removeEventListener("click",o))};setTimeout(()=>{document.addEventListener("click",o)},0)}async elevateIdea(e){if(!this.projectElevationService){new Oe.Notice("Elevation service not available.");return}if(!this.projectElevationService.canElevate(e)){new Oe.Notice("This idea cannot be elevated. It may already be elevated or have invalid frontmatter.");return}let t=this.projectElevationService.generateProjectName(e);if(await mt(this.app,`Elevate idea to project?

Project name: ${t}

The idea file will be moved to Projects/${t}/README.md
Original file will be deleted.`))try{new Oe.Notice("Elevating idea to project...");let s=await this.projectElevationService.elevateIdea(e);s.success?(new Oe.Notice(`Idea elevated to project: ${s.projectPath}`),await this.ideaRepository.refresh(),await this.loadGraph(),s.warnings&&s.warnings.length>0&&h.warn("Elevation warnings:",s.warnings)):(new Oe.Notice(`Failed to elevate idea: ${s.error??"Unknown error"}`),s.warnings&&s.warnings.length>0&&h.warn("Elevation warnings:",s.warnings))}catch(s){console.error("Failed to elevate idea:",s),new Oe.Notice("Failed to elevate idea. Please try again.")}}};var Gt=require("obsidian");var _u=require("obsidian");var J=class{constructor(e,t,r){this.app=e;this.plugin=t;this.settingsTab=r}settingsTab;async saveSettings(){await this.plugin.saveSettings()}refresh(){this.settingsTab?.display&&this.settingsTab.display()}};var Br=require("obsidian"),Ur=class extends Br.Modal{settings;onComplete;constructor(e,t,r,s){super(e),this.settings=r,this.onComplete=s}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-setup-modal"),e.createEl("h2",{text:"Manage AI models"}),e.createEl("p",{text:"Choose how you want to use AI for idea enhancement:",cls:"ideatr-setup-description"});let t=e.createEl("div",{cls:"ideatr-setup-option"});t.createEl("h3",{text:"Use my API key"}),t.createEl("p",{text:"Use a cloud AI provider (Anthropic, OpenAI, etc.) for better quality and faster responses."});let r=t.createEl("ul",{cls:"ideatr-setup-features"});r.createEl("li",{text:"\u2705 better quality results"}),r.createEl("li",{text:"\u2705 faster responses"}),r.createEl("li",{text:"\u2705 no local storage needed"}),r.createEl("li",{text:"\u26A0\uFE0F requires API key (paid)"}),t.createEl("button",{text:"Enter API key",cls:"mod-cta"}).addEventListener("click",()=>void this.handleApiKeyOption());let i=e.createEl("div",{cls:"ideatr-setup-option"});i.createEl("h3",{text:"Skip for now"}),i.createEl("p",{text:"Continue without AI. You can set up AI later in settings."}),i.createEl("button",{text:"Skip setup",cls:"mod-cancel"}).addEventListener("click",()=>void this.handleSkipOption())}handleApiKeyOption(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-setup-modal"),e.createEl("h2",{text:"Enter API key"}),e.createEl("p",{text:"Enter your API key for a cloud AI provider. You can configure this later in settings.",cls:"ideatr-setup-description"});let t=e.createEl("div",{cls:"ideatr-setting-item"});t.createEl("label",{text:"Provider:",attr:{for:"ideatr-provider-select"}});let r=t.createEl("select",{attr:{id:"ideatr-provider-select"}});r.createEl("option",{text:"Anthropic (Claude)",attr:{value:"anthropic"}}),r.createEl("option",{text:"OpenAI (GPT)",attr:{value:"openai"}}),r.createEl("option",{text:"Skip for now",attr:{value:"none"}});let s=e.createEl("div",{cls:"ideatr-setting-item"});s.createEl("label",{text:"API key:",attr:{for:"ideatr-api-key-input"}});let i=s.createEl("input",{attr:{id:"ideatr-api-key-input",type:"password",placeholder:"Enter your API key"}});e.createEl("p",{text:"Note: API keys are stored in plain text in Obsidian settings. Keep your vault secure.",cls:"ideatr-help-text"});let a=e.createEl("div",{cls:"ideatr-button-container"});a.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",()=>{let d=r.value,u=i.value;if(d==="none"){this.handleSkipOption();return}if(!u.trim()){new Br.Notice("Please enter an API key");return}this.handleApiKeySubmit(u,d)}),a.createEl("button",{text:"Back"}).addEventListener("click",()=>{this.onOpen()}),a.createEl("button",{text:"Cancel",cls:"mod-cancel"}).addEventListener("click",()=>{this.handleSkipOption()})}handleApiKeySubmit(e,t){this.settings.cloudApiKeys||(this.settings.cloudApiKeys={anthropic:"",openai:"",gemini:"",groq:"",openrouter:""}),this.settings.cloudApiKeys[t]=e,this.settings.cloudProvider=t,this.settings.preferCloud=!0,this.settings.llmProvider=t,this.settings.setupCompleted=!0,new Br.Notice("API key saved. Cloud AI setup complete!"),this.onComplete(),this.close()}handleSkipOption(){this.settings.setupCompleted=!0,this.settings.llmProvider="none",this.onComplete(),this.close(),new Br.Notice("Setup skipped. You can configure AI later in settings.")}onClose(){let{contentEl:e}=this;e.empty()}};function Cu(n){let e=n.cloudApiKeys&&Object.values(n.cloudApiKeys).some(r=>r&&r.length>0),t=n.cloudApiKey&&n.cloudApiKey.length>0;return!n.setupCompleted&&!e&&!t}Wt();var Xi=class extends J{display(e){let t=e.createDiv({cls:"settings-section-title"});t.createEl("h2",{text:"AI configuration"});let r=ue(this.app,"getting-started","Learn about AI configuration");t.appendChild(r),new _u.Setting(e).setName("Manage ai models").setDesc("Configure cloud ai providers (Anthropic, OpenAI, etc.)").addButton(s=>s.setButtonText("Manage ai models").setCta().onClick(()=>{new Ur(this.app,null,this.plugin.settings,()=>{(async()=>(await this.saveSettings(),this.refresh()))()}).open()}))}};var ee=require("obsidian");function _(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t}function b(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}var bl=function(){let{crypto:n}=globalThis;if(n?.randomUUID)return bl=n.randomUUID.bind(n),n.randomUUID();let e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function Qe(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}var An=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){let e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};var R=class extends Error{},ae=class n extends R{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.requestID=s?.get("request-id"),this.error=t}static makeMessage(e,t,r){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new ht({message:r,cause:An(t)});let i=t;return e===400?new Hr(e,i,r,s):e===401?new qr(e,i,r,s):e===403?new Gr(e,i,r,s):e===404?new Vr(e,i,r,s):e===409?new zr(e,i,r,s):e===422?new Wr(e,i,r,s):e===429?new Kr(e,i,r,s):e>=500?new Jr(e,i,r,s):new n(e,i,r,s)}},pe=class extends ae{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},ht=class extends ae{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},jr=class extends ht{constructor({message:e}={}){super({message:e??"Request timed out."})}},Hr=class extends ae{},qr=class extends ae{},Gr=class extends ae{},Vr=class extends ae{},zr=class extends ae{},Wr=class extends ae{},Kr=class extends ae{},Jr=class extends ae{};var Yh=/^[a-z][a-z0-9+.-]*:/i,Pu=n=>Yh.test(n),vl=n=>(vl=Array.isArray,vl(n)),wl=vl;function Qi(n){return typeof n!="object"?{}:n??{}}function Ru(n){if(!n)return!0;for(let e in n)return!1;return!0}function Tu(n,e){return Object.prototype.hasOwnProperty.call(n,e)}var ku=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new R(`${n} must be an integer`);if(e<0)throw new R(`${n} must be a positive integer`);return e};var Yi=n=>{try{return JSON.parse(n)}catch{return}};var Mu=n=>new Promise(e=>setTimeout(e,n));var ft="0.71.0";var Nu=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Zh(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var ef=()=>{let n=Zh();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":Fu(Deno.build.os),"X-Stainless-Arch":Lu(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":Fu(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Lu(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=tf();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function tf(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}var Lu=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Fu=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),Ou,Du=()=>Ou??(Ou=ef());function $u(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function xl(...n){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function Zi(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return xl({start(){},async pull(t){let{done:r,value:s}=await e.next();r?t.close():t.enqueue(s)},async cancel(){await e.return?.()}})}function In(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Bu(n){if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await n[Symbol.asyncIterator]().return?.();return}let e=n.getReader(),t=e.cancel();e.releaseLock(),await t}var Uu=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function qu(n){let e=0;for(let s of n)e+=s.length;let t=new Uint8Array(e),r=0;for(let s of n)t.set(s,r),r+=s.length;return t}var ju;function Sn(n){let e;return(ju??(e=new globalThis.TextEncoder,ju=e.encode.bind(e)))(n)}var Hu;function El(n){let e;return(Hu??(e=new globalThis.TextDecoder,Hu=e.decode.bind(e)))(n)}var ye,be,Ye=class{constructor(){ye.set(this,void 0),be.set(this,void 0),_(this,ye,new Uint8Array,"f"),_(this,be,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Sn(e):e;_(this,ye,qu([b(this,ye,"f"),t]),"f");let r=[],s;for(;(s=nf(b(this,ye,"f"),b(this,be,"f")))!=null;){if(s.carriage&&b(this,be,"f")==null){_(this,be,s.index,"f");continue}if(b(this,be,"f")!=null&&(s.index!==b(this,be,"f")+1||s.carriage)){r.push(El(b(this,ye,"f").subarray(0,b(this,be,"f")-1))),_(this,ye,b(this,ye,"f").subarray(b(this,be,"f")),"f"),_(this,be,null,"f");continue}let i=b(this,be,"f")!==null?s.preceding-1:s.preceding,a=El(b(this,ye,"f").subarray(0,i));r.push(a),_(this,ye,b(this,ye,"f").subarray(s.index),"f"),_(this,be,null,"f")}return r}flush(){return b(this,ye,"f").length?this.decode(`
`):[]}};ye=new WeakMap,be=new WeakMap;Ye.NEWLINE_CHARS=new Set([`
`,"\r"]);Ye.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function nf(n,e){for(let s=e??0;s<n.length;s++){if(n[s]===10)return{preceding:s,index:s+1,carriage:!1};if(n[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Gu(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}var ta={off:0,error:200,warn:300,info:400,debug:500},Al=(n,e,t)=>{if(n){if(Tu(ta,n))return n;oe(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(ta))}`)}};function Cn(){}function ea(n,e,t){return!e||ta[n]>ta[t]?Cn:e[n].bind(e)}var af={error:Cn,warn:Cn,info:Cn,debug:Cn},Vu=new WeakMap;function oe(n){let e=n.logger,t=n.logLevel??"off";if(!e)return af;let r=Vu.get(e);if(r&&r[0]===t)return r[1];let s={error:ea("error",e,t),warn:ea("warn",e,t),info:ea("info",e,t),debug:ea("debug",e,t)};return Vu.set(e,[t,s]),s}var Ze=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var _n,Ne=class n{constructor(e,t,r){this.iterator=e,_n.set(this,void 0),this.controller=t,_(this,_n,r,"f")}static fromSSEResponse(e,t,r){let s=!1,i=r?oe(r):console;async function*a(){if(s)throw new R("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(let c of of(e,t)){if(c.event==="completion")try{yield JSON.parse(c.data)}catch(l){throw i.error("Could not parse message into JSON:",c.data),i.error("From chunk:",c.raw),l}if(c.event==="message_start"||c.event==="message_delta"||c.event==="message_stop"||c.event==="content_block_start"||c.event==="content_block_delta"||c.event==="content_block_stop")try{yield JSON.parse(c.data)}catch(l){throw i.error("Could not parse message into JSON:",c.data),i.error("From chunk:",c.raw),l}if(c.event!=="ping"&&c.event==="error")throw new ae(void 0,Yi(c.data)??c.data,void 0,e.headers)}o=!0}catch(c){if(Qe(c))return;throw c}finally{o||t.abort()}}return new n(a,t,r)}static fromReadableStream(e,t,r){let s=!1;async function*i(){let o=new Ye,c=In(e);for await(let l of c)for(let d of o.decode(l))yield d;for(let l of o.flush())yield l}async function*a(){if(s)throw new R("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(let c of i())o||c&&(yield JSON.parse(c));o=!0}catch(c){if(Qe(c))return;throw c}finally{o||t.abort()}}return new n(a,t,r)}[(_n=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){let a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new n(()=>s(e),this.controller,b(this,_n,"f")),new n(()=>s(t),this.controller,b(this,_n,"f"))]}toReadableStream(){let e=this,t;return xl({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{let{value:s,done:i}=await t.next();if(i)return r.close();let a=Sn(JSON.stringify(s)+`
`);r.enqueue(a)}catch(s){r.error(s)}},async cancel(){await t.return?.()}})}};async function*of(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new R("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new R("Attempted to iterate over a response with no body");let t=new Il,r=new Ye,s=In(n.body);for await(let i of cf(s))for(let a of r.decode(i)){let o=t.decode(a);o&&(yield o)}for(let i of r.flush()){let a=t.decode(i);a&&(yield a)}}async function*cf(n){let e=new Uint8Array;for await(let t of n){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Sn(t):t,s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=Gu(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var Il=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=lf(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function lf(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function ra(n,e){let{response:t,requestLogID:r,retryOfRequestLogID:s,startTime:i}=e,a=await(async()=>{if(e.options.stream)return oe(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):Ne.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let c=t.headers.get("content-type")?.split(";")[0]?.trim();if(c?.includes("application/json")||c?.endsWith("+json")){let u=await t.json();return Sl(u,t)}return await t.text()})();return oe(n).debug(`[${r}] response parsed`,Ze({retryOfRequestLogID:s,url:t.url,status:t.status,body:a,durationMs:Date.now()-i})),a}function Sl(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var Pn,Kt=class n extends Promise{constructor(e,t,r=ra){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=r,Pn.set(this,void 0),_(this,Pn,e,"f")}_thenUnwrap(e){return new n(b(this,Pn,"f"),this.responsePromise,async(t,r)=>Sl(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(b(this,Pn,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Pn=new WeakMap;var sa,na=class{constructor(e,t,r,s){sa.set(this,void 0),_(this,sa,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new R("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await b(this,sa,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(sa=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Rn=class extends Kt{constructor(e,t,r){super(e,t,async(s,i)=>new r(s,i.response,await ra(s,i),i.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Se=class extends na{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let t=this.first_id;return t?{...this.options,query:{...Qi(this.options.query),before_id:t}}:null}let e=this.last_id;return e?{...this.options,query:{...Qi(this.options.query),after_id:e}}:null}};var Xr=class extends na{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.next_page=r.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...Qi(this.options.query),page:e}}:null}};var _l=()=>{if(typeof File>"u"){let{process:n}=globalThis,e=typeof n?.versions?.node=="string"&&parseInt(n.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Jt(n,e,t){return _l(),new File(n,e??"unknown_file",t)}function Tn(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}var Pl=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";var Qr=async(n,e)=>({...n,body:await pf(n.body,e)}),zu=new WeakMap;function uf(n){let e=typeof n=="function"?n:n.fetch,t=zu.get(e);if(t)return t;let r=(async()=>{try{let s="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new s(i).text()}catch{return!0}})();return zu.set(e,r),r}var pf=async(n,e)=>{if(!await uf(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(n||{}).map(([r,s])=>Cl(t,r,s))),t},mf=n=>n instanceof Blob&&"name"in n;var Cl=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response){let r={},s=t.headers.get("Content-Type");s&&(r={type:s}),n.append(e,Jt([await t.blob()],Tn(t),r))}else if(Pl(t))n.append(e,Jt([await new Response(Zi(t)).blob()],Tn(t)));else if(mf(t))n.append(e,Jt([t],Tn(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(r=>Cl(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Cl(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Wu=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",hf=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Wu(n),ff=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function ia(n,e,t){if(_l(),n=await n,e||(e=Tn(n)),hf(n))return n instanceof File&&e==null&&t==null?n:Jt([await n.arrayBuffer()],e??n.name,{type:n.type,lastModified:n.lastModified,...t});if(ff(n)){let s=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),Jt(await Rl(s),e,t)}let r=await Rl(n);if(!t?.type){let s=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof s=="string"&&(t={...t,type:s})}return Jt(r,e,t)}async function Rl(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Wu(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(Pl(n))for await(let t of n)e.push(...await Rl(t));else{let t=n?.constructor?.name;throw new Error(`Unexpected data type: ${typeof n}${t?`; constructor: ${t}`:""}${gf(n)}`)}return e}function gf(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}var V=class{constructor(e){this._client=e}};var Ku=Symbol.for("brand.privateNullableHeaders");function*bf(n){if(!n)return;if(Ku in n){let{values:r,nulls:s}=n;yield*r.entries();for(let i of s)yield[i,null];return}let e=!1,t;n instanceof Headers?t=n.entries():wl(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let r of t){let s=r[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");let i=wl(r[1])?r[1]:[r[1]],a=!1;for(let o of i)o!==void 0&&(e&&!a&&(a=!0,yield[s,null]),yield[s,o])}}var L=n=>{let e=new Headers,t=new Set;for(let r of n){let s=new Set;for(let[i,a]of bf(r)){let o=i.toLowerCase();s.has(o)||(e.delete(i),s.add(o)),a===null?(e.delete(i),t.add(o)):(e.append(i,a),t.delete(o))}}return{[Ku]:!0,values:e,nulls:t}};function Xu(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Ju=Object.freeze(Object.create(null)),vf=(n=Xu)=>function(t,...r){if(t.length===1)return t[0];let s=!1,i=[],a=t.reduce((d,u,m)=>{/[?#]/.test(u)&&(s=!0);let p=r[m],y=(s?encodeURIComponent:n)(""+p);return m!==r.length&&(p==null||typeof p=="object"&&p.toString===Object.getPrototypeOf(Object.getPrototypeOf(p.hasOwnProperty??Ju)??Ju)?.toString)&&(y=p+"",i.push({start:d.length+u.length,length:y.length,error:`Value of type ${Object.prototype.toString.call(p).slice(8,-1)} is not a valid path parameter`})),d+u+(m===r.length?"":y)},""),o=a.split(/[?#]/,1)[0],c=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,l;for(;(l=c.exec(o))!==null;)i.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(i.sort((d,u)=>d.start-u.start),i.length>0){let d=0,u=i.reduce((m,p)=>{let y=" ".repeat(p.start-d),v="^".repeat(p.length);return d=p.start+p.length,m+y+v},"");throw new R(`Path parameters result in path with invalid segments:
${i.map(m=>m.error).join(`
`)}
${a}
${u}`)}return a},z=vf(Xu);var Yr=class extends V{list(e={},t){let{betas:r,...s}=e??{};return this._client.getAPIList("/v1/files",Se,{query:s,...t,headers:L([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},r){let{betas:s}=t??{};return this._client.delete(z`/v1/files/${e}`,{...r,headers:L([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},r?.headers])})}download(e,t={},r){let{betas:s}=t??{};return this._client.get(z`/v1/files/${e}/content`,{...r,headers:L([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},r){let{betas:s}=t??{};return this._client.get(z`/v1/files/${e}`,{...r,headers:L([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},r?.headers])})}upload(e,t){let{betas:r,...s}=e;return this._client.post("/v1/files",Qr({body:s,...t,headers:L([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}};var Zr=class extends V{retrieve(e,t={},r){let{betas:s}=t??{};return this._client.get(z`/v1/models/${e}?beta=true`,{...r,headers:L([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},r?.headers])})}list(e={},t){let{betas:r,...s}=e??{};return this._client.getAPIList("/v1/models?beta=true",Se,{query:s,...t,headers:L([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},t?.headers])})}};var aa={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function Tl(n,e){return!e||!("parse"in(e.output_format??{}))?{...n,content:n.content.map(t=>t.type==="text"?{...t,parsed:null}:t),parsed_output:null}:kl(n,e)}function kl(n,e){let t=null,r=n.content.map(s=>{if(s.type==="text"){let i=Ef(e,s.text);return t===null&&(t=i),{...s,parsed:i}}return s});return{...n,content:r,parsed_output:t}}function Ef(n,e){if(n.output_format?.type!=="json_schema")return null;try{return"parse"in n.output_format?n.output_format.parse(e):JSON.parse(e)}catch(t){throw new R(`Failed to parse structured output: ${t}`)}}var Af=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",c=!1;for(r=n[++e];r!=='"';){if(e===n.length){c=!0;break}if(r==="\\"){if(e++,e===n.length){c=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],c||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&i.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(r&&a.test(r)){let o="";for(;r&&a.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},es=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),es(n);break;case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),es(n);case"string":let r=n[n.length-2];if(r?.type==="delimiter")return n=n.slice(0,n.length-1),es(n);if(r?.type==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),es(n);break;case"delimiter":return n=n.slice(0,n.length-1),es(n);break}return n},If=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},Sf=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},oa=n=>JSON.parse(Sf(If(es(Af(n)))));var Ce,gt,ts,kn,ca,Mn,Ln,la,Fn,et,On,da,ua,rs,pa,ma,Ml,Qu,ha,Ll,Fl,Ol,Yu,Zu="__json_buf";function ep(n){return n.type==="tool_use"||n.type==="server_tool_use"||n.type==="mcp_tool_use"}var fa=class n{constructor(e){Ce.add(this),this.messages=[],this.receivedMessages=[],gt.set(this,void 0),ts.set(this,null),this.controller=new AbortController,kn.set(this,void 0),ca.set(this,()=>{}),Mn.set(this,()=>{}),Ln.set(this,void 0),la.set(this,()=>{}),Fn.set(this,()=>{}),et.set(this,{}),On.set(this,!1),da.set(this,!1),ua.set(this,!1),rs.set(this,!1),pa.set(this,void 0),ma.set(this,void 0),ha.set(this,t=>{if(_(this,da,!0,"f"),Qe(t)&&(t=new pe),t instanceof pe)return _(this,ua,!0,"f"),this._emit("abort",t);if(t instanceof R)return this._emit("error",t);if(t instanceof Error){let r=new R(t.message);return r.cause=t,this._emit("error",r)}return this._emit("error",new R(String(t)))}),_(this,kn,new Promise((t,r)=>{_(this,ca,t,"f"),_(this,Mn,r,"f")}),"f"),_(this,Ln,new Promise((t,r)=>{_(this,la,t,"f"),_(this,Fn,r,"f")}),"f"),b(this,kn,"f").catch(()=>{}),b(this,Ln,"f").catch(()=>{}),_(this,ts,e,"f")}get response(){return b(this,pa,"f")}get request_id(){return b(this,ma,"f")}async withResponse(){let e=await b(this,kn,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let s=new n(t);for(let i of t.messages)s._addMessageParam(i);return _(s,ts,{...t,stream:!0},"f"),s._run(()=>s._createMessage(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},b(this,ha,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){let s=r?.signal,i;s&&(s.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),s.addEventListener("abort",i));try{b(this,Ce,"m",Ll).call(this);let{response:a,data:o}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(a);for await(let c of o)b(this,Ce,"m",Fl).call(this,c);if(o.controller.signal?.aborted)throw new pe;b(this,Ce,"m",Ol).call(this)}finally{s&&i&&s.removeEventListener("abort",i)}}_connected(e){this.ended||(_(this,pa,e,"f"),_(this,ma,e?.headers.get("request-id"),"f"),b(this,ca,"f").call(this,e),this._emit("connect"))}get ended(){return b(this,On,"f")}get errored(){return b(this,da,"f")}get aborted(){return b(this,ua,"f")}abort(){this.controller.abort()}on(e,t){return(b(this,et,"f")[e]||(b(this,et,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=b(this,et,"f")[e];if(!r)return this;let s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(b(this,et,"f")[e]||(b(this,et,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{_(this,rs,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){_(this,rs,!0,"f"),await b(this,Ln,"f")}get currentMessage(){return b(this,gt,"f")}async finalMessage(){return await this.done(),b(this,Ce,"m",Ml).call(this)}async finalText(){return await this.done(),b(this,Ce,"m",Qu).call(this)}_emit(e,...t){if(b(this,On,"f"))return;e==="end"&&(_(this,On,!0,"f"),b(this,la,"f").call(this));let r=b(this,et,"f")[e];if(r&&(b(this,et,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!b(this,rs,"f")&&!r?.length&&Promise.reject(s),b(this,Mn,"f").call(this,s),b(this,Fn,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!b(this,rs,"f")&&!r?.length&&Promise.reject(s),b(this,Mn,"f").call(this,s),b(this,Fn,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",b(this,Ce,"m",Ml).call(this))}async _fromReadableStream(e,t){let r=t?.signal,s;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{b(this,Ce,"m",Ll).call(this),this._connected(null);let i=Ne.fromReadableStream(e,this.controller);for await(let a of i)b(this,Ce,"m",Fl).call(this,a);if(i.controller.signal?.aborted)throw new pe;b(this,Ce,"m",Ol).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(gt=new WeakMap,ts=new WeakMap,kn=new WeakMap,ca=new WeakMap,Mn=new WeakMap,Ln=new WeakMap,la=new WeakMap,Fn=new WeakMap,et=new WeakMap,On=new WeakMap,da=new WeakMap,ua=new WeakMap,rs=new WeakMap,pa=new WeakMap,ma=new WeakMap,ha=new WeakMap,Ce=new WeakSet,Ml=function(){if(this.receivedMessages.length===0)throw new R("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Qu=function(){if(this.receivedMessages.length===0)throw new R("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new R("stream ended without producing a content block with type=text");return t.join(" ")},Ll=function(){this.ended||_(this,gt,void 0,"f")},Fl=function(t){if(this.ended)return;let r=b(this,Ce,"m",Yu).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{let s=r.content.at(-1);switch(t.delta.type){case"text_delta":{s.type==="text"&&this._emit("text",t.delta.text,s.text||"");break}case"citations_delta":{s.type==="text"&&this._emit("citation",t.delta.citation,s.citations??[]);break}case"input_json_delta":{ep(s)&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"thinking_delta":{s.type==="thinking"&&this._emit("thinking",t.delta.thinking,s.thinking);break}case"signature_delta":{s.type==="thinking"&&this._emit("signature",s.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(Tl(r,b(this,ts,"f")),!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{_(this,gt,r,"f");break}case"content_block_start":case"message_delta":break}},Ol=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");let t=b(this,gt,"f");if(!t)throw new R("request ended without sending any chunks");return _(this,gt,void 0,"f"),Tl(t,b(this,ts,"f"))},Yu=function(t){let r=b(this,gt,"f");if(t.type==="message_start"){if(r)throw new R(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new R(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.container=t.delta.container,r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r.context_management=t.context_management,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{let s=r.content.at(t.index);switch(t.delta.type){case"text_delta":{s?.type==="text"&&(r.content[t.index]={...s,text:(s.text||"")+t.delta.text});break}case"citations_delta":{s?.type==="text"&&(r.content[t.index]={...s,citations:[...s.citations??[],t.delta.citation]});break}case"input_json_delta":{if(s&&ep(s)){let i=s[Zu]||"";i+=t.delta.partial_json;let a={...s};if(Object.defineProperty(a,Zu,{value:i,enumerable:!1,writable:!0}),i)try{a.input=oa(i)}catch(o){let c=new R(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${o}. JSON: ${i}`);b(this,ha,"f").call(this,c)}r.content[t.index]=a}break}case"thinking_delta":{s?.type==="thinking"&&(r.content[t.index]={...s,thinking:s.thinking+t.delta.thinking});break}case"signature_delta":{s?.type==="thinking"&&(r.content[t.index]={...s,signature:t.delta.signature});break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ne(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var tp=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but complete\u2014err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;var Nn,ss,Xt,te,Dn,ve,tt,yt,$n,rp,Nl;function sp(){let n,e;return{promise:new Promise((r,s)=>{n=r,e=s}),resolve:n,reject:e}}var ns=class{constructor(e,t,r){Nn.add(this),this.client=e,ss.set(this,!1),Xt.set(this,!1),te.set(this,void 0),Dn.set(this,void 0),ve.set(this,void 0),tt.set(this,void 0),yt.set(this,void 0),$n.set(this,0),_(this,te,{params:{...t,messages:structuredClone(t.messages)}},"f"),_(this,Dn,{...r,headers:L([{"x-stainless-helper":"BetaToolRunner"},r?.headers])},"f"),_(this,yt,sp(),"f")}async*[(ss=new WeakMap,Xt=new WeakMap,te=new WeakMap,Dn=new WeakMap,ve=new WeakMap,tt=new WeakMap,yt=new WeakMap,$n=new WeakMap,Nn=new WeakSet,rp=async function(){let t=b(this,te,"f").params.compactionControl;if(!t||!t.enabled)return!1;let r=0;if(b(this,ve,"f")!==void 0)try{let l=await b(this,ve,"f");r=l.usage.input_tokens+(l.usage.cache_creation_input_tokens??0)+(l.usage.cache_read_input_tokens??0)+l.usage.output_tokens}catch{return!1}let s=t.contextTokenThreshold??1e5;if(r<s)return!1;let i=t.model??b(this,te,"f").params.model,a=t.summaryPrompt??tp,o=b(this,te,"f").params.messages;if(o[o.length-1].role==="assistant"){let l=o[o.length-1];if(Array.isArray(l.content)){let d=l.content.filter(u=>u.type!=="tool_use");d.length===0?o.pop():l.content=d}}let c=await this.client.beta.messages.create({model:i,messages:[...o,{role:"user",content:[{type:"text",text:a}]}],max_tokens:b(this,te,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(c.content[0]?.type!=="text")throw new R("Expected text response for compaction");return b(this,te,"f").params.messages=[{role:"user",content:c.content}],!0},Symbol.asyncIterator)](){var e;if(b(this,ss,"f"))throw new R("Cannot iterate over a consumed stream");_(this,ss,!0,"f"),_(this,Xt,!0,"f"),_(this,tt,void 0,"f");try{for(;;){let t;try{if(b(this,te,"f").params.max_iterations&&b(this,$n,"f")>=b(this,te,"f").params.max_iterations)break;_(this,Xt,!1,"f"),_(this,tt,void 0,"f"),_(this,$n,(e=b(this,$n,"f"),e++,e),"f"),_(this,ve,void 0,"f");let{max_iterations:r,compactionControl:s,...i}=b(this,te,"f").params;if(i.stream?(t=this.client.beta.messages.stream({...i},b(this,Dn,"f")),_(this,ve,t.finalMessage(),"f"),b(this,ve,"f").catch(()=>{}),yield t):(_(this,ve,this.client.beta.messages.create({...i,stream:!1},b(this,Dn,"f")),"f"),yield b(this,ve,"f")),!await b(this,Nn,"m",rp).call(this)){if(!b(this,Xt,"f")){let{role:c,content:l}=await b(this,ve,"f");b(this,te,"f").params.messages.push({role:c,content:l})}let o=await b(this,Nn,"m",Nl).call(this,b(this,te,"f").params.messages.at(-1));if(o)b(this,te,"f").params.messages.push(o);else if(!b(this,Xt,"f"))break}}finally{t&&t.abort()}}if(!b(this,ve,"f"))throw new R("ToolRunner concluded without a message from the server");b(this,yt,"f").resolve(await b(this,ve,"f"))}catch(t){throw _(this,ss,!1,"f"),b(this,yt,"f").promise.catch(()=>{}),b(this,yt,"f").reject(t),_(this,yt,sp(),"f"),t}}setMessagesParams(e){typeof e=="function"?b(this,te,"f").params=e(b(this,te,"f").params):b(this,te,"f").params=e,_(this,Xt,!0,"f"),_(this,tt,void 0,"f")}async generateToolResponse(){let e=await b(this,ve,"f")??this.params.messages.at(-1);return e?b(this,Nn,"m",Nl).call(this,e):null}done(){return b(this,yt,"f").promise}async runUntilDone(){if(!b(this,ss,"f"))for await(let e of this);return this.done()}get params(){return b(this,te,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}};Nl=async function(e){return b(this,tt,"f")!==void 0?b(this,tt,"f"):(_(this,tt,_f(b(this,te,"f").params,e),"f"),b(this,tt,"f"))};async function _f(n,e=n.messages.at(-1)){if(!e||e.role!=="assistant"||!e.content||typeof e.content=="string")return null;let t=e.content.filter(s=>s.type==="tool_use");return t.length===0?null:{role:"user",content:await Promise.all(t.map(async s=>{let i=n.tools.find(a=>("name"in a?a.name:a.mcp_server_name)===s.name);if(!i||!("run"in i))return{type:"tool_result",tool_use_id:s.id,content:`Error: Tool '${s.name}' not found`,is_error:!0};try{let a=s.input;"parse"in i&&i.parse&&(a=i.parse(a));let o=await i.run(a);return{type:"tool_result",tool_use_id:s.id,content:o}}catch(a){return{type:"tool_result",tool_use_id:s.id,content:`Error: ${a instanceof Error?a.message:String(a)}`,is_error:!0}}}))}}var is=class n{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){let e=new Ye;for await(let t of this.iterator)for(let r of e.decode(t))yield JSON.parse(r);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new R("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new R("Attempted to iterate over a response with no body");return new n(In(e.body),t)}};var as=class extends V{create(e,t){let{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:L([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},r){let{betas:s}=t??{};return this._client.get(z`/v1/messages/batches/${e}?beta=true`,{...r,headers:L([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},r?.headers])})}list(e={},t){let{betas:r,...s}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",Se,{query:s,...t,headers:L([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},r){let{betas:s}=t??{};return this._client.delete(z`/v1/messages/batches/${e}?beta=true`,{...r,headers:L([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},r?.headers])})}cancel(e,t={},r){let{betas:s}=t??{};return this._client.post(z`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:L([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},r?.headers])})}async results(e,t={},r){let s=await this.retrieve(e);if(!s.results_url)throw new R(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);let{betas:i}=t??{};return this._client.get(s.results_url,{...r,headers:L([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},r?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((a,o)=>is.fromResponse(o.response,o.controller))}};var np={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"},bt=class extends V{constructor(){super(...arguments),this.batches=new as(this._client)}create(e,t){let{betas:r,...s}=e;s.model in np&&console.warn(`The model '${s.model}' is deprecated and will reach end-of-life on ${np[s.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let i=this._client._options.timeout;if(!s.stream&&i==null){let a=aa[s.model]??void 0;i=this._client.calculateNonstreamingTimeout(s.max_tokens,a)}return this._client.post("/v1/messages?beta=true",{body:s,timeout:i??6e5,...t,headers:L([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:L([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-11-13"].toString()},t?.headers])},this.create(e,t).then(r=>kl(r,e))}stream(e,t){return fa.createMessage(this,e,t)}countTokens(e,t){let{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:L([{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new ns(this._client,e,t)}};bt.Batches=as;bt.BetaToolRunner=ns;var os=class extends V{create(e,t={},r){let{betas:s,...i}=t??{};return this._client.post(z`/v1/skills/${e}/versions?beta=true`,Qr({body:i,...r,headers:L([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},r?.headers])},this._client))}retrieve(e,t,r){let{skill_id:s,betas:i}=t;return this._client.get(z`/v1/skills/${s}/versions/${e}?beta=true`,{...r,headers:L([{"anthropic-beta":[...i??[],"skills-2025-10-02"].toString()},r?.headers])})}list(e,t={},r){let{betas:s,...i}=t??{};return this._client.getAPIList(z`/v1/skills/${e}/versions?beta=true`,Xr,{query:i,...r,headers:L([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},r?.headers])})}delete(e,t,r){let{skill_id:s,betas:i}=t;return this._client.delete(z`/v1/skills/${s}/versions/${e}?beta=true`,{...r,headers:L([{"anthropic-beta":[...i??[],"skills-2025-10-02"].toString()},r?.headers])})}};var Qt=class extends V{constructor(){super(...arguments),this.versions=new os(this._client)}create(e={},t){let{betas:r,...s}=e??{};return this._client.post("/v1/skills?beta=true",Qr({body:s,...t,headers:L([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},t?.headers])},this._client))}retrieve(e,t={},r){let{betas:s}=t??{};return this._client.get(z`/v1/skills/${e}?beta=true`,{...r,headers:L([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},r?.headers])})}list(e={},t){let{betas:r,...s}=e??{};return this._client.getAPIList("/v1/skills?beta=true",Xr,{query:s,...t,headers:L([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},t?.headers])})}delete(e,t={},r){let{betas:s}=t??{};return this._client.delete(z`/v1/skills/${e}?beta=true`,{...r,headers:L([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},r?.headers])})}};Qt.Versions=os;var Te=class extends V{constructor(){super(...arguments),this.models=new Zr(this._client),this.messages=new bt(this._client),this.files=new Yr(this._client),this.skills=new Qt(this._client)}};Te.Models=Zr;Te.Messages=bt;Te.Files=Yr;Te.Skills=Qt;var Yt=class extends V{create(e,t){let{betas:r,...s}=e;return this._client.post("/v1/complete",{body:s,timeout:this._client._options.timeout??6e5,...t,headers:L([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}};var _e,vt,Bn,ga,Un,jn,ya,Hn,rt,qn,ba,va,cs,wa,xa,Dl,ip,$l,Bl,Ul,jl,ap,op="__json_buf";function cp(n){return n.type==="tool_use"||n.type==="server_tool_use"}var Ea=class n{constructor(){_e.add(this),this.messages=[],this.receivedMessages=[],vt.set(this,void 0),this.controller=new AbortController,Bn.set(this,void 0),ga.set(this,()=>{}),Un.set(this,()=>{}),jn.set(this,void 0),ya.set(this,()=>{}),Hn.set(this,()=>{}),rt.set(this,{}),qn.set(this,!1),ba.set(this,!1),va.set(this,!1),cs.set(this,!1),wa.set(this,void 0),xa.set(this,void 0),$l.set(this,e=>{if(_(this,ba,!0,"f"),Qe(e)&&(e=new pe),e instanceof pe)return _(this,va,!0,"f"),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){let t=new R(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new R(String(e)))}),_(this,Bn,new Promise((e,t)=>{_(this,ga,e,"f"),_(this,Un,t,"f")}),"f"),_(this,jn,new Promise((e,t)=>{_(this,ya,e,"f"),_(this,Hn,t,"f")}),"f"),b(this,Bn,"f").catch(()=>{}),b(this,jn,"f").catch(()=>{})}get response(){return b(this,wa,"f")}get request_id(){return b(this,xa,"f")}async withResponse(){let e=await b(this,Bn,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new n;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let s=new n;for(let i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},b(this,$l,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){let s=r?.signal,i;s&&(s.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),s.addEventListener("abort",i));try{b(this,_e,"m",Bl).call(this);let{response:a,data:o}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(a);for await(let c of o)b(this,_e,"m",Ul).call(this,c);if(o.controller.signal?.aborted)throw new pe;b(this,_e,"m",jl).call(this)}finally{s&&i&&s.removeEventListener("abort",i)}}_connected(e){this.ended||(_(this,wa,e,"f"),_(this,xa,e?.headers.get("request-id"),"f"),b(this,ga,"f").call(this,e),this._emit("connect"))}get ended(){return b(this,qn,"f")}get errored(){return b(this,ba,"f")}get aborted(){return b(this,va,"f")}abort(){this.controller.abort()}on(e,t){return(b(this,rt,"f")[e]||(b(this,rt,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=b(this,rt,"f")[e];if(!r)return this;let s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(b(this,rt,"f")[e]||(b(this,rt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{_(this,cs,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){_(this,cs,!0,"f"),await b(this,jn,"f")}get currentMessage(){return b(this,vt,"f")}async finalMessage(){return await this.done(),b(this,_e,"m",Dl).call(this)}async finalText(){return await this.done(),b(this,_e,"m",ip).call(this)}_emit(e,...t){if(b(this,qn,"f"))return;e==="end"&&(_(this,qn,!0,"f"),b(this,ya,"f").call(this));let r=b(this,rt,"f")[e];if(r&&(b(this,rt,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!b(this,cs,"f")&&!r?.length&&Promise.reject(s),b(this,Un,"f").call(this,s),b(this,Hn,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!b(this,cs,"f")&&!r?.length&&Promise.reject(s),b(this,Un,"f").call(this,s),b(this,Hn,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",b(this,_e,"m",Dl).call(this))}async _fromReadableStream(e,t){let r=t?.signal,s;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{b(this,_e,"m",Bl).call(this),this._connected(null);let i=Ne.fromReadableStream(e,this.controller);for await(let a of i)b(this,_e,"m",Ul).call(this,a);if(i.controller.signal?.aborted)throw new pe;b(this,_e,"m",jl).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(vt=new WeakMap,Bn=new WeakMap,ga=new WeakMap,Un=new WeakMap,jn=new WeakMap,ya=new WeakMap,Hn=new WeakMap,rt=new WeakMap,qn=new WeakMap,ba=new WeakMap,va=new WeakMap,cs=new WeakMap,wa=new WeakMap,xa=new WeakMap,$l=new WeakMap,_e=new WeakSet,Dl=function(){if(this.receivedMessages.length===0)throw new R("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},ip=function(){if(this.receivedMessages.length===0)throw new R("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new R("stream ended without producing a content block with type=text");return t.join(" ")},Bl=function(){this.ended||_(this,vt,void 0,"f")},Ul=function(t){if(this.ended)return;let r=b(this,_e,"m",ap).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{let s=r.content.at(-1);switch(t.delta.type){case"text_delta":{s.type==="text"&&this._emit("text",t.delta.text,s.text||"");break}case"citations_delta":{s.type==="text"&&this._emit("citation",t.delta.citation,s.citations??[]);break}case"input_json_delta":{cp(s)&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"thinking_delta":{s.type==="thinking"&&this._emit("thinking",t.delta.thinking,s.thinking);break}case"signature_delta":{s.type==="thinking"&&this._emit("signature",s.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{_(this,vt,r,"f");break}case"content_block_start":case"message_delta":break}},jl=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");let t=b(this,vt,"f");if(!t)throw new R("request ended without sending any chunks");return _(this,vt,void 0,"f"),t},ap=function(t){let r=b(this,vt,"f");if(t.type==="message_start"){if(r)throw new R(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new R(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push({...t.content_block}),r;case"content_block_delta":{let s=r.content.at(t.index);switch(t.delta.type){case"text_delta":{s?.type==="text"&&(r.content[t.index]={...s,text:(s.text||"")+t.delta.text});break}case"citations_delta":{s?.type==="text"&&(r.content[t.index]={...s,citations:[...s.citations??[],t.delta.citation]});break}case"input_json_delta":{if(s&&cp(s)){let i=s[op]||"";i+=t.delta.partial_json;let a={...s};Object.defineProperty(a,op,{value:i,enumerable:!1,writable:!0}),i&&(a.input=oa(i)),r.content[t.index]=a}break}case"thinking_delta":{s?.type==="thinking"&&(r.content[t.index]={...s,thinking:s.thinking+t.delta.thinking});break}case"signature_delta":{s?.type==="thinking"&&(r.content[t.index]={...s,signature:t.delta.signature});break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ne(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var ls=class extends V{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(z`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",Se,{query:e,...t})}delete(e,t){return this._client.delete(z`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(z`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let r=await this.retrieve(e);if(!r.results_url)throw new R(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,headers:L([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((s,i)=>is.fromResponse(i.response,i.controller))}};var wt=class extends V{constructor(){super(...arguments),this.batches=new ls(this._client)}create(e,t){e.model in lp&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${lp[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let r=this._client._options.timeout;if(!e.stream&&r==null){let s=aa[e.model]??void 0;r=this._client.calculateNonstreamingTimeout(e.max_tokens,s)}return this._client.post("/v1/messages",{body:e,timeout:r??6e5,...t,stream:e.stream??!1})}stream(e,t){return Ea.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}},lp={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};wt.Batches=ls;var Zt=class extends V{retrieve(e,t={},r){let{betas:s}=t??{};return this._client.get(z`/v1/models/${e}`,{...r,headers:L([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},r?.headers])})}list(e={},t){let{betas:r,...s}=e??{};return this._client.getAPIList("/v1/models",Se,{query:s,...t,headers:L([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},t?.headers])})}};var Gn=n=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[n]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(n)?.trim()};var Hl,ql,Aa,dp,up="\\n\\nHuman:",pp="\\n\\nAssistant:",K=class{constructor({baseURL:e=Gn("ANTHROPIC_BASE_URL"),apiKey:t=Gn("ANTHROPIC_API_KEY")??null,authToken:r=Gn("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){Hl.add(this),Aa.set(this,void 0);let i={apiKey:t,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&Nu())throw new R(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=i.baseURL,this.timeout=i.timeout??ql.DEFAULT_TIMEOUT,this.logger=i.logger??console;let a="warn";this.logLevel=a,this.logLevel=Al(i.logLevel,"ClientOptions.logLevel",this)??Al(Gn("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??a,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??$u(),_(this,Aa,Uu,"f"),this._options=i,this.apiKey=typeof t=="string"?t:null,this.authToken=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization"))&&!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return L([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(this.apiKey!=null)return L([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(this.authToken!=null)return L([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new R(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${ft}`}defaultIdempotencyKey(){return`stainless-node-retry-${bl()}`}makeStatusError(e,t,r,s){return ae.generate(e,t,r,s)}buildURL(e,t,r){let s=!b(this,Hl,"m",dp).call(this)&&r||this.baseURL,i=Pu(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return Ru(a)||(t={...a,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new R("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new Kt(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let s=await e,i=s.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(s);let{req:a,url:o,timeout:c}=await this.buildRequest(s,{retryCount:i-t});await this.prepareRequest(a,{url:o,options:s});let l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,u=Date.now();if(oe(this).debug(`[${l}] sending request`,Ze({retryOfRequestLogID:r,method:s.method,url:o,options:s,headers:a.headers})),s.signal?.aborted)throw new pe;let m=new AbortController,p=await this.fetchWithTimeout(o,a,c,m).catch(An),y=Date.now();if(p instanceof globalThis.Error){let A=`retrying, ${t} attempts remaining`;if(s.signal?.aborted)throw new pe;let f=Qe(p)||/timed? ?out/i.test(String(p)+("cause"in p?String(p.cause):""));if(t)return oe(this).info(`[${l}] connection ${f?"timed out":"failed"} - ${A}`),oe(this).debug(`[${l}] connection ${f?"timed out":"failed"} (${A})`,Ze({retryOfRequestLogID:r,url:o,durationMs:y-u,message:p.message})),this.retryRequest(s,t,r??l);throw oe(this).info(`[${l}] connection ${f?"timed out":"failed"} - error; no more retries left`),oe(this).debug(`[${l}] connection ${f?"timed out":"failed"} (error; no more retries left)`,Ze({retryOfRequestLogID:r,url:o,durationMs:y-u,message:p.message})),f?new jr:new ht({cause:p})}let v=[...p.headers.entries()].filter(([A])=>A==="request-id").map(([A,f])=>", "+A+": "+JSON.stringify(f)).join(""),E=`[${l}${d}${v}] ${a.method} ${o} ${p.ok?"succeeded":"failed"} with status ${p.status} in ${y-u}ms`;if(!p.ok){let A=await this.shouldRetry(p);if(t&&A){let F=`retrying, ${t} attempts remaining`;return await Bu(p.body),oe(this).info(`${E} - ${F}`),oe(this).debug(`[${l}] response error (${F})`,Ze({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:y-u})),this.retryRequest(s,t,r??l,p.headers)}let f=A?"error; no more retries left":"error; not retryable";oe(this).info(`${E} - ${f}`);let S=await p.text().catch(F=>An(F).message),P=Yi(S),k=P?void 0:S;throw oe(this).debug(`[${l}] response error (${f})`,Ze({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,message:k,durationMs:Date.now()-u})),this.makeStatusError(p.status,P,k,p.headers)}return oe(this).info(E),oe(this).debug(`[${l}] response start`,Ze({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:y-u})),{response:p,options:s,controller:m,requestLogID:l,retryOfRequestLogID:r,startTime:u}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){let r=this.makeRequest(t,null,void 0);return new Rn(this,r,e)}async fetchWithTimeout(e,t,r,s){let{signal:i,method:a,...o}=t||{};i&&i.addEventListener("abort",()=>s.abort());let c=setTimeout(()=>s.abort(),r),l=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,d={signal:s.signal,...l?{duplex:"half"}:{},method:"GET",...o};a&&(d.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,s){let i,a=s?.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(i=c)}let o=s?.get("retry-after");if(o&&!i){let c=parseFloat(o);Number.isNaN(c)?i=Date.parse(o)-Date.now():i=c*1e3}if(!(i&&0<=i&&i<60*1e3)){let c=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,c)}return await Mu(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new R("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:s,path:i,query:a,defaultBaseURL:o}=r,c=this.buildURL(i,a,o);"timeout"in r&&ku("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:d}=this.buildBody({options:r}),u=await this.buildHeaders({options:e,method:s,bodyHeaders:l,retryCount:t});return{req:{method:s,headers:u,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"},...d&&{body:d},...this.fetchOptions??{},...r.fetchOptions??{}},url:c,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:s}){let i={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let a=L([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Du(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=L([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Zi(e)}:b(this,Aa,"f").call(this,{body:e,headers:r})}};ql=K,Aa=new WeakMap,Hl=new WeakSet,dp=function(){return this.baseURL!=="https://api.anthropic.com"};K.Anthropic=ql;K.HUMAN_PROMPT=up;K.AI_PROMPT=pp;K.DEFAULT_TIMEOUT=6e5;K.AnthropicError=R;K.APIError=ae;K.APIConnectionError=ht;K.APIConnectionTimeoutError=jr;K.APIUserAbortError=pe;K.NotFoundError=Vr;K.ConflictError=zr;K.RateLimitError=Kr;K.BadRequestError=Hr;K.AuthenticationError=qr;K.InternalServerError=Jr;K.PermissionDeniedError=Gr;K.UnprocessableEntityError=Wr;K.toFile=ia;var De=class extends K{constructor(){super(...arguments),this.completions=new Yt(this),this.messages=new wt(this),this.models=new Zt(this),this.beta=new Te(this)}};De.Completions=Yt;De.Messages=wt;De.Models=Zt;De.Beta=Te;function Ff(n){let e=n.trim();e=Of(e),e=e.replace(/,\s*([}\]])/g,"$1"),e=e.replace(/,\s*$/,"");let t=0,r=0,s=!1,i=!1,a=-1;for(let o=0;o<e.length;o++){let c=e[o];if(/\s/.test(c)||(a=o),i){i=!1;continue}if(c==="\\"){i=!0;continue}if(c==='"'&&!i){s=!s;continue}s||(c==="{"?t++:c==="}"?t--:c==="["?r++:c==="]"&&r--)}for(e=e.trimEnd(),s&&a>=0&&(e+='"');t>0;)e+="}",t--;for(;r>0;)e+="]",r--;return e}function Of(n){let e="",t=0,r=!1,s=!1;for(;t<n.length;){let i=n[t];if(s){e+=i,s=!1,t++;continue}if(i==="\\"){e+=i,s=!0,t++;continue}if(i==='"'&&!s){if(r=!r,e+=i,!r){let a=t+1;for(;a<n.length&&/\s/.test(n[a]);)a++;if(a<n.length){let o=n[a];if(!(n.substring(t+1,a).indexOf(",")!==-1)&&o==='"'){let d=t-1;for(;d>=0&&/\s/.test(n[d]);)d--;if(d>=0){let u=n[d];u!==":"&&(u===","||u==="{"||u==="["||u==='"'||u==="}"||u==="]")&&(e+=",")}else e+=","}}}t++;continue}if(r){e+=i,t++;continue}if((i==="}"||i==="]")&&t+1<n.length){e+=i;let a=t+1;for(;a<n.length&&/\s/.test(n[a]);)a++;if(a<n.length){let o=n[a];!(n.substring(t+1,a).indexOf(",")!==-1)&&(o==='"'||o==="{"||o==="[")&&(e+=",")}t++;continue}e+=i,t++}return e}function X(n,e=!1){let t=n.trim(),r=/```(?:json)?\s*([\s\S]*?)```/,s=t.match(r);s?.[1]&&(t=s[1].trim()),t=t.replace(/^(?:Here'?s?|Here is|Response:|Output:).*?:\s*\n?\s*/i,""),t=t.replace(/^(?:Example:|Example format:|Example response:).*?:\s*\n?\s*/i,""),t=t.replace(/^Here is.*?:\s*\n?\s*/i,"");let i=t.indexOf("["),a=t.indexOf("{"),o=-1;if(e&&i!==-1?o=i:!e&&a!==-1?o=a:i!==-1&&a!==-1?o=Math.min(i,a):!e&&a===-1?o=-1:i!==-1?o=i:a!==-1&&(o=a),o!==-1&&o>0&&(t=t.substring(o)),t=t.trim(),e&&!t.startsWith("[")?t.startsWith("{")?t=`[${t}]`:t=`[${t}`:!e&&!t.startsWith("{")&&(t=`{${t}`),e&&t.startsWith("[")){let c=0,l=!1,d=!1,u=-1;for(let m=0;m<t.length;m++){let p=t[m];if(d){d=!1;continue}if(p==="\\"){d=!0;continue}if(p==='"'&&!d){l=!l;continue}if(!l){if(p==="[")c++;else if(p==="]"&&(c--,c===0)){u=m+1;break}}}u!==-1&&c===0&&(t=t.substring(0,u))}else if(!e&&t.startsWith("{")){let c=0,l=!1,d=!1,u=-1;for(let m=0;m<t.length;m++){let p=t[m];if(d){d=!1;continue}if(p==="\\"){d=!0;continue}if(p==='"'&&!d){l=!l;continue}if(!l){if(p==="{")c++;else if(p==="}"&&(c--,c===0)){u=m+1;break}}}u!==-1&&c===0&&(t=t.substring(0,u))}return Ff(t)}var Vn=class{name="Anthropic";client=null;apiKey;model;constructor(e,t){this.apiKey=e,this.model=t??"claude-3-5-haiku-20241022"}getClient(){if(!this.client&&this.apiKey&&this.apiKey.trim().length>0)try{this.client=new De({apiKey:this.apiKey})}catch(e){throw h.warn("Failed to initialize Anthropic client:",e),new Error("Failed to initialize Anthropic client")}if(!this.client)throw new Error("Anthropic client not initialized");return this.client}authenticate(e){return Promise.resolve(e.trim().length>0&&e.startsWith("sk-"))}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("Anthropic provider is not available");let t=this.constructPrompt(e);try{let i=(await this.getClient().messages.create({model:this.model,max_tokens:256,messages:[{role:"user",content:t}]})).content[0];if(i.type!=="text")throw new Error("Unexpected response type from Anthropic API");return this.parseResponse(i.text)}catch(r){let s=r;if(s?.status===429||s?.response?.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(s?.status===401||s?.response?.status===401)throw new Error("Invalid API key. Please check your Anthropic API key.");let i="Unknown error";try{let a=String(r);a!=="[object Object]"?i=a:s?.name&&(i=`${s.name}: API request failed`)}catch{i="Unknown error"}throw new Error(`Anthropic API error: ${i}`)}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=X(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse Anthropic response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};function T(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t}function g(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}var Gl=function(){let{crypto:n}=globalThis;if(n?.randomUUID)return Gl=n.randomUUID.bind(n),n.randomUUID();let e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function zn(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}var Wn=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){let e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};var C=class extends Error{},re=class n extends C{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.requestID=s?.get("x-request-id"),this.error=t;let i=t;this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,r){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new xt({message:r,cause:Wn(t)});let i=t?.error;return e===400?new ds(e,i,r,s):e===401?new us(e,i,r,s):e===403?new ps(e,i,r,s):e===404?new ms(e,i,r,s):e===409?new hs(e,i,r,s):e===422?new fs(e,i,r,s):e===429?new gs(e,i,r,s):e>=500?new ys(e,i,r,s):new n(e,i,r,s)}},Z=class extends re{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},xt=class extends re{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Et=class extends xt{constructor({message:e}={}){super({message:e??"Request timed out."})}},ds=class extends re{},us=class extends re{},ps=class extends re{},ms=class extends re{},hs=class extends re{},fs=class extends re{},gs=class extends re{},ys=class extends re{},bs=class extends C{constructor(){super("Could not parse response content as the length limit was reached")}},vs=class extends C{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},$e=class extends Error{constructor(e){super(e)}};var Df=/^[a-z][a-z0-9+.-]*:/i,mp=n=>Df.test(n),fe=n=>(fe=Array.isArray,fe(n)),Vl=fe;function zl(n){return typeof n!="object"?{}:n??{}}function hp(n){if(!n)return!0;for(let e in n)return!1;return!0}function fp(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Kn(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}var gp=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new C(`${n} must be an integer`);if(e<0)throw new C(`${n} must be a positive integer`);return e};var yp=n=>{try{return JSON.parse(n)}catch{return}};var Be=n=>new Promise(e=>setTimeout(e,n));var At="6.9.1";var xp=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function $f(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var Bf=()=>{let n=$f();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":At,"X-Stainless-OS":vp(Deno.build.os),"X-Stainless-Arch":bp(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":At,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":At,"X-Stainless-OS":vp(globalThis.process.platform??"unknown"),"X-Stainless-Arch":bp(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=Uf();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":At,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":At,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Uf(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}var bp=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",vp=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),wp,Ep=()=>wp??(wp=Bf());function Ap(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Wl(...n){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function Ia(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return Wl({start(){},async pull(t){let{done:r,value:s}=await e.next();r?t.close():t.enqueue(s)},async cancel(){await e.return?.()}})}function Kl(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Ip(n){if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await n[Symbol.asyncIterator]().return?.();return}let e=n.getReader(),t=e.cancel();e.releaseLock(),await t}var Sp=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var Sa="RFC3986",Jl=n=>String(n),Ca={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:Jl},Xl="RFC1738";var _a=(n,e)=>(_a=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),_a(n,e)),Ue=(()=>{let n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})();var Ql=1024,Cp=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=Ql){let c=i.length>=Ql?i.slice(o,o+Ql):i,l=[];for(let d=0;d<c.length;++d){let u=c.charCodeAt(d);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===Xl&&(u===40||u===41)){l[l.length]=c.charAt(d);continue}if(u<128){l[l.length]=Ue[u];continue}if(u<2048){l[l.length]=Ue[192|u>>6]+Ue[128|u&63];continue}if(u<55296||u>=57344){l[l.length]=Ue[224|u>>12]+Ue[128|u>>6&63]+Ue[128|u&63];continue}d+=1,u=65536+((u&1023)<<10|c.charCodeAt(d)&1023),l[l.length]=Ue[240|u>>18]+Ue[128|u>>12&63]+Ue[128|u>>6&63]+Ue[128|u&63]}a+=l.join("")}return a};function _p(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function Yl(n,e){if(fe(n)){let t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}var Rp={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},Tp=function(n,e){Array.prototype.push.apply(n,fe(e)?e:[e])},Pp,se={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Cp,encodeValuesOnly:!1,format:Sa,formatter:Jl,indices:!1,serializeDate(n){return(Pp??(Pp=Function.prototype.call.bind(Date.prototype.toISOString)))(n)},skipNulls:!1,strictNullHandling:!1};function qf(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}var Zl={};function kp(n,e,t,r,s,i,a,o,c,l,d,u,m,p,y,v,E,A){let f=n,S=A,P=0,k=!1;for(;(S=S.get(Zl))!==void 0&&!k;){let D=S.get(n);if(P+=1,typeof D<"u"){if(D===P)throw new RangeError("Cyclic object value");k=!0}typeof S.get(Zl)>"u"&&(P=0)}if(typeof l=="function"?f=l(e,f):f instanceof Date?f=m?.(f):t==="comma"&&fe(f)&&(f=Yl(f,function(D){return D instanceof Date?m?.(D):D})),f===null){if(i)return c&&!v?c(e,se.encoder,E,"key",p):e;f=""}if(qf(f)||_p(f)){if(c){let D=v?e:c(e,se.encoder,E,"key",p);return[y?.(D)+"="+y?.(c(f,se.encoder,E,"value",p))]}return[y?.(e)+"="+y?.(String(f))]}let $=[];if(typeof f>"u")return $;let F;if(t==="comma"&&fe(f))v&&c&&(f=Yl(f,c)),F=[{value:f.length>0?f.join(",")||null:void 0}];else if(fe(l))F=l;else{let D=Object.keys(f);F=d?D.sort(d):D}let B=o?String(e).replace(/\./g,"%2E"):String(e),H=r&&fe(f)&&f.length===1?B+"[]":B;if(s&&fe(f)&&f.length===0)return H+"[]";for(let D=0;D<F.length;++D){let q=F[D],Nr=typeof q=="object"&&typeof q.value<"u"?q.value:f[q];if(a&&Nr===null)continue;let Dr=u&&o?q.replace(/\./g,"%2E"):q,Oh=fe(f)?typeof t=="function"?t(H,Dr):H:H+(u?"."+Dr:"["+Dr+"]");A.set(n,P);let du=new WeakMap;du.set(Zl,A),Tp($,kp(Nr,Oh,t,r,s,i,a,o,t==="comma"&&v&&fe(f)?null:c,l,d,u,m,p,y,v,E,du))}return $}function Gf(n=se){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=n.charset||se.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Sa;if(typeof n.format<"u"){if(!_a(Ca,n.format))throw new TypeError("Unknown format option provided.");t=n.format}let r=Ca[t],s=se.filter;(typeof n.filter=="function"||fe(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in Rp?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=se.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:se.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:se.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:se.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:se.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?se.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:se.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:se.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:se.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:se.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:se.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:se.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:se.strictNullHandling}}function ed(n,e={}){let t=n,r=Gf(e),s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):fe(r.filter)&&(i=r.filter,s=i);let a=[];if(typeof t!="object"||t===null)return"";let o=Rp[r.arrayFormat],c=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let m=0;m<s.length;++m){let p=s[m];r.skipNulls&&t[p]===null||Tp(a,kp(t[p],p,o,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let d=a.join(r.delimiter),u=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),d.length>0?u+d:""}function Fp(n){let e=0;for(let s of n)e+=s.length;let t=new Uint8Array(e),r=0;for(let s of n)t.set(s,r),r+=s.length;return t}var Mp;function ws(n){let e;return(Mp??(e=new globalThis.TextEncoder,Mp=e.encode.bind(e)))(n)}var Lp;function td(n){let e;return(Lp??(e=new globalThis.TextDecoder,Lp=e.decode.bind(e)))(n)}var we,xe,er=class{constructor(){we.set(this,void 0),xe.set(this,void 0),T(this,we,new Uint8Array,"f"),T(this,xe,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?ws(e):e;T(this,we,Fp([g(this,we,"f"),t]),"f");let r=[],s;for(;(s=zf(g(this,we,"f"),g(this,xe,"f")))!=null;){if(s.carriage&&g(this,xe,"f")==null){T(this,xe,s.index,"f");continue}if(g(this,xe,"f")!=null&&(s.index!==g(this,xe,"f")+1||s.carriage)){r.push(td(g(this,we,"f").subarray(0,g(this,xe,"f")-1))),T(this,we,g(this,we,"f").subarray(g(this,xe,"f")),"f"),T(this,xe,null,"f");continue}let i=g(this,xe,"f")!==null?s.preceding-1:s.preceding,a=td(g(this,we,"f").subarray(0,i));r.push(a),T(this,we,g(this,we,"f").subarray(s.index),"f"),T(this,xe,null,"f")}return r}flush(){return g(this,we,"f").length?this.decode(`
`):[]}};we=new WeakMap,xe=new WeakMap;er.NEWLINE_CHARS=new Set([`
`,"\r"]);er.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function zf(n,e){for(let s=e??0;s<n.length;s++){if(n[s]===10)return{preceding:s,index:s+1,carriage:!1};if(n[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function Op(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}var Ra={off:0,error:200,warn:300,info:400,debug:500},rd=(n,e,t)=>{if(n){if(fp(Ra,n))return n;Y(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(Ra))}`)}};function Jn(){}function Pa(n,e,t){return!e||Ra[n]>Ra[t]?Jn:e[n].bind(e)}var Wf={error:Jn,warn:Jn,info:Jn,debug:Jn},Np=new WeakMap;function Y(n){let e=n.logger,t=n.logLevel??"off";if(!e)return Wf;let r=Np.get(e);if(r&&r[0]===t)return r[1];let s={error:Pa("error",e,t),warn:Pa("warn",e,t),info:Pa("info",e,t),debug:Pa("debug",e,t)};return Np.set(e,[t,s]),s}var st=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var Xn,je=class n{constructor(e,t,r){this.iterator=e,Xn.set(this,void 0),this.controller=t,T(this,Xn,r,"f")}static fromSSEResponse(e,t,r){let s=!1,i=r?Y(r):console;async function*a(){if(s)throw new C("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(let c of Kf(e,t))if(!o){if(c.data.startsWith("[DONE]")){o=!0;continue}if(c.event===null||!c.event.startsWith("thread.")){let l;try{l=JSON.parse(c.data)}catch(d){throw i.error("Could not parse message into JSON:",c.data),i.error("From chunk:",c.raw),d}if(l&&l.error)throw new re(void 0,l.error,void 0,e.headers);yield l}else{let l;try{l=JSON.parse(c.data)}catch(d){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),d}if(c.event=="error")throw new re(void 0,l.error,l.message,void 0);yield{event:c.event,data:l}}}o=!0}catch(c){if(zn(c))return;throw c}finally{o||t.abort()}}return new n(a,t,r)}static fromReadableStream(e,t,r){let s=!1;async function*i(){let o=new er,c=Kl(e);for await(let l of c)for(let d of o.decode(l))yield d;for(let l of o.flush())yield l}async function*a(){if(s)throw new C("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(let c of i())o||c&&(yield JSON.parse(c));o=!0}catch(c){if(zn(c))return;throw c}finally{o||t.abort()}}return new n(a,t,r)}[(Xn=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){let a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new n(()=>s(e),this.controller,g(this,Xn,"f")),new n(()=>s(t),this.controller,g(this,Xn,"f"))]}toReadableStream(){let e=this,t;return Wl({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{let{value:s,done:i}=await t.next();if(i)return r.close();let a=ws(JSON.stringify(s)+`
`);r.enqueue(a)}catch(s){r.error(s)}},async cancel(){await t.return?.()}})}};async function*Kf(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new C("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new C("Attempted to iterate over a response with no body");let t=new sd,r=new er,s=Kl(n.body);for await(let i of Jf(s))for(let a of r.decode(i)){let o=t.decode(a);o&&(yield o)}for(let i of r.flush()){let a=t.decode(i);a&&(yield a)}}async function*Jf(n){let e=new Uint8Array;for await(let t of n){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?ws(t):t,s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=Op(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var sd=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Xf(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function Xf(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function Ta(n,e){let{response:t,requestLogID:r,retryOfRequestLogID:s,startTime:i}=e,a=await(async()=>{if(e.options.stream)return Y(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):je.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let c=t.headers.get("content-type")?.split(";")[0]?.trim();if(c?.includes("application/json")||c?.endsWith("+json")){let u=await t.json();return nd(u,t)}return await t.text()})();return Y(n).debug(`[${r}] response parsed`,st({retryOfRequestLogID:s,url:t.url,status:t.status,body:a,durationMs:Date.now()-i})),a}function nd(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Qn,tr=class n extends Promise{constructor(e,t,r=Ta){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=r,Qn.set(this,void 0),T(this,Qn,e,"f")}_thenUnwrap(e){return new n(g(this,Qn,"f"),this.responsePromise,async(t,r)=>nd(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(g(this,Qn,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Qn=new WeakMap;var ka,Yn=class{constructor(e,t,r,s){ka.set(this,void 0),T(this,ka,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new C("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await g(this,ka,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ka=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Zn=class extends tr{constructor(e,t,r){super(e,t,async(s,i)=>new r(s,i.response,await Ta(s,i),i.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},He=class extends Yn{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},O=class extends Yn{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...zl(this.options.query),after:t}}:null}},nt=class extends Yn{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...zl(this.options.query),after:e}}:null}};var od=()=>{if(typeof File>"u"){let{process:n}=globalThis,e=typeof n?.versions?.node=="string"&&parseInt(n.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function xs(n,e,t){return od(),new File(n,e??"unknown_file",t)}function ei(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}var Ma=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",cd=async(n,e)=>id(n.body)?{...n,body:await $p(n.body,e)}:n,Ee=async(n,e)=>({...n,body:await $p(n.body,e)}),Dp=new WeakMap;function Yf(n){let e=typeof n=="function"?n:n.fetch,t=Dp.get(e);if(t)return t;let r=(async()=>{try{let s="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new s(i).text()}catch{return!0}})();return Dp.set(e,r),r}var $p=async(n,e)=>{if(!await Yf(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(n||{}).map(([r,s])=>ad(t,r,s))),t},Bp=n=>n instanceof Blob&&"name"in n,Zf=n=>typeof n=="object"&&n!==null&&(n instanceof Response||Ma(n)||Bp(n)),id=n=>{if(Zf(n))return!0;if(Array.isArray(n))return n.some(id);if(n&&typeof n=="object"){for(let e in n)if(id(n[e]))return!0}return!1},ad=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response)n.append(e,xs([await t.blob()],ei(t)));else if(Ma(t))n.append(e,xs([await new Response(Ia(t)).blob()],ei(t)));else if(Bp(t))n.append(e,t,ei(t));else if(Array.isArray(t))await Promise.all(t.map(r=>ad(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>ad(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Up=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",eg=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Up(n),tg=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function La(n,e,t){if(od(),n=await n,eg(n))return n instanceof File?n:xs([await n.arrayBuffer()],n.name);if(tg(n)){let s=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),xs(await ld(s),e,t)}let r=await ld(n);if(e||(e=ei(n)),!t?.type){let s=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof s=="string"&&(t={...t,type:s})}return xs(r,e,t)}async function ld(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Up(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(Ma(n))for await(let t of n)e.push(...await ld(t));else{let t=n?.constructor?.name;throw new Error(`Unexpected data type: ${typeof n}${t?`; constructor: ${t}`:""}${rg(n)}`)}return e}function rg(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}var x=class{constructor(e){this._client=e}};function Hp(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var jp=Object.freeze(Object.create(null)),ng=(n=Hp)=>function(t,...r){if(t.length===1)return t[0];let s=!1,i=[],a=t.reduce((d,u,m)=>{/[?#]/.test(u)&&(s=!0);let p=r[m],y=(s?encodeURIComponent:n)(""+p);return m!==r.length&&(p==null||typeof p=="object"&&p.toString===Object.getPrototypeOf(Object.getPrototypeOf(p.hasOwnProperty??jp)??jp)?.toString)&&(y=p+"",i.push({start:d.length+u.length,length:y.length,error:`Value of type ${Object.prototype.toString.call(p).slice(8,-1)} is not a valid path parameter`})),d+u+(m===r.length?"":y)},""),o=a.split(/[?#]/,1)[0],c=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,l;for(;(l=c.exec(o))!==null;)i.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(i.sort((d,u)=>d.start-u.start),i.length>0){let d=0,u=i.reduce((m,p)=>{let y=" ".repeat(p.start-d),v="^".repeat(p.length);return d=p.start+p.length,m+y+v},"");throw new C(`Path parameters result in path with invalid segments:
${i.map(m=>m.error).join(`
`)}
${a}
${u}`)}return a},w=ng(Hp);var rr=class extends x{list(e,t={},r){return this._client.getAPIList(w`/chat/completions/${e}/messages`,O,{query:t,...r})}};function ti(n){return n!==void 0&&"function"in n&&n.function!==void 0}function ri(n){return n?.$brand==="auto-parseable-response-format"}function sr(n){return n?.$brand==="auto-parseable-tool"}function qp(n,e){return!e||!dd(e)?{...n,choices:n.choices.map(t=>(Vp(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:si(n,e)}function si(n,e){let t=n.choices.map(r=>{if(r.finish_reason==="length")throw new bs;if(r.finish_reason==="content_filter")throw new vs;return Vp(r.message.tool_calls),{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:r.message.tool_calls?.map(s=>cg(e,s))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?og(e,r.message.content):null}}});return{...n,choices:t}}function og(n,e){return n.response_format?.type!=="json_schema"?null:n.response_format?.type==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function cg(n,e){let t=n.tools?.find(r=>ti(r)&&r.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:sr(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function Gp(n,e){if(!n||!("tools"in n)||!n.tools)return!1;let t=n.tools?.find(r=>ti(r)&&r.function?.name===e.function.name);return ti(t)&&(sr(t)||t?.function.strict||!1)}function dd(n){return ri(n.response_format)?!0:n.tools?.some(e=>sr(e)||e.type==="function"&&e.function.strict===!0)??!1}function Vp(n){for(let e of n||[])if(e.type!=="function")throw new C(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function zp(n){for(let e of n??[]){if(e.type!=="function")throw new C(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new C(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Es=n=>n?.role==="assistant",ud=n=>n?.role==="tool";var pd,Fa,Oa,ni,ii,Na,ai,it,oi,Da,$a,As,Wp,It=class{constructor(){pd.add(this),this.controller=new AbortController,Fa.set(this,void 0),Oa.set(this,()=>{}),ni.set(this,()=>{}),ii.set(this,void 0),Na.set(this,()=>{}),ai.set(this,()=>{}),it.set(this,{}),oi.set(this,!1),Da.set(this,!1),$a.set(this,!1),As.set(this,!1),T(this,Fa,new Promise((e,t)=>{T(this,Oa,e,"f"),T(this,ni,t,"f")}),"f"),T(this,ii,new Promise((e,t)=>{T(this,Na,e,"f"),T(this,ai,t,"f")}),"f"),g(this,Fa,"f").catch(()=>{}),g(this,ii,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},g(this,pd,"m",Wp).bind(this))},0)}_connected(){this.ended||(g(this,Oa,"f").call(this),this._emit("connect"))}get ended(){return g(this,oi,"f")}get errored(){return g(this,Da,"f")}get aborted(){return g(this,$a,"f")}abort(){this.controller.abort()}on(e,t){return(g(this,it,"f")[e]||(g(this,it,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=g(this,it,"f")[e];if(!r)return this;let s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(g(this,it,"f")[e]||(g(this,it,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{T(this,As,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){T(this,As,!0,"f"),await g(this,ii,"f")}_emit(e,...t){if(g(this,oi,"f"))return;e==="end"&&(T(this,oi,!0,"f"),g(this,Na,"f").call(this));let r=g(this,it,"f")[e];if(r&&(g(this,it,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!g(this,As,"f")&&!r?.length&&Promise.reject(s),g(this,ni,"f").call(this,s),g(this,ai,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!g(this,As,"f")&&!r?.length&&Promise.reject(s),g(this,ni,"f").call(this,s),g(this,ai,"f").call(this,s),this._emit("end")}}_emitFinal(){}};Fa=new WeakMap,Oa=new WeakMap,ni=new WeakMap,ii=new WeakMap,Na=new WeakMap,ai=new WeakMap,it=new WeakMap,oi=new WeakMap,Da=new WeakMap,$a=new WeakMap,As=new WeakMap,pd=new WeakSet,Wp=function(e){if(T(this,Da,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Z),e instanceof Z)return T(this,$a,!0,"f"),this._emit("abort",e);if(e instanceof C)return this._emit("error",e);if(e instanceof Error){let t=new C(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new C(String(e)))};function Kp(n){return typeof n.parse=="function"}var ge,md,Ba,hd,fd,gd,Jp,Xp,lg=10,Is=class extends It{constructor(){super(...arguments),ge.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),ud(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Es(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new C("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),g(this,ge,"m",md).call(this)}async finalMessage(){return await this.done(),g(this,ge,"m",Ba).call(this)}async finalFunctionToolCall(){return await this.done(),g(this,ge,"m",hd).call(this)}async finalFunctionToolCallResult(){return await this.done(),g(this,ge,"m",fd).call(this)}async totalUsage(){return await this.done(),g(this,ge,"m",gd).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=g(this,ge,"m",Ba).call(this);t&&this._emit("finalMessage",t);let r=g(this,ge,"m",md).call(this);r&&this._emit("finalContent",r);let s=g(this,ge,"m",hd).call(this);s&&this._emit("finalFunctionToolCall",s);let i=g(this,ge,"m",fd).call(this);i!=null&&this._emit("finalFunctionToolCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",g(this,ge,"m",gd).call(this))}async _createChatCompletion(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),g(this,ge,"m",Jp).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(si(i,t))}async _runChatCompletion(e,t,r){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){let s="tool",{tool_choice:i="auto",stream:a,...o}=t,c=typeof i!="string"&&i.type==="function"&&i?.function?.name,{maxChatCompletions:l=lg}=r||{},d=t.tools.map(p=>{if(sr(p)){if(!p.$callback)throw new C("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:p.$callback,name:p.function.name,description:p.function.description||"",parameters:p.function.parameters,parse:p.$parseRaw,strict:!0}}}return p}),u={};for(let p of d)p.type==="function"&&(u[p.function.name||p.function.function.name]=p.function);let m="tools"in t?d.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description,strict:p.function.strict}}:p):void 0;for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){let v=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:m,messages:[...this.messages]},r)).choices[0]?.message;if(!v)throw new C("missing message in ChatCompletion response");if(!v.tool_calls?.length)return;for(let E of v.tool_calls){if(E.type!=="function")continue;let A=E.id,{name:f,arguments:S}=E.function,P=u[f];if(P){if(c&&c!==f){let B=`Invalid tool_call: ${JSON.stringify(f)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:s,tool_call_id:A,content:B});continue}}else{let B=`Invalid tool_call: ${JSON.stringify(f)}. Available options are: ${Object.keys(u).map(H=>JSON.stringify(H)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:A,content:B});continue}let k;try{k=Kp(P)?await P.parse(S):S}catch(B){let H=B instanceof Error?B.message:String(B);this._addMessage({role:s,tool_call_id:A,content:H});continue}let $=await P.function(k,this),F=g(this,ge,"m",Xp).call(this,$);if(this._addMessage({role:s,tool_call_id:A,content:F}),c)return}}}};ge=new WeakSet,md=function(){return g(this,ge,"m",Ba).call(this).content??null},Ba=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(Es(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new C("stream ended without producing a ChatCompletionMessage with role=assistant")},hd=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Es(t)&&t?.tool_calls?.length)return t.tool_calls.filter(r=>r.type==="function").at(-1)?.function}},fd=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ud(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>r.role==="assistant"&&r.tool_calls?.some(s=>s.type==="function"&&s.id===t.tool_call_id)))return t.content}},gd=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Jp=function(e){if(e.n!=null&&e.n>1)throw new C("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Xp=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var ci=class n extends Is{static runTools(e,t,r){let s=new n,i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),Es(e)&&e.content&&this._emit("content",e.content)}};var ce={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},yd=class extends Error{},bd=class extends Error{};function dg(n,e=ce.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return ug(n.trim(),e)}var ug=(n,e)=>{let t=n.length,r=0,s=m=>{throw new yd(`${m} at position ${r}`)},i=m=>{throw new bd(`${m} at position ${r}`)},a=()=>(u(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?c():n[r]==="["?l():n.substring(r,r+4)==="null"||ce.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||ce.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||ce.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||ce.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||ce.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||ce.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):d()),o=()=>{let m=r,p=!1;for(r++;r<t&&(n[r]!=='"'||p&&n[r-1]==="\\");)p=n[r]==="\\"?!p:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(m,++r-Number(p)))}catch(y){i(String(y))}else if(ce.STR&e)try{return JSON.parse(n.substring(m,r-Number(p))+'"')}catch{return JSON.parse(n.substring(m,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},c=()=>{r++,u();let m={};try{for(;n[r]!=="}";){if(u(),r>=t&&ce.OBJ&e)return m;let p=o();u(),r++;try{let y=a();Object.defineProperty(m,p,{value:y,writable:!0,enumerable:!0,configurable:!0})}catch(y){if(ce.OBJ&e)return m;throw y}u(),n[r]===","&&r++}}catch{if(ce.OBJ&e)return m;s("Expected '}' at end of object")}return r++,m},l=()=>{r++;let m=[];try{for(;n[r]!=="]";)m.push(a()),u(),n[r]===","&&r++}catch{if(ce.ARR&e)return m;s("Expected ']' at end of array")}return r++,m},d=()=>{if(r===0){n==="-"&&ce.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(p){if(ce.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(p))}}let m=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(ce.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(m,r))}catch{n.substring(m,r)==="-"&&ce.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(m,n.lastIndexOf("e")))}catch(y){i(String(y))}}},u=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},vd=n=>dg(n,ce.ALL^ce.NUM);var ne,at,Ss,St,wd,Ua,xd,Ed,Ad,ja,Id,Qp,nr=class n extends Is{constructor(e){super(),ne.add(this),at.set(this,void 0),Ss.set(this,void 0),St.set(this,void 0),T(this,at,e,"f"),T(this,Ss,[],"f")}get currentChatCompletionSnapshot(){return g(this,St,"f")}static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let s=new n(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){super._createChatCompletion;let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),g(this,ne,"m",wd).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let a of i)g(this,ne,"m",xd).call(this,a);if(i.controller.signal?.aborted)throw new Z;return this._addChatCompletion(g(this,ne,"m",ja).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),g(this,ne,"m",wd).call(this),this._connected();let s=je.fromReadableStream(e,this.controller),i;for await(let a of s)i&&i!==a.id&&this._addChatCompletion(g(this,ne,"m",ja).call(this)),g(this,ne,"m",xd).call(this,a),i=a.id;if(s.controller.signal?.aborted)throw new Z;return this._addChatCompletion(g(this,ne,"m",ja).call(this))}[(at=new WeakMap,Ss=new WeakMap,St=new WeakMap,ne=new WeakSet,wd=function(){this.ended||T(this,St,void 0,"f")},Ua=function(t){let r=g(this,Ss,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},g(this,Ss,"f")[t.index]=r,r)},xd=function(t){if(this.ended)return;let r=g(this,ne,"m",Qp).call(this,t);this._emit("chunk",t,r);for(let s of t.choices){let i=r.choices[s.index];s.delta.content!=null&&i.message?.role==="assistant"&&i.message?.content&&(this._emit("content",s.delta.content,i.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),s.delta.refusal!=null&&i.message?.role==="assistant"&&i.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:i.message.refusal}),s.logprobs?.content!=null&&i.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:i.logprobs?.content??[]}),s.logprobs?.refusal!=null&&i.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});let a=g(this,ne,"m",Ua).call(this,i);i.finish_reason&&(g(this,ne,"m",Ad).call(this,i),a.current_tool_call_index!=null&&g(this,ne,"m",Ed).call(this,i,a.current_tool_call_index));for(let o of s.delta.tool_calls??[])a.current_tool_call_index!==o.index&&(g(this,ne,"m",Ad).call(this,i),a.current_tool_call_index!=null&&g(this,ne,"m",Ed).call(this,i,a.current_tool_call_index)),a.current_tool_call_index=o.index;for(let o of s.delta.tool_calls??[]){let c=i.message.tool_calls?.[o.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:o.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(c?.type,void 0))}}},Ed=function(t,r){if(g(this,ne,"m",Ua).call(this,t).done_tool_calls.has(r))return;let i=t.message.tool_calls?.[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let a=g(this,at,"f")?.tools?.find(o=>ti(o)&&o.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:sr(a)?a.$parseRaw(i.function.arguments):a?.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Ad=function(t){let r=g(this,ne,"m",Ua).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let s=g(this,ne,"m",Id).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},ja=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=g(this,St,"f");if(!t)throw new C("request ended without sending any chunks");return T(this,St,void 0,"f"),T(this,Ss,[],"f"),pg(t,g(this,at,"f"))},Id=function(){let t=g(this,at,"f")?.response_format;return ri(t)?t:null},Qp=function(t){var r,s,i,a;let o=g(this,St,"f"),{choices:c,...l}=t;o?Object.assign(o,l):o=T(this,St,{...l,choices:[]},"f");for(let{delta:d,finish_reason:u,index:m,logprobs:p=null,...y}of t.choices){let v=o.choices[m];if(v||(v=o.choices[m]={finish_reason:u,index:m,message:{},logprobs:p,...y}),p)if(!v.logprobs)v.logprobs=Object.assign({},p);else{let{content:$,refusal:F,...B}=p;Object.assign(v.logprobs,B),$&&((r=v.logprobs).content??(r.content=[]),v.logprobs.content.push(...$)),F&&((s=v.logprobs).refusal??(s.refusal=[]),v.logprobs.refusal.push(...F))}if(u&&(v.finish_reason=u,g(this,at,"f")&&dd(g(this,at,"f")))){if(u==="length")throw new bs;if(u==="content_filter")throw new vs}if(Object.assign(v,y),!d)continue;let{content:E,refusal:A,function_call:f,role:S,tool_calls:P,...k}=d;if(Object.assign(v.message,k),A&&(v.message.refusal=(v.message.refusal||"")+A),S&&(v.message.role=S),f&&(v.message.function_call?(f.name&&(v.message.function_call.name=f.name),f.arguments&&((i=v.message.function_call).arguments??(i.arguments=""),v.message.function_call.arguments+=f.arguments)):v.message.function_call=f),E&&(v.message.content=(v.message.content||"")+E,!v.message.refusal&&g(this,ne,"m",Id).call(this)&&(v.message.parsed=vd(v.message.content))),P){v.message.tool_calls||(v.message.tool_calls=[]);for(let{index:$,id:F,type:B,function:H,...D}of P){let q=(a=v.message.tool_calls)[$]??(a[$]={});Object.assign(q,D),F&&(q.id=F),B&&(q.type=B),H&&(q.function??(q.function={name:H.name??"",arguments:""})),H?.name&&(q.function.name=H.name),H?.arguments&&(q.function.arguments+=H.arguments,Gp(g(this,at,"f"),q)&&(q.function.parsed_arguments=vd(q.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new je(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function pg(n,e){let{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,c={...o,id:t,choices:r.map(({message:l,finish_reason:d,index:u,logprobs:m,...p})=>{if(!d)throw new C(`missing finish_reason for choice ${u}`);let{content:y=null,function_call:v,tool_calls:E,...A}=l,f=l.role;if(!f)throw new C(`missing role for choice ${u}`);if(v){let{arguments:S,name:P}=v;if(S==null)throw new C(`missing function_call.arguments for choice ${u}`);if(!P)throw new C(`missing function_call.name for choice ${u}`);return{...p,message:{content:y,function_call:{arguments:S,name:P},role:f,refusal:l.refusal??null},finish_reason:d,index:u,logprobs:m}}return E?{...p,index:u,finish_reason:d,logprobs:m,message:{...A,role:f,content:y,refusal:l.refusal??null,tool_calls:E.map((S,P)=>{let{function:k,type:$,id:F,...B}=S,{arguments:H,name:D,...q}=k||{};if(F==null)throw new C(`missing choices[${u}].tool_calls[${P}].id
${Ha(n)}`);if($==null)throw new C(`missing choices[${u}].tool_calls[${P}].type
${Ha(n)}`);if(D==null)throw new C(`missing choices[${u}].tool_calls[${P}].function.name
${Ha(n)}`);if(H==null)throw new C(`missing choices[${u}].tool_calls[${P}].function.arguments
${Ha(n)}`);return{...B,id:F,type:$,function:{...q,name:D,arguments:H}}})}}:{...p,message:{...A,content:y,role:f,refusal:l.refusal??null},finish_reason:d,index:u,logprobs:m}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return qp(c,e)}function Ha(n){return JSON.stringify(n)}var li=class n extends nr{static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let s=new n(t),i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}};var ot=class extends x{constructor(){super(...arguments),this.messages=new rr(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(w`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(w`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",O,{query:e,...t})}delete(e,t){return this._client.delete(w`/chat/completions/${e}`,t)}parse(e,t){return zp(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>si(r,e))}runTools(e,t){return e.stream?li.runTools(this._client,e,t):ci.runTools(this._client,e,t)}stream(e,t){return nr.createChatCompletion(this._client,e,t)}};ot.Messages=rr;var Ct=class extends x{constructor(){super(...arguments),this.completions=new ot(this._client)}};Ct.Completions=ot;var Yp=Symbol("brand.privateNullableHeaders");function*hg(n){if(!n)return;if(Yp in n){let{values:r,nulls:s}=n;yield*r.entries();for(let i of s)yield[i,null];return}let e=!1,t;n instanceof Headers?t=n.entries():Vl(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let r of t){let s=r[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");let i=Vl(r[1])?r[1]:[r[1]],a=!1;for(let o of i)o!==void 0&&(e&&!a&&(a=!0,yield[s,null]),yield[s,o])}}var I=n=>{let e=new Headers,t=new Set;for(let r of n){let s=new Set;for(let[i,a]of hg(r)){let o=i.toLowerCase();s.has(o)||(e.delete(i),s.add(o)),a===null?(e.delete(i),t.add(o)):(e.append(i,a),t.delete(o))}}return{[Yp]:!0,values:e,nulls:t}};var Cs=class extends x{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:I([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}};var _s=class extends x{create(e,t){return this._client.post("/audio/transcriptions",Ee({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var Ps=class extends x{create(e,t){return this._client.post("/audio/translations",Ee({body:e,...t,__metadata:{model:e.model}},this._client))}};var qe=class extends x{constructor(){super(...arguments),this.transcriptions=new _s(this._client),this.translations=new Ps(this._client),this.speech=new Cs(this._client)}};qe.Transcriptions=_s;qe.Translations=Ps;qe.Speech=Cs;var ir=class extends x{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(w`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",O,{query:e,...t})}cancel(e,t){return this._client.post(w`/batches/${e}/cancel`,t)}};var Rs=class extends x{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(w`/assistants/${e}`,{...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(w`/assistants/${e}`,{body:t,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",O,{query:e,...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(w`/assistants/${e}`,{...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var Ts=class extends x{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var ks=class extends x{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var _t=class extends x{constructor(){super(...arguments),this.sessions=new Ts(this._client),this.transcriptionSessions=new ks(this._client)}};_t.Sessions=Ts;_t.TranscriptionSessions=ks;var Ms=class extends x{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:I([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(w`/chatkit/sessions/${e}/cancel`,{...t,headers:I([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}};var Ls=class extends x{retrieve(e,t){return this._client.get(w`/chatkit/threads/${e}`,{...t,headers:I([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",nt,{query:e,...t,headers:I([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(w`/chatkit/threads/${e}`,{...t,headers:I([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},r){return this._client.getAPIList(w`/chatkit/threads/${e}/items`,nt,{query:t,...r,headers:I([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}};var Pt=class extends x{constructor(){super(...arguments),this.sessions=new Ms(this._client),this.threads=new Ls(this._client)}};Pt.Sessions=Ms;Pt.Threads=Ls;var Fs=class extends x{create(e,t,r){return this._client.post(w`/threads/${e}/messages`,{body:t,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{thread_id:s}=t;return this._client.get(w`/threads/${s}/messages/${e}`,{...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:s,...i}=t;return this._client.post(w`/threads/${s}/messages/${e}`,{body:i,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(w`/threads/${e}/messages`,O,{query:t,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{thread_id:s}=t;return this._client.delete(w`/threads/${s}/messages/${e}`,{...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Os=class extends x{retrieve(e,t,r){let{thread_id:s,run_id:i,...a}=t;return this._client.get(w`/threads/${s}/runs/${i}/steps/${e}`,{query:a,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t,r){let{thread_id:s,...i}=t;return this._client.getAPIList(w`/threads/${s}/runs/${e}/steps`,O,{query:i,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Zp=n=>{if(typeof Buffer<"u"){let e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};var Rt=n=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[n]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(n)?.trim()};var me,or,Sd,Ge,qa,ke,cr,Ns,ar,za,Ae,Ga,Va,pi,di,ui,em,tm,rm,sm,nm,im,am,ct=class extends It{constructor(){super(...arguments),me.add(this),Sd.set(this,[]),Ge.set(this,{}),qa.set(this,{}),ke.set(this,void 0),cr.set(this,void 0),Ns.set(this,void 0),ar.set(this,void 0),za.set(this,void 0),Ae.set(this,void 0),Ga.set(this,void 0),Va.set(this,void 0),pi.set(this,void 0)}[(Sd=new WeakMap,Ge=new WeakMap,qa=new WeakMap,ke=new WeakMap,cr=new WeakMap,Ns=new WeakMap,ar=new WeakMap,za=new WeakMap,Ae=new WeakMap,Ga=new WeakMap,Va=new WeakMap,pi=new WeakMap,me=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new or;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=je.fromReadableStream(e,this.controller);for await(let i of s)g(this,me,"m",di).call(this,i);if(s.controller.signal?.aborted)throw new Z;return this._addRun(g(this,me,"m",ui).call(this))}toReadableStream(){return new je(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s){let i=new or;return i._run(()=>i._runToolAssistantStream(e,t,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},o=await e.submitToolOutputs(t,a,{...s,signal:this.controller.signal});this._connected();for await(let c of o)g(this,me,"m",di).call(this,c);if(o.controller.signal?.aborted)throw new Z;return this._addRun(g(this,me,"m",ui).call(this))}static createThreadAssistantStream(e,t,r){let s=new or;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){let i=new or;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return g(this,Ga,"f")}currentRun(){return g(this,Va,"f")}currentMessageSnapshot(){return g(this,ke,"f")}currentRunStepSnapshot(){return g(this,pi,"f")}async finalRunSteps(){return await this.done(),Object.values(g(this,Ge,"f"))}async finalMessages(){return await this.done(),Object.values(g(this,qa,"f"))}async finalRun(){if(await this.done(),!g(this,cr,"f"))throw Error("Final run was not received.");return g(this,cr,"f")}async _createThreadAssistantStream(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(let o of a)g(this,me,"m",di).call(this,o);if(a.controller.signal?.aborted)throw new Z;return this._addRun(g(this,me,"m",ui).call(this))}async _createAssistantStream(e,t,r,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(let c of o)g(this,me,"m",di).call(this,c);if(o.controller.signal?.aborted)throw new Z;return this._addRun(g(this,me,"m",ui).call(this))}static accumulateDelta(e,t){for(let[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Kn(i)&&Kn(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(let a of s){if(!Kn(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let c=i[o];c==null?i.push(a):i[o]=this.accumulateDelta(c,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s){return await this._createToolAssistantStream(t,e,r,s)}};or=ct,di=function(e){if(!this.ended)switch(T(this,Ga,e,"f"),g(this,me,"m",rm).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":g(this,me,"m",am).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":g(this,me,"m",tm).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":g(this,me,"m",em).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},ui=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");if(!g(this,cr,"f"))throw Error("Final run has not been received");return g(this,cr,"f")},em=function(e){let[t,r]=g(this,me,"m",nm).call(this,e,g(this,ke,"f"));T(this,ke,t,"f"),g(this,qa,"f")[t.id]=t;for(let s of r){let i=t.content[s.index];i?.type=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=g(this,Ns,"f")){if(g(this,ar,"f"))switch(g(this,ar,"f").type){case"text":this._emit("textDone",g(this,ar,"f").text,g(this,ke,"f"));break;case"image_file":this._emit("imageFileDone",g(this,ar,"f").image_file,g(this,ke,"f"));break}T(this,Ns,s.index,"f")}T(this,ar,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(g(this,Ns,"f")!==void 0){let s=e.data.content[g(this,Ns,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,g(this,ke,"f"));break;case"text":this._emit("textDone",s.text,g(this,ke,"f"));break}}g(this,ke,"f")&&this._emit("messageDone",e.data),T(this,ke,void 0,"f")}},tm=function(e){let t=g(this,me,"m",sm).call(this,e);switch(T(this,pi,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of r.step_details.tool_calls)i.index==g(this,za,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(g(this,Ae,"f")&&this._emit("toolCallDone",g(this,Ae,"f")),T(this,za,i.index,"f"),T(this,Ae,t.step_details.tool_calls[i.index],"f"),g(this,Ae,"f")&&this._emit("toolCallCreated",g(this,Ae,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":T(this,pi,void 0,"f"),e.data.step_details.type=="tool_calls"&&g(this,Ae,"f")&&(this._emit("toolCallDone",g(this,Ae,"f")),T(this,Ae,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},rm=function(e){g(this,Sd,"f").push(e),this._emit("event",e)},sm=function(e){switch(e.event){case"thread.run.step.created":return g(this,Ge,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=g(this,Ge,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let s=or.accumulateDelta(t,r.delta);g(this,Ge,"f")[e.data.id]=s}return g(this,Ge,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":g(this,Ge,"f")[e.data.id]=e.data;break}if(g(this,Ge,"f")[e.data.id])return g(this,Ge,"f")[e.data.id];throw new Error("No snapshot available")},nm=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=g(this,me,"m",im).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},im=function(e,t){return or.accumulateDelta(t,e)},am=function(e){switch(T(this,Va,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":T(this,cr,e.data,"f"),g(this,Ae,"f")&&(this._emit("toolCallDone",g(this,Ae,"f")),T(this,Ae,void 0,"f"));break;case"thread.run.cancelling":break}};var lr=class extends x{constructor(){super(...arguments),this.steps=new Os(this._client)}create(e,t,r){let{include:s,...i}=t;return this._client.post(w`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}retrieve(e,t,r){let{thread_id:s}=t;return this._client.get(w`/threads/${s}/runs/${e}`,{...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:s,...i}=t;return this._client.post(w`/threads/${s}/runs/${e}`,{body:i,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(w`/threads/${e}/runs`,O,{query:t,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{thread_id:s}=t;return this._client.post(w`/threads/${s}/runs/${e}/cancel`,{...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(s.id,{thread_id:e},r)}createAndStream(e,t,r){return ct.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let s=I([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let c=a.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(o=l)}}await Be(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return ct.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){let{thread_id:s,...i}=t;return this._client.post(w`/threads/${s}/runs/${e}/submit_tool_outputs`,{body:i,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){let s=await this.submitToolOutputs(e,t,r);return await this.poll(s.id,t,r)}submitToolOutputsStream(e,t,r){return ct.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}};lr.Steps=Os;var Tt=class extends x{constructor(){super(...arguments),this.runs=new lr(this._client),this.messages=new Fs(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(w`/threads/${e}`,{...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(w`/threads/${e}`,{body:t,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t){return this._client.delete(w`/threads/${e}`,{...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return ct.createThreadAssistantStream(e,this._client.beta.threads,t)}};Tt.Runs=lr;Tt.Messages=Fs;var Me=class extends x{constructor(){super(...arguments),this.realtime=new _t(this._client),this.chatkit=new Pt(this._client),this.assistants=new Rs(this._client),this.threads=new Tt(this._client)}};Me.Realtime=_t;Me.ChatKit=Pt;Me.Assistants=Rs;Me.Threads=Tt;var dr=class extends x{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var Ds=class extends x{retrieve(e,t,r){let{container_id:s}=t;return this._client.get(w`/containers/${s}/files/${e}/content`,{...r,headers:I([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}};var ur=class extends x{constructor(){super(...arguments),this.content=new Ds(this._client)}create(e,t,r){return this._client.post(w`/containers/${e}/files`,Ee({body:t,...r},this._client))}retrieve(e,t,r){let{container_id:s}=t;return this._client.get(w`/containers/${s}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(w`/containers/${e}/files`,O,{query:t,...r})}delete(e,t,r){let{container_id:s}=t;return this._client.delete(w`/containers/${s}/files/${e}`,{...r,headers:I([{Accept:"*/*"},r?.headers])})}};ur.Content=Ds;var kt=class extends x{constructor(){super(...arguments),this.files=new ur(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(w`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",O,{query:e,...t})}delete(e,t){return this._client.delete(w`/containers/${e}`,{...t,headers:I([{Accept:"*/*"},t?.headers])})}};kt.Files=ur;var $s=class extends x{create(e,t,r){let{include:s,...i}=t;return this._client.post(w`/conversations/${e}/items`,{query:{include:s},body:i,...r})}retrieve(e,t,r){let{conversation_id:s,...i}=t;return this._client.get(w`/conversations/${s}/items/${e}`,{query:i,...r})}list(e,t={},r){return this._client.getAPIList(w`/conversations/${e}/items`,nt,{query:t,...r})}delete(e,t,r){let{conversation_id:s}=t;return this._client.delete(w`/conversations/${s}/items/${e}`,r)}};var Mt=class extends x{constructor(){super(...arguments),this.items=new $s(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(w`/conversations/${e}`,t)}update(e,t,r){return this._client.post(w`/conversations/${e}`,{body:t,...r})}delete(e,t){return this._client.delete(w`/conversations/${e}`,t)}};Mt.Items=$s;var pr=class extends x{create(e,t){let r=!!e.encoding_format,s=r?e.encoding_format:"base64";r&&Y(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return r?i:(Y(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{let c=o.embedding;o.embedding=Zp(c)}),a)))}};var Bs=class extends x{retrieve(e,t,r){let{eval_id:s,run_id:i}=t;return this._client.get(w`/evals/${s}/runs/${i}/output_items/${e}`,r)}list(e,t,r){let{eval_id:s,...i}=t;return this._client.getAPIList(w`/evals/${s}/runs/${e}/output_items`,O,{query:i,...r})}};var mr=class extends x{constructor(){super(...arguments),this.outputItems=new Bs(this._client)}create(e,t,r){return this._client.post(w`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){let{eval_id:s}=t;return this._client.get(w`/evals/${s}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(w`/evals/${e}/runs`,O,{query:t,...r})}delete(e,t,r){let{eval_id:s}=t;return this._client.delete(w`/evals/${s}/runs/${e}`,r)}cancel(e,t,r){let{eval_id:s}=t;return this._client.post(w`/evals/${s}/runs/${e}`,r)}};mr.OutputItems=Bs;var Lt=class extends x{constructor(){super(...arguments),this.runs=new mr(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(w`/evals/${e}`,t)}update(e,t,r){return this._client.post(w`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",O,{query:e,...t})}delete(e,t){return this._client.delete(w`/evals/${e}`,t)}};Lt.Runs=mr;var hr=class extends x{create(e,t){return this._client.post("/files",Ee({body:e,...t},this._client))}retrieve(e,t){return this._client.get(w`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",O,{query:e,...t})}delete(e,t){return this._client.delete(w`/files/${e}`,t)}content(e,t){return this._client.get(w`/files/${e}/content`,{...t,headers:I([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await Be(t),a=await this.retrieve(e),Date.now()-i>r)throw new Et({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}};var Us=class extends x{};var js=class extends x{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var fr=class extends x{constructor(){super(...arguments),this.graders=new js(this._client)}};fr.Graders=js;var Hs=class extends x{create(e,t,r){return this._client.getAPIList(w`/fine_tuning/checkpoints/${e}/permissions`,He,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(w`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){let{fine_tuned_model_checkpoint:s}=t;return this._client.delete(w`/fine_tuning/checkpoints/${s}/permissions/${e}`,r)}};var gr=class extends x{constructor(){super(...arguments),this.permissions=new Hs(this._client)}};gr.Permissions=Hs;var qs=class extends x{list(e,t={},r){return this._client.getAPIList(w`/fine_tuning/jobs/${e}/checkpoints`,O,{query:t,...r})}};var yr=class extends x{constructor(){super(...arguments),this.checkpoints=new qs(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(w`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",O,{query:e,...t})}cancel(e,t){return this._client.post(w`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(w`/fine_tuning/jobs/${e}/events`,O,{query:t,...r})}pause(e,t){return this._client.post(w`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(w`/fine_tuning/jobs/${e}/resume`,t)}};yr.Checkpoints=qs;var Le=class extends x{constructor(){super(...arguments),this.methods=new Us(this._client),this.jobs=new yr(this._client),this.checkpoints=new gr(this._client),this.alpha=new fr(this._client)}};Le.Methods=Us;Le.Jobs=yr;Le.Checkpoints=gr;Le.Alpha=fr;var Gs=class extends x{};var Ft=class extends x{constructor(){super(...arguments),this.graderModels=new Gs(this._client)}};Ft.GraderModels=Gs;var br=class extends x{createVariation(e,t){return this._client.post("/images/variations",Ee({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Ee({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}};var vr=class extends x{retrieve(e,t){return this._client.get(w`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",He,e)}delete(e,t){return this._client.delete(w`/models/${e}`,t)}};var wr=class extends x{create(e,t){return this._client.post("/moderations",{body:e,...t})}};var Vs=class extends x{accept(e,t,r){return this._client.post(w`/realtime/calls/${e}/accept`,{body:t,...r,headers:I([{Accept:"*/*"},r?.headers])})}hangup(e,t){return this._client.post(w`/realtime/calls/${e}/hangup`,{...t,headers:I([{Accept:"*/*"},t?.headers])})}refer(e,t,r){return this._client.post(w`/realtime/calls/${e}/refer`,{body:t,...r,headers:I([{Accept:"*/*"},r?.headers])})}reject(e,t={},r){return this._client.post(w`/realtime/calls/${e}/reject`,{body:t,...r,headers:I([{Accept:"*/*"},r?.headers])})}};var zs=class extends x{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}};var lt=class extends x{constructor(){super(...arguments),this.clientSecrets=new zs(this._client),this.calls=new Vs(this._client)}};lt.ClientSecrets=zs;lt.Calls=Vs;function om(n,e){return!e||!Vg(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:Cd(n,e)}function Cd(n,e){let t=n.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:Kg(e,s)};if(s.type==="message"){let i=s.content.map(a=>a.type==="output_text"?{...a,parsed:Gg(e,a.text)}:a);return{...s,content:i}}return s}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||Wa(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let s of r.output)if(s.type==="message"){for(let i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),r}function Gg(n,e){return n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(e):JSON.parse(e)}function Vg(n){return!!ri(n.text?.format)}function zg(n){return n?.$brand==="auto-parseable-tool"}function Wg(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function Kg(n,e){let t=Wg(n.tools??[],e.name);return{...e,...e,parsed_arguments:zg(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function Wa(n){let e=[];for(let t of n.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var Ws,Ka,Ot,Ja,cm,lm,dm,um,Xa=class n extends It{constructor(e){super(),Ws.add(this),Ka.set(this,void 0),Ot.set(this,void 0),Ja.set(this,void 0),T(this,Ka,e,"f")}static createResponse(e,t,r){let s=new n(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),g(this,Ws,"m",cm).call(this);let i,a=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(let o of i)g(this,Ws,"m",lm).call(this,o,a);if(i.controller.signal?.aborted)throw new Z;return g(this,Ws,"m",dm).call(this)}[(Ka=new WeakMap,Ot=new WeakMap,Ja=new WeakMap,Ws=new WeakSet,cm=function(){this.ended||T(this,Ot,void 0,"f")},lm=function(t,r){if(this.ended)return;let s=(a,o)=>{(r==null||o.sequence_number>r)&&this._emit(a,o)},i=g(this,Ws,"m",um).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{let a=i.output[t.output_index];if(!a)throw new C(`missing output at index ${t.output_index}`);if(a.type==="message"){let o=a.content[t.content_index];if(!o)throw new C(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new C(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let a=i.output[t.output_index];if(!a)throw new C(`missing output at index ${t.output_index}`);a.type==="function_call"&&s("response.function_call_arguments.delta",{...t,snapshot:a.arguments});break}default:s(t.type,t);break}},dm=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=g(this,Ot,"f");if(!t)throw new C("request ended without sending any events");T(this,Ot,void 0,"f");let r=Jg(t,g(this,Ka,"f"));return T(this,Ja,r,"f"),r},um=function(t){let r=g(this,Ot,"f");if(!r){if(t.type!=="response.created")throw new C(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=T(this,Ot,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let s=r.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);let i=s.type,a=t.part;i==="message"&&a.type!=="reasoning_text"?s.content.push(a):i==="reasoning"&&a.type==="reasoning_text"&&(s.content||(s.content=[]),s.content.push(a));break}case"response.output_text.delta":{let s=r.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);if(s.type==="message"){let i=s.content[t.content_index];if(!i)throw new C(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new C(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{let s=r.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.reasoning_text.delta":{let s=r.output[t.output_index];if(!s)throw new C(`missing output at index ${t.output_index}`);if(s.type==="reasoning"){let i=s.content?.[t.content_index];if(!i)throw new C(`missing content at index ${t.content_index}`);if(i.type!=="reasoning_text")throw new C(`expected content to be 'reasoning_text', got ${i.type}`);i.text+=t.delta}break}case"response.completed":{T(this,Ot,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=g(this,Ja,"f");if(!e)throw new C("stream ended without producing a ChatCompletion");return e}};function Jg(n,e){return om(n,e)}var Ks=class extends x{list(e,t={},r){return this._client.getAPIList(w`/responses/${e}/input_items`,O,{query:t,...r})}};var Js=class extends x{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}};var dt=class extends x{constructor(){super(...arguments),this.inputItems=new Ks(this._client),this.inputTokens=new Js(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&Wa(r),r))}retrieve(e,t={},r){return this._client.get(w`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&Wa(s),s))}delete(e,t){return this._client.delete(w`/responses/${e}`,{...t,headers:I([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>Cd(r,e))}stream(e,t){return Xa.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(w`/responses/${e}/cancel`,t)}};dt.InputItems=Ks;dt.InputTokens=Js;var Xs=class extends x{create(e,t,r){return this._client.post(w`/uploads/${e}/parts`,Ee({body:t,...r},this._client))}};var Nt=class extends x{constructor(){super(...arguments),this.parts=new Xs(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(w`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(w`/uploads/${e}/complete`,{body:t,...r})}};Nt.Parts=Xs;var pm=async n=>{let e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(let s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let s of e)s.status==="fulfilled"&&r.push(s.value);return r};var Qs=class extends x{create(e,t,r){return this._client.post(w`/vector_stores/${e}/file_batches`,{body:t,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:s}=t;return this._client.get(w`/vector_stores/${s}/file_batches/${e}`,{...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{vector_store_id:s}=t;return this._client.post(w`/vector_stores/${s}/file_batches/${e}/cancel`,{...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r){let{vector_store_id:s,...i}=t;return this._client.getAPIList(w`/vector_stores/${s}/file_batches/${e}/files`,O,{query:i,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(e,t,r){let s=I([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(t,{vector_store_id:e},{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let c=a.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(o=l)}}await Be(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=s?.maxConcurrency??5,a=Math.min(i,t.length),o=this._client,c=t.values(),l=[...r];async function d(m){for(let p of m){let y=await o.files.create({file:p,purpose:"assistants"},s);l.push(y.id)}}let u=Array(a).fill(c).map(d);return await pm(u),await this.createAndPoll(e,{file_ids:l})}};var Ys=class extends x{create(e,t,r){return this._client.post(w`/vector_stores/${e}/files`,{body:t,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:s}=t;return this._client.get(w`/vector_stores/${s}/files/${e}`,{...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{vector_store_id:s,...i}=t;return this._client.post(w`/vector_stores/${s}/files/${e}`,{body:i,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(w`/vector_stores/${e}/files`,O,{query:t,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{vector_store_id:s}=t;return this._client.delete(w`/vector_stores/${s}/files/${e}`,{...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){let s=I([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(t,{vector_store_id:e},{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let c=i.response.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(o=l)}}await Be(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){let s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){let s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}content(e,t,r){let{vector_store_id:s}=t;return this._client.getAPIList(w`/vector_stores/${s}/files/${e}/content`,He,{...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var ut=class extends x{constructor(){super(...arguments),this.files=new Ys(this._client),this.fileBatches=new Qs(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(w`/vector_stores/${e}`,{...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(w`/vector_stores/${e}`,{body:t,...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",O,{query:e,...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(w`/vector_stores/${e}`,{...t,headers:I([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,r){return this._client.getAPIList(w`/vector_stores/${e}/search`,He,{body:t,method:"post",...r,headers:I([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};ut.Files=Ys;ut.FileBatches=Qs;var xr=class extends x{create(e,t){return this._client.post("/videos",cd({body:e,...t},this._client))}retrieve(e,t){return this._client.get(w`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",nt,{query:e,...t})}delete(e,t){return this._client.delete(w`/videos/${e}`,t)}downloadContent(e,t={},r){return this._client.get(w`/videos/${e}/content`,{query:t,...r,headers:I([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}remix(e,t,r){return this._client.post(w`/videos/${e}/remix`,cd({body:t,...r},this._client))}};var Zs,mm,Qa,Er=class extends x{constructor(){super(...arguments),Zs.add(this)}async unwrap(e,t,r=this._client.webhookSecret,s=300){return await this.verifySignature(e,t,r,s),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");g(this,Zs,"m",mm).call(this,r);let i=I([t]).values,a=g(this,Zs,"m",Qa).call(this,i,"webhook-signature"),o=g(this,Zs,"m",Qa).call(this,i,"webhook-timestamp"),c=g(this,Zs,"m",Qa).call(this,i,"webhook-id"),l=parseInt(o,10);if(isNaN(l))throw new $e("Invalid webhook timestamp format");let d=Math.floor(Date.now()/1e3);if(d-l>s)throw new $e("Webhook timestamp is too old");if(l>d+s)throw new $e("Webhook timestamp is too new");let u=a.split(" ").map(v=>v.startsWith("v1,")?v.substring(3):v),m=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),p=c?`${c}.${o}.${e}`:`${o}.${e}`,y=await crypto.subtle.importKey("raw",m,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let v of u)try{let E=Buffer.from(v,"base64");if(await crypto.subtle.verify("HMAC",y,E,new TextEncoder().encode(p)))return}catch{continue}throw new $e("The given webhook signature does not match the expected signature")}};Zs=new WeakSet,mm=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Qa=function(e,t){if(!e)throw new Error("Headers are required");let r=e.get(t);if(r==null)throw new Error(`Missing required header: ${t}`);return r};var _d,Pd,Ya,hm,M=class{constructor({baseURL:e=Rt("OPENAI_BASE_URL"),apiKey:t=Rt("OPENAI_API_KEY"),organization:r=Rt("OPENAI_ORG_ID")??null,project:s=Rt("OPENAI_PROJECT_ID")??null,webhookSecret:i=Rt("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(_d.add(this),Ya.set(this,void 0),this.completions=new dr(this),this.chat=new Ct(this),this.embeddings=new pr(this),this.files=new hr(this),this.images=new br(this),this.audio=new qe(this),this.moderations=new wr(this),this.models=new vr(this),this.fineTuning=new Le(this),this.graders=new Ft(this),this.vectorStores=new ut(this),this.webhooks=new Er(this),this.beta=new Me(this),this.batches=new ir(this),this.uploads=new Nt(this),this.responses=new dt(this),this.realtime=new lt(this),this.conversations=new Mt(this),this.evals=new Lt(this),this.containers=new kt(this),this.videos=new xr(this),t===void 0)throw new C("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let o={apiKey:t,organization:r,project:s,webhookSecret:i,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&xp())throw new C(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??Pd.DEFAULT_TIMEOUT,this.logger=o.logger??console;let c="warn";this.logLevel=c,this.logLevel=rd(o.logLevel,"ClientOptions.logLevel",this)??rd(Rt("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??c,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??Ap(),T(this,Ya,Sp,"f"),this._options=o,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=r,this.project=s,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return I([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return ed(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${At}`}defaultIdempotencyKey(){return`stainless-node-retry-${Gl()}`}makeStatusError(e,t,r,s){return re.generate(e,t,r,s)}async _callApiKey(){let e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=await e()}catch(r){throw r instanceof C?r:new C(`Failed to get token from 'apiKey' function: ${r.message}`,{cause:r})}if(typeof t!="string"||!t)throw new C(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,r){let s=!g(this,_d,"m",hm).call(this)&&r||this.baseURL,i=mp(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return hp(a)||(t={...a,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tr(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let s=await e,i=s.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(s);let{req:a,url:o,timeout:c}=await this.buildRequest(s,{retryCount:i-t});await this.prepareRequest(a,{url:o,options:s});let l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,u=Date.now();if(Y(this).debug(`[${l}] sending request`,st({retryOfRequestLogID:r,method:s.method,url:o,options:s,headers:a.headers})),s.signal?.aborted)throw new Z;let m=new AbortController,p=await this.fetchWithTimeout(o,a,c,m).catch(Wn),y=Date.now();if(p instanceof globalThis.Error){let A=`retrying, ${t} attempts remaining`;if(s.signal?.aborted)throw new Z;let f=zn(p)||/timed? ?out/i.test(String(p)+("cause"in p?String(p.cause):""));if(t)return Y(this).info(`[${l}] connection ${f?"timed out":"failed"} - ${A}`),Y(this).debug(`[${l}] connection ${f?"timed out":"failed"} (${A})`,st({retryOfRequestLogID:r,url:o,durationMs:y-u,message:p.message})),this.retryRequest(s,t,r??l);throw Y(this).info(`[${l}] connection ${f?"timed out":"failed"} - error; no more retries left`),Y(this).debug(`[${l}] connection ${f?"timed out":"failed"} (error; no more retries left)`,st({retryOfRequestLogID:r,url:o,durationMs:y-u,message:p.message})),f?new Et:new xt({cause:p})}let v=[...p.headers.entries()].filter(([A])=>A==="x-request-id").map(([A,f])=>", "+A+": "+JSON.stringify(f)).join(""),E=`[${l}${d}${v}] ${a.method} ${o} ${p.ok?"succeeded":"failed"} with status ${p.status} in ${y-u}ms`;if(!p.ok){let A=await this.shouldRetry(p);if(t&&A){let F=`retrying, ${t} attempts remaining`;return await Ip(p.body),Y(this).info(`${E} - ${F}`),Y(this).debug(`[${l}] response error (${F})`,st({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:y-u})),this.retryRequest(s,t,r??l,p.headers)}let f=A?"error; no more retries left":"error; not retryable";Y(this).info(`${E} - ${f}`);let S=await p.text().catch(F=>Wn(F).message),P=yp(S),k=P?void 0:S;throw Y(this).debug(`[${l}] response error (${f})`,st({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,message:k,durationMs:Date.now()-u})),this.makeStatusError(p.status,P,k,p.headers)}return Y(this).info(E),Y(this).debug(`[${l}] response start`,st({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:y-u})),{response:p,options:s,controller:m,requestLogID:l,retryOfRequestLogID:r,startTime:u}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){let r=this.makeRequest(t,null,void 0);return new Zn(this,r,e)}async fetchWithTimeout(e,t,r,s){let{signal:i,method:a,...o}=t||{};i&&i.addEventListener("abort",()=>s.abort());let c=setTimeout(()=>s.abort(),r),l=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,d={signal:s.signal,...l?{duplex:"half"}:{},method:"GET",...o};a&&(d.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,s){let i,a=s?.get("retry-after-ms");if(a){let c=parseFloat(a);Number.isNaN(c)||(i=c)}let o=s?.get("retry-after");if(o&&!i){let c=parseFloat(o);Number.isNaN(c)?i=Date.parse(o)-Date.now():i=c*1e3}if(!(i&&0<=i&&i<60*1e3)){let c=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,c)}return await Be(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:s,path:i,query:a,defaultBaseURL:o}=r,c=this.buildURL(i,a,o);"timeout"in r&&gp("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:d}=this.buildBody({options:r}),u=await this.buildHeaders({options:e,method:s,bodyHeaders:l,retryCount:t});return{req:{method:s,headers:u,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"},...d&&{body:d},...this.fetchOptions??{},...r.fetchOptions??{}},url:c,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:s}){let i={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let a=I([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Ep(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=I([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Ia(e)}:g(this,Ya,"f").call(this,{body:e,headers:r})}};Pd=M,Ya=new WeakMap,_d=new WeakSet,hm=function(){return this.baseURL!=="https://api.openai.com/v1"};M.OpenAI=Pd;M.DEFAULT_TIMEOUT=6e5;M.OpenAIError=C;M.APIError=re;M.APIConnectionError=xt;M.APIConnectionTimeoutError=Et;M.APIUserAbortError=Z;M.NotFoundError=ms;M.ConflictError=hs;M.RateLimitError=gs;M.BadRequestError=ds;M.AuthenticationError=us;M.InternalServerError=ys;M.PermissionDeniedError=ps;M.UnprocessableEntityError=fs;M.InvalidWebhookSignatureError=$e;M.toFile=La;M.Completions=dr;M.Chat=Ct;M.Embeddings=pr;M.Files=hr;M.Images=br;M.Audio=qe;M.Moderations=wr;M.Models=vr;M.FineTuning=Le;M.Graders=Ft;M.VectorStores=ut;M.Webhooks=Er;M.Beta=Me;M.Batches=ir;M.Uploads=Nt;M.Responses=dt;M.Realtime=lt;M.Conversations=Mt;M.Evals=Lt;M.Containers=kt;M.Videos=xr;var mi=class{name="OpenAI";client=null;apiKey;model;constructor(e,t){this.apiKey=e,this.model=t??"gpt-4o-mini"}getClient(){if(!this.client&&this.apiKey&&this.apiKey.trim().length>0)try{this.client=new M({apiKey:this.apiKey})}catch(e){throw h.warn("Failed to initialize OpenAI client:",e),new Error("Failed to initialize OpenAI client")}if(!this.client)throw new Error("OpenAI client not initialized");return this.client}authenticate(e){return Promise.resolve(e.trim().length>0&&e.startsWith("sk-"))}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("OpenAI provider is not available");let t=this.constructPrompt(e);try{let i=(await this.getClient().chat.completions.create({model:this.model,messages:[{role:"user",content:t}],max_tokens:256,temperature:.1})).choices[0]?.message?.content;if(!i)throw new Error("No content in OpenAI response");return this.parseResponse(i)}catch(r){let s=r;if(s?.status===429||s?.response?.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(s?.status===401||s?.response?.status===401)throw new Error("Invalid API key. Please check your OpenAI API key.");if(r instanceof Error){let i=r.message??"Unknown error";throw new Error(`OpenAI API error: ${i}`)}throw new Error("OpenAI API error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=X(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse OpenAI response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var fm;(function(n){n.STRING="string",n.NUMBER="number",n.INTEGER="integer",n.BOOLEAN="boolean",n.ARRAY="array",n.OBJECT="object"})(fm||(fm={}));var gm;(function(n){n.LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python"})(gm||(gm={}));var ym;(function(n){n.OUTCOME_UNSPECIFIED="outcome_unspecified",n.OUTCOME_OK="outcome_ok",n.OUTCOME_FAILED="outcome_failed",n.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(ym||(ym={}));var bm=["user","model","function","system"],vm;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(vm||(vm={}));var wm;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(wm||(wm={}));var xm;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(xm||(xm={}));var Em;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(Em||(Em={}));var hi;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.OTHER="OTHER"})(hi||(hi={}));var Am;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(Am||(Am={}));var Im;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(Im||(Im={}));var Sm;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Sm||(Sm={}));var le=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},Dt=class extends le{constructor(e,t){super(e),this.response=t}},eo=class extends le{constructor(e,t,r,s){super(e),this.status=t,this.statusText=r,this.errorDetails=s}},Ve=class extends le{},to=class extends le{};var ry="https://generativelanguage.googleapis.com",sy="v1beta",ny="0.24.1",iy="genai-js",Ar;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Ar||(Ar={}));var Rd=class{constructor(e,t,r,s,i){this.model=e,this.task=t,this.apiKey=r,this.stream=s,this.requestOptions=i}toString(){var e,t;let r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||sy,i=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||ry}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}};function ay(n){let e=[];return n?.apiClient&&e.push(n.apiClient),e.push(`${iy}/${ny}`),e.join(" ")}async function oy(n){var e;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",ay(n.requestOptions)),t.append("x-goog-api-key",n.apiKey);let r=(e=n.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new Ve(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(let[s,i]of r.entries()){if(s==="x-goog-api-key")throw new Ve(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new Ve(`Header name ${s} can only be set using the apiClient field`);t.append(s,i)}}return t}async function cy(n,e,t,r,s,i){let a=new Rd(n,e,t,r,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},py(i)),{method:"POST",headers:await oy(a),body:s})}}async function yi(n,e,t,r,s,i={},a=fetch){let{url:o,fetchOptions:c}=await cy(n,e,t,r,s,i);return ly(o,c,a)}async function ly(n,e,t=fetch){let r;try{r=await t(n,e)}catch(s){dy(s,n)}return r.ok||await uy(r,n),r}function dy(n,e){let t=n;throw t.name==="AbortError"?(t=new to(`Request aborted when fetching ${e.toString()}: ${n.message}`),t.stack=n.stack):n instanceof eo||n instanceof Ve||(t=new le(`Error fetching from ${e.toString()}: ${n.message}`),t.stack=n.stack),t}async function uy(n,e){let t="",r;try{let s=await n.json();t=s.error.message,s.error.details&&(t+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new eo(`Error fetching from ${e.toString()}: [${n.status} ${n.statusText}] ${t}`,n.status,n.statusText,r)}function py(n){let e={};if(n?.signal!==void 0||n?.timeout>=0){let t=new AbortController;n?.timeout>=0&&setTimeout(()=>t.abort(),n.timeout),n?.signal&&n.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function kd(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Za(n.candidates[0]))throw new Dt(`${$t(n)}`,n);return my(n)}else if(n.promptFeedback)throw new Dt(`Text not available. ${$t(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Za(n.candidates[0]))throw new Dt(`${$t(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Cm(n)[0]}else if(n.promptFeedback)throw new Dt(`Function call not available. ${$t(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Za(n.candidates[0]))throw new Dt(`${$t(n)}`,n);return Cm(n)}else if(n.promptFeedback)throw new Dt(`Function call not available. ${$t(n)}`,n)},n}function my(n){var e,t,r,s;let i=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.text&&i.push(a.text),a.executableCode&&i.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&i.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function Cm(n){var e,t,r,s;let i=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.functionCall&&i.push(a.functionCall);if(i.length>0)return i}var hy=[hi.RECITATION,hi.SAFETY,hi.LANGUAGE];function Za(n){return!!n.finishReason&&hy.includes(n.finishReason)}function $t(n){var e,t,r;let s="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)s+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((r=n.candidates)===null||r===void 0)&&r[0]){let i=n.candidates[0];Za(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function fi(n){return this instanceof fi?(this.v=n,this):new fi(n)}function fy(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(m){r[m]&&(s[m]=function(p){return new Promise(function(y,v){i.push([m,p,y,v])>1||o(m,p)})})}function o(m,p){try{c(r[m](p))}catch(y){u(i[0][3],y)}}function c(m){m.value instanceof fi?Promise.resolve(m.value.v).then(l,d):u(i[0][2],m)}function l(m){o("next",m)}function d(m){o("throw",m)}function u(m,p){m(p),i.shift(),i.length&&o(i[0][0],i[0][1])}}var _m=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function gy(n){let e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=vy(e),[r,s]=t.tee();return{stream:by(r),response:yy(s)}}async function yy(n){let e=[],t=n.getReader();for(;;){let{done:r,value:s}=await t.read();if(r)return kd(wy(e));e.push(s)}}function by(n){return fy(this,arguments,function*(){let t=n.getReader();for(;;){let{value:r,done:s}=yield fi(t.read());if(s)break;yield yield fi(kd(r))}})}function vy(n){let e=n.getReader();return new ReadableStream({start(r){let s="";return i();function i(){return e.read().then(({value:a,done:o})=>{if(o){if(s.trim()){r.error(new le("Failed to parse stream"));return}r.close();return}s+=a;let c=s.match(_m),l;for(;c;){try{l=JSON.parse(c[1])}catch{r.error(new le(`Error parsing JSON response: "${c[1]}"`));return}r.enqueue(l),s=s.substring(c[0].length),c=s.match(_m)}return i()}).catch(a=>{let o=a;throw o.stack=a.stack,o.name==="AbortError"?o=new to("Request aborted when reading from the stream"):o=new le("Error reading from the stream"),o})}}})}function wy(n){let e=n[n.length-1],t={promptFeedback:e?.promptFeedback};for(let r of n){if(r.candidates){let s=0;for(let i of r.candidates)if(t.candidates||(t.candidates=[]),t.candidates[s]||(t.candidates[s]={index:s}),t.candidates[s].citationMetadata=i.citationMetadata,t.candidates[s].groundingMetadata=i.groundingMetadata,t.candidates[s].finishReason=i.finishReason,t.candidates[s].finishMessage=i.finishMessage,t.candidates[s].safetyRatings=i.safetyRatings,i.content&&i.content.parts){t.candidates[s].content||(t.candidates[s].content={role:i.content.role||"user",parts:[]});let a={};for(let o of i.content.parts)o.text&&(a.text=o.text),o.functionCall&&(a.functionCall=o.functionCall),o.executableCode&&(a.executableCode=o.executableCode),o.codeExecutionResult&&(a.codeExecutionResult=o.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),t.candidates[s].content.parts.push(a)}s++}r.usageMetadata&&(t.usageMetadata=r.usageMetadata)}return t}async function Mm(n,e,t,r){let s=await yi(e,Ar.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),r);return gy(s)}async function Lm(n,e,t,r){let i=await(await yi(e,Ar.GENERATE_CONTENT,n,!1,JSON.stringify(t),r)).json();return{response:kd(i)}}function Fm(n){if(n!=null){if(typeof n=="string")return{role:"system",parts:[{text:n}]};if(n.text)return{role:"system",parts:[n]};if(n.parts)return n.role?n:{role:"system",parts:n.parts}}}function gi(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(let t of n)typeof t=="string"?e.push({text:t}):e.push(t);return xy(e)}function xy(n){let e={role:"user",parts:[]},t={role:"function",parts:[]},r=!1,s=!1;for(let i of n)"functionResponse"in i?(t.parts.push(i),s=!0):(e.parts.push(i),r=!0);if(r&&s)throw new le("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new le("No content is provided for sending chat message.");return r?e:t}function Ey(n,e){var t;let r={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},s=n.generateContentRequest!=null;if(n.contents){if(s)throw new Ve("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=n.contents}else if(s)r=Object.assign(Object.assign({},r),n.generateContentRequest);else{let i=gi(n);r.contents=[i]}return{generateContentRequest:r}}function Pm(n){let e;return n.contents?e=n:e={contents:[gi(n)]},n.systemInstruction&&(e.systemInstruction=Fm(n.systemInstruction)),e}function Ay(n){return typeof n=="string"||Array.isArray(n)?{content:gi(n)}:n}var Rm=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Iy={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Sy(n){let e=!1;for(let t of n){let{role:r,parts:s}=t;if(!e&&r!=="user")throw new le(`First content should be with role 'user', got ${r}`);if(!bm.includes(r))throw new le(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(bm)}`);if(!Array.isArray(s))throw new le("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new le("Each Content should have at least one part");let i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let o of s)for(let c of Rm)c in o&&(i[c]+=1);let a=Iy[r];for(let o of Rm)if(!a.includes(o)&&i[o]>0)throw new le(`Content with role '${r}' can't contain '${o}' part`);e=!0}}function Tm(n){var e;if(n.candidates===void 0||n.candidates.length===0)return!1;let t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(let r of t.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}var km="SILENT_ERROR",Td=class{constructor(e,t,r,s={}){this.model=t,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r?.history&&(Sy(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,s,i,a,o,c;await this._sendPromise;let l=gi(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t),m;return this._sendPromise=this._sendPromise.then(()=>Lm(this._apiKey,this.model,d,u)).then(p=>{var y;if(Tm(p.response)){this._history.push(l);let v=Object.assign({parts:[],role:"model"},(y=p.response.candidates)===null||y===void 0?void 0:y[0].content);this._history.push(v)}else{let v=$t(p.response);v&&console.warn(`sendMessage() was unsuccessful. ${v}. Inspect response object for details.`)}m=p}).catch(p=>{throw this._sendPromise=Promise.resolve(),p}),await this._sendPromise,m}async sendMessageStream(e,t={}){var r,s,i,a,o,c;await this._sendPromise;let l=gi(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t),m=Mm(this._apiKey,this.model,d,u);return this._sendPromise=this._sendPromise.then(()=>m).catch(p=>{throw new Error(km)}).then(p=>p.response).then(p=>{if(Tm(p)){this._history.push(l);let y=Object.assign({},p.candidates[0].content);y.role||(y.role="model"),this._history.push(y)}else{let y=$t(p);y&&console.warn(`sendMessageStream() was unsuccessful. ${y}. Inspect response object for details.`)}}).catch(p=>{p.message!==km&&console.error(p)}),m}};async function Cy(n,e,t,r){return(await yi(e,Ar.COUNT_TOKENS,n,!1,JSON.stringify(t),r)).json()}async function _y(n,e,t,r){return(await yi(e,Ar.EMBED_CONTENT,n,!1,JSON.stringify(t),r)).json()}async function Py(n,e,t,r){let s=t.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await yi(e,Ar.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:s}),r)).json()}var ro=class{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=Fm(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;let s=Pm(e),i=Object.assign(Object.assign({},this._requestOptions),t);return Lm(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}async generateContentStream(e,t={}){var r;let s=Pm(e),i=Object.assign(Object.assign({},this._requestOptions),t);return Mm(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}startChat(e){var t;return new Td(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let r=Ey(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return Cy(this.apiKey,this.model,r,s)}async embedContent(e,t={}){let r=Ay(e),s=Object.assign(Object.assign({},this._requestOptions),t);return _y(this.apiKey,this.model,r,s)}async batchEmbedContents(e,t={}){let r=Object.assign(Object.assign({},this._requestOptions),t);return Py(this.apiKey,this.model,e,r)}};var so=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new le("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ro(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new Ve("Cached content must contain a `name` field.");if(!e.model)throw new Ve("Cached content must contain a `model` field.");let s=["model","systemInstruction"];for(let a of s)if(t?.[a]&&e[a]&&t?.[a]!==e[a]){if(a==="model"){let o=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===c)continue}throw new Ve(`Different value for "${a}" specified in modelParams (${t[a]}) and cachedContent (${e[a]})`)}let i=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new ro(this.apiKey,i,r)}};var bi=class{name="Gemini";client=null;apiKey;model;constructor(e,t){this.apiKey=e,this.model=t??"gemini-1.5-flash"}getClient(){if(!this.client&&this.apiKey&&this.apiKey.trim().length>0)try{this.client=new so(this.apiKey)}catch(e){throw h.warn("Failed to initialize Gemini client:",e),new Error("Failed to initialize Gemini client")}if(!this.client)throw new Error("Gemini client not initialized");return this.client}authenticate(e){return Promise.resolve(e.trim().length>0)}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("Gemini provider is not available");let t=this.constructPrompt(e);try{let o=(await this.getClient().getGenerativeModel({model:this.model}).generateContent(t)).response.text();return this.parseResponse(o)}catch(r){let s=r;if(s?.status===429||s?.response?.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(s?.status===401||s?.response?.status===401)throw new Error("Invalid API key. Please check your Gemini API key.");if(r instanceof Error){let i=r.message??"Unknown error";throw new Error(`Gemini API error: ${i}`)}throw new Error("Gemini API error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=X(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse Gemini response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var Ir="0.37.0";var Om=!1,Sr,Md,Ry,Ty,ky,Ld,My,no,Fd,Od,Nd,io,Dd;function Nm(n,e={auto:!1}){if(Om)throw new Error(`you must \`import 'groq-sdk/shims/${n.kind}'\` before importing anything else from groq-sdk`);if(Sr)throw new Error(`can't \`import 'groq-sdk/shims/${n.kind}'\` after \`import 'groq-sdk/shims/${Sr}'\``);Om=e.auto,Sr=n.kind,Md=n.fetch,Ry=n.Request,Ty=n.Response,ky=n.Headers,Ld=n.FormData,My=n.Blob,no=n.File,Fd=n.ReadableStream,Od=n.getMultipartRequestOptions,Nd=n.getDefaultAgent,io=n.fileFromPath,Dd=n.isFsReadStream}var ao=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Dm({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'groq-sdk'`:\n- `import 'groq-sdk/shims/node'` (if you're running on Node)\n- `import 'groq-sdk/shims/web'` (otherwise)\n",t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new ao(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:a=>!1}}var $d=()=>{Sr||Nm(Dm(),{auto:!0})};$d();var he=class extends Error{},de=class n extends he{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,r){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new Bt({message:r,cause:oo(t)});let i=t;return e===400?new vi(e,i,r,s):e===401?new wi(e,i,r,s):e===403?new xi(e,i,r,s):e===404?new Ei(e,i,r,s):e===409?new Ai(e,i,r,s):e===422?new Ii(e,i,r,s):e===429?new Si(e,i,r,s):e>=500?new Ci(e,i,r,s):new n(e,i,r,s)}},Cr=class extends de{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Bt=class extends de{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},en=class extends Bt{constructor({message:e}={}){super({message:e??"Request timed out."})}},vi=class extends de{},wi=class extends de{},xi=class extends de{},Ei=class extends de{},Ai=class extends de{},Ii=class extends de{},Si=class extends de{},Ci=class extends de{};var co=class n{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1,s=new Bd;async function*i(){if(!e.body)throw t.abort(),new he("Attempted to iterate over a response with no body");let o=new tn,c=$m(e.body);for await(let l of c)for(let d of o.decode(l)){let u=s.decode(d);u&&(yield u)}for(let l of o.flush()){let d=s.decode(l);d&&(yield d)}}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(let c of i())if(!o){if(c.data.startsWith("[DONE]")){o=!0;continue}if(c.event===null||c.event==="error"){let l;try{l=JSON.parse(c.data)}catch(d){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),d}if(l&&l.error)throw new de(l.error.status_code,l.error,l.error.message,void 0);yield l}}o=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{o||t.abort()}}return new n(a,t)}static fromReadableStream(e,t){let r=!1;async function*s(){let a=new tn,o=$m(e);for await(let c of o)for(let l of a.decode(c))yield l;for(let c of a.flush())yield c}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new n(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){let a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new n(()=>s(e),this.controller),new n(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new Fd({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:i,done:a}=await t.next();if(a)return s.close();let o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){await t.return?.()}})}},Bd=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Oy(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}},tn=class n{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=n.NEWLINE_CHARS.has(t[t.length-1]||""),s=t.split(n.NEWLINE_REGEXP);return s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new he(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new he(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new he("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};tn.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","\x85","\u2028","\u2029"]);tn.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Oy(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function $m(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Bm=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Um=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&_i(n),_i=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Ny=n=>Um(n)||Bm(n)||Dd(n);async function Hd(n,e,t){if(n=await n,Um(n))return n;if(Bm(n)){let s=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");let i=_i(s)?[await s.arrayBuffer()]:[s];return new no(i,e,t)}let r=await Dy(n);if(e||(e=By(n)??"unknown_file"),!t?.type){let s=r[0]?.type;typeof s=="string"&&(t={...t,type:s})}return new no(r,e,t)}async function Dy(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(_i(n))e.push(await n.arrayBuffer());else if(Uy(n))for await(let t of n)e.push(t);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${n?.constructor?.name}; props: ${$y(n)}`);return e}function $y(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function By(n){return Ud(n.name)||Ud(n.filename)||Ud(n.path)?.split(/[\\/]/).pop()}var Ud=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Uy=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",qd=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var _r=async n=>{let e=await jm(n.body);return Od(e,n)},jm=async n=>{let e=new Ld;return await Promise.all(Object.entries(n||{}).map(([t,r])=>jd(e,t,r))),e};var jd=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Ny(t)){let r=await Hd(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>jd(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>jd(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Wm=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Km=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},po,lo;$d();async function Jm(n){let{response:e}=n;if(n.options.stream)return rn("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):co.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let r=e.headers.get("content-type")?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){let a=await e.json();return rn("response",e.status,e.url,e.headers,a),a}let i=await e.text();return rn("response",e.status,e.url,e.headers,i),i}var mo=class n extends Promise{constructor(e,t=Jm){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new n(this.responsePromise,async t=>e(await this.parseResponse(t),t))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},ho=class{constructor({baseURL:e,baseURLOverridden:t,maxRetries:r=2,timeout:s=6e4,httpAgent:i,fetch:a}){po.set(this,void 0),this.baseURL=e,Wm(this,po,t,"f"),this.maxRetries=Gd("maxRetries",r),this.timeout=Gd("timeout",s),this.httpAgent=i,this.fetch=a??Md}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json",...["head","get"].includes(e.method)?{}:{"Content-Type":"application/json"},"User-Agent":this.getUserAgent(),...Vy(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Yy()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{let i=s&&_i(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:s,path:i,query:a,defaultBaseURL:o,headers:c={}}=r,l=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:qd(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,d=this.calculateContentLength(l),u=this.buildURL(i,a,o);"timeout"in r&&Gd("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let m=r.httpAgent??this.httpAgent??Nd(u),p=r.timeout+1e3;typeof m?.options?.timeout=="number"&&p>(m.options.timeout??0)&&(m.options.timeout=p),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),c[this.idempotencyHeader]=e.idempotencyKey);let y=this.buildHeaders({options:r,headers:c,contentLength:d,retryCount:t});return{req:{method:s,...l&&{body:l},headers:y,...m&&{agent:m},signal:r.signal??null},url:u,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){let i={};r&&(i["content-length"]=r);let a=this.defaultHeaders(e);return zm(i,a),zm(i,t),qd(e.body)&&Sr!=="node"&&delete i["content-type"],uo(a,"x-stainless-retry-count")===void 0&&uo(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),uo(a,"x-stainless-timeout")===void 0&&uo(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return de.generate(e,t,r,s)}request(e,t=null){return new mo(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);let{req:i,url:a,timeout:o}=await this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),rn("request",a,r,i.headers),r.signal?.aborted)throw new Cr;let c=new AbortController,l=await this.fetchWithTimeout(a,i,o,c).catch(oo);if(l instanceof Error){if(r.signal?.aborted)throw new Cr;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new en:new Bt({cause:l})}let d=Hy(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let E=`retrying, ${t} attempts remaining`;return rn(`response (error; ${E})`,l.status,a,d),this.retryRequest(r,t,d)}let u=await l.text().catch(E=>oo(E).message),m=zy(u),p=m?void 0:u;throw rn(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,d,p),this.makeStatusError(l.status,m,p,d)}return{response:l,options:r,controller:c}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new Vd(this,r,e)}buildURL(e,t,r){let s=!Km(this,po,"f")&&r||this.baseURL,i=Ky(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return Xy(a)||(t={...a,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new he(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){let{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r),c={signal:s.signal,...a};return c.method&&(c.method=c.method.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s,i=r?.["retry-after-ms"];if(i){let o=parseFloat(i);Number.isNaN(o)||(s=o)}let a=r?.["retry-after"];if(a&&!s){let o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){let o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Jy(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ir}`}};po=new WeakMap;var Hm=class{constructor(e,t,r,s){lo.set(this,void 0),Wm(this,lo,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new he("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Km(this,lo,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(lo=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Vd=class extends mo{constructor(e,t,r){super(t,async s=>new r(e,s.response,await Jm(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Hy=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}});var qy=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ir,"X-Stainless-OS":Gm(Deno.build.os),"X-Stainless-Arch":qm(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ir,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ir,"X-Stainless-OS":Gm(process.platform),"X-Stainless-Arch":qm(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=Gy();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ir,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ir,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Gy(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}var qm=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Gm=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),Vm,Vy=()=>Vm??(Vm=qy()),zy=n=>{try{return JSON.parse(n)}catch{return}},Wy=/^[a-z][a-z0-9+.-]*:/i,Ky=n=>Wy.test(n),Jy=n=>new Promise(e=>setTimeout(e,n)),Gd=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new he(`${n} must be an integer`);if(e<0)throw new he(`${n} must be a positive integer`);return e},oo=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)};var zd=n=>{if(typeof process<"u")return process.env?.[n]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(n)?.trim()};function Xy(n){if(!n)return!0;for(let e in n)return!1;return!0}function Qy(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function zm(n,e){for(let t in e){if(!Qy(e,t))continue;let r=t.toLowerCase();if(!r)continue;let s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function rn(n,...e){typeof process<"u"&&process?.env?.DEBUG==="true"&&console.log(`Groq:DEBUG:${n}`,...e)}var Yy=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Xm=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Zy=n=>typeof n?.get=="function";var uo=(n,e)=>{let t=e.toLowerCase();if(Zy(n)){let r=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,i,a)=>i+a.toUpperCase());for(let s of[e,t,e.toUpperCase(),r]){let i=n.get(s);if(i)return i}}for(let[r,s]of Object.entries(n))if(r.toLowerCase()===t)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s};var W=class{constructor(e){this._client=e}};var sn=class extends W{create(e,t){return this._client.post("/openai/v1/audio/speech",{body:e,...t,headers:{Accept:"audio/wav",...t?.headers},__binaryResponse:!0})}};var nn=class extends W{create(e,t){return this._client.post("/openai/v1/audio/transcriptions",_r({body:e,...t}))}};var an=class extends W{create(e,t){return this._client.post("/openai/v1/audio/translations",_r({body:e,...t}))}};var ze=class extends W{constructor(){super(...arguments),this.speech=new sn(this._client),this.transcriptions=new nn(this._client),this.translations=new an(this._client)}};ze.Speech=sn;ze.Transcriptions=nn;ze.Translations=an;var Pr=class extends W{create(e,t){return this._client.post("/openai/v1/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/openai/v1/batches/${e}`,t)}list(e){return this._client.get("/openai/v1/batches",e)}cancel(e,t){return this._client.post(`/openai/v1/batches/${e}/cancel`,t)}};var on=class extends W{create(e,t){return this._client.post("/openai/v1/chat/completions",{body:e,...t,stream:e.stream??!1})}};var Ut=class extends W{constructor(){super(...arguments),this.completions=new on(this._client)}};Ut.Completions=on;var Rr=class extends W{};var Tr=class extends W{create(e,t){return this._client.post("/openai/v1/embeddings",{body:e,...t})}};var kr=class extends W{create(e,t){return this._client.post("/openai/v1/files",_r({body:e,...t}))}list(e){return this._client.get("/openai/v1/files",e)}delete(e,t){return this._client.delete(`/openai/v1/files/${e}`,t)}content(e,t){return this._client.get(`/openai/v1/files/${e}/content`,{...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}info(e,t){return this._client.get(`/openai/v1/files/${e}`,t)}};var Mr=class extends W{retrieve(e,t){return this._client.get(`/openai/v1/models/${e}`,t)}list(e){return this._client.get("/openai/v1/models",e)}delete(e,t){return this._client.delete(`/openai/v1/models/${e}`,t)}};var Qm,Ym,ib,j=class extends ho{constructor({baseURL:e=zd("GROQ_BASE_URL"),apiKey:t=zd("GROQ_API_KEY"),...r}={}){if(t===void 0)throw new he("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");let s={apiKey:t,...r,baseURL:e||"https://api.groq.com"};if(!s.dangerouslyAllowBrowser&&Xm())throw new he(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Groq({ apiKey, dangerouslyAllowBrowser: true })`);super({baseURL:s.baseURL,baseURLOverridden:e?e!=="https://api.groq.com":!1,timeout:s.timeout??6e4,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),Qm.add(this),this.completions=new Rr(this),this.chat=new Ut(this),this.embeddings=new Tr(this),this.audio=new ze(this),this.models=new Mr(this),this.batches=new Pr(this),this.files=new kr(this),this._options=s,this.apiKey=t}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};Ym=j,Qm=new WeakSet,ib=function(){return this.baseURL!=="https://api.groq.com"};j.Groq=Ym;j.DEFAULT_TIMEOUT=6e4;j.GroqError=he;j.APIError=de;j.APIConnectionError=Bt;j.APIConnectionTimeoutError=en;j.APIUserAbortError=Cr;j.NotFoundError=Ei;j.ConflictError=Ai;j.RateLimitError=Si;j.BadRequestError=vi;j.AuthenticationError=wi;j.InternalServerError=Ci;j.PermissionDeniedError=xi;j.UnprocessableEntityError=Ii;j.toFile=Hd;j.fileFromPath=io;j.Completions=Rr;j.Chat=Ut;j.Embeddings=Tr;j.Audio=ze;j.Models=Mr;j.Batches=Pr;j.Files=kr;var Zm=j;var Pi=class{name="Groq";client=null;apiKey;model;constructor(e,t){this.apiKey=e,this.model=t??"llama-3.3-70b-versatile"}getClient(){if(!this.client&&this.apiKey&&this.apiKey.trim().length>0)try{this.client=new Zm({apiKey:this.apiKey,dangerouslyAllowBrowser:!0})}catch(e){throw h.warn("Failed to initialize Groq client:",e),new Error("Failed to initialize Groq client")}if(!this.client)throw new Error("Groq client not initialized");return this.client}authenticate(e){return Promise.resolve(e.trim().length>0)}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("Groq provider is not available");let t=this.constructPrompt(e);try{let i=(await this.getClient().chat.completions.create({model:this.model,messages:[{role:"user",content:t}],max_tokens:256,temperature:.1})).choices[0]?.message?.content;if(!i)throw new Error("No content in Groq response");return this.parseResponse(i)}catch(r){let s=r;if(s?.status===429||s?.response?.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(s?.status===401||s?.response?.status===401)throw new Error("Invalid API key. Please check your Groq API key.");if(r instanceof Error){let i=r.message??"Unknown error";throw new Error(`Groq API error: ${i}`)}throw new Error("Groq API error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=X(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse Groq response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var eh=require("obsidian");var go=class{name="OpenRouter";apiKey;model;baseUrl="https://openrouter.ai/api/v1/chat/completions";constructor(e,t){this.apiKey=e,this.model=t??"openai/gpt-4o-mini"}authenticate(e){return Promise.resolve(e.trim().length>0)}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("OpenRouter provider is not available");let t=this.constructPrompt(e);try{let r=await(0,eh.requestUrl)({url:this.baseUrl,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":"https://github.com/FallingWithStyle/obsidian-ideatr","X-Title":"Ideatr"},body:JSON.stringify({model:this.model,messages:[{role:"user",content:t}],max_tokens:256,temperature:.1}),throw:!1});if(r.status<200||r.status>=300){if(r.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(r.status===401)throw new Error("Invalid API key. Please check your OpenRouter API key.");let c=(typeof r.json=="function"?await r.json():r.json)??{};throw new Error(`OpenRouter API error: ${typeof c.error=="string"?c.error:"Request failed"}`)}let a=(typeof r.json=="function"?await r.json():r.json).choices?.[0]?.message?.content;if(!a)throw new Error("No content in OpenRouter response");return this.parseResponse(a)}catch(r){throw r instanceof Error?r.message.includes("Rate limit")||r.message.includes("Invalid API key")?r:new Error(`OpenRouter API error: ${r.message}`):new Error("OpenRouter API error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=X(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse OpenRouter response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var th=require("obsidian");var yo=class{name="Custom Endpoint";endpointUrl;format;constructor(e,t="ollama"){this.endpointUrl=e,this.format=t}authenticate(e){try{return new URL(e),Promise.resolve(e.trim().length>0)}catch{return Promise.resolve(!1)}}isAvailable(){return this.endpointUrl.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("Custom endpoint provider is not available");let t=this.constructPrompt(e);try{let r,s;this.format==="ollama"?(r={model:"llama3.2",messages:[{role:"user",content:t}],stream:!1},s="message.content"):(r={model:"gpt-4o-mini",messages:[{role:"user",content:t}],max_tokens:256,temperature:.1},s="choices[0].message.content");let i=await(0,th.requestUrl)({url:this.endpointUrl,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),throw:!1});if(i.status<200||i.status>=300){let d=(typeof i.json=="function"?await i.json():i.json)??{};throw new Error(`Custom endpoint error: ${typeof d.error=="string"?d.error:"Request failed"}`)}let o=typeof i.json=="function"?await i.json():i.json,c;if(s==="message.content"?c=typeof o.message?.content=="string"?o.message.content:"":c=typeof o.choices?.[0]?.message?.content=="string"?o.choices[0].message.content:"",!c)throw new Error("No content in custom endpoint response");return this.parseResponse(c)}catch(r){throw r instanceof Error?new Error(`Custom endpoint error: ${r.message}`):new Error("Custom endpoint error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=X(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse custom endpoint response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var pt=class{static createProvider(e,t,r){switch(e){case"anthropic":return new Vn(t,r?.customModel);case"openai":return new mi(t,r?.customModel);case"gemini":return new bi(t,r?.customModel);case"groq":return new Pi(t,r?.customModel);case"openrouter":return new go(t,r?.openRouterModel);case"custom":{if(!r?.customEndpointUrl)throw new Error("Custom endpoint URL is required for custom provider");let s=r.customEndpointUrl.includes("/v1/chat/completions")?"openai":"ollama";return new yo(r.customEndpointUrl,s)}case"custom-model":{if(!r?.customModelProvider||!r?.customModel)throw new Error("Custom model provider and model are required for custom-model provider");let s=r.customModelProvider;switch(s){case"anthropic":return new Vn(t,r.customModel);case"openai":return new mi(t,r.customModel);case"gemini":return new bi(t,r.customModel);case"groq":return new Pi(t,r.customModel);default:throw new Error(`Unsupported custom model provider: ${String(s)}`)}}case"none":throw new Error('Cannot create provider for type "none"');default:throw new Error(`Unknown provider type: ${String(e)}`)}}};var ab={"anthropic-haiku":{key:"anthropic-haiku",name:"Claude 3.5 Haiku",badge:"EFFICIENT",provider:"anthropic",modelId:"claude-3-5-haiku-20241022",description:"Fast, cost-effective model ideal for classification tasks. Excellent at structured work like categorization and tagging.",quality:4,speed:5,cost:"low",costEstimate:"~$0.002 per idea",pros:["Fast","Cost-effective","Good accuracy","Low latency"],cons:["Less nuanced than larger models"],bestFor:"Most users"},"anthropic-sonnet":{key:"anthropic-sonnet",name:"Claude 3.5 Sonnet",badge:"BALANCED",provider:"anthropic",modelId:"claude-3-5-sonnet-20241022",description:"Balanced performance with better reasoning and accuracy. Great for complex or nuanced classification tasks.",quality:4.5,speed:4,cost:"medium",costEstimate:"~$0.015 per idea",pros:["Better reasoning","Higher accuracy","Handles complexity well"],cons:["More expensive","Slightly slower"],bestFor:"Users who want better quality"},"anthropic-opus":{key:"anthropic-opus",name:"Claude 3 Opus",badge:"PREMIUM",provider:"anthropic",modelId:"claude-3-opus-20240229",description:"Highest quality model for complex or nuanced classification. Best for edge cases and ambiguous ideas.",quality:5,speed:2,cost:"high",costEstimate:"~$0.15 per idea",pros:["Best quality","Excellent reasoning","Handles edge cases"],cons:["Expensive","Slower","Overkill for simple tasks"],bestFor:"Power users with complex ideas"},"openai-mini":{key:"openai-mini",name:"GPT-4o Mini",badge:"EFFICIENT",provider:"openai",modelId:"gpt-4o-mini",description:"Fast, cost-effective model ideal for classification tasks. Excellent at structured work like categorization and tagging.",quality:4,speed:5,cost:"low",costEstimate:"~$0.001 per idea",pros:["Very fast","Most cost-effective","Good accuracy","Low latency"],cons:["Less nuanced than GPT-4o"],bestFor:"Most users"},"openai-4o":{key:"openai-4o",name:"GPT-4o",badge:"BALANCED",provider:"openai",modelId:"gpt-4o",description:"High-quality model with excellent reasoning capabilities. Great for complex or nuanced classification tasks.",quality:4.5,speed:4,cost:"medium",costEstimate:"~$0.01 per idea",pros:["Better reasoning","Higher accuracy","Handles complexity well"],cons:["More expensive","Slightly slower"],bestFor:"Users who want better quality"},"gemini-flash":{key:"gemini-flash",name:"Gemini 1.5 Flash",badge:"EFFICIENT",provider:"gemini",modelId:"gemini-1.5-flash",description:"Fast, cost-effective model ideal for classification tasks. Excellent at structured work like categorization and tagging.",quality:4,speed:5,cost:"low",costEstimate:"~$0.0005 per idea",pros:["Very fast","Most cost-effective","Good accuracy","Low latency"],cons:["Less nuanced than Pro"],bestFor:"Most users"},"gemini-pro":{key:"gemini-pro",name:"Gemini 1.5 Pro",badge:"BALANCED",provider:"gemini",modelId:"gemini-1.5-pro",description:"High-quality model with better reasoning and accuracy. Great for complex or nuanced classification tasks.",quality:4.5,speed:4,cost:"medium",costEstimate:"~$0.005 per idea",pros:["Better reasoning","Higher accuracy","Handles complexity well"],cons:["More expensive","Slightly slower"],bestFor:"Users who want better quality"},"groq-llama-70b":{key:"groq-llama-70b",name:"Llama 3.3 70B Versatile",badge:"BALANCED",provider:"groq",modelId:"llama-3.3-70b-versatile",description:"High-quality model with excellent reasoning. Fast inference via Groq's infrastructure.",quality:4.5,speed:5,cost:"low",costEstimate:"Free (via Groq)",pros:["Free","Very fast","High quality","Excellent reasoning"],cons:["Requires Groq API key"],bestFor:"Users who want free high-quality AI"},"groq-mixtral":{key:"groq-mixtral",name:"Mixtral 8x7B",badge:"VERSATILE",provider:"groq",modelId:"mixtral-8x7b-32768",description:"High-quality mixture-of-experts model. Fast inference via Groq's infrastructure.",quality:4.5,speed:5,cost:"low",costEstimate:"Free (via Groq)",pros:["Free","Very fast","High quality","Mixture-of-experts"],cons:["Requires Groq API key"],bestFor:"Users who want free high-quality AI"}};function Ri(n){return Object.values(ab).filter(e=>e.provider===n)}function rh(n){return{name:n.name,badge:n.badge,description:n.description,quality:n.quality,speed:n.speed,pros:n.pros,cons:n.cons,bestFor:n.bestFor,cost:n.cost,costEstimate:n.costEstimate}}function ob(n,e,t=!1){let r=n.createDiv({cls:"model-comparison-card"});r.setCssProps({border:"1px solid var(--background-modifier-border)","border-radius":"6px",padding:"0.75em","margin-bottom":"0.75em"});let s=r.createDiv({cls:"model-comparison-header"});s.setCssProps({display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"0.5em"}),s.createEl("strong",{text:e.name}).setCssProps({"font-size":"0.95em"}),s.createEl("span",{text:e.badge,cls:"model-comparison-badge"}).setCssProps({background:"var(--text-accent)",color:"var(--text-on-accent)",padding:"0.15em 0.4em","border-radius":"3px","font-size":"0.7em","font-weight":"bold"});let o=r.createDiv({cls:"model-comparison-stats"});if(o.setCssProps({display:"grid","grid-template-columns":"repeat(2, 1fr)",gap:"0.4em 1em","margin-bottom":"0.5em","font-size":"0.85em"}),o.createEl("div",{text:`\u2B50 ${e.quality}/5`}),o.createEl("div",{text:`\u26A1 ${e.speed}/5`}),t&&e.sizeMB)o.createEl("div",{text:`\u{1F4E6} ${(e.sizeMB/1e3).toFixed(1)}GB`}),e.ram&&o.createEl("div",{text:`\u{1F4BE} ${e.ram}`});else if(!t&&e.costEstimate&&(o.createEl("div",{text:`\u{1F4B0} ${e.costEstimate}`}),e.cost)){let u=e.cost.charAt(0).toUpperCase()+e.cost.slice(1);o.createEl("div",{text:`\u{1F4B5} ${u}`})}r.createEl("p",{text:e.description,cls:"model-comparison-description"}).setCssProps({margin:"0.4em 0",color:"var(--text-muted)","font-size":"0.85em","line-height":"1.4"});let l=r.createDiv({cls:"model-comparison-details"});if(l.setCssProps({display:"flex",gap:"1em","margin-top":"0.4em","font-size":"0.8em"}),e.pros.length>0){let u=l.createDiv({cls:"model-comparison-pros"});u.setCssProps({flex:"1"}),u.createEl("strong",{text:"\u2713 "}),u.appendText(e.pros.join(", "))}if(e.cons.length>0){let u=l.createDiv({cls:"model-comparison-cons"});u.setCssProps({flex:"1",color:"var(--text-muted)"}),u.createEl("strong",{text:"\u2717 "}),u.appendText(e.cons.join(", "))}let d=r.createDiv({cls:"model-comparison-best-for"});return d.setCssProps({"margin-top":"0.4em","padding-top":"0.4em","border-top":"1px solid var(--background-modifier-border)","font-size":"0.8em",color:"var(--text-muted)"}),d.createEl("strong",{text:"Best for: "}),d.appendText(e.bestFor),r}function sh(n,e,t,r=!1){if(t.length===0)return;let s=n.createDiv({cls:"model-comparison-group"});s.setCssProps({"margin-bottom":"1.5em"}),s.createEl("h5",{text:e}).setCssProps({margin:"0 0 0.75em 0","font-size":"0.95em","font-weight":"600"});for(let a of t)ob(s,a,r)}var bo=class extends J{showComparison=!1;display(e){e.createEl("h3",{text:"Cloud AI"});let r=e.createDiv({cls:"cloud-model-comparison-container"}).createEl("button",{text:this.showComparison?"\u25BC Hide model comparison":"\u25B6 Show model comparison",cls:"mod-link"});r.setCssProps({"margin-bottom":"1em"}),r.addEventListener("click",()=>{this.showComparison=!this.showComparison,r.textContent=this.showComparison?"\u25BC Hide model comparison":"\u25B6 Show model comparison";let a=e.querySelector(".cloud-model-comparison-section");a&&a.setCssProps({display:this.showComparison?"block":"none"})});let s=e.createDiv({cls:"cloud-model-comparison-section"});s.setCssProps({display:"none"}),this.renderModelComparison(s),new ee.Setting(e).setName("Enable cloud AI").setDesc("Use cloud AI providers for better quality and faster responses (requires API key)").addToggle(a=>a.setValue(this.plugin.settings.cloudProvider!=="none").onChange(async o=>{o?(this.plugin.settings.cloudProvider==="none"&&(this.plugin.settings.cloudProvider="anthropic"),this.plugin.settings.preferCloud=!0):(this.plugin.settings.cloudProvider="none",this.plugin.settings.preferCloud=!1),await this.saveSettings(),this.refresh()}));let i=this.plugin.settings.cloudApiKeys&&Object.values(this.plugin.settings.cloudApiKeys).some(a=>a&&a.length>0)||this.plugin.settings.cloudApiKey&&this.plugin.settings.cloudApiKey.length>0;if((this.plugin.settings.cloudProvider!=="none"||i)&&(new ee.Setting(e).setName("Cloud provider").setDesc("Select the cloud AI provider").addDropdown(a=>{a.addOption("anthropic","anthropic (Claude 3.5 Haiku)").addOption("openai","openai (GPT-4o Mini)").addOption("gemini","google Gemini (Gemini 1.5 Flash)").addOption("groq","groq (Llama 3.3 70B)").addOption("openrouter","openRouter (multiple models)").addOption("custom","Custom endpoint (Ollama/LM Studio)").addOption("none","none").setValue(this.plugin.settings.cloudProvider==="none"?"none":this.plugin.settings.cloudProvider).onChange(async o=>{this.plugin.settings.cloudProvider=o,await this.saveSettings(),this.refresh()})}),this.plugin.settings.cloudProvider!=="none")){if(this.plugin.settings.cloudProvider!=="custom"){let a={anthropic:"Anthropic",openai:"OpenAI",gemini:"Google Gemini",groq:"Groq",openrouter:"OpenRouter"},o={anthropic:"https://console.anthropic.com/",openai:"https://platform.openai.com/api-keys",gemini:"https://makersuite.google.com/app/apikey",groq:"https://console.groq.com/keys",openrouter:"https://openrouter.ai/keys"},c=this.plugin.settings.cloudProvider,l="";this.plugin.settings.cloudApiKeys&&c in this.plugin.settings.cloudApiKeys&&(l=this.plugin.settings.cloudApiKeys[c]||""),!l&&this.plugin.settings.cloudApiKey&&this.plugin.settings.cloudProvider===c&&(l=this.plugin.settings.cloudApiKey),new ee.Setting(e).setName("API key").setDesc(`Enter your ${a[this.plugin.settings.cloudProvider]||"provider"} API key`).addText(E=>{E.setPlaceholder("sk-...").setValue(l),E.inputEl.setAttribute("type","password"),E.onChange(async A=>{this.plugin.settings.cloudApiKeys||(this.plugin.settings.cloudApiKeys={anthropic:"",openai:"",gemini:"",groq:"",openrouter:""}),c in this.plugin.settings.cloudApiKeys&&(this.plugin.settings.cloudApiKeys[c]=A),await this.saveSettings()})});let d=e.createDiv("setting-item-description");d.setCssProps({"margin-top":"5px"});let u=a[this.plugin.settings.cloudProvider]||"provider",m=o[this.plugin.settings.cloudProvider]||"#";d.createEl("a",{href:m,text:`get your ${u} API key`,attr:{target:"_blank"}});let y={anthropic:"~$0.002 per idea (Claude 3.5 Haiku)",openai:"~$0.001 per idea (GPT-4o Mini)",gemini:"~$0.0005 per idea (Gemini 1.5 Flash)",groq:"Free (Llama 3.3 70B)",openrouter:"Varies by model (see OpenRouter pricing)"}[this.plugin.settings.cloudProvider]||"Varies",v=e.createDiv("setting-item-description");v.setCssProps({"margin-top":"5px",color:"var(--text-muted)"}),v.textContent=`cost estimate: ${y}`,new ee.Setting(e).setName("Test connection").setDesc("Verify your API key is valid").addButton(E=>E.setButtonText("Test connection").onClick(async()=>{let A=this.plugin.settings.cloudProvider,f=this.plugin.settings.cloudApiKeys&&A in this.plugin.settings.cloudApiKeys?(this.plugin.settings.cloudApiKeys[A]||"").trim():"";if(!f){new ee.Notice("Please enter an API key first");return}E.setButtonText("Testing..."),E.setDisabled(!0);try{let S=pt.createProvider(this.plugin.settings.cloudProvider,f,{openRouterModel:this.plugin.settings.openRouterModel,customEndpointUrl:this.plugin.settings.customEndpointUrl});if(!await S.authenticate(f)){new ee.Notice("Authentication failed: invalid API key format");return}let k=await S.classify("test idea for connection verification");k&&(k.category||k.tags.length>0)?new ee.Notice(`\u2713 Connection successful! Provider: ${S.name}`):new ee.Notice("Connection test completed, but got unexpected response")}catch(S){console.error("Connection test failed:",S);let P=S instanceof Error?S.message:"Unknown error";new ee.Notice(`Connection failed: ${P}`)}finally{E.setButtonText("Test connection"),E.setDisabled(!1)}}))}if(this.plugin.settings.cloudProvider==="openrouter"&&new ee.Setting(e).setName("Model").setDesc("Select the model to use via OpenRouter").addText(a=>a.setPlaceholder("openai/gpt-4o-mini").setValue(this.plugin.settings.openRouterModel||"openai/gpt-4o-mini").onChange(async o=>{this.plugin.settings.openRouterModel=o,await this.saveSettings()})),this.plugin.settings.cloudProvider==="custom"){new ee.Setting(e).setName("Endpoint URL").setDesc("Enter your custom endpoint URL (e.g., http://localhost:11434/api/chat for Ollama)").addText(o=>o.setPlaceholder("http://localhost:11434/api/chat").setValue(this.plugin.settings.customEndpointUrl||"").onChange(async c=>{this.plugin.settings.customEndpointUrl=c,await this.saveSettings()}));let a=e.createDiv("setting-item-description");a.setCssProps({"margin-top":"5px",color:"var(--text-muted)"}),a.textContent="Cost estimate: free (self-hosted)",new ee.Setting(e).setName("Test connection").setDesc("Verify your custom endpoint is accessible").addButton(o=>o.setButtonText("Test connection").onClick(async()=>{let c=this.plugin.settings.customEndpointUrl.trim();if(!c){new ee.Notice("Please enter an endpoint URL first");return}o.setButtonText("Testing..."),o.setDisabled(!0);try{let l=pt.createProvider("custom","",{customEndpointUrl:c});if(!await l.authenticate(c)){new ee.Notice("Authentication failed: invalid endpoint URL");return}let u=await l.classify("test idea for connection verification");u&&(u.category||u.tags.length>0)?new ee.Notice(`\u2713 Connection successful! Provider: ${l.name}`):new ee.Notice("Connection test completed, but got unexpected response")}catch(l){console.error("Connection test failed:",l);let d=l instanceof Error?l.message:"Unknown error";new ee.Notice(`Connection failed: ${d}`)}finally{o.setButtonText("Test connection"),o.setDisabled(!1)}}))}new ee.Setting(e).setName("Prefer cloud AI").setDesc("Use cloud AI when available, fallback to local AI on failure").addToggle(a=>a.setValue(this.plugin.settings.preferCloud).onChange(async o=>{this.plugin.settings.preferCloud=o,await this.saveSettings()}))}}renderModelComparison(e){e.empty(),e.createEl("h4",{text:"Cloud AI model comparison"}),e.createEl("p",{text:"Compare default cloud AI models to find the best fit for your needs. All models are validated for ideatr's classification and tagging tasks.",cls:"cloud-model-comparison-intro"}).setCssProps({"margin-bottom":"1em",color:"var(--text-muted)","font-size":"0.9em"});let r={Anthropic:Ri("anthropic"),OpenAI:Ri("openai"),"Google Gemini":Ri("gemini"),Groq:Ri("groq")};for(let[s,i]of Object.entries(r)){if(i.length===0)continue;let a=i.map(rh);sh(e,s,a,!1)}}};var jt=require("obsidian");var vo=class extends J{display(e){new jt.Setting(e).setName("Enable web search").setDesc("Search for similar ideas/products/services on the web").addToggle(t=>t.setValue(this.plugin.settings.enableWebSearch).onChange(async r=>{this.plugin.settings.enableWebSearch=r,await this.saveSettings()})),new jt.Setting(e).setName("Auto-search existence on capture").setDesc("Automatically search for similar items when capturing ideas").addToggle(t=>t.setValue(this.plugin.settings.autoSearchExistence).onChange(async r=>{this.plugin.settings.autoSearchExistence=r,await this.saveSettings()})),new jt.Setting(e).setName("Web search provider").setDesc("Select the web search provider to use").addDropdown(t=>t.addOption("google","Google").addOption("duckduckgo","DuckDuckGo").addOption("none","none").setValue(this.plugin.settings.webSearchProvider).onChange(async r=>{this.plugin.settings.webSearchProvider=r,await this.saveSettings(),this.refresh()})),this.plugin.settings.webSearchProvider==="google"&&(new jt.Setting(e).setName("Google API key").setDesc("Google custom search API key").addText(t=>t.setPlaceholder("Enter your Google API key").setValue(this.plugin.settings.googleSearchApiKey).onChange(async r=>{this.plugin.settings.googleSearchApiKey=r,await this.saveSettings()})),new jt.Setting(e).setName("Google search engine ID").setDesc("Google custom search engine ID (CSE ID)").addText(t=>t.setPlaceholder("Enter your Google CSE ID").setValue(this.plugin.settings.googleSearchEngineId).onChange(async r=>{this.plugin.settings.googleSearchEngineId=r,await this.saveSettings()}))),new jt.Setting(e).setName("Web search timeout (ms)").setDesc("Maximum time to wait for web search response").addText(t=>t.setPlaceholder("15000").setValue(String(this.plugin.settings.webSearchTimeout)).onChange(async r=>{let s=Number(r);!isNaN(s)&&s>0&&(this.plugin.settings.webSearchTimeout=s,await this.saveSettings())})),new jt.Setting(e).setName("Max search results (1-10)").setDesc("Maximum number of search results to store in frontmatter").addText(t=>t.setPlaceholder("5").setValue(String(this.plugin.settings.maxSearchResults)).onChange(async r=>{let s=Number(r);!isNaN(s)&&s>=1&&s<=10&&(this.plugin.settings.maxSearchResults=s,await this.saveSettings())}))}};var We=require("obsidian");var wo=class extends J{display(e){new We.Setting(e).setName("Enable name variants").setDesc("Generate name variants for ideas").addToggle(t=>t.setValue(this.plugin.settings.enableNameVariants).onChange(async r=>{this.plugin.settings.enableNameVariants=r,await this.saveSettings()})),new We.Setting(e).setName("Auto-generate variants on capture").setDesc("Automatically generate name variants when capturing ideas").addToggle(t=>t.setValue(this.plugin.settings.autoGenerateVariants).onChange(async r=>{this.plugin.settings.autoGenerateVariants=r,await this.saveSettings()})),new We.Setting(e).setName("Max variants (5-10)").setDesc("Maximum number of name variants to generate").addText(t=>t.setPlaceholder("8").setValue(String(this.plugin.settings.maxVariants)).onChange(async r=>{let s=Number(r);!isNaN(s)&&s>=5&&s<=10&&(this.plugin.settings.maxVariants=s,await this.saveSettings())})),new We.Setting(e).setName("Use language model for name extraction").setDesc("Use AI to intelligently extract idea names (more accurate but slower)").addToggle(t=>t.setValue(this.plugin.settings.useLLMForNameExtraction).onChange(async r=>{this.plugin.settings.useLLMForNameExtraction=r,await this.saveSettings()})),new We.Setting(e).setName("Cache max size").setDesc("Maximum number of cached variants (0 = unlimited)").addText(t=>t.setPlaceholder("100").setValue(String(this.plugin.settings.variantCacheMaxSize||0)).onChange(async r=>{let s=Number(r);!isNaN(s)&&s>=0&&(this.plugin.settings.variantCacheMaxSize=s,await this.saveSettings())})),new We.Setting(e).setName("Persist cache to disk").setDesc("Save variant cache to disk (survives plugin reloads)").addToggle(t=>t.setValue(this.plugin.settings.variantCachePersist).onChange(async r=>{this.plugin.settings.variantCachePersist=r,await this.saveSettings()})),new We.Setting(e).setName("Clear variant cache").setDesc("Clear all cached name variants").addButton(t=>t.setButtonText("Clear cache").setCta().onClick(()=>(this.plugin.nameVariantService&&(this.plugin.nameVariantService.clearCache(),new We.Notice("Variant cache cleared")),Promise.resolve())))}};var Wd=require("obsidian");var xo=class extends J{display(e){new Wd.Setting(e).setName("Enable scaffolds").setDesc("Generate scaffold templates for ideas").addToggle(t=>t.setValue(this.plugin.settings.enableScaffolds).onChange(async r=>{this.plugin.settings.enableScaffolds=r,await this.saveSettings()})),new Wd.Setting(e).setName("Scaffold default action").setDesc("Default action when generating scaffold: append to current note or create new note").addDropdown(t=>t.addOption("append","Append to current note").addOption("new-note","Create new note").setValue(this.plugin.settings.scaffoldDefaultAction).onChange(async r=>{this.plugin.settings.scaffoldDefaultAction=r,await this.saveSettings()}))}};var Ti=require("obsidian");var Eo=class extends J{display(e){new Ti.Setting(e).setName("Enable project elevation").setDesc("Allow elevating ideas to full projects").addToggle(s=>s.setValue(this.plugin.settings.enableElevation).onChange(async i=>{this.plugin.settings.enableElevation=i,await this.saveSettings()})),new Ti.Setting(e).setName("Projects directory").setDesc("Directory where elevated projects will be created (relative to vault root)").addText(s=>s.setPlaceholder("Projects").setValue(this.plugin.settings.elevationProjectsDirectory).onChange(async i=>{let a=i.trim().replace(/^\/+|\/+$/g,"").replace(/\s+/g,"-");this.plugin.settings.elevationProjectsDirectory=a||"Projects",await this.saveSettings()})),new Ti.Setting(e).setName("Default folders").setDesc("Comma-separated list of folders to create in each elevated project (e.g., docs,notes,assets)").addText(s=>s.setPlaceholder("docs,notes,assets").setValue(this.plugin.settings.elevationDefaultFolders).onChange(async i=>{let a=i.split(",").map(o=>o.trim().replace(/[^a-zA-Z0-9_-]/g,"")).filter(o=>o.length>0).join(",");this.plugin.settings.elevationDefaultFolders=a||"docs,notes,assets",await this.saveSettings()})),new Ti.Setting(e).setName("Create project metadata").setDesc("Create project metadata file for future project management integrations (planned expansion)").addToggle(s=>s.setValue(this.plugin.settings.elevationCreateDevraMetadata).onChange(async i=>{this.plugin.settings.elevationCreateDevraMetadata=i,await this.saveSettings()}));let t=e.createDiv("setting-item-description");t.setCssProps({"margin-top":"10px",padding:"10px","background-color":"var(--background-secondary)","border-radius":"4px"});let r=this.plugin.settings.elevationProjectsDirectory||"Projects";t.createEl("strong",{text:"About project elevation:"}),t.createEl("br"),t.createEl("span",{text:`Elevating an idea moves it from the Ideas/ directory to a project folder structure in ${r}/. The original idea file becomes the project's README.md, and default folders are created automatically.`}),t.createEl("br"),t.createEl("br"),t.createEl("strong",{text:"Note:"}),t.createEl("span",{text:" Folder structure customization is planned for v2. Currently, the default structure is used for all projects."})}};var Lr=require("obsidian");var Ao=class extends J{display(e){new Lr.Setting(e).setName("Enable error logging").setDesc("Collect error logs for bug reports. Logs are stored locally and only sent if you choose to include them.").addToggle(t=>t.setValue(this.plugin.settings.errorLoggingEnabled).onChange(async r=>{this.plugin.settings.errorLoggingEnabled=r,await this.saveSettings(),this.plugin.errorLogService&&this.plugin.errorLogService.updateSettings({enabled:r,maxEntries:this.plugin.settings.errorLogMaxEntries,retentionDays:this.plugin.settings.errorLogRetentionDays})})),new Lr.Setting(e).setName("Maximum log entries").setDesc("Maximum number of error log entries to keep in memory (default: 50)").addText(t=>t.setPlaceholder("50").setValue(String(this.plugin.settings.errorLogMaxEntries)).onChange(async r=>{let s=Number(r);!isNaN(s)&&s>0&&s<=500&&(this.plugin.settings.errorLogMaxEntries=s,await this.saveSettings(),this.plugin.errorLogService&&this.plugin.errorLogService.updateSettings({enabled:this.plugin.settings.errorLoggingEnabled,maxEntries:s,retentionDays:this.plugin.settings.errorLogRetentionDays}))})),new Lr.Setting(e).setName("Log retention (days)").setDesc("Number of days to retain error logs (default: 7)").addText(t=>t.setPlaceholder("7").setValue(String(this.plugin.settings.errorLogRetentionDays)).onChange(async r=>{let s=Number(r);!isNaN(s)&&s>0&&s<=30&&(this.plugin.settings.errorLogRetentionDays=s,await this.saveSettings(),this.plugin.errorLogService&&this.plugin.errorLogService.updateSettings({enabled:this.plugin.settings.errorLoggingEnabled,maxEntries:this.plugin.settings.errorLogMaxEntries,retentionDays:s}))})),new Lr.Setting(e).setName("Clear error logs").setDesc("Clear all stored error logs").addButton(t=>t.setButtonText("Clear logs").onClick(()=>{this.plugin.errorLogService&&(this.plugin.errorLogService.clearLogs(),new Lr.Notice("Error logs cleared"))}))}};var Ht=require("obsidian");var Ke=require("obsidian");var Io=class extends Ke.Modal{errorLogService;systemInfo;requestType="feature";description="";includeErrorLogs=!1;includeSystemInfo=!0;constructor(e,t,r){super(e),this.systemInfo=t,this.errorLogService=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-feedback-modal"),e.createEl("h2",{text:"Submit feedback"}),e.createEl("p",{text:"Help improve Ideatr by submitting a feature request or bug report.",cls:"ideatr-feedback-description"});let t=e.createEl("div",{cls:"ideatr-setting-item"});t.createEl("label",{text:"Type:",attr:{for:"ideatr-request-type"},cls:"ideatr-label"});let r=t.createEl("select",{attr:{id:"ideatr-request-type"},cls:"ideatr-select"});r.createEl("option",{text:"Feature request",attr:{value:"feature"}}),r.createEl("option",{text:"Bug report",attr:{value:"bug"}}),r.createEl("option",{text:"Performance issue",attr:{value:"performance"}}),r.value=this.requestType,r.addEventListener("change",A=>{this.requestType=A.target.value,this.updateDescriptionPlaceholder()});let s=e.createEl("div",{cls:"ideatr-setting-item"});s.createEl("label",{text:"Description:",attr:{for:"ideatr-description"},cls:"ideatr-label"});let i=s.createEl("textarea",{attr:{id:"ideatr-description",rows:"8",placeholder:this.getDescriptionPlaceholder()},cls:"ideatr-textarea"});i.value=this.description,i.addEventListener("input",A=>{this.description=A.target.value});let a=e.createEl("div",{cls:"ideatr-feedback-options"});a.createEl("h3",{text:"Additional information (optional)"});let o=a.createEl("div",{cls:"ideatr-checkbox-item"}),c=o.createEl("input",{attr:{type:"checkbox",id:"ideatr-include-system-info",checked:this.includeSystemInfo}});if(o.createEl("label",{text:"Include system information (Obsidian version, plugin version, OS)",attr:{for:"ideatr-include-system-info"}}),c.addEventListener("change",A=>{this.includeSystemInfo=A.target.checked}),this.errorLogService){let A=a.createEl("div",{cls:"ideatr-checkbox-item"}),f=A.createEl("input",{attr:{type:"checkbox",id:"ideatr-include-error-logs",checked:this.includeErrorLogs}});A.createEl("label",{text:"Include recent error logs (last 7 days, sanitized)",attr:{for:"ideatr-include-error-logs"}}),f.addEventListener("change",P=>{this.includeErrorLogs=P.target.checked});let S=this.errorLogService.getRecentLogs();S.length>0&&a.createEl("p",{text:`${S.length} error log${S.length>1?"s":""} available`,cls:"ideatr-help-text"}).addClass("ideatr-log-count")}let l=e.createEl("div",{cls:"ideatr-feedback-preview"});l.createEl("h3",{text:"Preview"});let d=l.createEl("textarea",{attr:{id:"ideatr-preview",rows:"12",readonly:"true"},cls:"ideatr-textarea"});d.addClass("ideatr-preview-textarea");let u=()=>{d.value=this.generateIssueContent()};if(r.addEventListener("change",u),i.addEventListener("input",u),c.addEventListener("change",u),this.errorLogService){let A=e.querySelector("#ideatr-include-error-logs");A&&A.addEventListener("change",u)}u();let m=e.createEl("div",{cls:"ideatr-button-container"});m.createEl("button",{text:"Copy to clipboard",cls:"mod-cta"}).addEventListener("click",()=>void this.handleCopyToClipboard()),m.createEl("button",{text:"Open email",cls:"mod-cta"}).addEventListener("click",()=>this.handleOpenEmail()),m.createEl("button",{text:"Open GitHub issue",cls:"mod-cta"}).addEventListener("click",()=>this.handleOpenGitHub()),m.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close())}getDescriptionPlaceholder(){return this.requestType==="bug"?`Describe the bug:

1. What happened?
2. What did you expect to happen?
3. Steps to reproduce:
   - Step 1
   - Step 2
   - Step 3`:this.requestType==="performance"?`Describe the performance issue:

- What operation is slow?
- How long does it take?
- When did you first notice this?
- Any patterns (specific features, large vaults, etc.)?`:`Describe your feature request:

- What problem does this solve?
- How would you like it to work?
- Any additional context or examples?`}updateDescriptionPlaceholder(){let e=this.contentEl.querySelector("#ideatr-description");e&&(e.placeholder=this.getDescriptionPlaceholder())}generateIssueContent(){let t=`## ${this.requestType==="bug"?"Bug Report":this.requestType==="performance"?"Performance Issue":"Feature Request"}

`;if(this.description.trim()?t+=`${this.description}

`:t+=`[Please describe your ${this.requestType==="bug"?"bug":"feature request"} here]

`,this.includeSystemInfo&&(t+=`## System Information

`,t+=`- **Obsidian Version:** ${this.systemInfo.obsidianVersion}
`,t+=`- **Ideatr Version:** ${this.systemInfo.pluginVersion}
`,t+=`- **Platform:** ${this.systemInfo.platform}
`,t+=`- **OS:** ${this.systemInfo.os}

`),this.includeErrorLogs&&this.errorLogService){let r=this.errorLogService.getRecentLogs();r.length>0&&(t+=this.errorLogService.formatLogsForIssue(r),t+=`

`)}return t.trim()}generateIssueTitle(){let e=this.requestType==="bug"?"[Bug]":this.requestType==="performance"?"[Performance]":"[Feature]",t=this.description.trim();if(t){let s=t.split(`
`)[0].trim(),i=s.length>50?s.substring(0,47)+"...":s;return`${e} ${i}`}let r=this.requestType==="bug"?"Bug report":this.requestType==="performance"?"Performance issue":"Feature request";return`${e} ${r}`}async handleCopyToClipboard(){if(!this.description.trim()){new Ke.Notice("Please enter a description first");return}let e=this.generateIssueContent();try{if(navigator.clipboard)await navigator.clipboard.writeText(e);else throw new Error("Clipboard API not available");new Ke.Notice("Content copied to clipboard! Paste it into a GitHub issue.")}catch(t){h.error("Failed to copy to clipboard:",t),new Ke.Notice("Failed to copy to clipboard. Please copy manually from the preview.")}}handleOpenEmail(){if(!this.description.trim()){new Ke.Notice("Please enter a description first");return}let e=this.generateEmailSubject(),t=this.generateIssueContent(),r=encodeURIComponent(e),s=encodeURIComponent(t),i=`mailto:ideatr@paraphlabs.com?subject=${r}&body=${s}`;window.location.href=i,new Ke.Notice("Opening email client...")}generateEmailSubject(){let e=this.requestType==="bug"?"[Bug]":this.requestType==="performance"?"[Performance]":"[Feature]",t=this.description.trim();if(t){let s=t.split(`
`)[0].trim(),i=s.length>60?s.substring(0,57)+"...":s;return`${e} ${i}`}let r=this.requestType==="bug"?"Bug report":this.requestType==="performance"?"Performance issue":"Feature request";return`${e} ${r}`}handleOpenGitHub(){if(!this.description.trim()){new Ke.Notice("Please enter a description first");return}let e=encodeURIComponent(this.generateIssueTitle()),t=encodeURIComponent(this.generateIssueContent()),r=this.requestType==="bug"?"bug":this.requestType==="performance"?"performance":"enhancement",s=`https://github.com/FallingWithStyle/obsidian-ideatr/issues/new?title=${e}&body=${t}&labels=${r}`;window.open(s,"_blank"),new Ke.Notice("Opening GitHub issue page...")}onClose(){let{contentEl:e}=this;e.empty()}};var So=class extends J{display(e){new Ht.Setting(e).setName("View existing issues").setDesc("Browse and search existing bug reports and feature requests on GitHub").addButton(t=>t.setButtonText("View issues").onClick(()=>{window.open("https://github.com/FallingWithStyle/obsidian-ideatr/issues","_blank")})),new Ht.Setting(e).setName("Submit feedback").setDesc("Report bugs, suggest features, or report performance issues. Error logs can be included to help diagnose issues.").addButton(t=>t.setButtonText("Submit feedback").setCta().onClick(()=>{let r="Unknown";try{let a=this.app.appVersion,o=this.app.version;r=a??o??"Unknown"}catch{r="Unknown"}let s={obsidianVersion:r,pluginVersion:this.plugin.manifest.version,platform:Ht.Platform.isMobile?"mobile":"desktop",os:Ht.Platform.isMacOS?"Mac":Ht.Platform.isWin?"Windows":Ht.Platform.isLinux?"Linux":"Unknown"};new Io(this.app,s,this.plugin.errorLogService).open()}))}};var _o=require("obsidian");function cb(n){let e=[];n.metaKey&&e.push("cmd"),n.ctrlKey&&e.push("ctrl"),n.altKey&&e.push("alt"),n.shiftKey&&e.push("shift");let t=n.key.toLowerCase();return t===" "?e.push("space"):t==="enter"?e.push("enter"):t==="escape"?e.push("escape"):t==="tab"?e.push("tab"):t==="backspace"?e.push("backspace"):t==="delete"?e.push("delete"):t==="arrowup"?e.push("arrowup"):t==="arrowdown"?e.push("arrowdown"):t==="arrowleft"?e.push("arrowleft"):t==="arrowright"?e.push("arrowright"):(t.length,e.push(t)),e.join("+")}function ki(n){return n?n.split("+").map(e=>{let t=e.trim().toLowerCase();return t==="cmd"||t==="meta"?"\u2318":t==="ctrl"?"\u2303":t==="alt"?"\u2325":t==="shift"?"\u21E7":t==="space"?"Space":t==="enter"?"Enter":t==="escape"?"Esc":t==="tab"?"Tab":t==="backspace"?"Backspace":t==="delete"?"Delete":t==="arrowup"?"\u2191":t==="arrowdown"?"\u2193":t==="arrowleft"?"\u2190":t==="arrowright"?"\u2192":t.charAt(0).toUpperCase()+t.slice(1)}).join(" "):""}function Co(n,e,t){let r=!1,s=e||"";e?(n.value=ki(e),s=e):n.value="",n.placeholder="Click and press keys...",n.setCssProps({cursor:"text","font-family":"monospace"}),n.addEventListener("focus",()=>{r=!0,n.value="",n.placeholder="Press keys...",n.setCssProps({"background-color":"var(--background-modifier-active-hover)"})}),n.addEventListener("blur",()=>{r=!1,n.setCssProps({"background-color":""}),s?n.value=ki(s):(n.value=e?ki(e):"",n.placeholder="Click and press keys...")}),n.addEventListener("keydown",i=>{if(!r||(i.preventDefault(),i.stopPropagation(),["Meta","Control","Alt","Shift"].includes(i.key)))return;let a=cb(i);s=a,n.value=ki(a),t(a)}),n.addEventListener("keyup",i=>{r&&!i.metaKey&&!i.ctrlKey&&!i.altKey&&!i.shiftKey&&s&&(n.value=ki(s))})}var Po=class extends J{display(e){e.createEl("h3",{text:"Capture modal shortcuts"}),new _o.Setting(e).setName("Capture idea hotkey").setDesc(`Keyboard shortcut for opening the Capture idea modal. Click the field and press your desired key combination. Note: This setting stores your preference. To actually bind the hotkey, you must also set it in Obsidian's Hotkeys settings (Settings \u2192 Hotkeys \u2192 search for "Capture idea").`).addText(t=>{Co(t.inputEl,this.plugin.settings.captureIdeaHotkey,r=>{(async()=>(this.plugin.settings.captureIdeaHotkey=r,await this.saveSettings()))()})}),new _o.Setting(e).setName("Save shortcut").setDesc("Keyboard shortcut for the Save button in the Capture idea modal. Click the field and press your desired key combination.").addText(t=>{Co(t.inputEl,this.plugin.settings.captureSaveShortcut,r=>{(async()=>(this.plugin.settings.captureSaveShortcut=r,await this.saveSettings()))()})}),new _o.Setting(e).setName("Ideate shortcut").setDesc("Keyboard shortcut for the Ideate button in the Capture idea modal. Click the field and press your desired key combination.").addText(t=>{Co(t.inputEl,this.plugin.settings.captureIdeateShortcut,r=>{(async()=>(this.plugin.settings.captureIdeateShortcut=r,await this.saveSettings()))()})})}};var Fi=require("obsidian");var Q=require("obsidian"),qt=jh(require("fs"));function Je(...n){return n.filter(e=>e.length>0).map(e=>e.replace(/\\/g,"/").replace(/\/+/g,"/")).join("/").replace(/\/$/,"")}function Ro(...n){let e=Je(...n);return e.startsWith("/")||/^[A-Za-z]:/.test(e)?e.replace(/\/+/g,"/"):e.replace(/\/+/g,"/")}function To(n){return n.startsWith("/")||/^[A-Za-z]:/.test(n)}var cn=class{constructor(e,t){this.app=e;this.pluginDir=t}getTutorialVaultPath(){return"Tutorials"}findTutorialFolder(){let e="Tutorials",t="tutorials",r=this.app.vault.getAbstractFileByPath(e);if(r instanceof Q.TFolder)return r;let s=this.app.vault.getAbstractFileByPath(t);return s instanceof Q.TFolder?s:null}async getBundledTutorialFiles(){let e=new Map;if(this.pluginDir){let t=Je(this.pluginDir,"tutorials");try{if(qt.existsSync(t)&&qt.statSync(t).isDirectory()){let r=qt.readdirSync(t);for(let s of r)if(s.endsWith(".md")){let i=Je(t,s);try{let a=qt.readFileSync(i,"utf-8");e.set(s,a)}catch(a){console.warn(`Error reading tutorial file ${s}:`,a)}}}}catch(r){console.warn("Error reading tutorial directory from plugin:",r)}}if(e.size===0)try{let t=this.findTutorialFolder();if(t instanceof Q.TFolder&&t.children){for(let r of t.children)if(r instanceof Q.TFile&&r.name.endsWith(".md"))try{let s=await this.app.vault.read(r);e.set(r.name,s)}catch(s){console.warn(`Error reading tutorial file ${r.name}:`,s)}}}catch(t){console.warn("Error reading tutorial directory from vault:",t)}return e}async resetTutorials(e=!1){try{let t=await this.getBundledTutorialFiles();if(t.size===0)return new Q.Notice("Tutorial files not found in plugin directory. They may need to be manually restored."),!1;let r=this.getTutorialVaultPath();if(!this.app.vault.getAbstractFileByPath(r))try{await this.app.vault.createFolder(r)}catch(a){let o=a instanceof Error?a.message:String(a);if(o.includes("already exists")||o.includes("Folder already exists")){let c=this.app.vault.getAbstractFileByPath(r)}else if(!this.app.vault.getAbstractFileByPath(r))throw a}let i=0;for(let[a,o]of t.entries()){let c=`${r}/${a}`,l=this.app.vault.getAbstractFileByPath(c);if(l&&l instanceof Q.TFile)e&&(await this.app.vault.modify(l,o),i++);else try{await this.app.vault.create(c,o),i++}catch(d){let u=d instanceof Error?d.message:String(d);if(u.includes("already exists")||u.includes("File already exists")){if(e){let m=this.app.vault.getAbstractFileByPath(c);m&&m instanceof Q.TFile&&(await this.app.vault.modify(m,o),i++)}}else throw d}}return i>0?new Q.Notice(`Tutorials reset successfully! ${i} files restored.`):e&&new Q.Notice("All tutorial files already exist. No changes made."),!0}catch(t){let r=t instanceof Error?t.message:String(t);return!r.includes("already exists")&&!r.includes("File already exists")&&(console.error("Error resetting tutorials:",t),e&&new Q.Notice(`Failed to reset tutorials: ${r}`)),!1}}async deleteTutorials(){try{let e=this.findTutorialFolder();if(!e)return new Q.Notice("No tutorial files found to delete."),!1;let t=e.path,r=[],s=i=>{i instanceof Q.TFile&&i.path.startsWith(t)&&r.push(i),i instanceof Q.TFolder&&i.children&&i.children.forEach(a=>s(a))};if(s(e),r.length===0)return new Q.Notice("No tutorial files found to delete."),!1;for(let i of r)await this.app.fileManager.trashFile(i);try{e instanceof Q.TFolder&&(!e.children||e.children.length===0)&&await this.app.vault.delete(e,!0)}catch{}return new Q.Notice(`Tutorials deleted successfully! ${r.length} files removed.`),!0}catch(e){return console.error("Error deleting tutorials:",e),new Q.Notice(`Failed to delete tutorials: ${e instanceof Error?e.message:"Unknown error"}`),!1}}tutorialsExistInVault(){let e="Tutorials/00-Index.md",t="tutorials/00-Index.md";return this.app.vault.getAbstractFileByPath(e)instanceof Q.TFile?!0:this.app.vault.getAbstractFileByPath(t)instanceof Q.TFile}async bundledTutorialsAvailable(){return(await this.getBundledTutorialFiles()).size>0}};var ko=class extends J{tutorialManager;constructor(e,t,r){super(e,t,r);let s=e.vault.adapter.basePath??e.vault.configDir,i=To(e.vault.configDir)?e.vault.configDir:Je(s,e.vault.configDir),a=Ro(Je(i,"plugins",t.manifest.id));this.tutorialManager=new cn(e,a)}display(e){e.createEl("h2",{text:"Tutorials"}),new Fi.Setting(e).setName("Open tutorials").setDesc("Open the tutorial index to browse all available guides").addButton(t=>t.setButtonText("Open tutorials").setCta().onClick(async()=>{let{TutorialService:r}=await Promise.resolve().then(()=>(Kd(),nh));await new r(this.app).openIndex()})),new Fi.Setting(e).setName("Reset tutorials").setDesc("Restore tutorial files from the plugin. Use this if tutorials were deleted, modified, or corrupted.").addButton(t=>t.setButtonText("Reset tutorials").setWarning().onClick(async()=>{t.setDisabled(!0),t.setButtonText("Resetting...");try{await this.tutorialManager.resetTutorials(!0)&&setTimeout(()=>this.refresh(),1e3)}finally{t.setDisabled(!1),t.setButtonText("Reset tutorials")}})),new Fi.Setting(e).setName("Delete tutorials").setDesc('Remove all tutorial files from your vault. You can restore them later using "Reset tutorials".').addButton(t=>t.setButtonText("Delete tutorials").setWarning().onClick(async()=>{if(await mt(this.app,'Are you sure you want to delete all tutorial files? You can restore them later using "Reset tutorials".')){t.setDisabled(!0),t.setButtonText("Deleting...");try{await this.tutorialManager.deleteTutorials()&&setTimeout(()=>this.refresh(),1e3)}finally{t.setDisabled(!1),t.setButtonText("Delete tutorials")}}})),this.displayStatus(e)}async displayStatus(e){let t=e.createDiv("tutorial-status"),r=this.tutorialManager.tutorialsExistInVault(),s=await this.tutorialManager.bundledTutorialsAvailable(),i="",a="";r?(i="Tutorials: installed",a="Tutorial files are available in your vault."):s?(i="Tutorials: not installed",a="Tutorial files are not in your vault, but can be restored from the plugin."):(i="Tutorials: unavailable",a="Tutorial files are not available. They may need to be manually added."),new Fi.Setting(t).setName("Status").setDesc(a).setDisabled(!0).addText(o=>o.setValue(i))}};Wt();var ih={llmProvider:"none",concurrency:1,llmTimeout:1e4,autoClassify:!0,enableDomainCheck:!0,autoCheckDomains:!1,enableProspectr:!1,prospectrUrl:"http://localhost:3000",domainCheckTimeout:1e4,enableWebSearch:!0,autoSearchExistence:!1,webSearchProvider:"google",googleSearchApiKey:"",googleSearchEngineId:"",webSearchTimeout:15e3,maxSearchResults:5,enableNameVariants:!0,autoGenerateVariants:!1,maxVariants:8,useLLMForNameExtraction:!1,variantCacheMaxSize:100,variantCachePersist:!0,enableScaffolds:!0,scaffoldDefaultAction:"append",dashboardDefaultView:"table",dashboardItemsPerPage:50,dashboardAutoRefresh:!0,dashboardPersistFilters:!0,enableClustering:!0,clusteringAlgorithm:"hierarchical",maxClusters:0,clusterColorScheme:"category",clusteringSimilarityThreshold:.3,enableResurfacing:!0,resurfacingThresholdDays:7,resurfacingFrequency:"manual",resurfacingTime:"09:00",autoGenerateDigest:!1,digestIncludeSummary:!0,digestMaxIdeas:0,enableElevation:!0,elevationProjectsDirectory:"Projects",elevationCreateDevraMetadata:!0,elevationDefaultFolders:"docs,notes,assets",setupCompleted:!1,preloadOnStartup:!1,preferCloud:!1,cloudProvider:"none",cloudApiKeys:{anthropic:"",openai:"",gemini:"",groq:"",openrouter:""},customEndpointUrl:"",openRouterModel:"",customModelProvider:void 0,customModel:void 0,moveArchivedToFolder:!1,errorLoggingEnabled:!0,errorLogMaxEntries:50,errorLogRetentionDays:7,debugMode:!1,captureIdeaHotkey:"cmd+i",captureSaveShortcut:"alt+enter",captureIdeateShortcut:"cmd+enter"},Mo=class extends Gt.PluginSettingTab{plugin;constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=e.createDiv({cls:"ideatr-beta-notice"});t.setCssProps({background:"var(--background-modifier-border)",padding:"1em","border-radius":"4px","margin-bottom":"1.5em","border-left":"3px solid var(--text-warning)"}),t.createEl("strong",{text:"\u26A0\uFE0F local AI version - no updates"}).setCssProps({display:"block","margin-bottom":"0.5em",color:"var(--text-warning)"}),t.createEl("p",{text:"This version (v0.8.6) includes local AI functionality but will not receive updates or bug fixes. This is a one-time snapshot release for users who want to try local AI in the Obsidian plugin."}).setCssProps({margin:"0.5em 0","line-height":"1.5"}),t.createEl("p",{text:"We recommend keeping an eye out for the upcoming ideatr desktop app, which will include local AI with ongoing support and updates."}).setCssProps({margin:"0.5em 0","line-height":"1.5"}),t.createEl("a",{text:"Learn more about desktop app \u2192",href:"https://ideatr.app/desktop",attr:{target:"_blank",rel:"noopener"}}).setCssProps({color:"var(--text-accent)","text-decoration":"none",display:"inline-block","margin-top":"0.5em"});let o=t.createDiv();o.setCssProps({"margin-top":"0.75em",display:"flex",gap:"0.5em","flex-wrap":"wrap"});let c=o.createEl("a",{text:"\u{1F4DD} report bug or request a feature",href:"#ideatr-feedback-section"});c.setCssProps({color:"var(--text-accent)","text-decoration":"none",cursor:"pointer"}),c.addEventListener("click",Nr=>{Nr.preventDefault(),setTimeout(()=>{let Dr=e.querySelector("#ideatr-feedback-section");Dr&&Dr.scrollIntoView({behavior:"smooth",block:"start"})},100)}),o.createEl("a",{text:"\u{1F5FA}\uFE0F view planned features",href:"https://github.com/FallingWithStyle/obsidian-ideatr#roadmap",attr:{target:"_blank",rel:"noopener"}}).setCssProps({color:"var(--text-accent)","text-decoration":"none"}),o.createEl("a",{text:"\u{1F41B} GitHub issues",href:"https://github.com/FallingWithStyle/obsidian-ideatr/issues",attr:{target:"_blank",rel:"noopener"}}).setCssProps({color:"var(--text-accent)","text-decoration":"none"});let u=new Xi(this.app,this.plugin,this),m=new bo(this.app,this.plugin,this),p=new vo(this.app,this.plugin,this),y=new wo(this.app,this.plugin,this),v=new xo(this.app,this.plugin,this),E=new Eo(this.app,this.plugin,this),A=new Ao(this.app,this.plugin,this),f=new So(this.app,this.plugin,this),S=new Po(this.app,this.plugin,this),P=new ko(this.app,this.plugin,this);u.display(e),m.display(e);let k=e.createDiv({cls:"settings-section-title"});new Gt.Setting(k).setName("Validation tools").setHeading();let $=ue(this.app,"validation","Learn about Validation Tools");k.appendChild($),p.display(e);let F=e.createDiv({cls:"settings-section-title"});new Gt.Setting(F).setName("Transformation tools").setHeading();let B=ue(this.app,"transformation","Learn about Transformation Tools");F.appendChild(B),y.display(e),v.display(e),E.display(e);let H=e.createDiv({cls:"settings-section-title",attr:{id:"ideatr-feedback-section"}});new Gt.Setting(H).setName("Feedback & support").setHeading(),f.display(e),new Gt.Setting(e).setName("Error logging").setHeading(),A.display(e);let D=e.createDiv({cls:"settings-section-title"});new Gt.Setting(D).setName("Capture modal").setHeading();let q=ue(this.app,"capture-workflows","Learn about Capture Modal");D.appendChild(q),S.display(e),P.display(e)}};var oc=require("obsidian");function ln(n,e){return`${Jd(n)}.md`}function Jd(n){let e=n.trim().replace(/[:*?"<>|/\\]/g,"").replace(/\s+/g," ").trim();return e.length>100&&(e=e.substring(0,100).trim()),e.length===0&&(e="Untitled"),e}function ah(n,e){return`${n.replace(/\.md$/,"")}-${e}.md`}function Xd(){let n=Date.now(),e=Math.floor(Math.random()*1e4);return n*1e4+e}function oh(n){return n.length===0?1:Math.max(...n)+1}function Lo(n){let e=Xd(),t=0,r=10;for(;n.includes(e)&&t<r;)e=oh(n),t++;return n.includes(e)?oh(n):e}function Oo(n,e){let t=e?Lo(e):Xd();return{type:"idea",status:"captured",created:lb(n.timestamp),id:t,category:"",tags:[],related:[],domains:[],"existence-check":[]}}function dn(n){let e=["---",`type: ${n.type}`,`status: ${n.status}`,`created: ${n.created}`,`id: ${n.id??0}`,`category: ${typeof n.category=="string"?n.category:""}`,`tags: ${Fo(n.tags)}`,`related: ${Fo(n.related)}`,`domains: ${Fo(n.domains)}`,`existence-check: ${Fo(n["existence-check"])}`];return n.elevated&&e.push(`elevated: ${n.elevated}`),n.projectPath&&e.push(`projectPath: ${n.projectPath}`),n.codename&&e.push(`codename: ${n.codename}`),e.push("---"),e.join(`
`)}function lb(n){let e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${r}`}function Fo(n){return n.length===0?"[]":`[${n.join(", ")}]`}var No="Ideas",Fr=class{vault;constructor(e){this.vault=e}async createIdeaFile(e){await this.ensureIdeasDirectory();let t=ln(e.text,e.timestamp),r=`${No}/${t}`;r=this.resolveCollision(r);let s=Oo(e),a=`${dn(s)}

${e.text}`;return await this.vault.create(r,a)}async ensureIdeasDirectory(){this.vault.getAbstractFileByPath(No)||await this.vault.createFolder(No)}resolveCollision(e){let t=e,r=2;for(;this.vault.getAbstractFileByPath(t);){let s=e.split("/").pop()??"",i=ah(s,r);t=`${No}/${i}`,r++}return t}fileExists(e){return this.vault.getAbstractFileByPath(e)!==null}async updateIdeaFrontmatter(e,t){await this.vault.process(e,r=>{let s=/^---\n([\s\S]*?)\n---/,i=r.match(s);if(!i)return h.warn("No frontmatter found in file:",e.path),r;let a=i[1],o=(c,l)=>{let d=Array.isArray(l)?`[${l.join(", ")}]`:l,u=new RegExp(`^${c}:.*$`,"m");u.test(a)?a=a.replace(u,`${c}: ${d}`):a+=`
${c}: ${d}`};return Object.entries(t).forEach(([c,l])=>{o(c,l)}),r.replace(s,`---
${a}
---`)})}async appendToFileBody(e,t,r,s=!0){await this.vault.process(e,i=>{let a=this.findSectionInContent(i,t);if(a&&s){let o=i.substring(0,a.start),c=i.substring(a.end);return this.ensureSpacing(o,"before")+r+this.ensureSpacing(c,"after")}else if(a&&!s){let o=i.substring(0,a.end),c=i.substring(a.end);return this.ensureSpacing(o,"before")+`

`+r+this.ensureSpacing(c,"after")}else return this.ensureSpacing(i,"before")+`

`+r})}findSectionInContent(e,t){let r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`^##\\s+${r}\\s*$`,"im"),i=e.match(s);if(i?.index===void 0)return null;let a=i.index,o=a+i[0].length,c=e.substring(o),l=c.match(/^##\s+/m);if(l?.index!==void 0)return{start:a,end:o+l.index};let d=/\n\n(?![\s]*[-*|])/,u=c.match(d);if(u?.index!==void 0){let m=c.substring(u.index+2);if(m.trim()&&!m.match(/^\s*[-*|]/))return{start:a,end:o+u.index}}return{start:a,end:e.length}}ensureSpacing(e,t="before"){return t==="before"?e.endsWith(`
`)?e:e+`
`:e.startsWith(`
`)?e:`
`+e}};var Do=class{vault;IDEAS_DIR="Ideas/";MIN_SIMILARITY_THRESHOLD=.15;constructor(e){this.vault=e}async findRelatedNotes(e,t=5){let s=this.vault.getMarkdownFiles().filter(o=>o.path.startsWith(this.IDEAS_DIR));if(s.length===0)return[];let i=[];for(let o of s)try{let c=await this.vault.cachedRead(o),l=this.extractBodyText(c),d=this.calculateSimilarity(e,l);d>=this.MIN_SIMILARITY_THRESHOLD&&i.push({file:o,similarity:d})}catch(c){h.warn(`Failed to read file ${o.path}:`,c)}return i.sort((o,c)=>c.similarity-o.similarity),i.slice(0,t).map(({file:o,similarity:c})=>({path:o.path,title:o.basename,similarity:c}))}extractBodyText(e){let t=/^---\n[\s\S]*?\n---(\n\n?|\n?)/,r=e.match(t);return(r?e.substring(r[0].length):e).trim()}calculateSimilarity(e,t){if(!e||!t)return 0;let r=this.tokenize(e),s=this.tokenize(t);if(r.size===0||s.size===0)return 0;let i=new Set([...r].filter(l=>s.has(l))),a=new Set([...r,...s]);if(a.size===0)return 0;let o=i.size/a.size,c=i.size/Math.min(r.size,s.size);return Math.min(o*(1+c*.3),1)}tokenize(e){let t=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","as","is","are","was","were","been","be","have","has","had","do","does","did","will","would","could","should","may","might","must","can","this","that","these","those","i","you","he","she","it","we","they","what","which","who","when","where","why","how","all","each","every","some","any","no","other","another","such","only","just","more","most","very","much","many","few","little","own","same","so","than","too","also"]),a=e.toLowerCase().replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/#{1,6}\s+/g,"").replace(/\*\*([^*]+)\*\*/g,"$1").replace(/\*([^*]+)\*/g,"$1").replace(/`([^`]+)`/g,"$1").replace(/[^\w\s]/g," ").split(/\s+/).map(o=>o.trim()).filter(o=>o.length>3&&!t.has(o));return new Set(a)}};var $o=class{llmService;searchService;constructor(e,t){this.llmService=e,this.searchService=t}isAvailable(){return this.llmService.isAvailable()}async classifyIdea(e){let t={category:"",tags:[],related:[]},r=[];return this.llmService.isAvailable()&&r.push(this.llmService.classify(e).then(s=>{t.category=s.category,t.tags=[...new Set(s.tags)]}).catch(s=>{h.warn("LLM classification failed:",s)})),r.push(this.searchService.findRelatedNotes(e,3).then(s=>{t.related=s.map(i=>i.path)}).catch(s=>{h.warn("Related note search failed:",s)})),await Promise.all(r),t}};var Bo=class{searchService;DEFAULT_THRESHOLD=.75;constructor(e){this.searchService=e}async checkDuplicate(e,t){let r=t??this.DEFAULT_THRESHOLD;if(!e||e.trim().length===0)return{isDuplicate:!1,duplicates:[],threshold:r};let i=(await this.searchService.findRelatedNotes(e,10)).filter(a=>a.similarity!==void 0&&a.similarity>=r);return{isDuplicate:i.length>0,duplicates:i,threshold:r}}};var Uo=class{prospectrService;constructor(e){this.prospectrService=e}extractDomains(e){let t=/\b([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.(?:[a-zA-Z]{2,}))\b/g,r=e.match(t);if(!r)return[];let s=/["']([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})["']/g,i=e.match(s);i&&i.forEach(c=>{let l=c.replace(/["']/g,"");r.includes(l)||r.push(l)});let a=/domain(?:s)?:\s*([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/gi,o=e.match(a);return o&&o.forEach(c=>{let l=c.replace(/domain(?:s)?:\s*/i,"").trim();l&&!r.includes(l)&&r.push(l)}),[...new Set(r.map(c=>c.toLowerCase().trim()))]}async checkDomains(e,t){let r=this.extractDomains(e);if(r.length===0)return[];if(!this.prospectrService.isAvailable())return r.map(s=>({domain:s,available:!1,error:"Prospectr service is not available",checkedAt:new Date().toISOString()}));try{return await this.prospectrService.checkDomainsAvailability(r)}catch(s){return h.warn("Domain checking failed:",s),r.map(i=>({domain:i,available:!1,error:s instanceof Error?s.message:"Unknown error",checkedAt:new Date().toISOString()}))}}};var jo=class{prospectrUrl;isEnabled;timeout;constructor(e="http://localhost:3000",t=1e4){this.prospectrUrl=e,this.timeout=t,this.isEnabled=!1}isAvailable(){return this.prospectrUrl,this.timeout,this.isEnabled}checkDomainAvailability(e){return this.isAvailable()?Promise.resolve({domain:e,available:!1,error:"Domain checking service is not yet implemented",checkedAt:new Date().toISOString()}):Promise.resolve({domain:e,available:!1,error:"Prospectr service is not available",checkedAt:new Date().toISOString()})}async checkDomainsAvailability(e){return await Promise.all(e.map(r=>this.checkDomainAvailability(r)))}};var ch=require("obsidian");var Ho=class{settings;constructor(e){this.settings=e}isAvailable(){return this.settings.webSearchProvider==="none"?!1:this.settings.webSearchProvider==="google"?!!(this.settings.googleSearchApiKey&&this.settings.googleSearchEngineId):!1}async search(e,t,r){if(!this.isAvailable()||!e||e.trim().length===0)return[];let s=r??this.settings.maxSearchResults??5;try{let i=await this.performSearch(e,s);return this.processResults(i,e)}catch(i){return h.warn("Web search failed:",i),[]}}async performSearch(e,t){if(this.settings.webSearchProvider!=="google")throw new Error("Only Google Custom Search is currently supported");let r=this.settings.googleSearchApiKey,s=this.settings.googleSearchEngineId,i=`https://www.googleapis.com/customsearch/v1?key=${r}&cx=${s}&q=${encodeURIComponent(e)}&num=${Math.min(t,10)}`,a=new Promise((o,c)=>{setTimeout(()=>c(new Error(`Timeout: Request exceeded ${this.settings.webSearchTimeout}ms`)),this.settings.webSearchTimeout)});try{let o=await Promise.race([(0,ch.requestUrl)({url:i,method:"GET",throw:!1}),a]);if(o.status<200||o.status>=300)throw o.status===429?new Error("API rate limit exceeded"):new Error(`HTTP ${o.status}: Request failed`);return(typeof o.json=="function"?await o.json():o.json).items??[]}catch(o){throw o instanceof Error&&o.message.includes("Timeout")||o instanceof Error?o:new Error(String(o))}}processResults(e,t){if(!e||e.length===0)return[];let s=t.toLowerCase().split(/\s+/),i=e.map(a=>{let o=a.title??"",c=a.snippet??"",l=a.link??"",d;if(a.pagemap?.metatags){for(let m of a.pagemap.metatags)if(m["article:published_time"]){d=m["article:published_time"].split("T")[0];break}}let u=this.calculateRelevance(o,c,s);return{title:o,url:l,snippet:c,date:d,relevance:u}});return i.sort((a,o)=>(o.relevance??0)-(a.relevance??0)),i.filter(a=>(a.relevance??0)>=.3)}calculateRelevance(e,t,r){let s=e.toLowerCase(),i=t.toLowerCase(),a=`${s} ${i}`,o=0,c=0;for(let d of r)a.includes(d)&&(c++,s.includes(d)?o+=.3:o+=.1);let l=c/r.length;return o=Math.min(o+l*.2,1),Math.round(o*100)/100}};var qo=class{cache;ttl;maxSize;statistics;constructor(e=24*60*60*1e3,t=0){this.cache=new Map,this.ttl=e,this.maxSize=t,this.statistics={hits:0,misses:0}}get(e){let t=this.normalizeKey(e),r=this.cache.get(t);return r?Date.now()-r.timestamp>this.ttl?(this.cache.delete(t),this.statistics.misses++,null):(this.statistics.hits++,r.variants):(this.statistics.misses++,null)}set(e,t,r){let s=this.normalizeKey(e);this.maxSize>0&&this.cache.size>=this.maxSize&&!this.cache.has(s)&&this.evictOldest(),this.cache.set(s,{variants:t,timestamp:Date.now(),quality:r})}clearExpired(){let e=Date.now(),t=0;for(let[r,s]of this.cache.entries())e-s.timestamp>this.ttl&&(this.cache.delete(r),t++);return t}clear(){this.cache.clear(),this.statistics={hits:0,misses:0}}size(){return this.cache.size}getStatistics(){let e=this.statistics.hits+this.statistics.misses,t=e>0?this.statistics.hits/e:0,r=null,s=null;for(let i of this.cache.values())(r===null||i.timestamp<r)&&(r=i.timestamp),(s===null||i.timestamp>s)&&(s=i.timestamp);return{totalEntries:this.cache.size,totalHits:this.statistics.hits,totalMisses:this.statistics.misses,hitRate:Math.round(t*100)/100,oldestEntry:r,newestEntry:s}}resetStatistics(){this.statistics={hits:0,misses:0}}loadFromData(e){this.cache.clear();let t=Date.now();for(let[r,s]of Object.entries(e))t-s.timestamp<=this.ttl&&this.cache.set(r,s)}toData(){let e={};for(let[t,r]of this.cache.entries())e[t]=r;return e}evictOldest(){let e=null,t=Date.now();for(let[r,s]of this.cache.entries())s.timestamp<t&&(t=s.timestamp,e=r);e&&this.cache.delete(e)}normalizeKey(e){return e.toLowerCase().trim()}};function db(n){return{synonym:"synonym",short:"short","domain-hack":"domain name",phonetic:"phonetic",portmanteau:"portmanteau","made-up":"made-up"}[n]||n}function lh(n,e=10){if(n.length===0)return`## Name Variants

(No variants generated)`;let t=new Map;for(let i of n){let a=i.text.toLowerCase();t.has(a)||t.set(a,i)}return`## Name Variants

${Array.from(t.values()).sort((i,a)=>i.text.localeCompare(a.text)).slice(0,e).map(i=>`- ${i.text} (${db(i.type)})`).join(`
`)}`}async function ub(n,e,t=!1){return!n||n.trim().length===0?"":t&&e?await pu(n,e):ie(n)}function dh(n){return ie(n)}var Go=class{llmService;settings;cache;loadCacheData;saveCacheData;constructor(e,t,r,s){this.llmService=e,this.settings=t,this.cache=new qo(24*60*60*1e3,t.variantCacheMaxSize??0),this.loadCacheData=r,this.saveCacheData=s,t.variantCachePersist&&r&&this.loadCache().catch(i=>{h.warn("Failed to load variant cache:",i)})}async loadCache(){if(this.loadCacheData)try{let e=await this.loadCacheData();e&&typeof e=="object"&&this.cache.loadFromData(e)}catch(e){h.warn("Failed to load variant cache:",e)}}async saveCache(){if(!(!this.settings.variantCachePersist||!this.saveCacheData))try{let e=this.cache.toData();await this.saveCacheData(e)}catch(e){h.warn("Failed to save variant cache:",e)}}getCacheStatistics(){return this.cache.getStatistics()}clearCache(){this.cache.clear(),this.saveCache().catch(e=>{h.warn("Failed to save cache after clear:",e)})}async generateVariants(e,t){let r=t??await ub(e,this.llmService,this.settings.useLLMForNameExtraction||!1);if(!r||r.trim().length===0)return[];let s=this.cache.get(r);if(s)return s;if(this.llmService.isAvailable())try{let o=await this.generateVariantsWithLLM(r);if(o.length>0){let c=this.calculateAverageQuality(o);return this.cache.set(r,o,c),this.settings.variantCachePersist&&this.saveCache().catch(l=>h.warn("Cache save failed:",l)),o}}catch(o){h.warn("LLM variant generation failed, using fallback:",o)}let i=this.generateFallbackVariants(r),a=this.calculateAverageQuality(i,!1);return this.cache.set(r,i,a),this.settings.variantCachePersist&&this.saveCache().catch(o=>h.warn("Cache save failed:",o)),i}isAvailable(){return!0}async generateVariantsWithLLM(e){let t=this.constructPrompt(e);if(this.llmService.complete&&typeof this.llmService.complete=="function")try{let r=await this.llmService.complete(t,{temperature:.8,n_predict:512,stop:["}"]}),s=this.parseVariantResponse(r);if(s.length>0)return s}catch(r){h.warn("LLM completion failed, using fallback:",r)}return[]}parseVariantResponse(e){try{let t=X(e,!1),r=JSON.parse(t);return!r.variants||!Array.isArray(r.variants)?[]:r.variants.filter(s=>typeof s=="object"&&s!==null&&"text"in s&&"type"in s).map(s=>{let i;typeof s.text=="string"?i=s.text:s.text!=null&&typeof s.text!="object"&&typeof s.text!="function"&&(typeof s.text=="number"||typeof s.text=="boolean")?i=s.text.toString():i="";let a;return typeof s.type=="string"?a=s.type:s.type!=null&&typeof s.type!="object"&&typeof s.type!="function"&&(typeof s.type=="number"||typeof s.type=="boolean")?a=s.type.toString():a="",{text:i.trim(),type:this.validateVariantType(a),quality:this.calculateVariantQuality(i.trim(),this.validateVariantType(a))}}).slice(0,this.settings.maxVariants||10)}catch(t){return h.warn("Failed to parse variant response:",e,t),[]}}validateVariantType(e){return["synonym","short","domain-hack","phonetic","portmanteau","made-up"].includes(e)?e:"made-up"}constructPrompt(e){return`Generate creative, brandable name variants for: "${e}"

CRITICAL REQUIREMENTS:
- Extract the CORE CONCEPT, not just use the literal text
- Focus on what makes the idea unique and memorable
- Generate names that could actually be used as product/brand names
- Prioritize creativity and memorability over literal translation

Generate 8-12 high-quality, brandable name variants. Each variant must be:
- Memorable and easy to pronounce (test: can you say it out loud naturally?)
- Distinct and creative (avoid generic words like "AI", "App", "Tool")
- Brandable (could you see this as a real product name?)
- 2-15 characters for most variants (domain hacks can be slightly longer if clever)

Variant types (use diverse mix):
1. synonym - Words capturing the idea's essence (e.g., "puzzle game" \u2192 "Riddle", "Enigma")
2. short - Concise, punchy names 3-8 chars (e.g., "notification" \u2192 "Ping", "Buzz")
3. domain-hack - TLD completes word naturally, MUST be short and clever (e.g., "find.it", "read.ly", NOT "longphrase.io")
4. phonetic - Similar sound, different spelling (e.g., "notify" \u2192 "Notifai")
5. portmanteau - Blend two relevant words (e.g., "net" + "flicks" \u2192 "Netflix")
6. made-up - Invented but pronounceable words (e.g., "Zapier", "Slack", "Figma")

STRICT RULES:
- NEVER create unpronounceable acronyms (e.g., "AGPFOIM" is BAD)
- If using acronyms, they must be 6 chars or fewer AND pronounceable (e.g., "ACME", "NASA")
- Domain hacks: Must be SHORT (under 12 chars total) and clever, not just appending .io to long phrases
- Avoid overly generic terms (e.g., "AI", "App", "Tool" alone are too generic)
- Short names: Must be meaningful words or pronounceable invented words, not random letters
- Extract the essence: For "AI puzzle with monkeys like Where's Waldo" \u2192 focus on "puzzle", "find", "monkey", "hidden", not the full description

Examples:

Input: "notification app"
Output: {
  "variants": [
    {"text": "Alert", "type": "synonym"},
    {"text": "Ping", "type": "short"},
    {"text": "Buzz", "type": "short"},
    {"text": "notif.io", "type": "domain-hack"},
    {"text": "Notifai", "type": "phonetic"},
    {"text": "Alertify", "type": "made-up"},
    {"text": "Signal", "type": "synonym"},
    {"text": "Chime", "type": "short"}
  ]
}

Input: "AI generated puzzle full of interlinked monkeys that look similar, sort of a where's waldo of monkeys"
Output: {
  "variants": [
    {"text": "MonkeyFind", "type": "portmanteau"},
    {"text": "PrimateSeek", "type": "portmanteau"},
    {"text": "FindMonkey", "type": "portmanteau"},
    {"text": "WaldoMonkey", "type": "portmanteau"},
    {"text": "SpotTheApe", "type": "portmanteau"},
    {"text": "MonkeyHunt", "type": "portmanteau"},
    {"text": "PrimatePuzzle", "type": "portmanteau"},
    {"text": "ApeSpot", "type": "short"},
    {"text": "MonkeySee", "type": "portmanteau"},
    {"text": "find.ape", "type": "domain-hack"},
    {"text": "Spotly", "type": "made-up"},
    {"text": "Primate", "type": "synonym"}
  ]
}

Input: "meditation tracker"
Output: {
  "variants": [
    {"text": "Mindful", "type": "synonym"},
    {"text": "Zen", "type": "short"},
    {"text": "Breathe", "type": "synonym"},
    {"text": "Mindspace", "type": "portmanteau"},
    {"text": "Breathly", "type": "made-up"},
    {"text": "Calmly", "type": "made-up"},
    {"text": "Zenly", "type": "made-up"}
  ]
}

Input: "task manager"
Output: {
  "variants": [
    {"text": "Organize", "type": "synonym"},
    {"text": "Tasker", "type": "short"},
    {"text": "Doable", "type": "made-up"},
    {"text": "get.done", "type": "domain-hack"},
    {"text": "Taskly", "type": "phonetic"},
    {"text": "Tackle", "type": "synonym"},
    {"text": "Action", "type": "synonym"}
  ]
}

Input: "${e}"
Output: {`}formatVariantsForMarkdown(e){return lh(e,this.settings.maxVariants||10)}calculateVariantQuality(e,t){let r=.5;return e.length>=3&&e.length<=15?r+=.2:e.length>15&&e.length<=25?r+=.1:(e.length<3||e.length>30)&&(r-=.2),r+={synonym:.15,portmanteau:.15,phonetic:.1,short:.05,"domain-hack":.05,"made-up":0}[t]||0,/^[a-z]+$/i.test(e)&&(r+=.1),e.split(/\s+/).length<=2&&(r+=.05),Math.max(0,Math.min(1,r))}calculateAverageQuality(e,t=!0){if(e.length===0)return 0;let r=e.map(i=>i.quality!==void 0?i.quality:this.calculateVariantQuality(i.text,i.type)),s=r.reduce((i,a)=>i+a,0)/r.length;return t?Math.min(1,s+.1):s}generateFallbackVariants(e){let t=[],r=e.split(/\s+/).filter(c=>c.length>0&&c.length<=15),s=e.replace(/\s+/g,"").toLowerCase(),i=r.filter(c=>{let l=c.toLowerCase();return!["the","a","an","of","for","with","that","this","is","are","was","were"].includes(l)}),a=i.length>0?i:r;if(a.length>0){let c=a[0];if(c.length>=3&&c.length<=12){let l=c.charAt(0).toUpperCase()+c.slice(1).toLowerCase();t.push({text:l,type:"short"})}}if(s.length>0&&s.length<=12&&(t.push({text:`${s}.io`,type:"domain-hack"}),s.length<=10&&t.push({text:`${s}.app`,type:"domain-hack"})),a.length>=2){let c=a[0].toLowerCase(),l=a[1].toLowerCase();if(c.length<=8&&l.length<=8){let d=c+l,u=c.substring(0,Math.min(4,c.length))+l;if(d.length<=12){let m=d.charAt(0).toUpperCase()+d.slice(1);t.push({text:m,type:"portmanteau"})}if(u.length<=12&&u!==d){let m=u.charAt(0).toUpperCase()+u.slice(1);t.push({text:m,type:"portmanteau"})}}}if(a.length>=2&&a.length<=4){let c=a.map(l=>l[0]?.toUpperCase()||"").join("");c.length>=2&&c.length<=4&&t.push({text:c,type:"short"})}return t.map(c=>({...c,quality:this.calculateVariantQuality(c.text,c.type)})).slice(0,this.settings.maxVariants||8)}};var pb={saas:"project",tool:"project",ux:"project",game:"game-mechanic",mechanic:"game-mechanic",story:"narrative-seed",ip:"narrative-seed",hardware:"hardware-concept",brand:"hardware-concept",personal:"generic-idea","":"generic-idea"},mb={id:"project",name:"Project Scaffold",categories:["saas","tool","ux"],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Core Features",content:`## Core Features

- [ ] Feature 1
- [ ] Feature 2
- [ ] Feature 3`,questions:["What are the core features of this project?","What problems does it solve?","Who is the target audience?"]},{title:"Technical Considerations",content:`## Technical Considerations

- Technology stack
- Architecture decisions
- Scalability requirements`,questions:["What technologies are needed?","What are the technical challenges?","What infrastructure is required?"]},{title:"Next Steps",content:`## Next Steps

- [ ] Research existing solutions
- [ ] Validate market need
- [ ] Create prototype
- [ ] Gather feedback`}]},hb={id:"game-mechanic",name:"Game Mechanic Scaffold",categories:["game","mechanic"],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Mechanic Description",content:`## Mechanic Description

Describe how the mechanic works:

- Core gameplay loop
- Player interactions
- Progression systems`,questions:["How does this mechanic work?","What makes it engaging?","How does it fit into the larger game?"]},{title:"Implementation Considerations",content:`## Implementation Considerations

- Technical requirements
- Balance and tuning
- Player feedback systems`,questions:["What technical challenges exist?","How will this be balanced?","What metrics will measure success?"]},{title:"Next Steps",content:`## Next Steps

- [ ] Create prototype
- [ ] Playtest mechanic
- [ ] Iterate based on feedback
- [ ] Document design decisions`}]},fb={id:"narrative-seed",name:"Narrative Seed Scaffold",categories:["story","ip"],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Core Concept",content:`## Core Concept

- Main premise
- Key themes
- Unique elements`,questions:["What is the central premise?","What themes does this explore?","What makes this story unique?"]},{title:"Characters and World",content:`## Characters and World

- Main characters
- Setting details
- World-building elements`,questions:["Who are the main characters?","Where does this take place?","What are the key world-building elements?"]},{title:"Development",content:`## Development

- Plot structure
- Key scenes
- Resolution`,questions:["What is the story structure?","What are the key turning points?","How does it resolve?"]}]},gb={id:"hardware-concept",name:"Hardware Concept Scaffold",categories:["hardware","brand"],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Product Description",content:`## Product Description

- Physical specifications
- Key features
- Design considerations`,questions:["What does this product do?","What are the key features?","What is the target market?"]},{title:"Technical Requirements",content:`## Technical Requirements

- Components needed
- Manufacturing considerations
- Technical challenges`,questions:["What components are required?","What are the manufacturing challenges?","What technical expertise is needed?"]},{title:"Next Steps",content:`## Next Steps

- [ ] Create detailed specifications
- [ ] Research manufacturing options
- [ ] Build prototype
- [ ] Test and iterate`}]},uh={id:"generic-idea",name:"Idea Scaffold",categories:["personal",""],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Key Points",content:`## Key Points

- Main concept
- Important details
- Related ideas`,questions:["What is the core idea?","What are the key elements?","What should be explored further?"]},{title:"Next Steps",content:`## Next Steps

- [ ] Research
- [ ] Develop further
- [ ] Take action`}]},Vo=[mb,hb,fb,gb,uh];function ph(n){let e=pb[n]??"generic-idea";return Vo.find(t=>t.id===e)??uh}var Qd=require("obsidian");var un=".ideatr/templates",zo=class{vault;app;customTemplates=[];allTemplates=[];constructor(e,t){this.vault=e,this.app=t,this.allTemplates=[...Vo],e&&this.loadCustomTemplates().catch(r=>{h.warn("Failed to load custom templates:",r)})}async loadCustomTemplates(){if(this.vault)try{if(!this.vault.getAbstractFileByPath(un)){this.updateAllTemplates();return}let t=this.vault.getFiles().filter(s=>s.path.startsWith(un+"/")&&s.extension==="json"),r=[];for(let s of t)try{let i=await this.vault.read(s),a=JSON.parse(i);this.validateTemplate(a)?r.push(a):h.warn(`Invalid template structure in ${s.path}`)}catch(i){h.warn(`Failed to load template from ${s.path}:`,i)}this.customTemplates=r,this.updateAllTemplates()}catch(e){h.warn("Failed to load custom templates:",e),this.updateAllTemplates()}}updateAllTemplates(){let e=new Map;for(let t of Vo)e.set(t.id,t);for(let t of this.customTemplates)e.set(t.id,t);this.allTemplates=Array.from(e.values())}validateTemplate(e){if(!e||typeof e!="object")return!1;let t=e;return typeof t.id=="string"&&typeof t.name=="string"&&Array.isArray(t.categories)&&Array.isArray(t.sections)&&t.sections.every(r=>{if(!r||typeof r!="object")return!1;let s=r;return typeof s.title=="string"&&typeof s.content=="string"})}async saveCustomTemplate(e){if(!this.vault)throw new Error("Vault not available for saving templates");this.vault.getAbstractFileByPath(un)||await this.vault.createFolder(un);let r=`${e.id}.json`,s=`${un}/${r}`,i=JSON.stringify(e,null,2),a=this.vault.getAbstractFileByPath(s);a&&a instanceof Qd.TFile?await this.vault.modify(a,i):await this.vault.create(s,i),await this.loadCustomTemplates()}async deleteCustomTemplate(e){if(!this.vault)throw new Error("Vault not available for deleting templates");let t=`${un}/${e}.json`,r=this.vault.getAbstractFileByPath(t);r&&r instanceof Qd.TFile&&(this.app?await this.app.fileManager.trashFile(r):this.vault&&await this.vault.delete(r),await this.loadCustomTemplates())}getAvailableTemplates(){return this.allTemplates}isAvailable(){return!0}generateScaffold(e,t,r){let s=r??dh(e),i=this.selectTemplate(t),a={ideaName:s,ideaText:e||"",category:t||"uncategorized",created:new Date().toISOString().split("T")[0],tags:""};return i.sections.map(c=>{let l=this.substituteVariables(c.content,a);if(c.questions&&c.questions.length>0){let d=c.questions.map(u=>`- ${u}`).join(`
`);l+=`

### Questions to Consider

${d}`}return l}).join(`

`)}selectTemplate(e){let t=ph(e).id;return this.allTemplates.find(r=>r.id===t)??this.allTemplates.find(r=>r.id==="generic-idea")??this.allTemplates[0]}substituteVariables(e,t){let r=e;for(let[s,i]of Object.entries(t)){let a=new RegExp(`\\{\\{${s}\\}\\}`,"g");r=r.replace(a,i||"")}return r}};var Xe=class{parseFrontmatter(e){let t=/^---\n([\s\S]*?)\n---/,r=e.match(t);if(!r?.[1])return null;let s=r[1],i={},a=s.split(`
`),o=null,c=null,l=null,d=0,u="";for(let A of a){let f=A.trim();if(f.startsWith("type:"))o=f.substring(5).trim();else if(f.startsWith("status:"))c=f.substring(7).trim();else if(f.startsWith("created:"))l=f.substring(8).trim();else if(f.startsWith("id:")){let S=f.substring(3).trim(),P=parseInt(S,10);isNaN(P)||(d=P)}else f.startsWith("category:")&&(u=f.substring(9).trim())}if(!o||!c||!l)return null;i.type=o,i.status=c,i.created=l,i.id=d,i.category=u,i.tags=this.parseArrayField(s,"tags"),i.related=this.parseNumberArrayField(s,"related"),i.domains=this.parseArrayField(s,"domains"),i["existence-check"]=this.parseArrayField(s,"existence-check");let m=s.match(/^elevated:\s*(.+)$/m),p=s.match(/^projectPath:\s*(.+)$/m),y=s.match(/^codename:\s*(.+)$/m);m&&(i.elevated=m[1].trim()),p&&(i.projectPath=p[1].trim()),y&&(i.codename=y[1].trim());let v=s.match(/^dismissed:\s*(.+)$/m),E=s.match(/^actedUpon:\s*(.+)$/m);return v&&(i.dismissed=v[1].trim().toLowerCase()==="true"),E&&(i.actedUpon=E[1].trim().toLowerCase()==="true"),this.validateFrontmatter(i)?i:null}parseArrayField(e,t){let r=new RegExp(`^${t}:\\s*(.+)$`,"m"),s=e.match(r);if(!s)return[];let i=s[1].trim();if(i==="[]")return[];let a=i.match(/^\[(.+)\]$/);return a?a[1].split(",").map(c=>c.trim()).filter(c=>c.length>0):[]}parseNumberArrayField(e,t){let r=new RegExp(`^${t}:\\s*(.+)$`,"m"),s=e.match(r);if(!s)return[];let i=s[1].trim();if(i==="[]")return[];let a=i.match(/^\[(.+)\]$/);return a?a[1].split(",").map(c=>{let l=c.trim().replace(/^["']|["']$/g,""),d=parseInt(l,10);return isNaN(d)?0:d}).filter(c=>c!==0):[]}parseIdeaFile(e,t){let r=this.parseFrontmatter(t);return r?{frontmatter:r,body:this.extractBody(t),filename:e.name}:{frontmatter:{type:"idea",status:"captured",created:new Date().toISOString().split("T")[0],id:0,category:"",tags:[],related:[],domains:[],"existence-check":[]},body:this.extractBody(t),filename:e.name}}parse(e){let t=this.parseFrontmatter(e),r=this.extractBody(e);return t?{frontmatter:t,body:r}:{frontmatter:{type:"idea",status:"captured",created:new Date().toISOString().split("T")[0],id:0,category:"",tags:[],related:[],domains:[],"existence-check":[]},body:r}}build(e,t){return`${dn(e)}

${t}`}extractBody(e){let t=/^---\n[\s\S]*?\n---(\n\n?|\n?)/;return e.replace(t,"").trim()}validateFrontmatter(e){if(!e.type||e.type!=="idea")return!1;let t=["captured","elevated","archived","validated","promoted"];if(!e.status||!t.includes(e.status)||!e.created||typeof e.created!="string"||!/^\d{4}-\d{2}-\d{2}$/.test(e.created)||((e.id===void 0||typeof e.id!="number")&&(e.id=0),e.category!==void 0&&typeof e.category!="string"))return!1;let s=["tags","related","domains","existence-check"];for(let i of s)if(e[i]!==void 0&&!Array.isArray(e[i]))return!1;return!0}};var mh=require("obsidian");var Wo=class{constructor(e,t){this.vault=e;this.parser=t??new Xe}cache=new Map;watchers=new Set;parser;MAX_CACHE_SIZE=1e4;async getAllIdeas(){let t=this.vault.getMarkdownFiles().filter(s=>s.path.startsWith("Ideas/")),r=[];for(let s of t)try{let i=await this.vault.read(s),a=this.parser.parseIdeaFile(s,i);if(r.push(a),this.cache.set(s.path,a),this.cache.size>this.MAX_CACHE_SIZE){let o=this.cache.keys().next().value;o&&typeof o=="string"&&this.cache.delete(o)}}catch{let i=new Pe(`Failed to read idea file: ${s.path}`,"FILE_READ_ERROR");h.warn(i.message,i)}return r}async getIdeasByFilter(e){let r=this.cache.size>0?Array.from(this.cache.values()):await this.getAllIdeas();if(e.categories&&e.categories.length>0&&(r=r.filter(s=>e.categories.includes(s.frontmatter.category))),e.tags&&e.tags.length>0&&(r=r.filter(s=>e.tags.some(i=>s.frontmatter.tags.includes(i)))),e.status&&(r=r.filter(s=>s.frontmatter.status===e.status)),e.uncategorized&&(r=r.filter(s=>s.frontmatter.category==="")),e.searchText){let s=e.searchText.toLowerCase();r=r.filter(i=>{let a=i.filename.toLowerCase(),o=i.body.toLowerCase(),c=i.frontmatter.tags.join(" ").toLowerCase();return a.includes(s)||o.includes(s)||c.includes(s)})}return e.dateRange&&(r=r.filter(s=>{let i=new Date(s.frontmatter.created);return i>=e.dateRange.start&&i<=e.dateRange.end})),r}async getIdeaByPath(e){if(!e.startsWith("Ideas/"))return null;let t=this.vault.getAbstractFileByPath(e),r=t instanceof mh.TFile?t:null;if(!r)return null;try{let s=await this.vault.read(r),i=this.parser.parseIdeaFile(r,s);if(this.cache.set(e,i),this.cache.size>this.MAX_CACHE_SIZE){let a=this.cache.keys().next().value;a&&typeof a=="string"&&this.cache.delete(a)}return i}catch(s){return h.warn(`Failed to read idea file: ${e}`,s),null}}watchIdeas(e){let t=c=>{c.path.startsWith("Ideas/")&&(async()=>{try{let d=await this.vault.read(c),u=this.parser.parseIdeaFile(c,d);this.cache.set(c.path,u)}catch{this.cache.delete(c.path)}let l=Array.from(this.cache.values());e(l)})()},r=c=>{if(c.path.startsWith("Ideas/")){this.cache.delete(c.path);let l=Array.from(this.cache.values());e(l)}},s=this.vault.on.bind(this.vault),i=s("modify",t),a=s("create",t),o=s("delete",r);return this.watchers.add(i),this.watchers.add(a),this.watchers.add(o),()=>{i(),a(),o(),this.watchers.delete(i),this.watchers.delete(a),this.watchers.delete(o)}}async refresh(){this.cache.clear(),await this.getAllIdeas()}};var pn=class{isAvailable(){return!0}generateEmbedding(e){let t=this.tokenize(e),r=this.calculateWordFrequencies(t),s=[],i=Array.from(new Set(t));for(let a=0;a<50;a++){let o=0;for(let c of i){let l=this.simpleHash(c+a);o+=l%100/100*r[c]}s.push(o/i.length)}return s}generateEmbeddings(e){return e.map(t=>this.generateEmbedding(t))}calculateSimilarityMatrix(e){let t=[];for(let r=0;r<e.length;r++){let s=[],i=this.getIdeaText(e[r]);for(let a=0;a<e.length;a++)if(r===a)s.push(1);else{let o=this.getIdeaText(e[a]),c=this.calculateSimilarity(i,o);s.push(c)}t.push(s)}return t}calculateSimilarity(e,t){let r=new Set(this.tokenize(e.toLowerCase())),s=new Set(this.tokenize(t.toLowerCase()));if(r.size===0&&s.size===0)return 1;if(r.size===0||s.size===0)return 0;let i=new Set([...r].filter(o=>s.has(o))),a=new Set([...r,...s]);return i.size/a.size}tokenize(e){return e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(t=>t.length>0)}calculateWordFrequencies(e){let t={};for(let r of e)t[r]=(t[r]||0)+1;return t}simpleHash(e){let t=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);t=(t<<5)-t+s,t=t&t}return Math.abs(t)}getIdeaText(e){let t=[];return e.frontmatter.category&&t.push(e.frontmatter.category),t.push(...e.frontmatter.tags),t.push(e.body),t.join(" ")}};var Ko=class{constructor(e,t=.3){this.embeddingService=e;this.similarityThreshold=t}clusterIdeas(e,t){if(e.length===0)return Promise.resolve([]);if(e.length===1)return Promise.resolve([{id:"cluster-0",ideas:[e[0]],label:"Single Idea"}]);let r;if(t)r=this.calculateSimilarityMatrixFromEmbeddings(t);else if(this.embeddingService instanceof pn)r=this.embeddingService.calculateSimilarityMatrix(e);else{let i=e.map(o=>this.getIdeaText(o)),a=this.embeddingService.generateEmbeddings(i);r=this.calculateSimilarityMatrixFromEmbeddings(a)}let s=this.hierarchicalClustering(e,r);return Promise.resolve(s)}calculateSimilarity(e,t){if(e.length!==t.length)return 0;let r=0,s=0,i=0;for(let c=0;c<e.length;c++)r+=e[c]*t[c],s+=e[c]*e[c],i+=t[c]*t[c];let a=Math.sqrt(s)*Math.sqrt(i);return a===0?0:(r/a+1)/2}calculateSimilarityMatrixFromEmbeddings(e){let t=[];for(let r=0;r<e.length;r++){let s=[];for(let i=0;i<e.length;i++)if(r===i)s.push(1);else{let a=this.calculateSimilarity(e[r],e[i]);s.push(a)}t.push(s)}return t}hierarchicalClustering(e,t){let r=e.map((s,i)=>({id:`cluster-${i}`,ideas:[s],label:this.generateClusterLabel([s])}));for(;r.length>1;){let s=-1,i=-1,a=-1;for(let c=0;c<r.length;c++)for(let l=c+1;l<r.length;l++){let d=this.calculateClusterSimilarity(r[c],r[l],t,e);d>s&&(s=d,i=c,a=l)}if(s<this.similarityThreshold)break;let o={id:`cluster-${r.length}`,ideas:[...r[i].ideas,...r[a].ideas],label:this.generateClusterLabel([...r[i].ideas,...r[a].ideas])};r=r.filter((c,l)=>l!==i&&l!==a),r.push(o)}return r.map((s,i)=>({...s,id:`cluster-${i}`}))}calculateClusterSimilarity(e,t,r,s){let i=e.ideas.map(l=>s.findIndex(d=>d.filename===l.filename)),a=t.ideas.map(l=>s.findIndex(d=>d.filename===l.filename)),o=0,c=0;for(let l of i)for(let d of a)l>=0&&d>=0&&l<r.length&&d<r[l].length&&(o+=r[l][d],c++);return c>0?o/c:0}generateClusterLabel(e){if(e.length===0)return"Empty Cluster";if(e.length===1)return e[0].frontmatter.category||"Uncategorized";let t=e.map(i=>i.frontmatter.category).filter(i=>i);if(t.length===0)return"Mixed Ideas";let r={};for(let i of t)r[i]=(r[i]||0)+1;let s=Object.entries(r).sort((i,a)=>a[1]-i[1])[0];return s?`${s[0]} (${e.length})`:"Mixed Ideas"}getIdeaText(e){let t=[];return e.frontmatter.category&&t.push(e.frontmatter.category),t.push(...e.frontmatter.tags),t.push(e.body),t.join(" ")}};var Jo=class{layoutGraph(e,t,r){if(e.length===0)return{nodes:[],edges:[],width:t,height:r};let s=[],i=[],a=t/2,o=r/2,c=Math.min(t,r)*.3,l=0;for(let d of e){let u=2*Math.PI*e.indexOf(d)/e.length,m=a+c*Math.cos(u),p=o+c*Math.sin(u),y=Math.ceil(Math.sqrt(d.ideas.length)),v=50;d.ideas.forEach((E,A)=>{let f=Math.floor(A/y),P=(A%y-y/2)*v,k=(f-y/2)*v;s.push({id:`node-${l++}`,idea:E,x:m+P,y:p+k,clusterId:d.id})})}for(let d=0;d<s.length;d++)for(let u=d+1;u<s.length;u++)if(s[d].clusterId===s[u].clusterId){let m=this.calculateNodeSimilarity(s[d].idea,s[u].idea);m>.1&&i.push({from:s[d].id,to:s[u].id,weight:m})}return{nodes:s,edges:i,width:t,height:r}}updateLayout(e,t){if(!t.length||!e.nodes.length)return e;let r=new Map;for(let d of e.nodes)r.set(d.idea.filename,d);let s=[...e.nodes],i=[...e.edges],a=e.nodes.reduce((d,u)=>d+u.x,0)/e.nodes.length,o=e.nodes.reduce((d,u)=>d+u.y,0)/e.nodes.length,c=e.nodes[0]?.clusterId??"cluster-0",l=0;for(let d of t){let u=r.get(d.filename);if(u){u.idea=d;continue}let m=30+l*20,p=l%2===0?1:-1,y={id:`node-${s.length+l}`,idea:d,x:Math.min(Math.max(a+p*m,0),e.width),y:Math.min(Math.max(o+p*m,0),e.height),clusterId:c};s.push(y);for(let v of e.nodes){if(v.clusterId!==y.clusterId)continue;let E=this.calculateNodeSimilarity(v.idea,d);E>.1&&i.push({from:v.id,to:y.id,weight:E})}l++}return{...e,nodes:s,edges:i}}calculateNodeSimilarity(e,t){let r=0;e.frontmatter.category===t.frontmatter.category&&e.frontmatter.category&&(r+=.3);let s=new Set(e.frontmatter.tags),i=new Set(t.frontmatter.tags),a=new Set([...s].filter(m=>i.has(m))),o=new Set([...s,...i]);o.size>0&&(r+=.2*(a.size/o.size));let c=new Set(this.tokenize(e.body)),l=new Set(this.tokenize(t.body)),d=new Set([...c].filter(m=>l.has(m))),u=new Set([...c,...l]);return u.size>0&&(r+=.5*(d.size/u.size)),Math.min(r,1)}tokenize(e){return e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(t=>t.length>2)}};var Yd=require("obsidian");var Xo=class{constructor(e,t,r){this.ideaRepository=e;this.settings=t;this.vault=r}async identifyOldIdeas(e){let t=e??this.settings.resurfacingThresholdDays??7,r=await this.ideaRepository.getAllIdeas(),s=new Date,i=new Date(s.getTime()-t*24*60*60*1e3),a=[];for(let o of r){let c=new Date(o.frontmatter.created);if(isNaN(c.getTime())){let l=new Pe(`Failed to parse date for idea ${o.filename}`,"DATE_PARSE_ERROR");h.warn(l.message,l);continue}c<i&&(await this.isDismissedOrActedUpon(`Ideas/${o.filename}`)||a.push(o))}return a}async generateDigest(e){let t=e??await this.identifyOldIdeas();t.sort((s,i)=>{let a=new Date(s.frontmatter.created).getTime(),o=new Date(i.frontmatter.created).getTime();return a-o});let r=this.generateDigestMarkdown(t);return{id:`digest-${Date.now()}`,generatedAt:new Date,ideas:t,summary:r}}async markAsDismissed(e){if(!this.vault){h.warn("Vault not available, cannot mark as dismissed");return}let t=this.vault.getAbstractFileByPath(e),r=t instanceof Yd.TFile?t:null;if(!r){h.warn(`File not found: ${e}`);return}await new Fr(this.vault).updateIdeaFrontmatter(r,{dismissed:!0,dismissedAt:new Date().toISOString().split("T")[0]})}async markAsActedUpon(e){if(!this.vault){h.warn("Vault not available, cannot mark as acted upon");return}let t=this.vault.getAbstractFileByPath(e),r=t instanceof Yd.TFile?t:null;if(!r){h.warn(`File not found: ${e}`);return}await new Fr(this.vault).updateIdeaFrontmatter(r,{actedUpon:!0,actedUponAt:new Date().toISOString().split("T")[0]})}async isDismissedOrActedUpon(e){let t=await this.ideaRepository.getIdeaByPath(e);if(!t)return!1;let r=t.frontmatter;return!!((r.dismissed??!1)||(r.actedUpon??!1))}generateDigestMarkdown(e){if(e.length===0)return`# Weekly Idea Digest

No old ideas found.`;let t=["# Weekly Idea Digest","",`Generated on: ${new Date().toLocaleDateString()}`,"","## Old Ideas Needing Attention",""];for(let i of e){let a=this.calculateAge(i.frontmatter.created),o=i.body.substring(0,200),c=i.body.length>200;t.push(`### ${i.filename.replace(".md","")}`),t.push(""),t.push(`**Category**: ${i.frontmatter.category??"Uncategorized"}`),t.push(`**Created**: ${i.frontmatter.created}`),t.push(`**Age**: ${a} days`),i.frontmatter.tags.length>0&&t.push(`**Tags**: ${i.frontmatter.tags.join(", ")}`),t.push(""),t.push(o+(c?"...":"")),t.push(""),t.push(`[Open Idea](Ideas/${i.filename})`),t.push(""),t.push("---"),t.push("")}t.push("## Summary"),t.push(""),t.push(`- **Total Ideas**: ${e.length}`);let r={};for(let i of e){let a=i.frontmatter.category??"Uncategorized";r[a]=(r[a]??0)+1}let s=Object.entries(r).map(([i,a])=>`${i}: ${a}`).join(", ");return t.push(`- **By Category**: ${s}`),t.push(""),t.join(`
`)}calculateAge(e){try{let t=new Date(e),s=Math.abs(new Date().getTime()-t.getTime());return Math.ceil(s/(1e3*60*60*24))}catch{return 0}}};var Zd=require("obsidian");var Qo=class{vault;app;frontmatterParser;settings;constructor(e,t,r,s){this.vault=e,this.app=s,this.frontmatterParser=t,this.settings=r}getProjectsDirectory(){return this.settings.elevationProjectsDirectory??"Projects"}getDefaultFolders(){return(this.settings.elevationDefaultFolders??"docs,notes,assets").split(",").map(t=>t.trim()).filter(t=>t.length>0)}canElevate(e){return!(!e.frontmatter?.type||!e.frontmatter.status||e.frontmatter.status==="elevated"||e.frontmatter.type!=="idea")}generateProjectName(e){let t=ie(e.body);if(!t||t.trim().length===0){let r=e.filename.replace(/\.md$/,""),s=r.match(/^\d{4}-\d{2}-\d{2}\s+(.+)$/);s?t=s[1]:t=r}return this.sanitizeProjectName(t)}sanitizeProjectName(e){let t=e.toLowerCase();return t=t.replace(/[^a-z0-9-]/g,"-"),t=t.replace(/-+/g,"-"),t=t.replace(/^-+|-+$/g,""),t.length>50&&(t=t.substring(0,50),t=t.replace(/-+$/,"")),t.length<1&&(t="project"),t}isProjectNameAvailable(e){let t=`${this.getProjectsDirectory()}/${e}`;return this.vault.getAbstractFileByPath(t)===null}async elevateIdea(e,t){if(!this.canElevate(e))return{success:!1,error:"Idea cannot be elevated. It may already be elevated or have invalid frontmatter."};let r=`Ideas/${e.filename}`,s=this.vault.getAbstractFileByPath(r),i=s instanceof Zd.TFile?s:null;if(!i)return{success:!1,error:`Idea file not found: ${r}`};let a=t??this.generateProjectName(e),o=await this.resolveProjectNameCollision(a),c=`${this.getProjectsDirectory()}/${o}`,l=[],d=[];try{let u=await this.vault.read(i);await this.ensureProjectsDirectory(),await this.createProjectStructure(c,l);let m=this.prepareElevatedContent(u,c);await this.vault.create(`${c}/README.md`,m),l.push(`${c}/README.md`);try{await this.handleDevraIntegration(c,e),l.push(`${c}/.devra.json`)}catch(p){d.push("Failed to create project metadata file (non-fatal)"),h.warn("Project metadata integration failed:",p)}try{this.app?await this.app.fileManager.trashFile(i):await this.vault.delete(i)}catch(p){d.push("Failed to delete original idea file (project created successfully)"),h.warn("Failed to delete original file:",p)}return{success:!0,projectPath:c,warnings:d.length>0?d:void 0}}catch(u){return await this.rollback(l),{success:!1,error:u instanceof Error?u.message:"Unknown error during elevation"}}}resolveProjectNameCollision(e){let t=e,r=2;for(;!this.isProjectNameAvailable(t);)t=`${e}-${r}`,r++;return Promise.resolve(t)}async ensureProjectsDirectory(){let e=this.getProjectsDirectory();this.vault.getAbstractFileByPath(e)||await this.vault.createFolder(e)}async createProjectStructure(e,t){let r=this.getDefaultFolders();await this.vault.createFolder(e),t.push(e);for(let s of r){let i=`${e}/${s}`;await this.vault.createFolder(i),t.push(i)}}prepareElevatedContent(e,t){let r=this.frontmatterParser.parseFrontmatter(e);if(!r)throw new Error("Failed to parse frontmatter from original file");let s=e.match(/^---\n[\s\S]*?\n---(\n\n?|\n?)([\s\S]*)$/),i=s?s[2].trim():"",a={...r,status:"elevated",elevated:new Date().toISOString().split("T")[0],projectPath:t};return`${dn(a)}

${i}`}async handleDevraIntegration(e,t){if(!this.settings.elevationCreateDevraMetadata)return;let r={name:this.generateProjectName(t),type:"project",source:"ideatr",elevated:new Date().toISOString().split("T")[0],ideaPath:t.filename,ideaCategory:t.frontmatter.category??"",ideaTags:t.frontmatter.tags??[],devraReady:!1,devraProjectPath:null},s=`${e}/.devra.json`;await this.vault.adapter.write(s,JSON.stringify(r,null,2))}async rollback(e){for(let t of[...e].reverse())try{let r=this.vault.getAbstractFileByPath(t);r&&(r instanceof Zd.TFile?this.app?await this.app.fileManager.trashFile(r):await this.vault.delete(r):await this.vault.adapter.rmdir(t,!0))}catch(r){h.warn(`Failed to rollback ${t}:`,r)}}};var Yo=class{vault;embeddingService;llmService;MIN_SIMILARITY=.3;MAX_SIMILARITY=.5;constructor(e,t,r){this.vault=e,this.embeddingService=t,this.llmService=r}async findTenuousLinks(e,t,r,s){let a=this.vault.getMarkdownFiles().filter(l=>l.path.startsWith("Ideas/")&&!l.path.startsWith("Ideas/Archived/")),o=[];for(let l of a)if(!s.includes(l.path))try{let d=await this.vault.cachedRead(l),u=d.match(/^---\n[\s\S]*?\n---\n\n?([\s\S]*)$/),m=u?u[1].trim():d.trim();if(m.length===0)continue;let p=this.calculateSimilarity(e,m);if(p>=this.MIN_SIMILARITY&&p<=this.MAX_SIMILARITY){let y=d.match(/^---\n([\s\S]*?)\n---/);if(y){let E=y[1].match(/^category:\s*(.+)$/m);if((E?E[1].trim():"")===t)continue;o.push({file:l,similarity:p,content:m})}}}catch(d){h.warn(`Failed to process ${l.path} for tenuous links:`,d)}let c=[];for(let l of o.slice(0,10))try{let d=await this.analyzeConnection(e,t,r,l.content,l.similarity);d.relevance>.5&&c.push({idea:{path:l.file.path,title:l.file.basename,similarity:l.similarity},similarity:l.similarity,explanation:d.explanation,synergy:d.synergy,relevance:d.relevance})}catch(d){h.warn(`Failed to analyze connection with ${l.file.path}:`,d)}return c.sort((l,d)=>d.relevance-l.relevance),c}calculateSimilarity(e,t){let r=this.embeddingService.generateEmbedding(e),s=this.embeddingService.generateEmbedding(t);return this.cosineSimilarity(r,s)}cosineSimilarity(e,t){if(e.length!==t.length)return 0;let r=0,s=0,i=0;for(let o=0;o<e.length;o++)r+=e[o]*t[o],s+=e[o]*e[o],i+=t[o]*t[o];let a=Math.sqrt(s)*Math.sqrt(i);return a===0?0:r/a}async analyzeConnection(e,t,r,s,i){let a=`Analyze the connection between these two ideas, focusing on unexpected or creative connections.

Original Idea:
${e}
Category: ${t}
Tags: ${r.join(", ")}

Related Idea:
${s}
Similarity: ${i.toFixed(2)}

CRITICAL REQUIREMENTS:
- Look beyond surface-level similarities to find deeper, more interesting connections
- Focus on unexpected or creative connections that might not be immediately obvious
- Consider how these ideas could enhance or transform each other
- Think about novel applications or combinations

Analyze and identify:

1. Unexpected Connection
   - What is the non-obvious link between these ideas?
   - What hidden relationships exist beyond the similarity score?
   - How do they relate in ways that might not be immediately apparent?
   - What shared principles, approaches, or underlying concepts connect them?

2. Combination Potential
   - How could these ideas be meaningfully combined?
   - What would a merged or hybrid version look like?
   - How could elements from one idea enhance the other?
   - What complementary strengths do they have?

3. New Possibilities
   - What novel applications emerge from this connection?
   - What new ideas or directions does this relationship suggest?
   - How could combining these ideas solve problems neither could solve alone?
   - What unique value would a combination create?

Output format (JSON only, no markdown, no code blocks):
{
  "explanation": "Clear explanation of the unexpected connection between these ideas...",
  "synergy": "Specific description of how these ideas could be combined and what the result would be...",
  "relevance": 0.0-1.0
}

Response:`;if(!this.llmService.complete)return{explanation:`Similarity: ${i.toFixed(2)}`,relevance:i};try{let o=await this.llmService.complete(a,{temperature:.7,n_predict:500}),c=X(o,!1),l=JSON.parse(c);return{explanation:typeof l.explanation=="string"?l.explanation:"",synergy:typeof l.synergy=="string"?l.synergy:void 0,relevance:typeof l.relevance=="number"?l.relevance:.5}}catch(o){h.warn("Failed to parse LLM analysis:",o)}return{explanation:`Similarity: ${i.toFixed(2)}`,relevance:i}}};var Zo=class{vault;frontmatterParser;ideaRepository;constructor(e,t){this.vault=e,this.frontmatterParser=new Xe,this.ideaRepository=t}async exportIdeas(e){let r=this.vault.getMarkdownFiles().filter(o=>o.path.startsWith("Ideas/")&&!o.path.startsWith("Ideas/Archived/")),s=[],i=new U(this.ideaRepository);for(let o of r)try{let c=await this.vault.read(o),l=this.frontmatterParser.parse(c),d=o.basename.replace(/^\d{4}-\d{2}-\d{2}-/,"").replace(/-/g," "),u=Array.isArray(l.frontmatter.related)?l.frontmatter.related.filter(p=>typeof p=="number"&&p!==0):[],m=await i.idsToPaths(u);s.push({...l.frontmatter,related:m,title:d,body:l.body,filename:o.name,path:o.path})}catch(c){h.warn(`Failed to export ${o.path}:`,c)}let a={version:"1.0",exportedAt:new Date().toISOString(),totalIdeas:s.length,ideas:s};switch(e){case"json":return this.exportJSON(a);case"csv":return this.exportCSV(a);case"markdown":return this.exportMarkdown(a);default:throw new Error(`Unsupported export format: ${String(e)}`)}}exportJSON(e){return JSON.stringify(e,null,2)}exportCSV(e){let t=[];t.push("title,created,category,tags,status,body,related,domains,existence-check");for(let r of e.ideas){let s=[this.escapeCSV(r.title),r.created,r.category||"",r.tags.join(";"),r.status,this.escapeCSV(r.body.replace(/\n/g," ")),r.related.join(";"),r.domains.join(";"),r["existence-check"].join(";")];t.push(s.join(","))}return t.join(`
`)}exportMarkdown(e){let t=[];t.push("# Ideas Export"),t.push(`Exported: ${e.exportedAt}`),t.push(`Total Ideas: ${e.totalIdeas}`),t.push("");for(let r of e.ideas)t.push(`## ${r.title}`),t.push(`- Created: ${r.created}`),t.push(`- Category: ${r.category||"none"}`),t.push(`- Status: ${r.status}`),t.push(`- Tags: ${r.tags.join(", ")||"none"}`),t.push(""),t.push(r.body),t.push(""),t.push("---"),t.push("");return t.join(`
`)}escapeCSV(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}};var ec=class{vault;frontmatterParser;ideaRepository;constructor(e,t){this.vault=e,this.frontmatterParser=new Xe,this.ideaRepository=t}async importIdeas(e,t){let r={total:0,imported:0,failed:0,errors:[]},s=[];try{switch(t){case"json":s=this.parseJSON(e);break;case"csv":s=this.parseCSV(e);break;case"markdown":s=this.parseMarkdown(e);break;default:throw new Error(`Unsupported import format: ${String(t)}`)}}catch(i){return r.errors.push({item:"parse",error:i instanceof Error?i.message:"Unknown error"}),r}r.total=s.length;for(let i of s)try{await this.importIdea(i),r.imported++}catch(a){r.failed++,r.errors.push({item:i.title||"unknown",error:a instanceof Error?a.message:"Unknown error"})}return r}async importIdea(e){let t=Oo({text:e.body,timestamp:e.created?new Date(e.created):new Date}),r=[];if(e.related&&Array.isArray(e.related)){let d=e.related[0];if(e.related.length>0&&typeof d=="string"){let u=new U(this.ideaRepository),m=e.related.filter(p=>typeof p=="string");r=await u.pathsToIds(m)}else e.related.length>0&&typeof d=="number"&&(r=e.related.filter(u=>typeof u=="number"&&u!==0))}let s={...t,...e,type:"idea",status:e.status??"captured",created:e.created??new Date().toISOString().split("T")[0],id:typeof e.id=="number"?e.id:0,category:e.category??"",tags:e.tags??[],related:r,domains:e.domains??[],"existence-check":e["existence-check"]??[]},i=e.created?new Date(e.created):new Date,a=ln(e.title||e.body,i),c=`${this.frontmatterParser.build(s,e.body)}

${e.body}`,l=`Ideas/${a}`;await this.vault.create(l,c)}parseJSON(e){let t=JSON.parse(e);if(t.ideas&&Array.isArray(t.ideas))return t.ideas;throw new Error("Invalid JSON format: missing ideas array")}parseCSV(e){let t=e.split(`
`);if(t.length<2)throw new Error("Invalid CSV: no data rows");t[0].split(",");let r=[];for(let s=1;s<t.length;s++){let i=this.parseCSVLine(t[s]),a={title:i[0]||"Untitled",created:i[1]||new Date().toISOString().split("T")[0],category:i[2]||"",tags:i[3]?i[3].split(";").filter(o=>o):[],status:i[4]||"captured",body:i[5]||"",related:i[6]?i[6].split(";").filter(o=>o):[],domains:i[7]?i[7].split(";").filter(o=>o):[],"existence-check":i[8]?i[8].split(";").filter(o=>o):[]};r.push(a)}return r}parseCSVLine(e){let t=[],r="",s=!1;for(let i=0;i<e.length;i++){let a=e[i];a==='"'?s&&e[i+1]==='"'?(r+='"',i++):s=!s:a===","&&!s?(t.push(r),r=""):r+=a}return t.push(r),t}parseMarkdown(e){let t=[],r=e.split(/^## /m);for(let s=1;s<r.length;s++){let a=r[s].split(`
`),o=a[0].trim(),c={},l=0;for(let u=1;u<a.length;u++){let m=a[u];if(m.match(/^- /)){let p=m.match(/^- (\w+): (.+)$/);p&&(c[p[1].toLowerCase()]=p[2])}else if(m.trim()===""){l=u+1;break}}let d=a.slice(l).join(`
`).trim();t.push({title:o,body:d,created:c.created||new Date().toISOString().split("T")[0],category:c.category||"",status:c.status||"captured",tags:c.tags?c.tags.split(",").map(u=>u.trim()):[]})}return t}};var mn=class{provider;constructor(e){this.provider=e}async classify(e){return await this.provider.classify(e)}isAvailable(){return this.provider.isAvailable()}ensureReady(){return this.provider.isAvailable()?Promise.resolve(!0):Promise.resolve(!1)}async complete(e,t){let r=this.provider;if(r.complete&&typeof r.complete=="function")return await r.complete(e,t);throw new Error("Provider does not support generic completions. Use local LLM or a provider with complete() method.")}getProvider(){return this.provider}};var bb={enabled:!0,maxEntries:50,retentionDays:7},tc=class{logs=[];settings;constructor(e){this.settings={...bb,...e}}logError(e,t,r,s){if(!this.settings.enabled)return;let i=e instanceof Error?e.message:e,a=e instanceof Error?e.stack:void 0,o={timestamp:new Date,error:i,stack:a,context:t,userAction:r,metadata:s};this.logs.push(o),this.logs.length>this.settings.maxEntries&&(this.logs=this.logs.slice(-this.settings.maxEntries)),this.cleanOldEntries()}getRecentLogs(e){let t=new Date;t.setDate(t.getDate()-this.settings.retentionDays);let r=this.logs.filter(s=>s.timestamp>=t);return e?r.slice(-e):r}getAllLogs(){return[...this.logs]}clearLogs(){this.logs=[]}sanitizeLogs(e){let t=e.map(r=>{let s=this.sanitizeString(r.error),i=r.stack?this.sanitizeString(r.stack):void 0,a=r.metadata?this.sanitizeMetadata(r.metadata):void 0;return{...r,error:s,stack:i,metadata:a}});return JSON.stringify(t,null,2)}formatLogsForIssue(e){return e.length===0?"No error logs available.":`## Error Logs

${e.map(r=>{let s=this.sanitizeString(r.error),i=r.stack?this.sanitizeString(r.stack):void 0,a=`**${r.timestamp.toISOString()}**`;if(r.context&&(a+=` - Context: ${this.sanitizeString(r.context)}`),r.userAction&&(a+=` - Action: ${this.sanitizeString(r.userAction)}`),a+=`
\`\`\`
${s}
\`\`\``,i){let c=i.split(`
`).slice(-20).join(`
`);a+=`

Stack trace (last 20 lines):
\`\`\`
${c}
\`\`\``}return a}).join(`

---

`)}`}sanitizeString(e){return e=e.replace(new RegExp("/Users/[^/]+","g"),"[USER_HOME]"),e=e.replace(new RegExp("/home/[^/]+","g"),"[USER_HOME]"),e=e.replace(/C:\\Users\\[^\\]+/gi,"[USER_HOME]"),e=e.replace(/[A-Z]:\\[^:]+/g,"[DRIVE_PATH]"),e=e.replace(/sk-[a-zA-Z0-9]{20,}/g,"[API_KEY_REDACTED]"),e=e.replace(/[a-zA-Z0-9]{32,}/g,t=>t.length>40?"[API_KEY_REDACTED]":t),e=e.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,"[EMAIL_REDACTED]"),e=e.replace(/\.obsidian[^"'\s]*/g,"[OBSIDIAN_CONFIG]"),e=e.replace(/[^"'\s]*\/plugins\/[^"'\s]*/g,"[PLUGIN_PATH]"),e=e.replace(/Ideas\/[^"'\s]*/g,"[IDEA_FILE]"),e=e.replace(/Projects\/[^"'\s]*/g,"[PROJECT_FILE]"),e}sanitizeMetadata(e){let t={};for(let[r,s]of Object.entries(e))typeof s=="string"?t[r]=this.sanitizeString(s):typeof s=="object"&&s!==null?t[r]=this.sanitizeMetadata(s):t[r]=s;return t}cleanOldEntries(){let e=new Date;e.setDate(e.getDate()-this.settings.retentionDays),this.logs=this.logs.filter(t=>t.timestamp>=e)}updateSettings(e){this.settings={...this.settings,...e},this.cleanOldEntries()}getSettings(){return{...this.settings}}};var rc=class{vault;settings;ARCHIVE_DIR="Ideas/Archived/";constructor(e,t){this.vault=e,this.settings=t}async moveToArchive(e){if(!this.settings.moveArchivedToFolder||(await this.ensureDirectoryExists(this.ARCHIVE_DIR),e.path.startsWith(this.ARCHIVE_DIR)))return;let t=`${this.ARCHIVE_DIR}${e.name}`;if(this.vault.getAbstractFileByPath(t)){let s=Date.now(),i=e.basename,a=e.extension,o=`${i}-${s}.${a}`;await this.vault.rename(e,`${this.ARCHIVE_DIR}${o}`)}else await this.vault.rename(e,t)}async moveFromArchive(e){if(!e.path.startsWith(this.ARCHIVE_DIR))return;let t=`Ideas/${e.name}`;if(this.vault.getAbstractFileByPath(t)){let s=Date.now(),i=e.basename,a=e.extension,o=`${i}-${s}.${a}`;await this.vault.rename(e,`Ideas/${o}`)}else await this.vault.rename(e,t)}async ensureDirectoryExists(e){this.vault.getAbstractFileByPath(e)||await this.vault.createFolder(e)}};var sc=class{constructor(e,t,r,s,i,a,o,c,l,d,u,m,p,y,v,E,A,f,S,P,k,$,F,B){this.app=e;this.plugin=t;this.settings=r;this.fileManager=s;this.classificationService=i;this.duplicateDetector=a;this.domainService=o;this.webSearchService=c;this.nameVariantService=l;this.scaffoldService=d;this.frontmatterParser=u;this.ideaRepository=m;this.embeddingService=p;this.clusteringService=y;this.graphLayoutService=v;this.resurfacingService=E;this.projectElevationService=A;this.tenuousLinkService=f;this.exportService=S;this.importService=P;this.searchService=k;this.llmService=$;this.errorLogService=F;this.fileOrganizer=B}};var nc=class{constructor(e,t,r,s,i,a,o,c,l,d,u,m,p,y,v,E,A,f,S,P,k,$,F,B){this.app=e;this.plugin=t;this.settings=r;this.fileManager=s;this.classificationService=i;this.duplicateDetector=a;this.domainService=o;this.webSearchService=c;this.nameVariantService=l;this.scaffoldService=d;this.frontmatterParser=u;this.ideaRepository=m;this.embeddingService=p;this.clusteringService=y;this.graphLayoutService=v;this.resurfacingService=E;this.projectElevationService=A;this.tenuousLinkService=f;this.exportService=S;this.importService=P;this.searchService=k;this.llmService=$;this.errorLogService=F;this.fileOrganizer=B;this.commandContext=new sc(e,t,r,s,i,a,o,c,l,d,u,m,p,y,v,E,A,f,S,P,k,$,F,B)}commandContext};var hh=require("obsidian");var ic=class{vault;ideaRepository;fileManager;isProcessing=!1;idleTimeoutId;constructor(e,t,r){this.vault=e,this.ideaRepository=t,this.fileManager=r}async assignMissingIds(){if(this.isProcessing)return h.debug("ID assignment already in progress, skipping"),{assigned:0,errors:0};this.isProcessing=!0;let e=0,t=0;try{let r=await this.ideaRepository.getAllIdeas(),s=r.map(a=>a.frontmatter.id).filter(a=>a!==0&&a!==void 0),i=r.filter(a=>!a.frontmatter.id||a.frontmatter.id===0);h.debug(`Found ${i.length} ideas needing IDs`);for(let a of i)try{let o=this.vault.getAbstractFileByPath(`Ideas/${a.filename}`);if(!o||!(o instanceof hh.TFile)){h.warn(`File not found for idea: ${a.filename}`),t++;continue}let c=o,l=Lo(s);s.push(l),await this.fileManager.updateIdeaFrontmatter(c,{id:l}),e++,h.debug(`Assigned ID ${l} to idea: ${a.filename}`)}catch(o){h.warn(`Failed to assign ID to idea ${a.filename}:`,o),t++}e>0&&h.info(`Auto-assigned ${e} idea IDs`)}catch(r){h.error("Error during ID assignment:",r),t++}finally{this.isProcessing=!1}return{assigned:e,errors:t}}scheduleIdleAssignment(e=2e3){if(this.idleTimeoutId&&clearTimeout(this.idleTimeoutId),typeof window>"u")return;let t=window;t.requestIdleCallback&&typeof t.requestIdleCallback=="function"?this.idleTimeoutId=t.requestIdleCallback(()=>{this.assignMissingIds().catch(r=>{h.warn("Idle ID assignment failed:",r)})},{timeout:e}):typeof t.setTimeout=="function"&&(this.idleTimeoutId=t.setTimeout(()=>{this.assignMissingIds().catch(r=>{h.warn("Idle ID assignment failed:",r)})},e))}cancelScheduledAssignment(){this.idleTimeoutId&&(clearTimeout(this.idleTimeoutId),this.idleTimeoutId=void 0)}};var fh=require("obsidian");var ac=class{vault;ideaRepository;fileManager;constructor(e,t,r){this.vault=e,this.ideaRepository=t,this.fileManager=r}async migrateRelatedToIds(){let e=0,t=0,r=0;try{let s=await this.ideaRepository.getAllIdeas(),i=new Map;for(let a of s){let o=`Ideas/${a.filename}`;a.frontmatter.id&&a.frontmatter.id!==0&&i.set(o,a.frontmatter.id)}h.debug(`Created path-to-ID map with ${i.size} entries`);for(let a of s)try{let o=a.frontmatter.related||[];if(!o.some(u=>typeof u=="string"||u===0||typeof u=="number"&&!i.has(`Ideas/${u}`)&&!s.find(m=>m.frontmatter.id===u))){r++;continue}let l=[];for(let u of o)if(typeof u=="string"){let m=i.get(u);m?l.push(m):h.warn(`Could not find ID for path: ${String(u)}`)}else typeof u=="number"&&u!==0&&(s.some(p=>p.frontmatter.id===u)?l.push(u):h.warn(`Invalid ID found: ${u}`));let d=Array.from(new Set(l));if(d.length!==o.length||!d.every((u,m)=>o[m]===u)){let u=this.vault.getAbstractFileByPath(`Ideas/${a.filename}`);u instanceof fh.TFile?(await this.fileManager.updateIdeaFrontmatter(u,{related:d}),e++,h.debug(`Migrated related for idea: ${a.filename}`)):(h.warn(`File not found for idea: ${a.filename}`),t++)}else r++}catch(o){h.warn(`Failed to migrate related for idea ${a.filename}:`,o),t++}e>0&&h.info(`Migrated ${e} ideas' related fields from paths to IDs`)}catch(s){h.error("Error during related migration:",s),t++}return{migrated:e,errors:t,skipped:r}}};var cc=class{static async initialize(e,t,r){let{fileManager:s,fileOrganizer:i,errorLogService:a}=this.initializeCoreServices(e,r),o=await this.initializeLLMServices(e,t,r),{searchService:c,classificationService:l,duplicateDetector:d}=this.initializeSearchServices(e,o),{domainService:u,webSearchService:m}=this.initializeValidationServices(r),{nameVariantService:p,scaffoldService:y}=this.initializeTransformationServices(e,t,r,o),{frontmatterParser:v,ideaRepository:E,embeddingService:A,clusteringService:f,graphLayoutService:S,resurfacingService:P,projectElevationService:k}=this.initializeManagementServices(e,r),{tenuousLinkService:$,exportService:F,importService:B}=this.initializeAnalysisServices(e,o,A,E),H=new nc(e,t,r,s,l,d,u,m,p,y,v,E,A,f,S,P,k,$,F,B,c,o,a,i),D=new ic(e.vault,E,s),q=new ac(e.vault,E,s);return D.scheduleIdleAssignment(3e3),setTimeout(()=>{(async()=>{try{await q.migrateRelatedToIds()}catch(Nr){h.warn("Related migration failed:",Nr)}})()},5e3),{context:H}}static initializeCoreServices(e,t){let r=new Fr(e.vault),s=new rc(e.vault,t),i=new tc({enabled:t.errorLoggingEnabled,maxEntries:t.errorLogMaxEntries,retentionDays:t.errorLogRetentionDays});return{fileManager:r,fileOrganizer:s,errorLogService:i}}static initializeSearchServices(e,t){let r=new Do(e.vault),s=new $o(t,r),i=new Bo(r);return{searchService:r,classificationService:s,duplicateDetector:i}}static initializeValidationServices(e){let t=new jo(e.prospectrUrl,e.domainCheckTimeout),r=new Uo(t),s=new Ho(e);return{domainService:r,webSearchService:s}}static initializeTransformationServices(e,t,r,s){let i=new Go(s,r,async()=>{let o=await t.loadData();return o?.variantCache&&typeof o.variantCache=="object"?o.variantCache:{}},async o=>{let c=await t.loadData();await t.saveData({...c??{},variantCache:o})}),a=new zo(e.vault,e);return{nameVariantService:i,scaffoldService:a}}static initializeManagementServices(e,t){let r=new Xe,s=new Wo(e.vault,r),i=new pn,a=new Ko(i,t.clusteringSimilarityThreshold??.3),o=new Jo,c=new Xo(s,t,e.vault),l=new Qo(e.vault,r,t,e);return{frontmatterParser:r,ideaRepository:s,embeddingService:i,clusteringService:a,graphLayoutService:o,resurfacingService:c,projectElevationService:l}}static initializeAnalysisServices(e,t,r,s){let i=new Yo(e.vault,r,t),a=new Zo(e.vault,s),o=new ec(e.vault,s);return{tenuousLinkService:i,exportService:a,importService:o}}static initializeLLMServices(e,t,r){let s=null;if(r.cloudProvider!=="none"&&r.cloudProvider!=="custom"&&r.cloudProvider!=="custom-model"){let i=r.cloudApiKeys&&r.cloudProvider in r.cloudApiKeys?(r.cloudApiKeys[r.cloudProvider]??"").trim():"";if(i.length>0)try{let a=pt.createProvider(r.cloudProvider,i,{openRouterModel:r.openRouterModel,customEndpointUrl:r.customEndpointUrl});s=new mn(a),h.info("Cloud AI provider initialized:",a.name)}catch(a){h.warn("Failed to initialize cloud provider:",a),new oc.Notice("Failed to initialize cloud AI provider.")}}else if(r.cloudProvider==="custom-model"){if(r.customModelProvider&&r.customModel){let i=r.cloudApiKeys&&r.customModelProvider in r.cloudApiKeys?(r.cloudApiKeys[r.customModelProvider]??"").trim():"";if(i.length>0)try{let a=pt.createProvider("custom-model",i,{customModelProvider:r.customModelProvider,customModel:r.customModel});s=new mn(a),h.info("Custom model provider initialized:",a.name,r.customModel)}catch(a){h.warn("Failed to initialize custom model provider:",a),new oc.Notice("Failed to initialize custom model provider.")}}}else if(r.cloudProvider==="custom"&&r.customEndpointUrl&&r.customEndpointUrl.trim().length>0)try{let i=pt.createProvider("custom","",{customEndpointUrl:r.customEndpointUrl});s=new mn(i),h.info("Cloud AI provider initialized:",i.name)}catch(i){h.warn("Failed to initialize custom endpoint:",i),new oc.Notice("Failed to initialize custom endpoint.")}return s?(r.preloadOnStartup&&s.isAvailable()&&s.ensureReady?.().then(i=>{h.debug("LLM preloaded on startup")}).catch(i=>{h.warn("Failed to preload LLM on startup:",i)}),Promise.resolve(s)):Promise.reject(new Error("No LLM service configured. Please configure a cloud AI provider in settings."))}};var il=require("obsidian");var dc=require("obsidian");var lc=class extends Error{userMessage;constructor(e,t){super(e),this.name="UserFacingError",this.userMessage=t}};var G=class{constructor(e){this.context=e}handleError(e,t,r){if(h.error(`Failed to ${t??"execute command"}:`,e),this.context.errorLogService){let s=e instanceof Error?e:new Error(String(e));this.context.errorLogService.logError(s,t,r)}if(e instanceof lc)new dc.Notice(e.userMessage);else{let s=t?`Failed to ${t}. Please try again or check console for details.`:"Failed to execute command. Please try again or check console for details.";new dc.Notice(s)}}showNotice(e){new dc.Notice(e)}debug(e,...t){h.debug(e,...t)}info(e,...t){h.info(e,...t)}warn(e,...t){h.warn(e,...t)}};var uc=class extends G{constructor(e){super(e)}execute(){try{return new $r(this.context.app,this.context.fileManager,this.context.classificationService,this.context.duplicateDetector,this.context.settings,this.context.domainService,this.context.webSearchService,this.context.nameVariantService,this.context.llmService).open(),Promise.resolve()}catch(e){return this.handleError(e,"open capture modal","capture-idea"),Promise.resolve()}}};var pc=require("obsidian");var hn=require("obsidian");var N=class extends G{constructor(e){super(e)}async execute(){try{let e=this.getActiveIdeaFile();if(!e)return;let{frontmatter:t,body:r,content:s}=await this.readIdeaContent(e),i=r.trim();if(!i||i.length===0){new hn.Notice("No idea text found in file.");return}await this.executeWithFile(e,{frontmatter:t,body:r,content:s,ideaText:i})}catch(e){this.handleError(e,this.getCommandName())}}getActiveIdeaFile(){let e=this.context.app.workspace.getActiveFile();return e?(e.path.startsWith("Ideas/")||new hn.Notice("This command works best with idea files in the ideas/ directory."),e):(this.debug("No active file found"),new hn.Notice("No active note. Please open an idea file."),null)}async readIdeaContent(e){let t=await this.context.app.vault.read(e),r=this.context.frontmatterParser.parse(t);return{frontmatter:r.frontmatter,body:r.body,content:t}}async updateIdeaFrontmatter(e,t){let r=await this.context.app.vault.read(e),s=this.context.frontmatterParser.parse(r),i={...s.frontmatter,...t},a=this.context.frontmatterParser.build(i,s.body);await this.context.app.vault.modify(e,a)}checkServiceAvailability(e,t){return e.isAvailable()?!0:(new hn.Notice(`${t} is not configured. Please set it up in settings.`),!1)}checkLLMAvailability(){return this.context.llmService.isAvailable()?!0:(this.debug("LLM service not available"),new hn.Notice("AI service is not configured. Please set up AI in settings."),!1)}};var mc=class extends N{constructor(e){super(e)}getCommandName(){return"search existence"}async executeWithFile(e,t){if(!this.checkServiceAvailability(this.context.webSearchService,"Web search"))return;let r=t.frontmatter.category??"";new pc.Notice("Searching for similar ideas...");let s=await this.context.webSearchService.search(t.ideaText,r);if(s.length===0){new pc.Notice("No similar ideas found.");return}let i=s.map(a=>`${a.title}: ${a.snippet} (${a.url})`);await this.updateIdeaFrontmatter(e,{"existence-check":i}),new pc.Notice(`Search complete: Found ${s.length} similar idea${s.length>1?"s":""}`)}};var fc=require("obsidian");var gh=require("obsidian"),hc=class extends gh.Modal{duplicates;onLink;selected=new Set;constructor(e,t,r){super(e),this.duplicates=t,this.onLink=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Duplicate ideas found"}),e.createEl("p",{text:`Found ${this.duplicates.length} potential duplicate${this.duplicates.length>1?"s":""}. Select which ones to link in frontmatter:`}).addClass("ideatr-modal-description");let r=e.createDiv("ideatr-duplicate-list");this.duplicates.forEach(o=>{let c=r.createDiv("ideatr-duplicate-item"),l=c.createEl("input",{type:"checkbox",attr:{checked:"true"}});this.selected.add(o.path),l.addEventListener("change",u=>{u.target.checked?this.selected.add(o.path):this.selected.delete(o.path)});let d=c.createDiv("ideatr-duplicate-label");d.createEl("strong",{text:o.title}),d.createEl("div",{text:o.path,cls:"ideatr-duplicate-path"}),o.similarity!==void 0&&d.createEl("div",{text:`Similarity: ${(o.similarity*100).toFixed(0)}%`,cls:"ideatr-duplicate-similarity"})});let s=e.createDiv("ideatr-modal-buttons");s.createEl("button",{text:"Link selected",cls:"mod-cta"}).addEventListener("click",()=>{let o=this.duplicates.filter(c=>this.selected.has(c.path));this.onLink&&this.onLink(o),this.close()}),s.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var gc=class extends N{idConverter;constructor(e){super(e),this.idConverter=new U(e.ideaRepository)}getCommandName(){return"check duplicates"}async executeWithFile(e,t){new fc.Notice("Checking for duplicates...");let r=await this.context.duplicateDetector.checkDuplicate(t.ideaText);if(!r.isDuplicate||r.duplicates.length===0){new fc.Notice("No duplicates found.");return}new hc(this.context.app,r.duplicates,s=>{(async()=>{let i=s.map(o=>o.path),a=await this.idConverter.pathsToIds(i);await this.updateIdeaFrontmatter(e,{related:a}),new fc.Notice(`Linked ${s.length} duplicate${s.length>1?"s":""} in frontmatter.`)})()}).open()}};var bc=require("obsidian");var yh=require("obsidian"),yc=class extends yh.Modal{relatedNotes;existingRelated;onSelect;selected=new Set;constructor(e,t,r,s){super(e),this.relatedNotes=t,this.existingRelated=r,this.onSelect=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Related notes"}),e.createEl("p",{text:`Found ${this.relatedNotes.length} related note${this.relatedNotes.length>1?"s":""}. Select which ones to link in frontmatter:`}).addClass("ideatr-modal-description");let r=e.createDiv("ideatr-related-list");this.relatedNotes.forEach(o=>{let c=r.createDiv("ideatr-related-item"),l=c.createEl("input",{type:"checkbox",attr:{checked:this.existingRelated.includes(o.path)?"true":null}});this.existingRelated.includes(o.path)&&this.selected.add(o.path),l.addEventListener("change",u=>{u.target.checked?this.selected.add(o.path):this.selected.delete(o.path)});let d=c.createDiv("ideatr-related-label");d.createEl("strong",{text:o.title}),d.createEl("div",{text:o.path,cls:"ideatr-related-path"}),o.similarity!==void 0&&d.createEl("div",{text:`Similarity: ${(o.similarity*100).toFixed(0)}%`,cls:"ideatr-related-similarity"}),this.existingRelated.includes(o.path)&&d.createEl("div",{text:"(already linked)",cls:"ideatr-related-existing"})});let s=e.createDiv("ideatr-modal-buttons");s.createEl("button",{text:"Link selected",cls:"mod-cta"}).addEventListener("click",()=>{let o=this.relatedNotes.filter(c=>this.selected.has(c.path));this.onSelect&&this.onSelect(o),this.close()}),s.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var vc=class extends N{idConverter;constructor(e){super(e),this.idConverter=new U(e.ideaRepository)}getCommandName(){return"find related notes"}async executeWithFile(e,t){new bc.Notice("Finding related notes...");let r=await this.context.searchService.findRelatedNotes(t.ideaText,10);if(r.length===0){new bc.Notice("No related notes found.");return}let s=Array.isArray(t.frontmatter.related)?t.frontmatter.related.filter(a=>typeof a=="number"&&a!==0):[],i=await this.idConverter.idsToPaths(s);new yc(this.context.app,r,i,a=>{(async()=>{let o=a.map(l=>l.path),c=await this.idConverter.pathsToIds(o);await this.updateIdeaFrontmatter(e,{related:c}),new bc.Notice(`Linked ${a.length} related note${a.length>1?"s":""} in frontmatter.`)})()}).open()}};var wc=require("obsidian");var xc=class extends N{constructor(e){super(e)}getCommandName(){return"run validations"}async executeWithFile(e,t){new wc.Notice("Running all validations...");let r=await Promise.allSettled([this.context.domainService.checkDomains(t.ideaText).catch(l=>(console.error("Domain check failed:",l),[])),this.context.webSearchService.isAvailable()?this.context.webSearchService.search(t.ideaText,t.frontmatter.category).catch(l=>(console.error("Web search failed:",l),[])):Promise.resolve([]),this.context.duplicateDetector.checkDuplicate(t.ideaText).catch(l=>(console.error("Duplicate check failed:",l),{isDuplicate:!1,duplicates:[],threshold:.75}))]),s=r[0].status==="fulfilled"?r[0].value:[],i=r[1].status==="fulfilled"?r[1].value:[],a=r[2].status==="fulfilled"?r[2].value:{isDuplicate:!1,duplicates:[],threshold:.75},o={};if(s.length>0){let l=s.map(d=>d.available?`${d.domain}: available`:`${d.domain}: unavailable${d.error?` (${d.error})`:""}`);o.domains=l}if(i.length>0){let l=i.map(d=>`${d.title}: ${d.snippet} (${d.url})`);o["existence-check"]=l}a.isDuplicate&&a.duplicates.length>0&&new wc.Notice(`Found ${a.duplicates.length} potential duplicate${a.duplicates.length>1?"s":""}. Use "check-duplicates" command to review.`),Object.keys(o).length>0&&await this.updateIdeaFrontmatter(e,o);let c=[`Domains: ${s.length} checked`,`Search: ${i.length} found`,`Duplicates: ${a.isDuplicate?a.duplicates.length+" found":"none"}`].join(", ");new wc.Notice(`Validation complete: ${c}`)}};var Ec=require("obsidian");var Ac=class extends N{constructor(e){super(e)}getCommandName(){return"generate name variants"}async executeWithFile(e,t){new Ec.Notice("Generating name variants...");let r=await this.context.nameVariantService.generateVariants(t.ideaText);if(r.length===0){new Ec.Notice("No name variants could be generated.");return}let s=this.context.nameVariantService.formatVariantsForMarkdown(r);await this.context.fileManager.appendToFileBody(e,"Name Variants",s),new Ec.Notice("Name variants generated and added to note.")}};var Ic=require("obsidian");var Sc=class extends N{constructor(e){super(e)}getCommandName(){return"generate scaffold"}async executeWithFile(e,t){let r="",s=t.content.match(/^---\n([\s\S]*?)\n---/);if(s){let o=s[1].match(/^category:\s*(.+)$/m);o&&(r=o[1].trim())}new Ic.Notice("Generating scaffold...");let i=this.context.scaffoldService.generateScaffold(t.ideaText,r);(this.context.settings.scaffoldDefaultAction||"append")==="append"?(await this.context.fileManager.appendToFileBody(e,"Scaffold",i),new Ic.Notice("Scaffold generated and added to note.")):(await this.context.fileManager.appendToFileBody(e,"Scaffold",i),new Ic.Notice("Scaffold generated and added to note."))}};var fn=require("obsidian");var bh=require("obsidian"),Cc=class extends bh.Modal{mutations;onSelect;selected=new Set;constructor(e,t,r){super(e),this.mutations=t,this.onSelect=r,t.forEach((s,i)=>this.selected.add(i))}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Idea mutations"}),e.createEl("p",{text:`Generated ${this.mutations.length} mutation${this.mutations.length>1?"s":""}. Select which ones to save:`}).addClass("ideatr-modal-description");let r=e.createDiv("ideatr-mutation-list");this.mutations.forEach((c,l)=>{let d=r.createDiv("ideatr-mutation-item");d.createEl("input",{type:"checkbox",attr:{checked:"true"}}).addEventListener("change",p=>{p.target.checked?this.selected.add(l):this.selected.delete(l)});let m=d.createDiv("ideatr-mutation-label");if(m.createEl("strong",{text:c.title}),m.createEl("div",{text:c.description,cls:"ideatr-mutation-description"}),c.differences.length>0){let p=m.createEl("ul",{cls:"ideatr-mutation-differences"});c.differences.forEach(y=>{p.createEl("li",{text:y})})}});let s=e.createDiv("ideatr-modal-buttons");s.createEl("button",{text:"Save as new ideas",cls:"mod-cta"}).addEventListener("click",()=>{let c=this.mutations.filter((l,d)=>this.selected.has(d));this.onSelect&&this.onSelect(c,"save"),this.close()}),s.createEl("button",{text:"Append to current note"}).addEventListener("click",()=>{let c=this.mutations.filter((l,d)=>this.selected.has(d));this.onSelect&&this.onSelect(c,"append"),this.close()}),s.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var _c=class extends N{idConverter;constructor(e){super(e),this.idConverter=new U(e.ideaRepository)}getCommandName(){return"generate mutations"}async executeWithFile(e,t){if(!this.checkLLMAvailability())return;if(new fn.Notice("Generating mutations..."),!this.context.llmService.generateMutations){new fn.Notice("Mutation generation is not supported by the current AI provider.");return}let r;try{r=await this.context.llmService.generateMutations(t.ideaText,{category:t.frontmatter.category,tags:Array.isArray(t.frontmatter.tags)?t.frontmatter.tags:void 0,count:8})}catch(s){let{MutationErrorModal:i}=await Promise.resolve().then(()=>(wh(),vh)),a=s instanceof Error?s.message:"Unknown error occurred",o=s,c=o.responseLength??(a.includes("empty response")?0:void 0),l=o.responsePreview;new i(this.context.app,{message:a,responseLength:c,responsePreview:l?.substring(0,500),canRetry:!0},async()=>{await this.execute()}).open();return}if(r.length===0){new fn.Notice("No mutations could be generated.");return}new Cc(this.context.app,r,(s,i)=>{(async()=>{if(i==="save"){let a=await this.idConverter.pathsToIds([e.path]);for(let o of s){let c=`---
type: idea
status: captured
created: ${new Date().toISOString().split("T")[0]}
id: 0
category: ${typeof t.frontmatter.category=="string"?t.frontmatter.category:""}
tags: ${JSON.stringify(t.frontmatter.tags??[])}
related: ${JSON.stringify(a)}
domains: []
existence-check: []
---

# ${o.title}

${o.description}

## Key Differences
${o.differences.map(d=>`- ${d}`).join(`
`)}
`,l=`Ideas/${ln(o.title,new Date)}`;await this.context.app.vault.create(l,c)}new fn.Notice(`Created ${s.length} new idea${s.length>1?"s":""} from mutations.`)}else{let a=s.map(o=>`## ${o.title}

${o.description}

**Key Differences:**
${o.differences.map(c=>`- ${c}`).join(`
`)}`).join(`

---

`);await this.context.fileManager.appendToFileBody(e,"Mutations",a),new fn.Notice(`Added ${s.length} mutation${s.length>1?"s":""} to note.`)}})()}).open()}};var Ni=require("obsidian");var xh=require("obsidian"),Pc=class extends xh.Modal{expansion;onAction;constructor(e,t,r){super(e),this.expansion=t,this.onAction=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Expanded idea preview"}),e.createEl("p",{text:"Review the expanded idea content below. Choose to append or replace the current content:"}).addClass("ideatr-modal-description");let r=e.createDiv("ideatr-expansion-preview");r.setCssProps({"max-height":"400px","overflow-y":"auto",padding:"10px",border:"1px solid var(--background-modifier-border)","border-radius":"4px"});let s=r.createDiv("ideatr-expansion-content");s.textContent=this.expansion.expandedText,s.setCssProps({"white-space":"pre-wrap"});let i=e.createDiv("ideatr-modal-buttons");i.createEl("button",{text:"Append to note",cls:"mod-cta"}).addEventListener("click",()=>{this.onAction&&this.onAction("append"),this.close()}),i.createEl("button",{text:"Replace content"}).addEventListener("click",()=>{this.onAction&&this.onAction("replace"),this.close()}),i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var Rc=class extends N{constructor(e){super(e)}getCommandName(){return"expand idea"}async executeWithFile(e,t){if(!this.checkLLMAvailability())return;if(new Ni.Notice("Expanding idea..."),!this.context.llmService.expandIdea){this.debug("LLM service does not support expandIdea"),new Ni.Notice("Idea expansion is not supported by the current AI provider.");return}let r=await this.context.llmService.expandIdea(t.ideaText,{category:t.frontmatter.category,tags:Array.isArray(t.frontmatter.tags)?t.frontmatter.tags:void 0,detailLevel:"detailed"});new Pc(this.context.app,r,s=>{(async()=>{if(s==="append")await this.context.fileManager.appendToFileBody(e,"Expanded Idea",r.expandedText),new Ni.Notice("Expanded content added to note.");else if(s==="replace"){let i=this.context.frontmatterParser.parse(t.content),a=this.context.frontmatterParser.build(i.frontmatter,r.expandedText);await this.context.app.vault.modify(e,a),new Ni.Notice("Idea content replaced with expanded version.")}})()}).open()}};var Di=require("obsidian");var Eh=require("obsidian"),Tc=class extends Eh.Modal{originalText;reorganization;onAction;constructor(e,t,r,s){super(e),this.originalText=t,this.reorganization=r,this.onAction=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Reorganized idea preview"}),e.createEl("p",{text:"Review the reorganized idea below. A backup file has been created. Choose to accept or reject the changes:"}).addClass("ideatr-modal-description");let r=e.createDiv("ideatr-reorganization-changes");this.reorganization.changes.sectionsAdded.length>0&&r.createEl("div",{text:`Sections added: ${this.reorganization.changes.sectionsAdded.join(", ")}`,cls:"ideatr-change-added"}),this.reorganization.changes.sectionsRemoved.length>0&&r.createEl("div",{text:`Sections removed: ${this.reorganization.changes.sectionsRemoved.join(", ")}`,cls:"ideatr-change-removed"}),this.reorganization.changes.sectionsReorganized.length>0&&r.createEl("div",{text:`Sections reorganized: ${this.reorganization.changes.sectionsReorganized.join(", ")}`,cls:"ideatr-change-reorganized"});let s=e.createDiv("ideatr-reorganization-tabs"),i=s.createEl("button",{text:"Before",cls:"ideatr-tab-button"}),a=s.createEl("button",{text:"After",cls:"ideatr-tab-button mod-cta"}),o=e.createDiv("ideatr-reorganization-preview");o.setCssProps({"max-height":"400px","overflow-y":"auto",padding:"10px",border:"1px solid var(--background-modifier-border)","border-radius":"4px","margin-top":"10px"});let c="after",l=()=>{o.empty();let p=c==="before"?this.originalText:this.reorganization.reorganizedText,y=o.createDiv("ideatr-reorganization-content");y.textContent=p,y.setCssProps({"white-space":"pre-wrap"}),i.classList.toggle("mod-cta",c==="before"),a.classList.toggle("mod-cta",c==="after")};i.addEventListener("click",()=>{c="before",l()}),a.addEventListener("click",()=>{c="after",l()}),l();let d=e.createDiv("ideatr-modal-buttons");d.createEl("button",{text:"Accept changes",cls:"mod-cta"}).addEventListener("click",()=>{this.onAction&&this.onAction("accept"),this.close()}),d.createEl("button",{text:"Reject"}).addEventListener("click",()=>{this.onAction&&this.onAction("reject"),this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var kc=class extends N{constructor(e){super(e)}getCommandName(){return"reorganize idea"}async executeWithFile(e,t){if(!this.checkLLMAvailability())return;if(new Di.Notice("Reorganizing idea..."),!this.context.llmService.reorganizeIdea){new Di.Notice("Idea reorganization is not supported by the current AI provider.");return}let r=e.path.replace(/\.md$/,".backup.md");try{await this.context.app.vault.create(r,t.content)}catch(i){h.warn("Failed to create backup file:",i)}let s=await this.context.llmService.reorganizeIdea(t.ideaText,{category:t.frontmatter.category,tags:Array.isArray(t.frontmatter.tags)?t.frontmatter.tags:void 0});new Tc(this.context.app,t.ideaText,s,i=>{(async()=>{if(i==="accept"){let a=this.context.frontmatterParser.parse(t.content),o=this.context.frontmatterParser.build(a.frontmatter,s.reorganizedText);await this.context.app.vault.modify(e,o),new Di.Notice("Idea reorganized successfully.")}else i==="reject"&&new Di.Notice("Reorganization cancelled.")})()}).open()}};var gn=require("obsidian");var Mc=class{llmService;constructor(e){this.llmService=e}async analyzeIntent(e,t,r){let s=this.buildIntentAnalysisPrompt(e,t,r);try{if(!this.llmService.complete)throw new Error("LLM service does not support completion");let i=await this.llmService.complete(s,{temperature:.3,n_predict:1e3,stop:["}"]});return this.parseIntentResponse(i)}catch(i){return h.warn("Intent analysis failed:",i),{intent:"custom",operations:[{type:"transform",target:"body",action:e}],description:`Apply transformation: ${e}`,requiresBodyModification:!0}}}async executeTransformation(e,t,r,s,i,a){let o=this.buildExecutionPrompt(e,t,r,s,a);try{if(!this.llmService.complete)throw new Error("LLM service does not support completion");let c=await this.llmService.complete(o,{temperature:.7,n_predict:4e3,stop:["}"]});return this.parseExecutionResponse(c)}catch(c){throw h.error("Transformation execution failed:",c),new Error(`Failed to execute transformation: ${c instanceof Error?c.message:String(c)}`)}}buildIntentAnalysisPrompt(e,t,r){let s=JSON.stringify(r,null,2),i=t.substring(0,2e3);return`Analyze this user request and determine what transformation to perform on an idea note.

User Request: "${e}"

Current Note Content (preview):
${i}

Frontmatter:
${s}

Available Operations:
- organize: Sort, group, or structure content (e.g., "sort alphabetically", "group by category")
- expand: Add content, examples, or variations (e.g., "add 3 alternatives", "include examples")
- transform: Rename, reformat, or restructure (e.g., "rename to X", "make it shorter", "convert to list")
- analyze: Extract insights or identify issues (e.g., "find problems", "list assumptions")
- restructure: Move, split, or combine sections (e.g., "move section X to top", "split into 3 parts")

Determine:
1. Primary intent (one of the operations above)
2. Specific action to take
3. What parts of the note to modify
4. Expected outcome

Respond in JSON format (no markdown, no code blocks, just JSON):
{
  "intent": "organize|expand|transform|analyze|restructure|custom",
  "action": "specific action description",
  "target": "what to modify (e.g., 'list in body', 'frontmatter fields', 'section X')",
  "expectedOutcome": "what the result should look like",
  "requiresFileRename": false,
  "requiresFrontmatterUpdate": false,
  "requiresBodyModification": true,
  "description": "human-readable description of what will happen"
}

Response: {`}buildExecutionPrompt(e,t,r,s,i){let a=JSON.stringify(s,null,2),o=i?`
Current Filename: ${i}`:"",c=this.getIntentInstructions(t.intent),l=t.operations[0],d=l?.action??t.description,u=l?.target??"body",m=t.description;return`Transform this idea note according to the user's request.

User Request: "${e}"

Transformation Plan:
- Intent: ${t.intent}
- Action: ${d}
- Target: ${u}
- Expected Outcome: ${m}

Current Note Content:
${r}${o}

Frontmatter:
${a}

Instructions:
${c}

Critical Rules:
1. Preserve ALL important information unless explicitly asked to remove it
2. Maintain valid YAML frontmatter structure
3. Preserve markdown formatting
4. Keep the original intent and meaning of the content
5. Only make changes that align with the user's request

Generate the transformed content. If no changes are needed to a section, return it as-is.

Output format (JSON only, no markdown, no code blocks):
{
  "newFilename": "new-filename.md" (if rename needed, else null),
  "frontmatter": { ... updated frontmatter as JSON object ... },
  "body": "transformed body content as string",
  "summary": "brief description of changes made"
}

Response: {`}getIntentInstructions(e){let t={organize:`- Organize content logically (sort, group, structure)
- Maintain all original content
- Use clear headings and structure
- Preserve relationships between items`,expand:`- Add new content that enhances the idea
- Maintain consistency with existing content
- Add content in appropriate locations
- Use markdown formatting for new content`,transform:`- Transform content format or structure
- Preserve meaning while changing presentation
- Update references if renaming
- Maintain valid markdown`,analyze:`- Extract insights from the content
- Identify patterns, problems, or assumptions
- Add analysis as a new section or append to existing
- Use clear headings for analysis results`,restructure:`- Reorganize sections or content
- Maintain all information
- Update section order logically
- Preserve content within sections`,custom:`- Follow the user's specific request
- Make reasonable interpretations
- Preserve important information
- Apply changes as requested`};return t[e]??t.custom}parseIntentResponse(e){try{let t=X(e,!0),r=JSON.parse(t),s=this.validateIntent(typeof r.intent=="string"?r.intent:"custom");return{intent:s,operations:[{type:typeof r.action=="string"?r.action:"transform",target:typeof r.target=="string"?r.target:"body",action:typeof r.action=="string"?r.action:"custom transformation",parameters:{}}],description:typeof r.description=="string"?r.description:`Apply ${s} transformation`,requiresFileRename:r.requiresFileRename===!0,requiresFrontmatterUpdate:r.requiresFrontmatterUpdate===!0,requiresBodyModification:r.requiresBodyModification!==!1}}catch(t){return h.warn("Failed to parse intent response:",t),{intent:"custom",operations:[{type:"transform",target:"body",action:"custom transformation"}],description:"Apply custom transformation",requiresBodyModification:!0}}}parseExecutionResponse(e){try{let t=X(e,!0),r=JSON.parse(t);return{newFilename:typeof r.newFilename=="string"?r.newFilename:null,frontmatter:r.frontmatter&&typeof r.frontmatter=="object"?r.frontmatter:void 0,body:typeof r.body=="string"?r.body:void 0,summary:typeof r.summary=="string"?r.summary:"Transformation applied"}}catch(t){h.warn("Failed to parse execution response:",t);let r=e.match(/"body"\s*:\s*"([^"]*(?:\\.[^"]*)*)"/);if(r)return{body:r[1].replace(/\\n/g,`
`).replace(/\\"/g,'"'),summary:"Transformation applied (partial parsing)"};throw new Error("Failed to parse transformation result")}}validateIntent(e){return["organize","expand","transform","analyze","restructure","custom"].includes(e)?e:"custom"}isAvailable(){return this.llmService.isAvailable()}};var $i=require("obsidian"),Lc=class extends $i.Modal{inputEl;statusEl;previewContainer;buttonContainer;service;noteContent;frontmatter;body;currentFilename;transformationResult;transformationPlan;onAccept;isProcessing=!1;constructor(e,t,r,s,i,a,o){super(e),this.service=t,this.noteContent=r,this.frontmatter=s,this.body=i,this.currentFilename=a,this.onAccept=o}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-guided-ideation-modal"),e.createEl("h2",{text:"Ideatr: transform"}),e.createEl("p",{text:'Describe the transformation you want to apply to this idea. Examples: "Organize this list alphabetically", "Add three alternatives", "Rename to Project Goodspring"'}).addClass("ideatr-modal-description"),this.inputEl=e.createEl("textarea",{attr:{placeholder:"Enter your transformation request...",rows:"4"}}),this.inputEl.addClass("ideatr-input"),this.inputEl.setCssProps({width:"100%","margin-bottom":"10px"}),this.statusEl=e.createDiv("ideatr-status"),this.statusEl.setCssProps({display:"none"}),this.previewContainer=e.createDiv("ideatr-preview-container"),this.previewContainer.setCssProps({display:"none","max-height":"400px","overflow-y":"auto",padding:"10px",border:"1px solid var(--background-modifier-border)","border-radius":"4px","margin-top":"10px","margin-bottom":"10px"}),this.buttonContainer=e.createDiv("ideatr-modal-buttons"),this.buttonContainer.setCssProps({"margin-top":"10px"}),this.buttonContainer.createEl("button",{text:"Transform",cls:"mod-cta"}).addEventListener("click",()=>void this.handleTransform()),this.buttonContainer.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),this.inputEl.addEventListener("keydown",i=>{(i.metaKey||i.ctrlKey)&&i.key==="Enter"&&(i.preventDefault(),this.isProcessing||this.handleTransform())}),this.inputEl.focus()}async handleTransform(){let e=this.inputEl.value.trim();if(!e){new $i.Notice("Please enter a transformation request.");return}if(!this.isProcessing){this.isProcessing=!0,this.showStatus("Analyzing intent...");try{let t=await this.service.analyzeIntent(e,this.noteContent,this.frontmatter);this.transformationPlan=t,this.showStatus("Generating transformation...");let r=await this.service.executeTransformation(e,t,this.noteContent,this.frontmatter,this.body,this.currentFilename);this.transformationResult=r,this.showPreview(r,t),this.showAcceptButton()}catch(t){this.showError(t instanceof Error?t.message:"Failed to transform idea."),console.error("Transformation failed:",t)}finally{this.isProcessing=!1}}}showStatus(e){this.statusEl.empty(),this.statusEl.setCssProps({display:"block"}),this.statusEl.createEl("p",{text:e}),this.previewContainer.setCssProps({display:"none"}),this.hideAcceptButton()}showError(e){this.statusEl.empty(),this.statusEl.setCssProps({display:"block"}),this.statusEl.addClass("ideatr-error"),this.statusEl.createEl("p",{text:e}),this.previewContainer.setCssProps({display:"none"}),this.hideAcceptButton()}showPreview(e,t){this.statusEl.setCssProps({display:"none"}),this.previewContainer.empty(),this.previewContainer.setCssProps({display:"block"});let r=this.previewContainer.createDiv("ideatr-plan-description");if(r.createEl("strong",{text:"Transformation: "}),r.createEl("span",{text:t.description}),e.summary){let s=this.previewContainer.createDiv("ideatr-summary");s.createEl("strong",{text:"Summary: "}),s.createEl("span",{text:e.summary})}if(e.newFilename&&e.newFilename!==this.currentFilename){let s=this.previewContainer.createDiv("ideatr-filename-change");s.createEl("strong",{text:"Filename: "}),s.createEl("span",{text:`${this.currentFilename} \u2192 ${e.newFilename}`})}if(e.body){this.previewContainer.createEl("strong",{text:"Body preview:"}).setCssProps({display:"block","margin-top":"10px","margin-bottom":"5px"});let i=this.previewContainer.createDiv("ideatr-body-preview");i.setCssProps({"white-space":"pre-wrap","font-family":"var(--font-monospace)","font-size":"0.9em",padding:"10px","background-color":"var(--background-secondary)","border-radius":"4px"}),i.textContent=e.body.substring(0,2e3),e.body.length>2e3&&(i.textContent+=`

... (content truncated for preview)`)}if(e.frontmatter){this.previewContainer.createEl("strong",{text:"Frontmatter changes:"}).setCssProps({display:"block","margin-top":"10px","margin-bottom":"5px"});let i=this.previewContainer.createDiv("ideatr-frontmatter-preview");i.setCssProps({"white-space":"pre-wrap","font-family":"var(--font-monospace)","font-size":"0.9em",padding:"10px","background-color":"var(--background-secondary)","border-radius":"4px"}),i.textContent=JSON.stringify(e.frontmatter,null,2)}}showAcceptButton(){let e=this.buttonContainer.querySelector(".ideatr-accept-button");e&&e.remove();let t=this.buttonContainer.createEl("button",{text:"Accept changes",cls:"mod-cta ideatr-accept-button"});t.setCssProps({"margin-left":"10px"}),t.addEventListener("click",()=>{(async()=>{if(this.transformationResult&&this.transformationPlan&&this.onAccept)try{await this.onAccept(this.transformationResult,this.transformationPlan),this.close()}catch(r){new $i.Notice(`Failed to apply changes: ${r instanceof Error?r.message:String(r)}`),console.error("Failed to apply transformation:",r)}})()})}hideAcceptButton(){let e=this.buttonContainer.querySelector(".ideatr-accept-button");e&&e.remove()}onClose(){let{contentEl:e}=this;e.empty()}};var Fc=class extends N{service;constructor(e){super(e),this.service=new Mc(e.llmService)}getCommandName(){return"Transform"}async executeWithFile(e,t){if(this.checkLLMAvailability())return new Lc(this.context.app,this.service,t.content,t.frontmatter,t.body,e.basename,async(r,s)=>{await this.applyTransformation(e,r,s,t)}).open(),Promise.resolve()}async applyTransformation(e,t,r,s){try{let i=e.path.replace(/\.md$/,".backup.md");try{await this.context.app.vault.create(i,s.content)}catch(o){h.warn("Failed to create backup file:",o)}let a=e;if(t.newFilename){let o=t.newFilename.split("/").pop()??t.newFilename;if(o.replace(/\.md$/,"")!==e.basename){o.endsWith(".md")||(o=`${o}.md`);let l=e.path.replace(e.name,o);try{await this.context.app.vault.rename(e,l);let d=this.context.app.vault.getAbstractFileByPath(l),u=d instanceof gn.TFile?d:null;if(u&&(a=u),!a)throw new Error("File rename succeeded but could not find renamed file");new gn.Notice(`File renamed to ${o}`)}catch(d){h.error("Failed to rename file:",d),new gn.Notice("Failed to rename file. Other changes will still be applied.")}}}t.frontmatter&&r.requiresFrontmatterUpdate&&await this.context.fileManager.updateIdeaFrontmatter(a,t.frontmatter),t.body&&r.requiresBodyModification&&await this.updateFileBody(a,t.body),new gn.Notice("Transformation applied successfully!")}catch(i){throw h.error("Failed to apply transformation:",i),i}}async updateFileBody(e,t){await this.context.app.vault.process(e,r=>{let s=/^---\n([\s\S]*?)\n---(\n\n?|\n?)/,i=r.match(s);return i?i[0]+t:t})}};var Ih=require("obsidian");var Ah=require("obsidian"),Oc=class extends Ah.Modal{currentStatus;onSelect;selectedStatus=null;constructor(e,t,r){super(e),this.currentStatus=t,this.onSelect=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Change idea status"}),e.createEl("p",{text:`Current status: ${this.currentStatus}. Select a new status:`}).addClass("ideatr-modal-description");let r=e.createDiv("ideatr-status-list");[{value:"captured",label:"Captured",description:"Newly captured idea"},{value:"validated",label:"Validated",description:"Idea has been validated"},{value:"promoted",label:"Promoted",description:"Idea has been promoted"},{value:"archived",label:"Archived",description:"Archived idea"}].forEach(c=>{let l=r.createDiv("ideatr-status-item"),d=l.createEl("input",{type:"radio",attr:{name:"status",value:c.value,checked:this.currentStatus===c.value?"true":null}});this.currentStatus===c.value&&(this.selectedStatus=c.value),d.addEventListener("change",m=>{m.target.checked&&(this.selectedStatus=c.value)});let u=l.createDiv("ideatr-status-label");u.createEl("strong",{text:c.label}),u.createEl("div",{text:c.description,cls:"ideatr-status-description"})});let i=e.createDiv("ideatr-modal-buttons");i.createEl("button",{text:"Apply",cls:"mod-cta"}).addEventListener("click",()=>{this.selectedStatus&&this.onSelect&&this.onSelect(this.selectedStatus),this.close()}),i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var Nc=class extends N{constructor(e){super(e)}getCommandName(){return"change status"}async executeWithFile(e,t){let r=t.frontmatter.status||"captured";return new Oc(this.context.app,r,s=>{(async()=>{await this.updateIdeaFrontmatter(e,{status:s});let a=t.frontmatter.status==="archived",o=s==="archived";o?await this.context.fileOrganizer.moveToArchive(e):a&&!o&&await this.context.fileOrganizer.moveFromArchive(e),new Ih.Notice(`Status changed to ${s}`)})()}).open(),Promise.resolve()}};var tu=require("obsidian");var Bi=class extends N{constructor(t,r){super(t);this.isArchive=r}getCommandName(){return this.isArchive?"archive idea":"unarchive idea"}async executeWithFile(t,r){if(this.isArchive)await this.updateIdeaFrontmatter(t,{status:"archived"}),await this.context.fileOrganizer.moveToArchive(t),new tu.Notice("Idea archived successfully.");else{let s=r.frontmatter.status==="archived"?"captured":r.frontmatter.status||"captured";await this.updateIdeaFrontmatter(t,{status:s}),await this.context.fileOrganizer.moveFromArchive(t),new tu.Notice("Idea unarchived successfully.")}}};var Ui=require("obsidian");var Dc=class extends N{constructor(e){super(e)}getCommandName(){return"generate codename"}async executeWithFile(e,t){if(!this.context.llmService?.isAvailable()||!this.context.llmService.complete){new Ui.Notice("Unable to generate codename because the language model service is not available");return}let r=ie(t.body),s=r?`${r}

${t.body}`:t.body;new Ui.Notice("Generating codename...");let i=await this.generateCodename(s);if(!i){new Ui.Notice("Failed to generate codename. Please try again.");return}await this.updateIdeaFrontmatter(e,{codename:i.trim()});let o=`${Jd(i.trim())}.md`;if(e.name!==o){let d=e.path.substring(0,e.path.lastIndexOf("/")+1)+o;await this.context.app.vault.rename(e,d)}new Ui.Notice(`Codename "${i}" generated successfully.`)}async generateCodename(e){if(!this.context.llmService?.complete)return null;let t=`Generate a memorable, brandable codename for this idea.

Idea: "${e.substring(0,500)}"

CRITICAL REQUIREMENTS:
- Extract the CORE CONCEPT, not just use the literal text
- Focus on what makes the idea unique or memorable
- Create a codename that could work as a project/product name
- Prioritize memorability and pronounceability over literal accuracy

Requirements:
- 1-3 words maximum (prefer 1-2 words)
- Easy to remember and pronounce (test: can you say it naturally?)
- Captures the idea's essence in a creative way
- Professional but distinctive
- Suitable for filenames (alphanumeric, hyphens, spaces only)
- 2-20 characters total (shorter is usually better)
- IMPORTANT: Avoid unpronounceable acronyms longer than 6 characters. If using acronyms, they must be pronounceable (e.g., "ACME" is fine, "AGPFOIM" is not)

Codename strategies:
- Portmanteau: Blend key words (e.g., "net" + "flicks" \u2192 "Netflix")
- Compound: Combine two relevant words (e.g., "VolumeBand", "SoundSense")
- Single word: Use a powerful, relevant word (e.g., "Zen", "Ping", "Alert")
- Short acronym: Only if pronounceable and 6 chars or fewer (e.g., "NASA", "ACME")

Examples:
- "bracelet that measures room volume" \u2192 "VolumeBand", "SoundSense", "EchoBand"
- "AI writing assistant" \u2192 "WriteBot", "TextCraft", "WordSmith"
- "social network for developers" \u2192 "DevNet", "CodeConnect", "DevHub"
- "AI generated puzzle full of interlinked monkeys that look similar, sort of a where's waldo of monkeys" \u2192 "MonkeyFind", "PrimateSeek", "ApeSpot", "FindMonkey"
- "task manager for remote teams" \u2192 "TaskFlow", "TeamSync", "RemoteTask"

Return ONLY the codename. No quotes, no explanation, no prefixes like "Codename:" or "Name:". Just the name itself:`;try{let s=(await this.context.llmService.complete(t,{temperature:.8,n_predict:50,stop:[`
`,".","!","?",'"',"'"]})).trim();return s=s.replace(/^["']|["']$/g,""),s=s.substring(0,30).trim(),s=s.replace(/[^a-zA-Z0-9\s-]/g,""),s.length<2?null:s}catch(r){throw console.error("Codename generation failed:",r),r}}};var $c=class extends G{constructor(e){super(e)}async execute(){try{await this.context.app.workspace.getLeaf(!1).setViewState({type:"ideatr-dashboard",active:!0})}catch(e){this.handleError(e,"open dashboard")}}};var Bc=class extends G{constructor(e){super(e)}async execute(){try{await this.context.app.workspace.getLeaf(!1).setViewState({type:"ideatr-graph",active:!0})}catch(e){this.handleError(e,"open graph view")}}};Kd();var Uc=class extends G{constructor(e){super(e)}async execute(){try{await new Li(this.context.app).openIndex()}catch(e){this.handleError(e,"open tutorials","Opening tutorials")}}};var ru=require("obsidian");var jc=class extends N{constructor(e){super(e)}getCommandName(){return"classify note"}async executeWithFile(e,t){if(!this.checkServiceAvailability(this.context.classificationService,"AI classification"))return;new ru.Notice("Classifying idea...");let r=await this.context.classificationService.classifyIdea(t.ideaText),s=this.context.frontmatterParser.parse(t.content);if(s.frontmatter.category=r.category,s.frontmatter.tags=r.tags,r.related.length>0){let o=await new U(this.context.ideaRepository).pathsToIds(r.related);s.frontmatter.related=o}let i=this.context.frontmatterParser.build(s.frontmatter,s.body);await this.context.app.vault.modify(e,i),new ru.Notice("Classification complete!")}};var su=require("obsidian");var Hc=class extends N{constructor(e){super(e)}getCommandName(){return"refresh idea"}async executeWithFile(e,t){new su.Notice("Refreshing idea...");let r={};if(this.context.classificationService.isAvailable())try{let s=await this.context.classificationService.classifyIdea(t.ideaText);r.category=s.category,r.tags=s.tags}catch(s){h.warn("Failed to re-classify:",s)}try{let s=await this.context.searchService.findRelatedNotes(t.ideaText,5),i=new U(this.context.ideaRepository),a=s.map(o=>o.path);r.related=await i.pathsToIds(a)}catch(s){h.warn("Failed to refresh related notes:",s)}if(this.context.settings.enableNameVariants&&this.context.nameVariantService.isAvailable())try{let s=await this.context.nameVariantService.generateVariants(t.ideaText);if(s.length>0){let i=this.context.nameVariantService.formatVariantsForMarkdown(s);await this.context.fileManager.appendToFileBody(e,"Name Variants",i)}}catch(s){h.warn("Failed to regenerate name variants:",s)}Object.keys(r).length>0&&await this.updateIdeaFrontmatter(e,r),new su.Notice("Idea refreshed successfully.")}};var nu=require("obsidian");var qc=class extends G{constructor(e){super(e)}async execute(){try{let e="json";new nu.Notice("Exporting ideas...");let t=await this.context.exportService.exportIdeas(e),s=`Ideatr-Export-${new Date().toISOString().replace(/[:.]/g,"-")}.${e==="json"?"json":e==="csv"?"csv":"md"}`,i=`Ideas/${s}`;await this.context.app.vault.create(i,t),new nu.Notice(`Exported ${s} successfully.`)}catch(e){this.handleError(e,"export ideas")}}};var yn=require("obsidian");var Sh=require("obsidian"),Gc=class extends Sh.SuggestModal{onSelect;allowedExtensions;constructor(e,t=["json","csv","md"],r){super(e),this.onSelect=r,this.allowedExtensions=t,this.setPlaceholder("Type to search for import files...")}getSuggestions(e){let r=this.app.vault.getFiles().filter(i=>{let a=i.extension.toLowerCase();return this.allowedExtensions.includes(a)});if(!e)return r.slice(0,50);let s=e.toLowerCase();return r.filter(i=>i.name.toLowerCase().includes(s)||i.path.toLowerCase().includes(s)).slice(0,50)}renderSuggestion(e,t){if(t.createEl("div",{text:e.name,attr:{style:"font-weight: bold;"}}),t.createEl("div",{text:e.path,attr:{style:"font-size: 12px; color: var(--text-muted); margin-top: 2px;"}}),e.stat?.size){let r=(e.stat.size/1024).toFixed(1);t.createEl("div",{text:`${r} KB`,attr:{style:"font-size: 11px; color: var(--text-faint); margin-top: 2px;"}})}}onChooseSuggestion(e,t){this.onSelect(e)}};var Ch=require("obsidian"),Vt=class extends Ch.Modal{onCancel;cancelled=!1;progressContainer;statusContainer;errorContainer;cancelButton=null;title;constructor(e,t,r){super(e),this.onCancel=r,this.title=t}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:this.title}),this.progressContainer=e.createDiv("ideatr-progress-container");let t=this.progressContainer.createDiv("ideatr-progress-bar");t.setCssProps({width:"100%",height:"20px","background-color":"var(--background-modifier-border)","border-radius":"4px",overflow:"hidden"});let r=t.createDiv("ideatr-progress-fill");r.setCssProps({width:"0%",height:"100%","background-color":"var(--interactive-accent)",transition:"width 0.3s ease"}),t.fill=r,this.statusContainer=e.createDiv("ideatr-progress-status"),this.statusContainer.setCssProps({"margin-top":"10px","font-size":"14px",color:"var(--text-muted)"}),this.errorContainer=e.createDiv("ideatr-progress-errors"),this.errorContainer.setCssProps({"margin-top":"10px","max-height":"200px","overflow-y":"auto",display:"none"});let s=e.createDiv("ideatr-modal-buttons");s.setCssProps({"margin-top":"20px"}),this.cancelButton=s.createEl("button",{text:"Cancel",cls:"mod-cta"}),this.cancelButton.addEventListener("click",()=>{this.cancelled=!0,this.onCancel&&this.onCancel(),this.close()}),this.progressFill=r,this.progressBar=t}updateProgress(e){let t=this.progressFill;if(!t)return;let r=e.total>0?e.current/e.total*100:0;t.setCssProps({width:`${r}%`}),this.statusContainer.empty(),e.currentItem&&this.statusContainer.createEl("div",{text:`Processing: ${e.currentItem}`,cls:"ideatr-progress-current-item"}),this.statusContainer.createEl("div",{text:`${e.current} / ${e.total} completed`,cls:"ideatr-progress-count"}),e.errors&&e.errors.length>0&&(this.errorContainer.setCssProps({display:"block"}),this.errorContainer.empty(),this.errorContainer.createEl("strong",{text:"Errors:"}),e.errors.forEach(s=>{this.errorContainer.createEl("div",{text:s,cls:"ideatr-progress-error"}).setCssProps({color:"var(--text-error)","margin-top":"5px"})})),e.status==="completed"?(this.statusContainer.createEl("div",{text:"\u2713 Completed",cls:"ideatr-progress-completed"}),this.cancelButton&&(this.cancelButton.textContent="Close")):e.status==="cancelled"&&this.statusContainer.createEl("div",{text:"\u2717 cancelled",cls:"ideatr-progress-cancelled"})}isCancelled(){return this.cancelled}onClose(){let{contentEl:e}=this;e.empty(),this.cancelled=!1}};var Vc=class extends G{constructor(e){super(e)}execute(){try{return this.context.importService?(new Gc(this.context.app,["json","csv","md"],e=>{(async()=>{let t="json",r=e.extension?.toLowerCase()||"";if(r==="json")t="json";else if(r==="csv")t="csv";else if(r==="md"||r==="markdown")t="markdown";else{new yn.Notice(`Unsupported file format: ${r}. Please use JSON, CSV, or Markdown files.`);return}try{let s=await this.context.app.vault.read(e),i=new Vt(this.context.app,"Importing Ideas");i.open(),i.updateProgress({current:0,total:1,currentItem:`Parsing ${e.name}...`,status:"processing"});let a=await this.context.importService.importIdeas(s,t);i.updateProgress({current:a.total,total:a.total,status:(a.failed===0,"completed"),errors:a.errors.length>0?a.errors.map(o=>`${o.item}: ${o.error}`):void 0}),a.imported>0?new yn.Notice(`Import complete: ${a.imported} imported, ${a.failed} failed${a.errors.length>0?". Check console for details.":"."}`):new yn.Notice(`Import failed: ${a.failed} failed. Check console for details.`),setTimeout(()=>{i.close()},2e3)}catch(s){console.error("Failed to import ideas:",s),new yn.Notice("Failed to import ideas. Please try again or check console for details.")}})()}).open(),Promise.resolve()):(new yn.Notice("Import service is not available."),Promise.resolve())}catch(e){return this.handleError(e,"show import file picker"),Promise.resolve()}}};var iu=require("obsidian");var zc=class extends G{constructor(e){super(e)}async execute(){try{new iu.Notice("Generating digest...");let e=await this.context.resurfacingService.generateDigest(),t=e.summary,r=`Ideas/.ideatr-digest-${Date.now()}.md`;await this.context.app.vault.create(r,t),new iu.Notice(`Digest generated: ${e.ideas.length} ideas`),this.context.app.vault.getAbstractFileByPath(r)&&await this.context.app.workspace.openLinkText(r,"",!1)}catch(e){this.handleError(e,"generate digest")}}};var Or=require("obsidian");var Wc=class extends G{constructor(e){super(e)}async execute(){try{let e=this.context.app.workspace.getActiveFile();if(!e){new Or.Notice("No active note. Please open an idea file.");return}if(!e.path.startsWith("Ideas/")){new Or.Notice("This command works with idea files in the ideas/ directory.");return}let t=await this.context.app.vault.read(e),r=this.context.frontmatterParser.parseIdeaFile({path:e.path,name:e.name},t);if(!this.context.projectElevationService.canElevate(r)){new Or.Notice("This idea cannot be elevated. It may already be elevated or have invalid frontmatter.");return}let s=this.context.projectElevationService.generateProjectName(r);if(!await mt(this.context.app,`Elevate idea to project?

Project name: ${s}

The idea file will be moved to Projects/${s}/README.md
Original file will be deleted.`))return;new Or.Notice("Elevating idea to project...");let a=await this.context.projectElevationService.elevateIdea(r);a.success?(new Or.Notice(`Idea elevated to project: ${a.projectPath}`),await this.context.ideaRepository.refresh(),this.context.app.vault.getAbstractFileByPath(`${a.projectPath}/README.md`)&&await this.context.app.workspace.openLinkText(`${a.projectPath}/README.md`,"",!1)):(new Or.Notice(`Failed to elevate idea: ${a.error??"Unknown error"}`),a.warnings&&a.warnings.length>0&&h.warn("Elevation warnings:",a.warnings))}catch(e){this.handleError(e,"elevate idea to project","elevate-idea")}}};var Kc=require("obsidian");var Jc=class extends G{constructor(e){super(e)}async execute(){try{let t=this.context.app.vault.getMarkdownFiles().filter(o=>o.path.startsWith("Ideas/")&&!o.path.startsWith("Ideas/Archived/"));if(t.length===0){new Kc.Notice("No idea files found in ideas/ directory.");return}if(!this.context.classificationService.isAvailable()){new Kc.Notice("Classification service is not available. Please configure AI in settings.");return}let r=new Vt(this.context.app,"Reclassifying ideas");r.open();let s=0,i=0,a=[];for(let o=0;o<t.length&&!r.isCancelled();o++){let c=t[o];r.updateProgress({current:o+1,total:t.length,currentItem:c.name,status:"processing"});try{let l=await this.context.app.vault.read(c),d=this.context.frontmatterParser.parse(l),u=d.body.trim();if(u.length===0){a.push(`${c.name}: No content to classify`),i++;continue}let m=await this.context.classificationService.classifyIdea(u),y=await new U(this.context.ideaRepository).pathsToIds(m.related),v={...d.frontmatter,category:m.category,tags:m.tags,related:y},E=this.context.frontmatterParser.build(v,d.body);await this.context.app.vault.modify(c,E),s++}catch(l){let d=l instanceof Error?l.message:"Unknown error";a.push(`${c.name}: ${d}`),i++}}r.updateProgress({current:t.length,total:t.length,status:r.isCancelled()?"cancelled":"completed",errors:a.length>0?a:void 0}),r.isCancelled()||new Kc.Notice(`Reclassification complete: ${s} updated, ${i} failed`)}catch(e){this.handleError(e,"reclassify all ideas")}}};var zt=require("obsidian");var _h=require("obsidian"),Xc=class extends _h.Modal{pairs;selected=new Set;onBulkAction;onLink;onArchive;onMerge;constructor(e,t,r){super(e),this.pairs=t,this.onBulkAction=r?.onBulkAction,this.onLink=r?.onLink,this.onArchive=r?.onArchive,this.onMerge=r?.onMerge}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Duplicate pairs found"}),e.createEl("p",{text:`Found ${this.pairs.length} duplicate pair${this.pairs.length>1?"s":""}. Select pairs and choose an action:`}).addClass("ideatr-modal-description");let r=e.createDiv("ideatr-duplicate-pairs-list");r.setCssProps({"max-height":"400px","overflow-y":"auto","margin-bottom":"20px"}),this.pairs.forEach((d,u)=>{let m=r.createDiv("ideatr-duplicate-pair-item");m.setCssProps({"margin-bottom":"15px",padding:"10px",border:"1px solid var(--background-modifier-border)","border-radius":"4px"});let p=m.createEl("input",{type:"checkbox",attr:{checked:"true"}});this.selected.add(u),p.setCssProps({"margin-right":"10px","margin-bottom":"10px"}),p.addEventListener("change",$=>{$.target.checked?this.selected.add(u):this.selected.delete(u)});let y=m.createDiv("ideatr-duplicate-pair-info");y.createEl("div",{text:`Similarity: ${(d.similarity*100).toFixed(1)}%`,cls:"ideatr-duplicate-pair-similarity"}).setCssProps({"font-weight":"bold","margin-bottom":"8px",color:"var(--text-accent)"});let E=y.createDiv("ideatr-duplicate-pair-file");E.createEl("strong",{text:"File 1: "}),E.createEl("span",{text:d.file1.name}),E.setCssProps({"margin-bottom":"4px"});let A=y.createDiv("ideatr-duplicate-pair-file");A.createEl("strong",{text:"File 2: "}),A.createEl("span",{text:d.file2.name}),A.setCssProps({"margin-bottom":"8px"});let f=m.createDiv("ideatr-duplicate-pair-actions");f.setCssProps({"margin-top":"8px",display:"flex",gap:"8px"}),f.createEl("button",{text:"Link",attr:{style:"font-size: 11px; padding: 4px 8px;"}}).addEventListener("click",()=>{this.onLink&&this.onLink(d)}),f.createEl("button",{text:"Archive",attr:{style:"font-size: 11px; padding: 4px 8px;"}}).addEventListener("click",()=>{this.onArchive&&this.onArchive(d)}),f.createEl("button",{text:"Merge",attr:{style:"font-size: 11px; padding: 4px 8px;"}}).addEventListener("click",()=>{this.onMerge&&this.onMerge(d)})});let s=e.createDiv("ideatr-duplicate-bulk-actions");s.setCssProps({"margin-top":"20px","padding-top":"20px","border-top":"1px solid var(--background-modifier-border)"}),s.createEl("h3",{text:"Bulk actions",attr:{style:"margin-bottom: 10px;"}}),s.createEl("p",{text:`Apply action to ${this.selected.size} selected pair${this.selected.size>1?"s":""}:`,attr:{style:"font-size: 12px; color: var(--text-muted); margin-bottom: 10px;"}});let i=s.createDiv("ideatr-modal-buttons");i.setCssProps({display:"flex",gap:"10px"}),i.createEl("button",{text:"Link selected",cls:"mod-cta"}).addEventListener("click",()=>{let d=this.pairs.filter((u,m)=>this.selected.has(m));this.onBulkAction&&this.onBulkAction(d,"link")}),i.createEl("button",{text:"Archive selected"}).addEventListener("click",()=>{let d=this.pairs.filter((u,m)=>this.selected.has(m));this.onBulkAction&&this.onBulkAction(d,"archive")}),i.createEl("button",{text:"Merge selected"}).addEventListener("click",()=>{let d=this.pairs.filter((u,m)=>this.selected.has(m));this.onBulkAction&&this.onBulkAction(d,"merge")}),i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var Qc=class extends G{constructor(e){super(e)}async execute(){try{let t=this.context.app.vault.getMarkdownFiles().filter(i=>i.path.startsWith("Ideas/")&&!i.path.startsWith("Ideas/Archived/"));if(t.length<2){new zt.Notice("Need at least 2 idea files to find duplicates.");return}new zt.Notice("Scanning for duplicates... This may take a while.");let r=[];for(let i=0;i<t.length;i++)for(let a=i+1;a<t.length;a++){let o=t[i],c=t[a];try{let l=await this.context.app.vault.read(o),d=await this.context.app.vault.read(c),u=this.context.frontmatterParser.parse(l),m=this.context.frontmatterParser.parse(d),p=u.body,y=m.body,v=this.context.searchService.calculateSimilarity(p,y);v>.75&&r.push({file1:o,file2:c,similarity:v})}catch(l){h.warn(`Failed to compare ${o.name} and ${c.name}:`,l)}}if(r.length===0){new zt.Notice("No duplicates found.");return}let s=new Xc(this.context.app,r,{onBulkAction:(i,a)=>{(async()=>{for(let o of i)try{a==="link"?await this.linkDuplicatePair(o):a==="archive"?await this.archiveDuplicatePair(o):a==="merge"&&await this.mergeDuplicatePair(o)}catch(c){console.error(`Failed to ${a} pair:`,c)}new zt.Notice(`Applied ${a} to ${i.length} pair${i.length>1?"s":""}.`),s.close()})()},onLink:i=>{(async()=>(await this.linkDuplicatePair(i),new zt.Notice("Duplicates linked in frontmatter.")))()},onArchive:i=>{(async()=>(await this.archiveDuplicatePair(i),new zt.Notice("Duplicate archived.")))()},onMerge:i=>{(async()=>(await this.mergeDuplicatePair(i),new zt.Notice("Duplicates merged.")))()}});s.open()}catch(e){this.handleError(e,"find all duplicates")}}async linkDuplicatePair(e){let t=await this.context.app.vault.read(e.file1),r=await this.context.app.vault.read(e.file2),s=this.context.frontmatterParser.parse(t),i=this.context.frontmatterParser.parse(r),a=new U(this.context.ideaRepository),o=Array.isArray(s.frontmatter.related)?[...s.frontmatter.related].filter(v=>typeof v=="number"&&v!==0):[],c=Array.isArray(i.frontmatter.related)?[...i.frontmatter.related].filter(v=>typeof v=="number"&&v!==0):[],l=await a.pathsToIds([e.file2.path]),d=await a.pathsToIds([e.file1.path]);l.length>0&&!o.includes(l[0])&&o.push(l[0]),d.length>0&&!c.includes(d[0])&&c.push(d[0]);let u={...s.frontmatter,related:o},m={...i.frontmatter,related:c},p=this.context.frontmatterParser.build(u,s.body),y=this.context.frontmatterParser.build(m,i.body);await this.context.app.vault.modify(e.file1,p),await this.context.app.vault.modify(e.file2,y)}async archiveDuplicatePair(e){await this.context.fileOrganizer.moveToArchive(e.file2);let t=await this.context.app.vault.read(e.file2),r=this.context.frontmatterParser.parse(t),s={...r.frontmatter,status:"archived"},i=this.context.frontmatterParser.build(s,r.body);await this.context.app.vault.modify(e.file2,i)}async mergeDuplicatePair(e){let t=await this.context.app.vault.read(e.file1),r=await this.context.app.vault.read(e.file2),s=this.context.frontmatterParser.parse(t),i=this.context.frontmatterParser.parse(r),a=`${s.body}

---

Merged from: ${e.file2.name}

${i.body}`,o=[...Array.isArray(s.frontmatter.tags)?s.frontmatter.tags:[],...Array.isArray(i.frontmatter.tags)?i.frontmatter.tags:[]],c=Array.from(new Set(o)),l=new U(this.context.ideaRepository),d=Array.isArray(s.frontmatter.related)?[...s.frontmatter.related].filter(A=>typeof A=="number"&&A!==0):[],u=Array.isArray(i.frontmatter.related)?[...i.frontmatter.related].filter(A=>typeof A=="number"&&A!==0):[],m=await l.pathsToIds([e.file2.path]),p=[...d,...u,...m],y=Array.from(new Set(p)),v={...s.frontmatter,tags:c,related:y},E=this.context.frontmatterParser.build(v,a);await this.context.app.vault.modify(e.file1,E),await this.context.app.fileManager.trashFile(e.file2)}};var au=require("obsidian");var Yc=class extends G{constructor(e){super(e)}async execute(){try{let t=this.context.app.vault.getMarkdownFiles().filter(o=>o.path.startsWith("Ideas/")&&!o.path.startsWith("Ideas/Archived/"));if(t.length===0){new au.Notice("No idea files found in ideas/ directory.");return}let r=new Vt(this.context.app,"Refreshing related notes");r.open();let s=0,i=0,a=[];for(let o=0;o<t.length&&!r.isCancelled();o++){let c=t[o];r.updateProgress({current:o+1,total:t.length,currentItem:c.name,status:"processing"});try{let l=await this.context.app.vault.read(c),d=this.context.frontmatterParser.parse(l),u=d.body.trim();if(u.length===0){a.push(`${c.name}: No content to search`),i++;continue}let m=await this.context.searchService.findRelatedNotes(u,5),p=new U(this.context.ideaRepository),y=m.map(f=>f.path),v=await p.pathsToIds(y),E={...d.frontmatter,related:v},A=this.context.frontmatterParser.build(E,d.body);await this.context.app.vault.modify(c,A),s++}catch(l){let d=l instanceof Error?l.message:"Unknown error";a.push(`${c.name}: ${d}`),i++}}r.updateProgress({current:t.length,total:t.length,status:r.isCancelled()?"cancelled":"completed",errors:a.length>0?a:void 0}),r.isCancelled()||new au.Notice(`Refresh complete: ${s} updated, ${i} failed`)}catch(e){this.handleError(e,"refresh all related notes")}}};var bn=require("obsidian");var Ph=require("obsidian"),Zc=class extends Ph.Modal{links;onLink;onCloseCallback;constructor(e,t,r,s){super(e),this.links=t,this.onLink=r,this.onCloseCallback=s}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Tenuous links"}),e.createEl("p",{text:`Found ${this.links.length} unexpected connection${this.links.length>1?"s":""}. These are ideas with lower similarity but interesting potential connections:`}).addClass("ideatr-modal-description");let r=e.createDiv("ideatr-tenuous-links-list");this.links.forEach(i=>{let a=r.createDiv("ideatr-tenuous-link-item");a.setCssProps({"margin-bottom":"20px",padding:"10px",border:"1px solid var(--background-modifier-border)","border-radius":"4px"}),a.createEl("strong",{text:i.idea.title}),a.createEl("div",{text:`Similarity: ${(i.similarity*100).toFixed(1)}% | Relevance: ${(i.relevance*100).toFixed(1)}%`,cls:"ideatr-tenuous-link-meta",attr:{style:"font-size: 12px; color: var(--text-muted); margin-top: 5px;"}}),a.createEl("div",{text:i.explanation,cls:"ideatr-tenuous-link-explanation",attr:{style:"margin-top: 10px; font-style: italic;"}}),i.synergy&&a.createEl("div",{text:`\u{1F4A1} Synergy: ${i.synergy}`,cls:"ideatr-tenuous-link-synergy",attr:{style:"margin-top: 10px; color: var(--text-accent);"}});let o=a.createDiv("ideatr-modal-buttons");o.setCssProps({"margin-top":"10px"}),o.createEl("button",{text:"Link ideas",cls:"mod-cta"}).addEventListener("click",()=>{this.onLink&&this.onLink(i,"link")}),o.createEl("button",{text:"Create combined idea"}).addEventListener("click",()=>{this.onLink&&this.onLink(i,"combine")})}),e.createDiv("ideatr-modal-buttons").createEl("button",{text:"Close"}).addEventListener("click",()=>{this.onCloseCallback&&this.onCloseCallback(),this.close()})}onClose(){let{contentEl:e}=this;e.empty(),this.onCloseCallback&&this.onCloseCallback()}};var el=class extends N{idConverter;constructor(e){super(e),this.idConverter=new U(e.ideaRepository)}getCommandName(){return"find tenuous links"}async executeWithFile(e,t){if(!this.context.tenuousLinkService){new bn.Notice("Tenuous link service is not available.");return}new bn.Notice("Finding tenuous links... This may take a moment.");let r=Array.isArray(t.frontmatter.related)?t.frontmatter.related.filter(a=>typeof a=="number"&&a!==0):[],s=await this.idConverter.idsToPaths(r),i=await this.context.tenuousLinkService.findTenuousLinks(t.ideaText,typeof t.frontmatter.category=="string"?t.frontmatter.category:"",Array.isArray(t.frontmatter.tags)?t.frontmatter.tags:[],s);if(i.length===0){new bn.Notice("No tenuous links found.");return}new Zc(this.context.app,i,(a,o)=>{(async()=>{if(o==="link"){let c=Array.isArray(t.frontmatter.related)?t.frontmatter.related.filter(d=>typeof d=="number"&&d!==0):[],l=await this.idConverter.pathsToIds([a.idea.path]);l.length>0&&!c.includes(l[0])&&(await this.updateIdeaFrontmatter(e,{related:[...c,l[0]]}),new bn.Notice(`Linked to ${a.idea.title}`))}else if(o==="combine"){let c=await this.idConverter.pathsToIds([e.path]),l=await this.idConverter.pathsToIds([a.idea.path]),d=[...c,...l].filter(p=>p!==0),u=`---
type: idea
status: captured
created: ${new Date().toISOString().split("T")[0]}
id: 0
category: ${typeof t.frontmatter.category=="string"?t.frontmatter.category:""}
tags: ${JSON.stringify([...Array.isArray(t.frontmatter.tags)?t.frontmatter.tags:[],"combined"])}
related: ${JSON.stringify(d)}
domains: []
existence-check: []
---

# Combined Idea

## Original Idea
${t.ideaText}

## Linked Idea
${a.explanation}

## Synergy
${a.synergy??"Potential combination of these ideas"}
`,m=`Ideas/${new Date().toISOString().split("T")[0]}-combined-idea.md`;await this.context.app.vault.create(m,u),new bn.Notice("Created combined idea.")}})()}).open()}};var ji=require("obsidian");var Rh=require("obsidian"),tl=class extends Rh.Modal{cluster;onOpenIdea;constructor(e,t,r){super(e),this.cluster=t,this.onOpenIdea=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Cluster analysis"});let t=e.createDiv("ideatr-cluster-header");if(t.createEl("h3",{text:this.cluster.label||"Unnamed Cluster",attr:{style:"margin-bottom: 10px;"}}),t.createEl("p",{text:`${this.cluster.ideas.length} idea${this.cluster.ideas.length>1?"s":""} in this cluster`,attr:{style:"color: var(--text-muted); margin-bottom: 20px;"}}),this.cluster.statistics){let o=e.createDiv("ideatr-cluster-stats");o.setCssProps({"margin-bottom":"20px",padding:"10px","background-color":"var(--background-secondary)","border-radius":"4px"}),o.createEl("h4",{text:"Statistics",attr:{style:"margin-bottom: 10px;"}});let c=o.createEl("ul",{attr:{style:"margin: 0; padding-left: 20px;"}});if(this.cluster.statistics.averageAge!==void 0&&c.createEl("li",{text:`Average age: ${Math.round(this.cluster.statistics.averageAge)} days`}),this.cluster.statistics.statusDistribution){let l=Object.entries(this.cluster.statistics.statusDistribution).map(([d,u])=>`${d}: ${u}`).join(", ");c.createEl("li",{text:`Status distribution: ${l}`})}}if(this.cluster.commonTags&&this.cluster.commonTags.length>0){let o=e.createDiv("ideatr-cluster-tags");o.setCssProps({"margin-bottom":"20px"}),o.createEl("h4",{text:"Common tags",attr:{style:"margin-bottom: 10px;"}});let c=o.createDiv("ideatr-cluster-tags-list");c.setCssProps({display:"flex","flex-wrap":"wrap",gap:"5px"}),this.cluster.commonTags.forEach(l=>{c.createEl("span",{text:l,attr:{style:"background: var(--background-modifier-border); padding: 2px 8px; border-radius: 12px; font-size: 12px;"}})})}if(this.cluster.commonThemes&&this.cluster.commonThemes.length>0){let o=e.createDiv("ideatr-cluster-themes");o.setCssProps({"margin-bottom":"20px"}),o.createEl("h4",{text:"Common themes",attr:{style:"margin-bottom: 10px;"}});let c=o.createEl("ul",{attr:{style:"margin: 0; padding-left: 20px;"}});this.cluster.commonThemes.forEach(l=>{c.createEl("li",{text:l})})}let r=e.createDiv("ideatr-cluster-members");r.setCssProps({"margin-bottom":"20px"}),r.createEl("h4",{text:"Cluster members",attr:{style:"margin-bottom: 10px;"}});let s=r.createDiv("ideatr-cluster-members-list");if(s.setCssProps({"max-height":"300px","overflow-y":"auto",border:"1px solid var(--background-modifier-border)","border-radius":"4px",padding:"10px"}),this.cluster.ideas.forEach(o=>{let c=s.createDiv("ideatr-cluster-member-item");c.setCssProps({"margin-bottom":"8px",padding:"8px",cursor:"pointer","border-radius":"4px",transition:"background-color 0.2s"}),c.addEventListener("mouseenter",()=>{c.setCssProps({"background-color":"var(--background-modifier-hover)"})}),c.addEventListener("mouseleave",()=>{c.setCssProps({"background-color":"transparent"})}),c.addEventListener("click",()=>{this.onOpenIdea&&this.onOpenIdea(`Ideas/${o.filename}`)}),c.createEl("strong",{text:o.filename}),o.frontmatter?.category&&c.createEl("div",{text:`Category: ${o.frontmatter.category}`,attr:{style:"font-size: 12px; color: var(--text-muted); margin-top: 4px;"}})}),this.cluster.relatedClusters&&this.cluster.relatedClusters.length>0){let o=e.createDiv("ideatr-cluster-related");o.setCssProps({"margin-bottom":"20px"}),o.createEl("h4",{text:"Related clusters",attr:{style:"margin-bottom: 10px;"}});let c=o.createEl("ul",{attr:{style:"margin: 0; padding-left: 20px;"}});this.cluster.relatedClusters.forEach(l=>{let d=c.createEl("li",{attr:{style:"margin-bottom: 8px;"}});d.createEl("strong",{text:`${l.label} (similarity: ${(l.similarity*100).toFixed(1)}%)`}),l.explanation&&d.createEl("div",{text:l.explanation,attr:{style:"font-size: 12px; color: var(--text-muted); margin-top: 4px; font-style: italic;"}})})}let i=e.createDiv("ideatr-modal-buttons");i.setCssProps({"margin-top":"20px"}),i.createEl("button",{text:"Close",cls:"mod-cta"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:e}=this;e.empty()}};var ou={DEFAULT_MUTATION_COUNT:8,DEFAULT_EXPANSION_DETAIL:"detailed",DEFAULT_N_PREDICT:{CLASSIFICATION:128,COMPLETION:256,EXPANSION:3e3,MUTATION:4e3,REORGANIZATION:4e3}};var cu={mutations:n=>{let e=n.count??ou.DEFAULT_MUTATION_COUNT,t=n.category??"general",r=n.tags&&n.tags.length>0?n.tags.join(", "):"none",s=n.focus?`

Focus: ${n.focus}`:"";return`Generate ${e} distinct variations of this idea.

Original Idea:
${n.ideaText}

Category: ${t}
Tags: ${r}${s}

Requirements:
- Each variation must be meaningfully different (audience, problem, business model, tech, scope).
- Variations should be interesting and viable.
- Avoid minor tweaks.

Output JSON array of objects with:
- title: Brief name (2-5 words)
- description: Clear explanation of difference (1-2 sentences)
- differences: 2-3 specific differences

Format: JSON array ONLY. No markdown.
[
  {
    "title": "Variation Name",
    "description": "Description...",
    "differences": ["Diff 1", "Diff 2"]
  }
]`},expansion:n=>{let e=n.category??"general",t=n.tags&&n.tags.length>0?n.tags.join(", "):"none",r=n.detailLevel??ou.DEFAULT_EXPANSION_DETAIL;return`Expand this idea into a comprehensive description.

Original Idea:
${n.ideaText}

Category: ${e}
Tags: ${t}

Requirements:
- Preserve core concept.
- Add meaningful detail.
- Use markdown headers.
- Detail level: ${r}

Structure:
## Overview
Summary (2-4 sentences).

## Key Features / Mechanics
Main components.

## Goals / Objectives
Primary goals and success criteria.

## Potential Challenges
Technical, market, or resource challenges.

## Next Steps
Actionable initial steps.`},reorganization:n=>{let e=n.category??"general",t=n.tags&&n.tags.length>0?n.tags.join(", "):"none",r=n.targetStructure&&n.targetStructure.length>0?n.targetStructure.join(`
- `):"Logical sections with clear headings",s=n.preserveSections&&n.preserveSections.length>0?n.preserveSections.join(`
- `):"None";return`Reorganize this idea into a clear format.

Original Idea:
${n.ideaText}

Category: ${e}
Tags: ${t}

Requirements:
- Preserve ALL info.
- Organize logically.
- Use markdown.

Target structure:
- ${r}

Preserve exactly:
- ${s}`},clusterAnalysis:n=>{let e=n.clusterIdeas.map((s,i)=>`${i+1}. ${s.title}
   Category: ${s.category??"none"}
   Tags: ${s.tags?.join(", ")??"none"}
   Text: ${s.text.substring(0,200)}...`).join(`

`),t=n.otherClusterIdeas?`

Other Cluster:
${n.otherClusterIdeas.map((s,i)=>`${i+1}. ${s.title} (${s.category??"none"})`).join(`
`)}`:"",r=n.similarity!==void 0?`
Similarity: ${(n.similarity*100).toFixed(1)}%`:"";return`Analyze this cluster of ideas.

Cluster Ideas:
${e}${t}${r}

Analyze:
1. Common Themes
2. Common Patterns
3. Relationship Explanation (Why do they belong together?)
4. Potential Synergies${n.otherClusterIdeas?`
5. Relationship to Other Cluster`:""}

Output JSON ONLY:
{
  "commonThemes": ["Theme 1", "Theme 2"],
  "commonPatterns": ["Pattern 1", "Pattern 2"],
  "relationshipExplanation": "Explanation...",
  "synergies": ["Synergy 1", "Synergy 2"],${n.otherClusterIdeas?`
  "relationshipToOtherCluster": "Relation...",`:""}
  "relevance": 0.0-1.0
}`}};var lu={_string:'string ::= "\\"" ([^"\\\\] | "\\\\" (["\\\\/bfnrt] | "u" [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F]))* "\\""',_number:'number ::= ("-"? ([0-9] | [1-9] [0-9]*)) ("." [0-9]+)? ([eE] [-+]? [0-9]+)?',_boolean:'boolean ::= "true" | "false"',_null:'null ::= "null"',_array:'array ::= "[" (value ("," value)*)? "]"',_ws:"ws ::= [ \\t\\n]*",classification:`root ::= object
ws ::= [ \\t\\n]*
string ::= "\\"" ([^"\\\\] | "\\\\" (["\\\\/bfnrt] | "u" [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F]))* "\\""
string_array ::= "[" ws (string (ws "," ws string)*)? ws "]"
object ::= "{" ws "\\"category\\"" ws ":" ws string ws "," ws "\\"tags\\"" ws ":" ws string_array ws "}"`,mutations:`root ::= mutation_array
ws ::= [ \\t\\n]*
string ::= "\\"" ([^"\\\\] | "\\\\" (["\\\\/bfnrt] | "u" [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F]))* "\\""
string_array ::= "[" ws (string (ws "," ws string)*)? ws "]"
mutation ::= "{" ws "\\"title\\"" ws ":" ws string ws "," ws "\\"description\\"" ws ":" ws string ws "," ws "\\"differences\\"" ws ":" ws string_array ws "}"
mutation_array ::= "[" ws (mutation (ws "," ws mutation)*)? ws "]"`,clusterAnalysis:`root ::= object
ws ::= [ \\t\\n]*
string ::= "\\"" ([^"\\\\] | "\\\\" (["\\\\/bfnrt] | "u" [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F] [0-9a-fA-F]))* "\\""
string_array ::= "[" ws (string (ws "," ws string)*)? ws "]"
number ::= ("-"? ([0-9] | [1-9] [0-9]*)) ("." [0-9]+)? ([eE] [-+]? [0-9]+)?
optional_relationship ::= ("," ws "\\"relationshipToOtherCluster\\"" ws ":" ws string)?
object ::= "{" ws "\\"commonThemes\\"" ws ":" ws string_array ws "," ws "\\"commonPatterns\\"" ws ":" ws string_array ws "," ws "\\"relationshipExplanation\\"" ws ":" ws string ws "," ws "\\"synergies\\"" ws ":" ws string_array ws "," ws "\\"relevance\\"" ws ":" ws number optional_relationship ws "}"
`};var rl=class extends N{constructor(e){super(e)}getCommandName(){return"analyze idea cluster"}async executeWithFile(e,t){if(!this.context.clusteringService){new ji.Notice("Clustering service is not available.");return}new ji.Notice("Analyzing cluster...");let s=this.context.app.vault.getMarkdownFiles().filter(f=>f.path.startsWith("Ideas/")&&!f.path.startsWith("Ideas/Archived/"));if(s.length===0){new ji.Notice("No idea files found.");return}let i=[];for(let f of s)try{let S=await this.context.app.vault.read(f),P=this.context.frontmatterParser.parseIdeaFile({path:f.path,name:f.name},S);i.push(P)}catch(S){h.warn(`Failed to parse ${f.path}:`,S)}let a=await this.context.clusteringService.clusterIdeas(i),o=a.find(f=>f.ideas.some(S=>S.filename===e.name||`Ideas/${S.filename}`===e.path));if(!o){new ji.Notice("Could not find cluster for this idea.");return}let c=new Map;o.ideas.forEach(f=>{(f.frontmatter?.tags??[]).forEach(P=>{c.set(P,(c.get(P)??0)+1)})});let l=Array.from(c.entries()).filter(([f,S])=>S>=2).sort((f,S)=>S[1]-f[1]).map(([f])=>f).slice(0,10),d=o.ideas.map(f=>{let S=f.frontmatter?.created?new Date(f.frontmatter.created).getTime():Date.now();return Math.floor((Date.now()-S)/(1e3*60*60*24))}),u=d.reduce((f,S)=>f+S,0)/d.length,m={};o.ideas.forEach(f=>{let S=f.frontmatter?.status??"unknown";m[S]=(m[S]??0)+1});let p=a.filter(f=>f!==o).map(f=>{let S=0,P=0;for(let $ of o.ideas)for(let F of f.ideas){let B=$.body??$.filename??"",H=F.body??F.filename??"";if(B&&H){let D=this.context.searchService.calculateSimilarity(B,H);S+=D,P++}}let k=P>0?S/P:0;return{label:f.label,similarity:k,cluster:f}}),y=p.filter(f=>f.similarity>.3).sort((f,S)=>S.similarity-f.similarity).slice(0,5).map(f=>({label:f.label,similarity:f.similarity})),v=[],E=new Map;if(this.context.llmService.isAvailable()&&this.context.llmService.complete)try{let f=o.ideas.map(k=>({title:k.filename.replace(".md",""),text:k.body??"",category:k.frontmatter?.category??"",tags:k.frontmatter?.tags??[]})),S=cu.clusterAnalysis({clusterIdeas:f}),P=await this.context.llmService.complete(S,{temperature:.7,n_predict:500,grammar:lu.clusterAnalysis});try{let k=X(P,!1),$=JSON.parse(k);v=Array.isArray($.commonThemes)?$.commonThemes??[]:[]}catch(k){h.warn("Failed to parse cluster analysis JSON:",k)}for(let k of y.slice(0,3)){let $=p.find(F=>F.label===k.label)?.cluster;if($){let F=$.ideas.map(D=>({title:D.filename.replace(".md",""),text:D.body??"",category:D.frontmatter?.category??"",tags:D.frontmatter?.tags??[]})),B=cu.clusterAnalysis({clusterIdeas:f,otherClusterIdeas:F,similarity:k.similarity}),H=await this.context.llmService.complete(B,{temperature:.7,n_predict:300,grammar:lu.clusterAnalysis});try{let D=X(H,!1),q=JSON.parse(D);k.label&&E.set(k.label,typeof q.relationshipToOtherCluster=="string"?q.relationshipToOtherCluster:q.relationshipToOtherCluster??"")}catch(D){h.warn("Failed to parse relationship analysis JSON:",D)}}}}catch(f){h.warn("Failed to analyze cluster with LLM:",f)}let A={label:o.label??"Unnamed Cluster",ideas:o.ideas,commonTags:l,commonThemes:v.length>0?v:void 0,statistics:{totalIdeas:o.ideas.length,averageAge:u,statusDistribution:m},relatedClusters:y.map(f=>({label:f.label??"Unnamed Cluster",similarity:f.similarity,explanation:E.get(f.label??"")})).filter(f=>f.label!=="Unnamed Cluster"||f.similarity>0)};new tl(this.context.app,A,f=>{(async()=>this.context.app.vault.getAbstractFileByPath(f||"")&&await this.context.app.workspace.openLinkText(f||"","",!0))()}).open()}};var Th=require("obsidian");var sl=class extends Th.Modal{stats;idConverter;constructor(e,t,r){super(e),this.stats=t,r&&(this.idConverter=new U(r))}async onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Idea statistics"});let t=e.createDiv("ideatr-stats-grid");t.setCssProps({display:"grid","grid-template-columns":"1fr 1fr",gap:"15px","margin-bottom":"20px"}),this.createStatCard(t,"Age",`${this.stats.age} day${this.stats.age!==1?"s":""}`),this.createStatCard(t,"Status",this.stats.status??"unknown"),this.createStatCard(t,"Category",this.stats.category??"none"),this.createStatCard(t,"Related Notes",this.stats.relatedCount.toString()),this.createStatCard(t,"Tags",this.stats.tagsCount.toString()),this.createStatCard(t,"Domains",this.stats.domainsCount.toString());let r=e.createDiv("ideatr-stats-dates");r.setCssProps({"margin-bottom":"20px",padding:"10px","background-color":"var(--background-secondary)","border-radius":"4px"}),r.createEl("h4",{text:"Dates",attr:{style:"margin-bottom: 10px;"}});let s=r.createEl("ul",{attr:{style:"margin: 0; padding-left: 20px;"}});if(s.createEl("li",{text:`Created: ${this.stats.created.toLocaleDateString()}`}),s.createEl("li",{text:`Last modified: ${this.stats.lastModified.toLocaleDateString()}`}),this.stats.frontmatter){let o=e.createDiv("ideatr-stats-additional");if(o.setCssProps({"margin-bottom":"20px"}),this.stats.frontmatter.tags&&this.stats.frontmatter.tags.length>0){let c=o.createDiv("ideatr-stats-tags");c.setCssProps({"margin-bottom":"10px"}),c.createEl("h4",{text:"Tags",attr:{style:"margin-bottom: 10px;"}});let l=c.createDiv("ideatr-stats-tags-list");l.setCssProps({display:"flex","flex-wrap":"wrap",gap:"5px"}),this.stats.frontmatter.tags.forEach(d=>{l.createEl("span",{text:d,attr:{style:"background: var(--background-modifier-border); padding: 2px 8px; border-radius: 12px; font-size: 12px;"}})})}if(this.stats.frontmatter.related&&this.stats.frontmatter.related.length>0){let c=o.createDiv("ideatr-stats-related");c.setCssProps({"margin-bottom":"10px"}),c.createEl("h4",{text:"Related notes",attr:{style:"margin-bottom: 10px;"}});let l=c.createEl("ul",{attr:{style:"margin: 0; padding-left: 20px; max-height: 150px; overflow-y: auto;"}}),d=this.stats.frontmatter.related,u=d.filter(m=>typeof m=="number"&&m!==0);if(u.length>0&&this.idConverter)try{let m=await this.idConverter.idsToTitles(u);u.forEach(p=>{l.createEl("li",{attr:{style:"font-size: 12px; cursor: help;"}}).createEl("span",{text:p.toString(),attr:{style:"text-decoration: underline; text-decoration-style: dotted;",title:m.get(p)??`ID: ${p}`}})})}catch{u.forEach(m=>{l.createEl("li",{text:m.toString(),attr:{style:"font-size: 12px;"}})})}else d.forEach(m=>{let p=typeof m=="number"?m.toString():m;l.createEl("li",{text:p,attr:{style:"font-size: 12px;"}})})}}let i=e.createDiv("ideatr-modal-buttons");i.setCssProps({"margin-top":"20px"}),i.createEl("button",{text:"Close",cls:"mod-cta"}).addEventListener("click",()=>{this.close()})}createStatCard(e,t,r){let s=e.createDiv("ideatr-stat-card");return s.setCssProps({padding:"10px","background-color":"var(--background-secondary)","border-radius":"4px",border:"1px solid var(--background-modifier-border)"}),s.createEl("div",{text:t,attr:{style:"font-size: 12px; color: var(--text-muted); margin-bottom: 5px;"}}),s.createEl("div",{text:r,attr:{style:"font-size: 16px; font-weight: bold;"}}),s}onClose(){let{contentEl:e}=this;e.empty()}};var nl=class extends N{constructor(e){super(e)}getCommandName(){return"show idea stats"}async executeWithFile(e,t){let r=t.frontmatter.created?new Date(t.frontmatter.created):new Date(e.stat.mtime),s=Math.floor((Date.now()-r.getTime())/(1e3*60*60*24)),i=Array.isArray(t.frontmatter.related)?t.frontmatter.related.length:0,a=Array.isArray(t.frontmatter.tags)?t.frontmatter.tags.length:0,o=Array.isArray(t.frontmatter.domains)?t.frontmatter.domains.length:0,c=new Date(e.stat.mtime),l={age:s,status:t.frontmatter.status||"unknown",category:t.frontmatter.category||"none",relatedCount:i,tagsCount:a,domainsCount:o,lastModified:c,created:r,frontmatter:t.frontmatter};return new sl(this.context.app,l,this.context.ideaRepository).open(),Promise.resolve()}};var al=class n{static createCommandCallback(e,t){let r=async()=>{h.info(`Callback invoked for: ${e}`),h.debug("Callback stack trace:",new Error().stack);try{h.debug(`About to call operation for: ${e}`),await n.safeExecute(e,t),h.debug(`Operation completed for: ${e}`)}catch(s){console.error(`[Ideatr] Callback error for ${e}:`,s),h.error(`Callback error for ${e}:`,s)}};return typeof r!="function"&&(console.error(`[Ideatr] ERROR: Callback for ${e} is not a function! Type: ${typeof r}`),h.error(`Callback for ${e} is not a function! Type: ${typeof r}`)),r}static async safeExecute(e,t){h.info(`Starting command: ${e}`);let r=null;try{r=new il.Notice(`\u23F3 Processing ${e}...`,0),h.debug(`Created loading notice for: ${e}`);try{let s=r.noticeEl;if(s){let i=s.createSpan({cls:"ideatr-loading-spinner"});i.textContent="\u23F3",i.addClass("ideatr-loading-spinner")}}catch(s){h.debug("Could not add spinner to notice (non-critical):",s)}}catch(s){console.error(`[Ideatr] Failed to create loading notice for ${e}:`,s),h.error(`Failed to create loading notice for ${e}:`,s)}try{h.debug(`Executing operation for: ${e}`),await t(),h.info(`Finished command: ${e}`),r&&r.hide(),new il.Notice(`\u2713 ${e} completed`,2e3)}catch(s){console.error(`[Ideatr] Command '${e}' failed:`,s),h.error(`Command '${e}' failed:`,s),r&&r.hide()}}static registerAll(e,t){h.debug("Registering commands...");let r=n.createCommandCallback("Capture idea",async()=>await new uc(t).execute());e.addCommand({id:"capture-idea",name:"Capture idea",callback:r}),h.debug("Registered: Capture idea"),e.addCommand({id:"search-existence",name:"Search existence",callback:n.createCommandCallback("Search existence",async()=>await new mc(t).execute())}),e.addCommand({id:"check-duplicates",name:"Check duplicates",callback:n.createCommandCallback("Check duplicates",async()=>await new gc(t).execute())}),e.addCommand({id:"find-related-notes",name:"Find related notes",callback:n.createCommandCallback("Find related notes",async()=>await new vc(t).execute())}),e.addCommand({id:"quick-validate",name:"Quick validate",callback:n.createCommandCallback("Quick validate",async()=>await new xc(t).execute())});let s=n.createCommandCallback("Generate name variants",async()=>await new Ac(t).execute());h.debug("Created nameVariantCallback, type:",typeof s),e.addCommand({id:"generate-name-variants",name:"Generate name variants",callback:s}),h.debug("Registered: Generate name variants"),e.addCommand({id:"generate-scaffold",name:"Generate scaffold",callback:n.createCommandCallback("Generate scaffold",async()=>await new Sc(t).execute())}),e.addCommand({id:"generate-mutations",name:"Generate mutations",callback:n.createCommandCallback("Generate mutations",async()=>await new _c(t).execute())});let i=n.createCommandCallback("Expand idea",async()=>await new Rc(t).execute());if(h.debug("Created expandCallback, type:",typeof i,"is function:",typeof i=="function"),e.addCommand({id:"expand-idea",name:"Expand idea",callback:i}),h.debug("Registered: Expand idea, callback stored:",typeof i),e.addCommand({id:"reorganize-idea",name:"Reorganize idea",callback:n.createCommandCallback("Reorganize idea",async()=>await new kc(t).execute())}),e.addCommand({id:"guided-ideation",name:"Transform",callback:n.createCommandCallback("Transform",async()=>await new Fc(t).execute())}),e.addCommand({id:"change-status",name:"Change status",callback:n.createCommandCallback("Change status",async()=>await new Nc(t).execute())}),e.addCommand({id:"archive-idea",name:"Archive idea",callback:n.createCommandCallback("Archive idea",async()=>await new Bi(t,!0).execute())}),e.addCommand({id:"unarchive-idea",name:"Unarchive idea",callback:n.createCommandCallback("Unarchive idea",async()=>await new Bi(t,!1).execute())}),e.addCommand({id:"add-codename",name:"Generate codename",callback:n.createCommandCallback("Generate codename",async()=>await new Dc(t).execute())}),e.addCommand({id:"open-dashboard",name:"Open dashboard",callback:n.createCommandCallback("Open dashboard",async()=>await new $c(t).execute())}),e.addCommand({id:"open-graph",name:"Open graph view",callback:n.createCommandCallback("Open graph view",async()=>await new Bc(t).execute())}),e.addCommand({id:"open-tutorials",name:"Open tutorials",callback:n.createCommandCallback("Open tutorials",async()=>await new Uc(t).execute())}),e.addCommand({id:"classify-current-note",name:"Classify current note",callback:n.createCommandCallback("Classify current note",async()=>await new jc(t).execute())}),e.addCommand({id:"refresh-idea",name:"Refresh idea",callback:n.createCommandCallback("Refresh idea",async()=>await new Hc(t).execute())}),e.addCommand({id:"export-ideas",name:"Export ideas",callback:n.createCommandCallback("Export ideas",async()=>await new qc(t).execute())}),e.addCommand({id:"import-ideas",name:"Import ideas",callback:n.createCommandCallback("Import ideas",async()=>await new Vc(t).execute())}),e.addCommand({id:"generate-digest",name:"Generate weekly digest",callback:n.createCommandCallback("Generate weekly digest",async()=>await new zc(t).execute())}),e.addCommand({id:"elevate-to-project",name:"Elevate to project",callback:n.createCommandCallback("Elevate to project",async()=>await new Wc(t).execute())}),e.addCommand({id:"reclassify-all-ideas",name:"Reclassify all ideas",callback:n.createCommandCallback("Reclassify all ideas",async()=>await new Jc(t).execute())}),e.addCommand({id:"find-all-duplicates",name:"Find all duplicates",callback:n.createCommandCallback("Find all duplicates",async()=>await new Qc(t).execute())}),e.addCommand({id:"refresh-all-related-notes",name:"Refresh all related notes",callback:n.createCommandCallback("Refresh all related notes",async()=>await new Yc(t).execute())}),e.addCommand({id:"find-tenuous-links",name:"Find tenuous links",callback:n.createCommandCallback("Find tenuous links",async()=>await new el(t).execute())}),e.addCommand({id:"analyze-idea-cluster",name:"Analyze idea cluster",callback:n.createCommandCallback("Analyze idea cluster",async()=>await new rl(t).execute())}),e.addCommand({id:"show-idea-stats",name:"Show idea statistics",callback:n.createCommandCallback("Show idea statistics",async()=>await new nl(t).execute())}),h.isDebugEnabled()){let a=n.createCommandCallback("Ideatr Debug (Registry)",()=>(h.debug("[Ideatr DEBUG REGISTRY] Command operation executed!"),h.info("DEBUG REGISTRY: Command executed successfully"),new il.Notice("Ideatr debug (registry) command executed - check console"),Promise.resolve()));h.debug("Debug registry callback type:",typeof a),e.addCommand({id:"debug-registry",name:"Debug (registry)",callback:a}),h.debug("Registered debug command via CommandRegistry")}}};var ol=class{snapshots=[];maxSnapshots=100;monitoringInterval=null;startMonitoring(e=3e4){if(this.monitoringInterval){h.warn("Memory monitoring already started");return}h.debug("Starting memory monitoring"),this.takeSnapshot(),this.monitoringInterval=setInterval(()=>{this.takeSnapshot(),this.checkForLeaks()},e)}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null,h.debug("Stopped memory monitoring"))}takeSnapshot(){let e=process.memoryUsage(),t={timestamp:Date.now(),heapUsedMB:e.heapUsed/1024/1024,heapTotalMB:e.heapTotal/1024/1024,externalMB:e.external/1024/1024,arrayBuffersMB:e.arrayBuffers/1024/1024};return this.snapshots.push(t),this.snapshots.length>this.maxSnapshots&&this.snapshots.shift(),t}checkForLeaks(){if(this.snapshots.length<10)return;let e=this.snapshots.slice(-10),t=e[0],r=e[e.length-1],s=r.heapUsedMB-t.heapUsedMB,i=(r.timestamp-t.timestamp)/1e3/60,a=s/i;a>1&&h.warn("Potential memory leak detected:",{heapGrowthMB:s.toFixed(2),timeElapsedMinutes:i.toFixed(2),growthRateMBPerMinute:a.toFixed(2)})}getReport(){if(this.snapshots.length===0)return"No memory snapshots available";let e=this.snapshots[this.snapshots.length-1],t=this.snapshots[0],r=e.heapUsedMB-t.heapUsedMB;return`Memory Report:
  Current Heap: ${e.heapUsedMB.toFixed(2)} MB
  Total Heap: ${e.heapTotalMB.toFixed(2)} MB
  External: ${e.externalMB.toFixed(2)} MB
  Growth since monitoring started: ${r.toFixed(2)} MB
  Snapshots collected: ${this.snapshots.length}`}getCurrentUsage(){return this.snapshots.length===0?null:this.snapshots[this.snapshots.length-1]}clearSnapshots(){this.snapshots=[]}isMonitoring(){return this.monitoringInterval!==null}};var kh="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABigAwAEAAAAAQAAABgAAAAAPuetXQAAAAlwSFlzAAAOxAAADsQBlSsOGwAABDNJREFUSA2lVN9rHFUU/ubeuXdm9kc2v1pJGmkloLEUH1QKkipGQVHqi/rSp7740Aeh4pNQCksV/AcqgiISbZWiPkTUJiC2WKHGGoi1IWkam7T53U12d3Y3uzM7s/d6Rgism01S8b7MvXfO+b5zvnPuAe5zXb24fOCPXwqPaK1j9+nyj5mxm/EH6YmEs9F5uq1LnIjv4ZKbWNBQU5YlJtxifuTo8Z5LO2Hw7X6m02l2fOD8UZVLDlazidfbH9SWjBmmoVg7lPlwzZdH3Ezl2D7xQnb01rlr2+Fsm8HwudUT2fnYh76r4RerOHiEQ0gOTUhBtQbP09DKwJ2pVTCBdxfl8pl0eiBsJGKNF9FZ6zSrVtgxaZrgdoj4XgOxVgYR17CSGnbMgGMbkFIj3iYwM5k7vXg5ONQMy2x2efP6W/sDL3yC2T6kApwYg5UADFPDIFGrAmDgyGQKuDL8F5TvwGkV/YQ13ojXNIPl2eB5S8Tj0laItQC1oIYrX3oYHwmxMKHgbxCBXcPvl++AhRyphESqRbyoib+RYEsGkdHwebzCuYYgGbjQuDmlUMwwlLIaKzM1mEIh1aWgqgba2+IwTUFyscNjY0sdQPdaPckWgunpQkfoV/stGSCRZFhbCFDKkN6kOyN5WORBlS6vmeju2YvCukdhGwirwQPXhzK99PdfBFskmhstV4r3SgsqCOGVfSxMUcQWwKmgpqNgUqF5jArDa1SFBFr3SSiusF4ozo7dyMzURx/tt2gWXX7+/uRrlbz1dTFbhmAOTEaFoOi5pcGkQe1JBAHDRjGPGxO3EfqUFq++MfjbS59E/vVrSwbRz553LgxJx//eCCVy2XWImEcZAMJikMIgzRnshMLS8gqMqqQ79atV2/NZPfDmvinBgJEOex+TbyujnC1lQ9zLrFK/k0SSmjMCdzj8MI9y3kc8birL4emPxp4MNkHrv00JIoOnX+2d1sw7SRUN795ykXfXIIQPi9oz0Rpi+XYWqWQLYjH27dlLz43Ug9bvm9Zg04Amp3Hy2Z8mgsB6VIuAoi5TBhz7H0oBpUgaG6HyXz514fGLmz6N320ziAyj9gug5pkhKXKGcpFadt3H2lIZrZ1J2C2ikkhZE42g9ecdCQhf11j4Y8hKNCo0Eo5AW4sNTkPOdGgeteKHrtzBxXrAxv2Wh9ZoUOn95jt3Vb136JkB6f45idm5efiej3zuADzkhr746uNao0/9eVeCvOt6brlQnpodl5niCrLeIo3rKjIFo1athcv1YM32O0tEHgYsThMJwpS0Z1ChIt00NkplOnN6fjuvXQkssArnjAkpqE0FGIveAoe0JN3qHbswot6VoFRKrVm28+nc3F24bgG27SBJ/U/Igzz0ft45/m1mUTOnw0/1v8kZTuWyLk+2JM9eG716ppnd/7rr6+vr6O7u7vwvIH8DwCqf0vItrMwAAAAASUVORK5CYII=",Mh="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABigAwAEAAAAAQAAABgAAAAAPuetXQAAAAlwSFlzAAAOxAAADsQBlSsOGwAABDZJREFUSA2tVV1oHFUU/u7cO3dmdme2u8nmv5SmiD5EKoEgVlpiCfokkfpQ7KsoaH2sT6LpVkEffKt/KFp8EIQ2iFKFKmnaUqnakpoYSA02Jm2TbP72L7ubzM7f9U4wEJJNNoIzD/fOme+e75zvnnsusKtHkIvZT/ddKZx/SAhh7GrJvyBSC3z2r1RsNjbWl2TJl5qCNq5AeQBCxhhjY5ncyk8n2/uu7eRjW4KUSCk0fbc3y5bOLPPswceCJ1EvmgEq4FMHPnMxv5hxB4ZvnhroHfpgOxK23Y/2Be2VGVP5SPc4XDuGBG+ERqQ6PuB4FJ4doD4aVx9tf/js4ZEnmruzDaePHk15m/0pmw3h95WnBLNJ8YQqODQvigbahLjSgAhiMEkcUSUGg0TXCOMsjqH5kTf6st8crOaragbmt5f32W65k7sGAiJgUBNREgMjHAoomCQWNEC+WMKl8UE4agUGjzwuCW5vJqmawT1/rEeVIerChEUScAIH/aXPcNnpxx3/FsqkAFXoGJz8GT53YFoGEmbimRTEFn9bMghBK8F7varQoMMCJQzjlUHkxSKKXhZT/p9QZSZJtMFlFdTH6sBUJqUzjjw9dyOZasbCxiy2MJ5YHqpzSPkQ9wxYNI5MsICsWICmGNCpIeWKSqlUFJUM2hvb0KK3ooEn4auV5Hdz5/ZvdB7OtxCM2N/bi6X8olMBik4Z496wdMigKgxcRq7JVye6XKhAjbpoYS0IbIHSkjOTLmenNhNUPQfvj731Qo6kv16w5yFiRTDTkxurrhGEGw0hpJABChkXo6PTqJAKzCBx8vrxoU82E2zJIAS8fv7tfinRD2F1LC2uQnctmYG6VpacaGsS6cLCzIMCXL0CTtWbzR0HvtjsPPyuSkBSxOuMHjkFl+ZyTgHp6RXEZP1zhcsNVmGwCCo5BXkvj0hUDwxLO32h44Kza4IQ+NyB4+N70X6GKUz8vXgfhbQAc+UOBPK4+Q2YzMzASkQQ5ZGLV3v++LGa89C2pUw3Ap/3X/z4WnHgVcbZI6P3J1C+U5atSMX+xr0Qpo96Xg9SoZ+DQGxct3FeVaJ1QFdXl1tx/LucSWkoRdEvyZJdQtpOI6knQ9nsuGqOruOrjTsShAsSouFGUCbQZHuI6ByWqSOgLqIwkVDqLnV30ulqjtdtdH2y3di951jGvU1f7ml8luJ3C6XrBJVfOfSJJuSuinf7jn01vN3a0L7jHoSApdm51bI8cRPDM3w5bcOeDuA6Anms+K7tzoaYnZ6aEhFdo7KBEqbKZMPLRnjySvBRXilB9o+aAdYEaFBWqaIoXFOhqrJdU9mwBQXXuDTTqp1gY0Y1MyiV9izpunFuavIeCvkCdM1AzIqFJ/TLKPN2vI9DopoRrEfTdejwa6qCN3O5vGJZ1oe3fvvlnfV//9vY0dFR19ramvwvDv8BxwGDgevhw4MAAAAASUVORK5CYII=",Lh="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABigAwAEAAAAAQAAABgAAAAAPuetXQAAAAlwSFlzAAAOxAAADsQBlSsOGwAABBBJREFUSA2VVVtonEUU/mbmv+19001MabpIpIqiEYrVFjEQib4Wn/qiPuiDoeAFS9GXSoXqg8+VUpRSX0SsDxEkiBWRUoxaqJDGapJaa7pJzOa21/z733bG87emTeKf7HqWYWcO3/m+OWfOzA+0ZYrZfxzJ24U3e5RSvK2Qf0GsFXjh+4FkzKy9pWd2v9Y0coASfwLBuOByvLJsj3bv/+LH7Ti2FFAKrDbef1DzVo7rsr43SB8ASEBwDo0HYMxGbaXmzY9PHn3ghd9ObiWypUB56o2hJK6cDpwqvIYD0fkswC3ioQpJB6pZBmc+grIDmch/kHkofYyxd4PNQtpmR7geGFAaky8/DyHgKxPMStPud1J5AEY/xciHJi1rcMlX//2Ht6cvzp+j0F8280UKDH/25W5eqe71JO2YEEzrAhMdd2KZtMnZhFPxsTT2LWK8gaRmPhElENkRrDH2TCIukorvADe66UwV/OunEMwNQ1bGoAIbknWgPnWZyF0kEnFY8Vj/nR2sm0RkoDhXRw4qFqPdd95qu1w8D+UViXgRsv4rZWMA1n3QNapPljCaoJMx+gtXz+3IP3xoZR1/eGIbrTw9kuGo7/dVBky/B2qViJ0ZIqW6h0OjsjFBWc3B2tkDkckD8Rwsk+VF+cIjG9lutcRGl1P+3POr1TkVxNB0XMjSJUIRIR04BCUs9NuDKQijChXfBc8XWF7xZuzitYmNbGFTRFhx9NXnLKM67NaL0OQ8EdVIhMg5kZNY2ElMcNhVHcXJBcK4aASpVx57ferjzXT/KVEIeGf85Ijr6iNms0SdoqB4JxHqNAywUITmSmRR/9tGXHi0Nn9WZuqTzeThOlLgoyHmB6mnjjq2Voa9BHuR7o9JIhoJhMOIw6snwNwarGRSWdmu9/cNXfbbFgiBux59acI3Hzyh0YE6xQLqpQRdrSQkz9Du74W3tIhkOkbz1Ne9hy6NRJGHvog2vQv173/xlJw5f1izrD3V2VnMT9ChKoF0d4CUFkBL5SAD8zRjTN6N2jiLLNEapLf3aSeAmhBWgh45Bi2oQPcWwVYL0NM5BHrKMTPZK2v4qP9tBcIAj3ddbDQUNY+BmKEjETco7QaUloAUuW+ys2IminjNt22JQtDx7/Z9ZfgLJwYHB42JyasoTN+A6znI9+ZQXuXDZ8982lwji/pvKVAqV5x6xV2NjxWMhQUXN2eb8DwJR7ObsunPRZGu97UsUZy+MEIwGBqn6yVpNKm3JezVOj1B9Ai1sJYC0mINzhm34hZMywSnL5rQNeiGLrbvwdvKLQX8SmXZMq0zN67/hdJyiR41C+lkGroQZ00EF1okQBm3aY8fePIwlelYaaUs0tn0hz+Njr7XZmj7sL6+vo6eHrpd/8P+AaolgMPx0J5bAAAAAElFTkSuQmCC",Fh="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABigAwAEAAAAAQAAABgAAAAAPuetXQAAAAlwSFlzAAAOxAAADsQBlSsOGwAABCpJREFUSA2tVVtoHFUY/s7cd7LXxIQ0iQk0MYEsBSstJeqLGlGKAV+LBN/0wRuiIuiDC14QhYJQEATBiqAYvNWE2lCxXmirJfQhSrw0Kblt0nbNbDK7c9mZneM/kdJ1d+JGcOAw55z5zvf93/+fcwbY5VM4+kq3M/nJ3mXOY7tcsg1jzcD5sTFdM1aeYAcOPusPDukQpRVa85ssS3ObRmm675nnv/43DnGnjzyXEx7vax9TreJxzbbHq8NZPUinZJGhTfYrQ4pp3uFcvXLkPiZsfLC0cmEnHmmnD4Wk+ogeU98OWnRYQQB0doLHdPjk2XcEuJUK9Na03HPbvmOz9492FXzxpbtyOb+eT6if2B5zLsLcPBKoKtyWOIQ9XWDtHWDxOLUEEDaaRywGlkjg6tmzL9iTH++L4op0kD892c3s8q0VIuCcA4k0hEQSkAguCuDlMsADmGUL86dOQXEcBJJ6kAQu1otECii/X7pbU5RkWaMIKVpe3ELw5usQenrAbhkC6+2DT26Wvv8BStVHPJWEB3Y7kb9TL9C4izhnhaOvfapWrAetZAaCrIB9/hn48iIYOWACZVVREOztxx9mGYFt0VCG73pzRTmx//DJk26tSEMNjDNnUnCsEU+n3Le1QVxZBsuvQNDJDRUcScq/pkJcX0PHnk6ovT2QCCfJ0mArKv215GG/QcCdmvLMza28S5F7tgP+4/ntiMOoQUXfbmFtyE28XILY2QUXDEXLXSxVzCv1Ao0pIsTF5548rAh8yikUkFlfR9rcAqc0QCEBWQanNIWRXSPiX1bXAEqT7fOHH5qbf79eoMFBCPjijbemA0GelE0T67SJnJvawcgRYtrfW5OcVDOtWKUaqK4LUZbPl/T0h/Xk4ThSIMeYHxve/7Tr84JvFLHkB+AddA5oV4UiLBHHhhpDhZzF4nqgpxK5R2dmvF0LhMCB8fFLnig8JXieZywuIq/pcFMp+OkMvJ5eFNbySJGQ2BL/cvSbn6ajyMO5yBrUgNnp4YFZ1qJlnUwGtmHQCgGZ/gHolglV0+Ax9sChj05M1az5RzfyoNUgeIWxhZiuZ0VGsfxpgFerqFAN2gb7w2LbIpNma/AN3cga1KL8ZPI72/UgiTJaqNBpItcsK0wNpHTrVwuGvVqLr+83c4CJ7KEpby3/6ui99yi/zv6MpfkFuK6Dm02GUsk/8d7ERLWetHbcVGDDKLqbtmvNXF5S1ssOlv0qvCpHdatcpSdfSxbVb5oi2vki/WSYIooQ6AYFCYDqYJVMyNsXUxTtjbmmDgRBshgRKZoCma4Lga5riUt0c6giF4NmuzD6oN3QB+X5WkFVY+9eXlhEkQ6dpmpI0E+GXB2Ha31bi43qN43g+qIDI3c+porsRWPDEFtSiWMXzp17+fq3/+09ks22dnd3t/0Xwr8AlfeB0c709XMAAAAASUVORK5CYII=";var cl=class extends Ie.Plugin{settings;pluginContext;statusBarItem;statusUpdateInterval;memoryMonitor;unhandledRejectionHandler;uncaughtExceptionHandler;exitHandler;sigintHandler;sigtermHandler;get nameVariantService(){return this.pluginContext.nameVariantService}get errorLogService(){return this.pluginContext.errorLogService}async onload(){await this.loadSettings(),this.unhandledRejectionHandler=(t,r)=>{console.error("Ideatr: Unhandled Rejection at:",r,"reason:",t),h.error("Unhandled Rejection:",t)},process.on("unhandledRejection",this.unhandledRejectionHandler),this.uncaughtExceptionHandler=t=>{console.error("Ideatr: Uncaught Exception:",t),h.error("Uncaught Exception:",t)},process.on("uncaughtException",this.uncaughtExceptionHandler),await h.initialize(this.app,this.settings.debugMode),Cu(this.settings)&&setTimeout(()=>{new Ur(this.app,null,this.settings,()=>{(async()=>await this.saveSettings())()}).open()},100);let{context:e}=await cc.initialize(this.app,this,this.settings);this.pluginContext=e,this.addStatusBarIndicator(),await this.ensureTutorialsAvailable(),this.registerView("ideatr-dashboard",t=>new Ki(t,this.pluginContext.ideaRepository,this.pluginContext.clusteringService,this.pluginContext.resurfacingService,this.pluginContext.projectElevationService,this.settings.dashboardItemsPerPage,this.settings.dashboardPersistFilters)),this.registerView("ideatr-graph",t=>new Ji(t,this.pluginContext.clusteringService,this.pluginContext.graphLayoutService,this.pluginContext.ideaRepository,this.pluginContext.projectElevationService)),this.addSettingTab(new Mo(this.app,this)),h.debug("Starting command registration...");try{if(!this.pluginContext)throw new Error("PluginContext is not initialized");if(!this.pluginContext.commandContext)throw new Error("CommandContext is not initialized");if(al.registerAll(this,this.pluginContext.commandContext),h.isDebugEnabled()){let t=()=>(h.debug("[Ideatr DEBUG MAIN] Command callback invoked!"),h.debug("[Ideatr DEBUG MAIN] Stack trace:",new Error().stack),h.info("DEBUG MAIN: Command executed successfully"),new Ie.Notice("Ideatr debug (main) command executed - check console"),Promise.resolve());h.debug("Debug main callback type:",typeof t),this.addCommand({id:"debug-main",name:"Debug (main)",callback:t}),h.debug("Registered debug command directly in main.ts")}(0,Ie.addIcon)(wn,xn(`data:image/png;base64,${kh}`)),(0,Ie.addIcon)(hl,xn(`data:image/png;base64,${Mh}`)),(0,Ie.addIcon)(fl,xn(`data:image/png;base64,${Lh}`)),(0,Ie.addIcon)(gl,xn(`data:image/png;base64,${Fh}`)),this.addRibbonIcon(wn,"Capture idea",()=>{this.openCaptureModal()}),this.addCommand({id:"show-memory-report",name:"Show memory report",callback:()=>{if(this.memoryMonitor){let t=this.memoryMonitor.getReport();h.debug("Memory report:",t);let r=this.memoryMonitor.getCurrentUsage();r?new Ie.Notice(`Heap: ${r.heapUsedMB.toFixed(0)}MB | Ext: ${r.externalMB.toFixed(0)}MB`):new Ie.Notice("Memory report logged to console")}else new Ie.Notice("Memory monitoring is not enabled (requires debug mode)")}}),h.info("All commands registered successfully")}catch(t){console.error("[Ideatr] Error registering commands:",t),console.error("[Ideatr] Error details:",t instanceof Error?t.stack:t),new Ie.Notice("Failed to register ideatr commands. Check console for details")}this.settings.debugMode&&(this.memoryMonitor=new ol,this.memoryMonitor.startMonitoring(6e4),h.debug("Memory monitoring started"))}openCaptureModal(){new $r(this.app,this.pluginContext.fileManager,this.pluginContext.classificationService,this.pluginContext.duplicateDetector,this.settings,this.pluginContext.domainService,this.pluginContext.webSearchService,this.pluginContext.nameVariantService,this.pluginContext.llmService,this.pluginContext.ideaRepository).open()}async ensureLLMReady(){this.pluginContext.llmService?.ensureReady&&await this.pluginContext.llmService.ensureReady()}onunload(){h.debug("Unloading Ideatr plugin"),this.unhandledRejectionHandler&&(process.removeListener("unhandledRejection",this.unhandledRejectionHandler),this.unhandledRejectionHandler=void 0),this.uncaughtExceptionHandler&&(process.removeListener("uncaughtException",this.uncaughtExceptionHandler),this.uncaughtExceptionHandler=void 0),this.exitHandler&&(process.removeListener("exit",this.exitHandler),this.exitHandler=void 0),this.sigintHandler&&(process.removeListener("SIGINT",this.sigintHandler),this.sigintHandler=void 0),this.sigtermHandler&&(process.removeListener("SIGTERM",this.sigtermHandler),this.sigtermHandler=void 0),this.statusUpdateInterval&&(clearInterval(this.statusUpdateInterval),this.statusUpdateInterval=void 0),this.memoryMonitor&&(h.debug("Memory report before unload:"),h.debug(this.memoryMonitor.getReport()),this.memoryMonitor.stopMonitoring(),this.memoryMonitor=void 0),this.pluginContext?.llmService&&this.pluginContext.llmService.cleanup?.(),h.debug("Ideatr plugin unloaded successfully")}async loadSettings(){let e=await this.loadData();if(this.settings=Object.assign({},ih,e),e&&"cloudApiKey"in e&&e.cloudApiKey&&(!this.settings.cloudApiKeys||Object.values(this.settings.cloudApiKeys).every(t=>!t))){let t=typeof e.cloudApiKey=="string"?e.cloudApiKey:"",r=typeof e.cloudProvider=="string"?e.cloudProvider:"none";t&&r!=="none"&&r!=="custom"&&(this.settings.cloudApiKeys||(this.settings.cloudApiKeys={anthropic:"",openai:"",gemini:"",groq:"",openrouter:""}),(r==="anthropic"||r==="openai"||r==="gemini"||r==="groq"||r==="openrouter")&&(this.settings.cloudApiKeys[r]=t),await this.saveSettings())}this.settings.cloudApiKeys||(this.settings.cloudApiKeys={anthropic:"",openai:"",gemini:"",groq:"",openrouter:""})}async saveSettings(){await this.saveData(this.settings)}addStatusBarIndicator(){this.statusBarItem=this.addStatusBarItem(),this.updateStatusBarIndicator(),this.statusUpdateInterval=window.setInterval(()=>{this.updateStatusBarIndicator()},5e3)}updateStatusBarIndicator(){if(!this.statusBarItem)return;this.statusBarItem.empty();let e=zi(this.pluginContext.llmService,this.settings,this.app);this.statusBarItem.appendChild(e)}async ensureTutorialsAvailable(){try{let t=this.app.vault.adapter.basePath??this.app.vault.configDir,r=To(this.app.vault.configDir)?this.app.vault.configDir:Je(t,this.app.vault.configDir),s=Ro(Je(r,"plugins",this.manifest.id)),i=new cn(this.app,s);i.tutorialsExistInVault()||(await i.bundledTutorialsAvailable()?(h.info("Tutorials not found in vault, copying from plugin directory..."),await i.resetTutorials()):h.warn("Tutorial files not found in plugin directory. They may need to be manually restored."))}catch(e){h.warn("Error ensuring tutorials are available:",e)}}};
/*! Bundled license information:

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
