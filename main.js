/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Fp=Object.create;var fi=Object.defineProperty;var Np=Object.getOwnPropertyDescriptor;var Dp=Object.getOwnPropertyNames;var $p=Object.getPrototypeOf,Bp=Object.prototype.hasOwnProperty;var Up=(s,e)=>{for(var t in e)fi(s,t,{get:e[t],enumerable:!0})},Il=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Dp(e))!Bp.call(s,n)&&n!==t&&fi(s,n,{get:()=>e[n],enumerable:!(r=Np(e,n))||r.enumerable});return s};var qp=(s,e,t)=>(t=s!=null?Fp($p(s)):{},Il(e||!s||!s.__esModule?fi(t,"default",{value:s,enumerable:!0}):t,s)),jp=s=>Il(fi({},"__esModule",{value:!0}),s);var vg={};Up(vg,{default:()=>Fa});module.exports=jp(vg);var ve=require("obsidian");var Pe=require("obsidian");function gi(s){let e=s.trim();return e.length===0?{valid:!1,error:"Idea cannot be empty"}:e.length<3?{valid:!1,error:"Idea must be at least 3 characters"}:e.length>5e3?{valid:!1,error:"Idea must be less than 5000 characters"}:{valid:!0,sanitizedText:Hp(e)}}function Hp(s){return s.trim().replace(/\0/g,"").replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\n{3,}/g,`

`)}var h=class s{static app=null;static debugMode=!0;static debugFileChecked=!1;static debugFileExists=!1;static DEBUG_FILE_NAMES=[".ideatr-debug",".ideatr-debug.md"];static checkPromise=null;static async initialize(e,t=!0){s.app=e,s.debugMode=t,s.debugFileChecked=!1,s.debugFileExists=!1,e?.vault&&await s.checkDebugFile(e.vault),s.isDebugEnabled()&&console.debug("[Ideatr] Logger initialized in DEBUG mode"),s.logDeployTimestamp().catch(()=>{})}static async logDeployTimestamp(){try{if(!s.app?.vault)return;let t=`${s.app.vault.configDir}/plugins/ideatr/deploy-timestamp.json`;if(!await s.app.vault.adapter.exists(t)){s.debug("Deploy timestamp file not found (this is normal for first deploy)");return}let n=await s.app.vault.adapter.read(t),i=JSON.parse(n),o=i.deployedAtReadable??i.deployedAt;console.debug(`[Ideatr] Last deployed: ${o}`),s.info(`Last deployed: ${o}`)}catch(e){s.debug("Could not read deploy timestamp:",e)}}static forceRecheckDebugFile(){s.app?.vault&&(s.debugFileChecked=!1,s.debugFileExists=!1,s.checkDebugFile(s.app.vault).catch(()=>{}))}static async checkDebugFile(e){if(s.debugFileChecked&&s.checkPromise){await s.checkPromise;return}s.debugFileChecked||(s.checkPromise=(async()=>{try{for(let t of s.DEBUG_FILE_NAMES)if(await e.adapter.exists(t)){s.debugFileExists=!0,s.debugFileChecked=!0,s.checkPromise=null;return}s.debugFileExists=!1}catch{s.debugFileExists=!1}finally{s.debugFileChecked=!0,s.checkPromise=null}})(),await s.checkPromise)}static isDebugEnabled(){return s.debugMode?!0:s.debugFileExists}static debug(...e){s.isDebugEnabled()&&console.debug("[Ideatr Debug]",...e)}static info(...e){s.isDebugEnabled()&&console.debug("[Ideatr]",...e)}static warn(...e){s.isDebugEnabled()&&console.warn("[Ideatr]",...e)}static error(...e){s.isDebugEnabled()&&console.error("[Ideatr]",...e)}static log(e,...t){s.isDebugEnabled()&&console.debug(`[Ideatr:${e}]`,...t)}};function ce(s){if(!s||s.trim().length===0)return"";let t=s.split(`
`)[0].trim().substring(0,50).trim();return t=t.replace(/[^a-zA-Z0-9\s-]/g,""),t.length<3&&(t=s.substring(0,50).trim(),t=t.replace(/[^a-zA-Z0-9\s-]/g,"")),t}async function Sl(s,e){if(!e?.complete||e.isAvailable&&!e.isAvailable())return ce(s);try{let t=`Extract a concise, descriptive name or title for this idea.

Idea: "${s}"

CRITICAL REQUIREMENTS:
- Extract the CORE CONCEPT, not just the first words
- Focus on what makes this idea unique or identifiable
- Create a title that someone could use to quickly understand what this is about

Rules:
- Return ONLY the name/title (3-50 characters)
- No quotes, no explanation, no prefixes like "Title:" or "Name:"
- If the idea is a long description, extract the key concept (e.g., "AI puzzle game with monkeys" \u2192 "Monkey Puzzle Game" or "AI Monkey Puzzle")
- If the first line is already a good title, use it
- Make it descriptive but concise - should capture the essence in a few words

Examples:
- "AI generated puzzle full of interlinked monkeys that look similar, sort of a where's waldo of monkeys" \u2192 "Monkey Puzzle Game" or "AI Monkey Find"
- "notification app that sends alerts" \u2192 "Notification App" or "Alert System"
- "task manager for teams" \u2192 "Team Task Manager"

Name:`,n=(await e.complete(t,{temperature:.3,n_predict:50,stop:[`
`,".","!","?"]})).trim();return n=n.replace(/^["']|["']$/g,""),n=n.substring(0,50).trim(),n=n.replace(/[^a-zA-Z0-9\s-]/g,""),n.length<3?ce(s):n}catch(t){return h.warn("LLM name extraction failed, using rule-based fallback:",t),ce(s)}}var yi=class{generateQuery(e,t,r){if(!e||e.trim().length===0)return"";let n=e.trim(),i=this.extractKeyTerms(n),o=r??ce(e);if(o&&o.trim().length>0&&o.length>=3){let a=o.trim();i.toLowerCase().includes(a.toLowerCase())||(i=`${a} ${i}`)}if(!t)return i;switch(t){case"saas":case"tool":case"ux":return`${i} app`;case"game":case"mechanic":return`${i} game`;case"hardware":case"brand":return`${i} product`;case"story":case"ip":return`${i} book`;default:return i}}generateQueryVariations(e,t,r){if(!e||e.trim().length===0)return[];let n=e.trim(),i=this.extractKeyTerms(n),o=r??ce(e);if(o&&o.trim().length>0&&o.length>=3){let c=o.trim();i.toLowerCase().includes(c.toLowerCase())||(i=`${c} ${i}`)}let a=[];if(!t)return a.push(i),a.push(`${i} product`),a.push(`${i} service`),a;switch(t){case"saas":case"tool":case"ux":a.push(`${i} app`),a.push(`${i} software`),a.push(`${i} tool`);break;case"game":case"mechanic":a.push(`${i} game`),a.push(`${i} gameplay`),a.push(`${i} game mechanic`);break;case"hardware":case"brand":a.push(`${i} product`),a.push(`${i} hardware`),a.push(`${i} device`);break;case"story":case"ip":a.push(`${i} book`),a.push(`${i} novel`),a.push(`${i} story`);break;default:a.push(i),a.push(`${i} product`)}return a}extractKeyTerms(e){return e.split(/\s+/).filter(r=>{let n=r.toLowerCase();return!["a","an","the","is","are","was","were","to","of","in","on","at","for","with"].includes(n)}).slice(0,5).join(" ")||e.split(/\s+/).slice(0,3).join(" ")}};function Vp(s){switch(s){case"game":case"mechanic":return"game";case"story":case"ip":return"story";case"saas":case"tool":case"ux":return"app";case"hardware":case"brand":return"product";case"personal":case"":default:return"similar"}}function El(s,e,t){if(s.length===0)return[];let r=e??s.length,n=s.slice(0,r),i=t!==void 0?Vp(t):"product",o=i==="similar"?"Found similar:":`Found similar ${i}:`;return n.map(a=>{let c=[],l=a.title.length>100?a.title.substring(0,100)+"...":a.title;return c.push(`${o} ${l}`),c.push(`URL: ${a.url}`),a.date&&c.push(`Date: ${a.date}`),c.join(" | ")})}var _l=require("obsidian"),bi=class extends _l.Modal{results;onAccept;onEdit;onRetry;editedTags=[];constructor(e,t,r,n,i){super(e),this.results=t,this.onAccept=r,this.onEdit=n,this.onRetry=i,this.editedTags=[...t.tags]}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-classification-results-modal"),e.createEl("h2",{text:"Classification results"});let t=e.createEl("div",{cls:"ideatr-setting-item"});t.createEl("label",{text:"Category:",attr:{for:"ideatr-category-display"}});let r=t.createEl("div",{cls:"ideatr-category",text:this.results.category||"(none)"});this.results.category||r.addClass("ideatr-empty");let n=e.createEl("div",{cls:"ideatr-setting-item"});n.createEl("label",{text:"Tags:"});let i=n.createEl("div",{cls:"ideatr-tags-list"});if(this.editedTags.forEach((m,p)=>{let w=i.createEl("div",{cls:"ideatr-tag-item"});w.createEl("input",{attr:{type:"text",value:m,placeholder:"Tag name"},cls:"ideatr-tag-input"}).addEventListener("input",I=>{let A=I.target;this.editedTags[p]=A.value.trim()}),w.createEl("button",{text:"\xD7",cls:"ideatr-remove-tag"}).addEventListener("click",()=>{this.editedTags.splice(p,1),this.renderTags(i)})}),i.createEl("button",{text:"+ add tag",cls:"ideatr-add-tag"}).addEventListener("click",()=>{this.editedTags.push(""),this.renderTags(i)}),this.results.confidence!==void 0){let m=e.createEl("div",{cls:"ideatr-setting-item"});m.createEl("label",{text:"Confidence:"}),m.createEl("div",{cls:"ideatr-confidence-bar"}).createEl("div",{cls:"ideatr-confidence-fill",attr:{style:`width: ${(this.results.confidence*100).toFixed(0)}%`}}),m.createEl("span",{cls:"ideatr-confidence-text",text:`${(this.results.confidence*100).toFixed(0)}%`})}let a=e.createEl("div",{cls:"ideatr-button-container"});a.createEl("button",{text:"Accept",cls:"mod-cta"}).addEventListener("click",()=>void this.handleAccept()),a.createEl("button",{text:"Edit in note"}).addEventListener("click",()=>void this.handleEdit()),a.createEl("button",{text:"Retry"}).addEventListener("click",()=>void this.handleRetry()),a.createEl("button",{text:"Cancel",cls:"mod-cancel"}).addEventListener("click",()=>this.close())}renderTags(e){e.empty(),this.editedTags.forEach((r,n)=>{let i=e.createEl("div",{cls:"ideatr-tag-item"});i.createEl("input",{attr:{type:"text",value:r,placeholder:"Tag name"},cls:"ideatr-tag-input"}).addEventListener("input",c=>{let l=c.target;this.editedTags[n]=l.value.trim()}),i.createEl("button",{text:"\xD7",cls:"ideatr-remove-tag"}).addEventListener("click",()=>{this.editedTags.splice(n,1),this.renderTags(e)})}),e.createEl("button",{text:"+ Add Tag",cls:"ideatr-add-tag"}).addEventListener("click",()=>{this.editedTags.push(""),this.renderTags(e)})}handleAccept(){let e=this.editedTags.filter(r=>r.trim().length>0),t={...this.results,tags:e};this.onAccept(t),this.close()}handleEdit(){this.close(),this.onEdit()}handleRetry(){this.close(),this.onRetry()}onClose(){let{contentEl:e}=this;e.empty()}};var en=require("obsidian"),Cl={"getting-started":{file:"01-Getting-Started.md"},"capture-workflows":{file:"02-Capture-Workflows.md"},validation:{file:"03-Validation-Guide.md"},transformation:{file:"04-Transformation-Tools.md"},lifecycle:{file:"05-Lifecycle-Management.md"},dashboard:{file:"06-Dashboard-Guide.md"},"graph-view":{file:"07-Graph-View-Guide.md"},"batch-operations":{file:"08-Batch-Operations.md"},"advanced-features":{file:"09-Advanced-Features.md"},"ideate-button":{file:"02-Capture-Workflows.md"},"save-button":{file:"02-Capture-Workflows.md"},"triage-inbox":{file:"06-Dashboard-Guide.md",anchor:"#triage-inbox"},clusters:{file:"06-Dashboard-Guide.md",anchor:"#clusters-panel"},resurfacing:{file:"06-Dashboard-Guide.md",anchor:"#resurfacing-panel"},filters:{file:"06-Dashboard-Guide.md",anchor:"#filtering"},"status-management":{file:"05-Lifecycle-Management.md",anchor:"#status-management"},"domain-checking":{file:"03-Validation-Guide.md",anchor:"#domain-checking"},"existence-search":{file:"03-Validation-Guide.md",anchor:"#existence-search"},"duplicate-detection":{file:"03-Validation-Guide.md",anchor:"#duplicate-detection"},"related-notes":{file:"03-Validation-Guide.md",anchor:"#related-notes-discovery"},"name-variants":{file:"04-Transformation-Tools.md",anchor:"#name-variants"},scaffolds:{file:"04-Transformation-Tools.md",anchor:"#scaffolds"},mutations:{file:"04-Transformation-Tools.md",anchor:"#mutations"},expansion:{file:"04-Transformation-Tools.md",anchor:"#expansion"},reorganization:{file:"04-Transformation-Tools.md",anchor:"#reorganization"},archiving:{file:"05-Lifecycle-Management.md",anchor:"#archiving-ideas"},codename:{file:"05-Lifecycle-Management.md",anchor:"#codename-generation"},"project-elevation":{file:"05-Lifecycle-Management.md",anchor:"#project-elevation"}};function Gp(s){let e=Cl[s];if(!e)return"Tutorials/00-Index.md";let t=e.anchor?`#${e.anchor.replace("#","")}`:"";return`Tutorials/${e.file}${t}`}async function Wp(s,e){let t=Gp(e),r=Cl[e],n=[t,t.replace("Tutorials/","tutorials/"),`Ideatr/${t}`,`Ideatr/${t.replace("Tutorials/","tutorials/")}`,`Ideatr/Tutorials/${r.file}`,`Ideatr/tutorials/${r.file}`];for(let o of n){let a=s.vault.getAbstractFileByPath(o);if(a&&a instanceof en.TFile){await s.workspace.openLinkText(o,"",!0);return}}let i=["Tutorials/00-Index.md","tutorials/00-Index.md","Ideatr/Tutorials/00-Index.md","Ideatr/tutorials/00-Index.md"];for(let o of i){let a=s.vault.getAbstractFileByPath(o);if(a&&a instanceof en.TFile){await s.workspace.openLinkText(a.path,"",!0);return}}new en.Notice("Tutorial file not found. Please ensure tutorials are available in your vault.")}function Ft(s,e,t){let r=document.createElement("span");return r.addClass("ideatr-help-icon"),r.setAttribute("aria-label",t??"Get help"),r.textContent="?",r.setCssProps({cursor:"pointer",display:"inline-flex","align-items":"center","justify-content":"center",width:"16px",height:"16px","border-radius":"50%","background-color":"var(--background-modifier-border)",color:"var(--text-muted)","font-size":"12px","font-weight":"bold","margin-left":"4px","vertical-align":"middle","line-height":"1"}),r.addEventListener("mouseenter",()=>{r.setCssProps({"background-color":"var(--interactive-accent)",color:"var(--text-on-accent)"})}),r.addEventListener("mouseleave",()=>{r.setCssProps({"background-color":"var(--background-modifier-border)",color:"var(--text-muted)"})}),r.addEventListener("click",n=>{n.stopPropagation(),Wp(s,e)}),t&&r.setAttribute("title",t),r}var Da=require("obsidian"),tn="ideatr-icon-purple",$a="ideatr-icon-green",Ba="ideatr-icon-yellow",Ua="ideatr-icon-red";function rn(s){return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <image href="${s}" width="24" height="24"/>
    </svg>`}function zp(s){switch(s){case"connected":return $a;case"loading":return Ba;case"not-connected":case"error":return Ua;default:return tn}}function Rl(s){let e=document.createElement("span");return s&&(e.className=s),(0,Da.setIcon)(e,tn),e}function Pl(s,e){let t=document.createElement("span");return e&&(t.className=e),(0,Da.setIcon)(t,zp(s)),t}function Kp(s,e){return s?s.isAvailable()?Jp(e):{status:"not-connected",modelName:"AI not available",provider:"none",details:"AI service is not configured or enabled"}:{status:"not-connected",modelName:"No AI configured",provider:"none",details:"Please configure AI in settings"}}function Jp(s){if(s.cloudProvider==="none")return{status:"not-connected",modelName:"Cloud AI not configured",provider:"cloud",details:"Please configure cloud AI in settings"};if(!(s.cloudProvider==="custom"?s.customEndpointUrl&&s.customEndpointUrl.trim().length>0:s.cloudProvider==="custom-model"?s.customModelProvider&&s.cloudApiKeys&&s.customModelProvider in s.cloudApiKeys&&(s.cloudApiKeys[s.customModelProvider]??"").trim().length>0:s.cloudApiKeys&&s.cloudProvider in s.cloudApiKeys&&(s.cloudApiKeys[s.cloudProvider]??"").trim().length>0))return{status:"not-connected",modelName:"Cloud AI not configured",provider:"cloud",details:"Please configure cloud AI in settings"};let t=s.cloudProvider;return s.cloudProvider==="openrouter"&&s.openRouterModel?t=`OpenRouter: ${s.openRouterModel}`:s.cloudProvider==="custom"&&s.customEndpointUrl?t=`Custom: ${s.customEndpointUrl}`:s.cloudProvider==="custom-model"&&s.customModelProvider&&s.customModel&&(t=`${s.customModelProvider}: ${s.customModel}`),{status:"connected",modelName:t.charAt(0).toUpperCase()+t.slice(1),provider:"cloud",details:"Cloud AI ready"}}function wi(s,e,t){let r=Kp(s,e),n=document.createElement("div");n.className="ideatr-model-status-indicator";let i=Pl(r.status,`ideatr-model-status-icon ideatr-model-status-${r.status}`);n.appendChild(i);let o=document.createElement("div");return o.className="ideatr-model-status-tooltip",o.textContent=`${r.modelName}${r.details?` - ${r.details}`:""}`,n.appendChild(o),n.setAttribute("title",`${r.modelName}${r.details?` - ${r.details}`:""}`),n}var it=class{ideaRepository;pathToIdCache=null;idToPathCache=null;idToTitleCache=null;constructor(e){this.ideaRepository=e}async buildCache(){if(!(this.pathToIdCache&&this.idToPathCache&&this.idToTitleCache)){this.pathToIdCache=new Map,this.idToPathCache=new Map,this.idToTitleCache=new Map;try{let e=await this.ideaRepository.getAllIdeas();for(let t of e){let r=`Ideas/${t.filename}`;if(t.frontmatter.id&&t.frontmatter.id!==0){this.pathToIdCache.set(r,t.frontmatter.id),this.idToPathCache.set(t.frontmatter.id,r);let n=t.filename.replace(/\.md$/,"");this.idToTitleCache.set(t.frontmatter.id,n)}}}catch(e){h.warn("Failed to build path-to-ID cache:",e)}}}async pathsToIds(e){await this.buildCache();let t=[];for(let r of e){let n=this.pathToIdCache?.get(r);n?t.push(n):h.warn(`Could not find ID for path: ${r}`)}return t}async idsToPaths(e){await this.buildCache();let t=[];for(let r of e){let n=this.idToPathCache?.get(r);n?t.push(n):h.warn(`Could not find path for ID: ${r}`)}return t}async idToTitle(e){return await this.buildCache(),this.idToTitleCache?.get(e)??null}async idsToTitles(e){await this.buildCache();let t=new Map;for(let r of e){let n=this.idToTitleCache?.get(r);n&&t.set(r,n)}return t}clearCache(){this.pathToIdCache=null,this.idToPathCache=null,this.idToTitleCache=null}};function kl(s){return s.split("+").map(e=>{let t=e.trim().toLowerCase();return t==="cmd"||t==="meta"?"\u2318":t==="ctrl"?"\u2303":t==="alt"?"\u2325":t==="shift"?"\u21E7":t.charAt(0).toUpperCase()+t.slice(1)}).join(" ")}function Tl(s,e){let t=e.toLowerCase().split("+").map(l=>l.trim()),r=s.key.toLowerCase(),n=t.includes("cmd")||t.includes("meta"),i=t.includes("ctrl"),o=t.includes("alt"),a=t.includes("shift");if(n&&!s.metaKey||i&&!s.ctrlKey||o&&!s.altKey||a&&!s.shiftKey||!n&&s.metaKey||!i&&s.ctrlKey||!o&&s.altKey||!a&&s.shiftKey)return!1;let c=t.find(l=>!["cmd","meta","ctrl","alt","shift"].includes(l));if(c){if(c==="enter"&&r!=="enter"||c==="space"&&r!==" "||c==="escape"&&r!=="escape")return!1;if(c!=="enter"&&c!=="space"&&c!=="escape"){let l=r.toLowerCase(),d=c.toLowerCase();if(l!==d)return!1}}else return!1;return!0}var Er=class extends Pe.Modal{inputEl;errorEl;classificationEl;saveButton;ideateButton;fileManager;classificationService;duplicateDetector;webSearchService;searchQueryGenerator;nameVariantService;llmService;settings;ideaRepository;idConverter;onSuccess;isWarningShown=!1;duplicatePaths=[];classificationAbortController=null;isFirstClassification=!0;constructor(e,t,r,n,i,o,a,c,l,d,u){super(e),this.fileManager=t,this.classificationService=r,this.duplicateDetector=n,this.webSearchService=a,this.searchQueryGenerator=new yi,this.nameVariantService=c,this.llmService=l,this.settings=i,this.ideaRepository=d,this.idConverter=new it(this.ideaRepository),this.onSuccess=u}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-capture-modal");let t=e.createDiv({cls:"ideatr-capture-title-container"});t.createEl("h2",{text:"Capture idea"});let r=wi(this.llmService,this.settings,this.app);t.appendChild(r),this.inputEl=e.createEl("textarea",{attr:{placeholder:"Type your idea here...",rows:"6"}}),this.inputEl.addClass("ideatr-input"),this.errorEl=e.createEl("div",{cls:"ideatr-error ideatr-hidden"}),this.classificationEl=e.createEl("div",{cls:"ideatr-classification ideatr-hidden"});let n=e.createEl("div",{cls:"ideatr-button-container"}),o=n.createEl("div",{cls:"ideatr-help-text"}).createEl("p",{attr:{style:"font-size: 0.85em; color: var(--text-muted); margin: 0; display: flex; align-items: center; gap: 0.4em;"}}),a=Rl();a.addClass("ideatr-icon-muted"),o.appendChild(a),o.appendText(' Tip: Access other Ideatr features via Command Palette (search "Ideatr")');let c=n.createEl("div",{cls:"ideatr-button-group"});!this.settings.setupCompleted&&!this.classificationService.isAvailable()&&c.createEl("button",{text:"Classify now",cls:"mod-cta"}).addEventListener("click",()=>void this.handleClassifyNow());let l=c.createDiv({cls:"ideatr-button-with-help"}),d=this.llmService?.isAvailable()??!1;if(this.ideateButton=l.createEl("button",{text:"Ideate",cls:"mod-cta ideatr-ideate-button"}),!d)this.ideateButton.disabled=!0,this.ideateButton.addClass("ideatr-ideate-button-disabled"),this.ideateButton.setAttribute("title","Ideate (AI service not available. Please configure AI in settings.)");else{let v=kl(this.settings.captureIdeateShortcut||"cmd+enter");this.ideateButton.setAttribute("title",`Ideate (${v})`),this.ideateButton.addEventListener("click",()=>void this.handleIdeate())}let u=Ft(this.app,"ideate-button","Learn about the Ideate button");l.appendChild(u);let m=c.createDiv({cls:"ideatr-button-with-help"});this.saveButton=m.createEl("button",{text:"Save",cls:"mod-cta"});let p=kl(this.settings.captureSaveShortcut||"alt+enter");this.saveButton.setAttribute("title",`Save (${p})`),this.saveButton.addEventListener("click",()=>void this.handleSubmit());let w=Ft(this.app,"save-button","Learn about the Save button");m.appendChild(w),this.inputEl.focus(),this.inputEl.addEventListener("keydown",v=>{let _=this.settings.captureIdeateShortcut||"cmd+enter";if(Tl(v,_)){v.preventDefault(),this.llmService?.isAvailable()&&this.ideateButton&&!this.ideateButton.disabled&&this.handleIdeate();return}let I=this.settings.captureSaveShortcut||"alt+enter";if(Tl(v,I)){v.preventDefault(),this.handleSubmit();return}this.isWarningShown&&(this.hideError(),this.isWarningShown=!1,this.saveButton.setText("Save"),this.ideateButton&&(this.ideateButton.textContent="Ideate"))})}async handleClassifyNow(){let e=this.inputEl.value,t=gi(e);if(!t.valid){this.showError(t.error??"Invalid input");return}this.classificationAbortController=new AbortController,this.showClassificationInProgress(this.isFirstClassification),this.isFirstClassification=!1;try{let r=await this.classificationService.classifyIdea(t.sanitizedText??e);if(this.classificationAbortController?.signal.aborted)return;this.showClassificationResults(r,null)}catch(r){if(this.classificationAbortController?.signal.aborted)return;console.error("Classification failed:",r),this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden");let n="Classification unavailable. Please configure AI in settings.";if(r instanceof Error){let o=r.message.toLowerCase();o.includes("invalid api key")||o.includes("unauthorized")?n="Invalid API key. Please check your AI settings.":o.includes("rate limit")?n="Rate limit exceeded. Please try again later.":(o.includes("connection_refused")||o.includes("server not available"))&&(n="AI server not available. Please configure AI in settings.")}this.classificationEl.createEl("p",{text:n,cls:"ideatr-classification-error"}),this.classificationEl.createEl("button",{text:"Retry",cls:"mod-cta"}).addEventListener("click",()=>{this.handleClassifyNow()})}}async handleSubmit(){let e=this.inputEl.value,t=gi(e);if(!t.valid){this.showError(t.error??"Invalid input");return}if(!this.isWarningShown)try{let r=await this.duplicateDetector.checkDuplicate(e);if(r.isDuplicate){let n=r.duplicates.length,i=`Found ${n} similar idea${n>1?"s":""}. Press Save again to confirm.`;this.showError(i,!0),this.isWarningShown=!0,this.duplicatePaths=r.duplicates.map(o=>o.path),this.saveButton.textContent="Save anyway";return}}catch(r){h.warn("Duplicate check failed:",r)}try{let r={text:t.sanitizedText??e,timestamp:new Date},n=await this.fileManager.createIdeaFile(r);new Pe.Notice("Idea captured!"),this.close(),this.onSuccess&&this.onSuccess(),this.processBackgroundTasks(n,r.text).catch(i=>{h.warn("Background processing failed:",i)})}catch(r){this.showError("Failed to save idea. Please try again."),console.error("Error creating idea file:",r)}}async handleIdeate(){let e=this.inputEl.value,t=gi(e);if(!t.valid){this.showError(t.error??"Invalid input");return}if(!this.llmService?.isAvailable()){this.showError("AI service is not available. Please configure AI in settings.");return}if(!this.isWarningShown)try{let n=await this.duplicateDetector.checkDuplicate(e);if(n.isDuplicate){let i=n.duplicates.length,o=`Found ${i} similar idea${i>1?"s":""}. Press Ideate again to confirm.`;this.showError(o,!0),this.isWarningShown=!0,this.duplicatePaths=n.duplicates.map(a=>a.path),this.ideateButton&&(this.ideateButton.textContent="Ideate anyway");return}}catch(n){h.warn("Duplicate check failed:",n)}let r=null;try{this.showClassificationInProgress(!0),this.classificationAbortController=new AbortController;let n={text:t.sanitizedText??e,timestamp:new Date};r=await this.fileManager.createIdeaFile(n);let i=await this.classificationService.classifyIdea(n.text);if(this.classificationAbortController?.signal.aborted)return;let o="";if(this.llmService.complete)try{let d=`Generate a concise, descriptive title for this idea.

Idea: "${n.text}"

Requirements:
- 2-8 words maximum
- Descriptive and clear (captures the core concept)
- Not overly creative or abstract
- Should help someone quickly understand what this idea is about
- Extract the key concept, not just use the first words

Examples:
- "AI generated puzzle full of interlinked monkeys" \u2192 "AI Monkey Puzzle Game"
- "notification app that sends alerts" \u2192 "Notification App"
- "task manager for remote teams" \u2192 "Team Task Manager"

Title:`;o=(await this.llmService.complete(d,{temperature:.3,n_predict:50,stop:[`
`,".","!","?"]})).trim().replace(/^["']|["']$/g,"").substring(0,100)}catch(d){h.warn("Title generation failed, using fallback:",d),o=ce(n.text)}else o=ce(n.text);let a="";if(this.llmService.expandIdea)try{let d=`Expand this idea with related concepts, questions, and next steps.

Original Idea:
${n.text}

Category: ${i.category||"general"}
Tags: ${i.tags.join(", ")||"none"}

Generate a structured expansion with:

## Related Ideas
2-3 variations or related concepts that explore different angles or implementations. Each should be:
- Distinct from the original but clearly related
- Brief (1-2 sentences each)
- Practical and actionable

## Key Questions
3-4 important questions to explore. Focus on:
- Validation questions (who needs this? what problem does it solve?)
- Implementation questions (how would this work? what's needed?)
- Strategic questions (what are the risks? what's the market?)

## Next Steps
1-2 concrete, actionable next steps to move forward. Be specific and practical.

Format as markdown with the sections above. Keep it concise and actionable - each item should be brief but meaningful.

Response:`;this.llmService.complete&&(a=await this.llmService.complete(d,{temperature:.7,n_predict:800}))}catch(d){h.warn("Expansion generation failed:",d),a=""}if(this.classificationAbortController?.signal.aborted)return;let c=[...new Set([...i.related,...this.duplicatePaths])],l=await this.idConverter.pathsToIds(c);await this.fileManager.updateIdeaFrontmatter(r,{category:i.category,tags:i.tags,related:l}),await this.app.vault.process(r,d=>{let u=/^---\n[\s\S]*?\n---(\n\n?|\n?)/,m=d.match(u),p=m?d.substring(m[0].length):d,w="";return o&&(w+=`# ${o}

`),w+=p.trim(),a&&(w+=`

---

## Ideas & Questions

`+a.trim()),(m?d.substring(0,m[0].length):"")+w}),this.triggerValidation(r,n.text,i.category).catch(d=>{h.warn("Background validation failed:",d)}),new Pe.Notice("Idea processed with AI!"),this.close(),this.onSuccess&&this.onSuccess()}catch(n){if(this.classificationAbortController?.signal.aborted)return;r&&new Pe.Notice("Ideate command failed, but your idea has been saved to your list of ideas."),this.showError("Failed to process idea. Please try again."),console.error("Error processing idea:",n),this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden"),this.classificationEl.createEl("p",{text:"Processing failed. Idea may have been saved without AI processing.",cls:"ideatr-classification-error"}),this.classificationEl.createEl("button",{text:"Continue",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.onSuccess&&this.onSuccess()})}}showError(e,t=!1){this.errorEl.empty(),this.errorEl.setText(e),this.errorEl.addClass("ideatr-visible"),this.errorEl.removeClass("ideatr-hidden","ideatr-invisible"),t?(this.errorEl.addClass("ideatr-warning"),this.errorEl.removeClass("ideatr-error")):(this.errorEl.addClass("ideatr-error"),this.errorEl.removeClass("ideatr-warning"))}hideError(){this.errorEl.addClass("ideatr-hidden","ideatr-invisible"),this.errorEl.removeClass("ideatr-visible"),this.errorEl.removeClass("ideatr-warning"),this.errorEl.removeClass("ideatr-error")}showClassificationInProgress(e=!1){this.inputEl.addClass("ideatr-hidden"),this.inputEl.removeClass("ideatr-visible");let t=this.contentEl.querySelector(".ideatr-button-container");t&&(t.addClass("ideatr-hidden"),t.removeClass("ideatr-visible")),this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden");let r=e?"Loading AI model (first use)... ~10 seconds":"Classifying idea... ~2-3 seconds";this.classificationEl.createEl("p",{text:r}).addClass("ideatr-classification-status"),this.classificationEl.createEl("button",{text:"Cancel",cls:"ideatr-cancel-classification"}).addEventListener("click",()=>{this.cancelClassification()})}cancelClassification(){this.classificationAbortController&&(this.classificationAbortController.abort(),this.classificationAbortController=null),this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden"),this.classificationEl.createEl("p",{text:"Classification cancelled. Idea saved without classification.",cls:"ideatr-classification-status"}),this.classificationEl.createEl("button",{text:"Continue",cls:"mod-cta"}).addEventListener("click",()=>{this.close(),this.onSuccess&&this.onSuccess()})}handleClassificationError(e,t,r){let n="Classification unavailable. Idea saved without classification.",i=!0;if(e instanceof Error){let o=e.message.toLowerCase();o.includes("connection_refused")||o.includes("server not available")?n="AI server not available. Idea saved without classification.":o.includes("invalid api key")||o.includes("unauthorized")?(n="Invalid API key. Please check your AI settings. Idea saved without classification.",i=!0):o.includes("rate limit")?n="Rate limit exceeded. Please try again later. Idea saved without classification.":o.includes("timeout")?n="Classification timed out. Idea saved without classification.":(o.includes("network")||o.includes("fetch"))&&(n="Network error. Idea saved without classification.")}this.classificationEl.empty(),this.classificationEl.addClass("ideatr-visible"),this.classificationEl.removeClass("ideatr-hidden"),this.classificationEl.createEl("p",{text:n,cls:"ideatr-classification-error"}),i?this.classificationEl.createEl("button",{text:"Continue",cls:"mod-cta"}).addEventListener("click",()=>{this.triggerValidation(t,r,"").catch(a=>{h.warn("Background validation failed:",a)}),this.close(),this.onSuccess&&this.onSuccess()}):setTimeout(()=>{this.triggerValidation(t,r,"").catch(o=>{h.warn("Background validation failed:",o)}),this.close(),this.onSuccess&&this.onSuccess()},2e3)}showClassificationResults(e,t){let r={category:e.category,tags:e.tags},n=[...e.related],i=[...this.duplicatePaths],o=new bi(this.app,r,a=>{(async()=>{let c=[...new Set([...n,...i])],l={category:a.category,tags:a.tags,related:c};t?await this.acceptClassification(l,t):(new Pe.Notice("Classification complete. Save the idea to apply results."),o.close())})()},()=>{(async()=>{let a=[...new Set([...n,...i])],c={category:r.category,tags:r.tags,related:a};t?await this.acceptClassification(c,t):(new Pe.Notice("Classification complete. Save the idea to apply results."),o.close())})()},()=>{(async()=>{try{let a=this.inputEl.value,c=await this.classificationService.classifyIdea(a);o.close(),this.showClassificationResults(c,t)}catch(a){console.error("Retry classification failed:",a),new Pe.Notice("Failed to retry classification. Please try again.")}})()});o.open()}async acceptClassification(e,t){if(!t)return;let r=[...new Set([...e.related,...this.duplicatePaths])],n=await this.idConverter.pathsToIds(r);await this.fileManager.updateIdeaFrontmatter(t,{category:e.category,tags:e.tags,related:n}),new Pe.Notice("Classification applied"),this.close(),this.onSuccess&&this.onSuccess()}rejectClassification(){this.close(),this.onSuccess&&this.onSuccess()}async processBackgroundTasks(e,t){let r="";if(this.settings.autoClassify&&this.classificationService.isAvailable())try{let n=await this.classificationService.classifyIdea(t);r=n.category;let i=[...new Set([...n.related,...this.duplicatePaths])],o=await this.idConverter.pathsToIds(i);await this.fileManager.updateIdeaFrontmatter(e,{category:n.category,tags:n.tags,related:o})}catch(n){h.warn("Background classification failed:",n)}await this.triggerValidation(e,t,r)}async triggerValidation(e,t,r){let n=ce(t),i=this.settings.enableWebSearch&&this.settings.autoSearchExistence,o=this.settings.enableNameVariants&&this.settings.autoGenerateVariants&&this.nameVariantService?.isAvailable();if(!i&&!o)return;let a=i?this.performWebSearch(t,r,n).catch(l=>(h.warn("Web search failed:",l),null)):Promise.resolve(null),c=o&&this.nameVariantService?this.nameVariantService.generateVariants(t).then(l=>{if(l.length>0){let d=this.nameVariantService.formatVariantsForMarkdown(l);return this.fileManager.appendToFileBody(e,"Name Variants",d)}return Promise.resolve()}).catch(l=>{h.warn("Name variant generation failed:",l)}):Promise.resolve(null);try{let[l]=await Promise.all([a,c]),d={};i&&(l===null?d["existence-check"]=["Search error: Validation failed"]:l.length>0&&(d["existence-check"]=El(l,this.settings.maxSearchResults,r))),Object.keys(d).length>0&&await this.fileManager.updateIdeaFrontmatter(e,d)}catch(l){h.warn("Validation orchestration failed:",l);let d={};i&&(d["existence-check"]=["Search error: Validation failed"]),Object.keys(d).length>0&&this.fileManager.updateIdeaFrontmatter(e,d).catch(u=>{h.error("Failed to store validation error state:",u)})}}async performWebSearch(e,t,r){if(!this.webSearchService.isAvailable())return[];try{let n=this.searchQueryGenerator.generateQuery(e,t,r);return!n||n.trim().length===0?[]:await this.webSearchService.search(n,t,this.settings.maxSearchResults)}catch(n){return h.warn("Web search failed:",n),[]}}onClose(){let{contentEl:e}=this;e.empty()}};var Ks=require("obsidian");var pe=require("obsidian");var Ae=class{constructor(e,t,r){this.app=e;this.plugin=t;this.settingsTab=r}settingsTab;async saveSettings(){await this.plugin.saveSettings()}refresh(){this.settingsTab?.display&&this.settingsTab.display()}};var _r=require("obsidian"),Cr=class extends _r.Modal{settings;onComplete;constructor(e,t,r,n){super(e),this.settings=r,this.onComplete=n}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-setup-modal"),e.createEl("h2",{text:"Manage AI models"}),e.createEl("p",{text:"Choose how you want to use AI for idea enhancement:",cls:"ideatr-setup-description"});let t=e.createEl("div",{cls:"ideatr-setup-option"});t.createEl("h3",{text:"Use my API key"}),t.createEl("p",{text:"Use a cloud AI provider (Anthropic, OpenAI, etc.) for better quality and faster responses."});let r=t.createEl("ul",{cls:"ideatr-setup-features"});r.createEl("li",{text:"\u2705 better quality results"}),r.createEl("li",{text:"\u2705 faster responses"}),r.createEl("li",{text:"\u2705 no local storage needed"}),r.createEl("li",{text:"\u26A0\uFE0F requires API key (paid)"}),t.createEl("button",{text:"Enter API key",cls:"mod-cta"}).addEventListener("click",()=>void this.handleApiKeyOption());let i=e.createEl("div",{cls:"ideatr-setup-option"});i.createEl("h3",{text:"Skip for now"}),i.createEl("p",{text:"Continue without AI. You can set up AI later in settings."}),i.createEl("button",{text:"Skip setup",cls:"mod-cancel"}).addEventListener("click",()=>void this.handleSkipOption())}handleApiKeyOption(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-setup-modal"),e.createEl("h2",{text:"Enter API key"}),e.createEl("p",{text:"Enter your API key for a cloud AI provider. You can configure this later in settings.",cls:"ideatr-setup-description"});let t=e.createEl("div",{cls:"ideatr-setting-item"});t.createEl("label",{text:"Provider:",attr:{for:"ideatr-provider-select"}});let r=t.createEl("select",{attr:{id:"ideatr-provider-select"}});r.createEl("option",{text:"Anthropic (Claude)",attr:{value:"anthropic"}}),r.createEl("option",{text:"OpenAI (GPT)",attr:{value:"openai"}}),r.createEl("option",{text:"Skip for now",attr:{value:"none"}});let n=e.createEl("div",{cls:"ideatr-setting-item"});n.createEl("label",{text:"API key:",attr:{for:"ideatr-api-key-input"}});let i=n.createEl("input",{attr:{id:"ideatr-api-key-input",type:"password",placeholder:"Enter your API key"}});e.createEl("p",{text:"Note: API keys are stored in plain text in Obsidian settings. Keep your vault secure.",cls:"ideatr-help-text"});let o=e.createEl("div",{cls:"ideatr-button-container"});o.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",()=>{let d=r.value,u=i.value;if(d==="none"){this.handleSkipOption();return}if(!u.trim()){new _r.Notice("Please enter an API key");return}this.handleApiKeySubmit(u,d)}),o.createEl("button",{text:"Back"}).addEventListener("click",()=>{this.onOpen()}),o.createEl("button",{text:"Cancel",cls:"mod-cancel"}).addEventListener("click",()=>{this.handleSkipOption()})}handleApiKeySubmit(e,t){this.settings.cloudApiKeys||(this.settings.cloudApiKeys={anthropic:"",openai:"",gemini:"",groq:"",openrouter:""}),this.settings.cloudApiKeys[t]=e,this.settings.cloudProvider=t,this.settings.preferCloud=!0,this.settings.llmProvider=t,this.settings.setupCompleted=!0,new _r.Notice("API key saved. Cloud AI setup complete!"),this.onComplete(),this.close()}handleSkipOption(){this.settings.setupCompleted=!0,this.settings.llmProvider="none",this.onComplete(),this.close(),new _r.Notice("Setup skipped. You can configure AI later in settings.")}onClose(){let{contentEl:e}=this;e.empty()}};function Ml(s){let e=s.cloudApiKeys&&Object.values(s.cloudApiKeys).some(r=>r&&r.length>0),t=s.cloudApiKey&&s.cloudApiKey.length>0;return!s.setupCompleted&&!s.modelDownloaded&&!e&&!t}var Nt={"phi-3.5-mini":{name:"Phi-3.5 Mini",badge:"EFFICIENT",description:"Lightweight model for quick responses",sizeMB:4200,ram:"6-8GB",quality:4,speed:5},"qwen-2.5-7b":{name:"Qwen 2.5 7B",badge:"VERSATILE",description:"Versatile model with better quality",sizeMB:7800,ram:"10GB",quality:4.5,speed:4},"llama-3.1-8b":{name:"Llama 3.1 8B",badge:"RELIABLE",description:"Reliable model with strong performance",sizeMB:8500,ram:"10-12GB",quality:4.5,speed:3},"llama-3.3-70b":{name:"Llama 3.3 70B",badge:"MAXIMUM",description:"Maximum quality for powerful hardware",sizeMB:42500,ram:"48GB+",quality:5,speed:1}},sn=class{modelKey;constructor(e){this.modelKey=e||"phi-3.5-mini"}getModelConfig(){return Nt[this.modelKey]||Nt["phi-3.5-mini"]}getModelInfo(){let e=this.getModelConfig();return{name:e.name,sizeMB:e.sizeMB}}getModelPath(){return""}async isModelDownloaded(){return!1}async verifyModelIntegrity(){return!1}async downloadModel(e,t,r){throw new Error("Model downloads are not available in MVP version")}cancelDownload(){}async deleteModel(){throw new Error("Model management is not available in MVP version")}};var nn=require("obsidian");function Ol(){return nn.Platform.isMacOS?"darwin":nn.Platform.isWin?"win32":nn.Platform.isLinux?"linux":"unknown"}function Ll(){return nn.Platform.isMacOS?"arm64":"x64"}function Fl(){return{totalRAMGB:0,availableRAMGB:0,platform:Ol(),arch:Ll()}}function Xp(s){let e=s.match(/(\d+)/);return e?parseInt(e[1],10):0}function Nl(s,e){let t=Nt[s];if(!t)return h.warn(`Unknown model key: ${s}`),{isCompatible:!0};let r=e??Fl(),n=Xp(t.ram??"0GB"),i=r.totalRAMGB;if(i===0)return{isCompatible:!0,warning:`This model requires ${t.ram} RAM. Please ensure your system meets this requirement.`,recommendation:"Check your system's available RAM before downloading large models."};if(n>i)return{isCompatible:!1,warning:`This model requires ${t.ram??"unknown"} RAM, but your system has ${i.toFixed(1)}GB total RAM. The model may fail to load.`,recommendation:'Consider using a smaller model like "Phi-3.5 Mini" (requires 6-8GB RAM) instead.'};if(n>i*.8){let a=`This model requires ${t.ram??"unknown"} RAM. Your system has ${i.toFixed(1)}GB total RAM. The model may struggle or fail to load if other applications are using memory.`,c=`Ensure you have at least ${n}GB free RAM before loading this model.`;return{isCompatible:!0,warning:a,recommendation:c}}return{isCompatible:!0}}function qa(){let s=Fl();return s.totalRAMGB>0?`System: ${s.platform} ${s.arch}, ${s.totalRAMGB.toFixed(1)}GB total RAM`:`System: ${s.platform} ${s.arch}`}var Dl=require("obsidian"),ja=class extends Dl.Modal{message;resolve;constructor(e,t,r){super(e),this.message=t,this.resolve=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Confirm"}),e.createEl("p",{text:this.message});let t=e.createDiv({cls:"modal-button-container"}),r=t.createEl("button",{text:"Confirm",cls:"mod-cta"});r.onclick=()=>{this.resolve(!0),this.close()};let n=t.createEl("button",{text:"Cancel"});n.onclick=()=>{this.resolve(!1),this.close()}}onClose(){let{contentEl:e}=this;e.empty(),this.resolve(!1)}};async function $l(s,e){return new Promise(t=>{new ja(s,e,t).open()})}function Bl(s=14){let e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("xmlns",e),t.setAttribute("width",String(s)),t.setAttribute("height",String(s)),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round");let r=document.createElementNS(e,"path");return r.setAttribute("d","M20 6L9 17l-5-5"),t.appendChild(r),t}function Ul(s=16){let e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("xmlns",e),t.setAttribute("width",String(s)),t.setAttribute("height",String(s)),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round");let r=document.createElementNS(e,"circle");r.setAttribute("cx","12"),r.setAttribute("cy","12"),r.setAttribute("r","10"),t.appendChild(r);let n=document.createElementNS(e,"line");n.setAttribute("x1","12"),n.setAttribute("y1","8"),n.setAttribute("x2","12"),n.setAttribute("y2","12"),t.appendChild(n);let i=document.createElementNS(e,"line");return i.setAttribute("x1","12"),i.setAttribute("y1","16"),i.setAttribute("x2","12.01"),i.setAttribute("y2","16"),t.appendChild(i),t}var vi=class extends Ae{async getDownloadedModels(){let e=[],t=Object.keys(Nt);for(let r of t){let n=sn;await new n(r).isModelDownloaded()&&e.push(r)}return e}display(e){let t=e.createDiv({cls:"settings-section-title"});t.createEl("h2",{text:"AI configuration"});let r=Ft(this.app,"getting-started","Learn about AI configuration");t.appendChild(r);let n=e.createDiv({cls:"ideatr-local-ai-warning"});if(n.setCssProps({background:"var(--background-modifier-border)",padding:"1em","border-radius":"4px","margin-bottom":"1.5em","border-left":"3px solid var(--text-warning)"}),n.createEl("strong",{text:"\u26A0\uFE0F Local AI version - no updates",attr:{style:"display: block; margin-bottom: 0.5em; color: var(--text-warning);"}}),n.createEl("p",{text:"This version includes local AI but will not receive updates. Watch for the upcoming Ideatr desktop app for local AI with ongoing support.",attr:{style:"margin: 0.5em 0; line-height: 1.5;"}}),n.createEl("a",{text:"Learn more about desktop app \u2192",href:"https://ideatr.app/desktop",attr:{style:"color: var(--text-accent); text-decoration: none;",target:"_blank"}}),new pe.Setting(e).setName("Local AI").setDesc("Use local AI model for idea enhancement (offline, free)").addToggle(i=>i.setValue(this.plugin.settings.llmProvider==="llama").onChange(async o=>{this.plugin.settings.llmProvider=o?"llama":"none",await this.saveSettings(),this.refresh()})),this.plugin.settings.llmProvider==="llama"){new pe.Setting(e).setName("Local AI model").setDesc('Select which downloaded model to use. Use "Manage AI models" to download new models or see all available options.').addDropdown(l=>{l.addOption("loading","loading..."),l.setValue("loading"),l.setDisabled(!0),(async()=>{let d=await this.getDownloadedModels(),u=l.selectEl;for(;u.firstChild;)u.removeChild(u.firstChild);if(d.length===0)l.addOption("none","No models downloaded"),l.setValue("none"),l.setDisabled(!0),new pe.Notice('No models downloaded. Use "Manage AI models" to download a model.',5e3);else{for(let w of d){let v=Nt[w];if(v){let _=`${v.name} [${v.badge}] (~${(v.sizeMB/1e3).toFixed(1)}GB, ${v.ram??"unknown"} RAM)`;l.addOption(w,_)}}let m=this.plugin.settings.localModel||"phi-3.5-mini",p=d.includes(m)?m:d[0];l.setValue(p),l.setDisabled(!1),p!==m&&(this.plugin.settings.localModel=p,this.saveSettings())}})(),l.onChange(async d=>{if(d==="none"||d==="loading")return;let u=d,m=Nl(u);if(m.isCompatible){if(m.warning){let p=qa();new pe.Notice(`${m.warning} ${p}`,8e3)}}else{let p=qa(),w=`${m.warning}

${m.recommendation??""}

${p}

Do you want to proceed anyway?`;if(!await $l(this.app,w)){let _=await this.getDownloadedModels(),I=_.includes(this.plugin.settings.localModel||"phi-3.5-mini")?this.plugin.settings.localModel||"phi-3.5-mini":_[0];l.setValue(I);return}}this.plugin.settings.localModel=u,await this.saveSettings(),this.refresh()})});let i=sn,o=new i(this.plugin.settings.localModel||"phi-3.5-mini"),a=o.getModelConfig();new pe.Setting(e).setName("Model information").setDesc(`${a.description}
Size: ${(a.sizeMB/1e3).toFixed(1)}GB | RAM: ${a.ram??"unknown"} | Quality: ${a.quality}/5 | Speed: ${a.speed}/5`).setDisabled(!0);let c=new pe.Setting(e).setName("Model status").setDisabled(!0);(async()=>{let l=o,d=await l.isModelDownloaded(),u=d?`Model downloaded: ${a.name}`:"Model not downloaded";if(d){let m=await l.verifyModelIntegrity(),p=c.descEl;if(p){p.empty(),p.createSpan({text:u+" "});let w=p.createSpan({cls:`model-status-icon ${m?"model-status-valid":"model-status-invalid"}`,attr:{title:m?"File verified":"File verification failed"}}),v=m?Bl(14):Ul(14);w.appendChild(v)}}else c.setDesc(u)})(),new pe.Setting(e).setName("Manage AI models").setDesc("Download a new model, switch between models, or configure cloud AI providers").addButton(l=>l.setButtonText("Manage AI models").setCta().onClick(()=>{new Cr(this.app,null,this.plugin.settings,()=>{(async()=>(await this.saveSettings(),this.refresh()))()}).open()})),new pe.Setting(e).setName("Keep model loaded").setDesc("Keep the AI model loaded in memory (uses ~4GB RAM, but faster responses)").addToggle(l=>l.setValue(this.plugin.settings.keepModelLoaded).onChange(async d=>{this.plugin.settings.keepModelLoaded=d,await this.saveSettings()})),new pe.Setting(e).setName("Preload on startup").setDesc("Automatically load the AI model when Obsidian starts").addToggle(l=>l.setValue(this.plugin.settings.preloadOnStartup).onChange(async d=>{this.plugin.settings.preloadOnStartup=d,await this.saveSettings()})),new pe.Setting(e).setName("Ensure language model ready").setDesc("Manually ensure the AI model is ready now. Not needed in most cases (model auto-starts when you use AI features), but helpful if: the model stopped unexpectedly, you want to test your configuration, or you prefer to preload before using features.").addButton(l=>l.setButtonText("Ensure ready").setCta().onClick(async()=>{l.setDisabled(!0),l.setButtonText("Preparing...");try{await this.plugin.ensureLLMReady(),new pe.Notice("AI model is ready"),setTimeout(()=>{l.setDisabled(!1),l.setButtonText("Ensure ready")},2e3)}catch{new pe.Notice("Failed to prepare model. Check console for details."),l.setDisabled(!1),l.setButtonText("Ensure ready")}}))}}};var J=require("obsidian");function E(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t}function g(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)}var Ha=function(){let{crypto:s}=globalThis;if(s?.randomUUID)return Ha=s.randomUUID.bind(s),s.randomUUID();let e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function He(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}var on=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){let e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};var C=class extends Error{},ee=class s extends C{constructor(e,t,r,n){super(`${s.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.requestID=n?.get("request-id"),this.error=t}static makeMessage(e,t,r){let n=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new ot({message:r,cause:on(t)});let i=t;return e===400?new Pr(e,i,r,n):e===401?new kr(e,i,r,n):e===403?new Tr(e,i,r,n):e===404?new Mr(e,i,r,n):e===409?new Or(e,i,r,n):e===422?new Lr(e,i,r,n):e===429?new Fr(e,i,r,n):e>=500?new Nr(e,i,r,n):new s(e,i,r,n)}},ie=class extends ee{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},ot=class extends ee{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Rr=class extends ot{constructor({message:e}={}){super({message:e??"Request timed out."})}},Pr=class extends ee{},kr=class extends ee{},Tr=class extends ee{},Mr=class extends ee{},Or=class extends ee{},Lr=class extends ee{},Fr=class extends ee{},Nr=class extends ee{};var Yp=/^[a-z][a-z0-9+.-]*:/i,ql=s=>Yp.test(s),Va=s=>(Va=Array.isArray,Va(s)),Ga=Va;function Ai(s){return typeof s!="object"?{}:s??{}}function jl(s){if(!s)return!0;for(let e in s)return!1;return!0}function Hl(s,e){return Object.prototype.hasOwnProperty.call(s,e)}var Vl=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new C(`${s} must be an integer`);if(e<0)throw new C(`${s} must be a positive integer`);return e};var xi=s=>{try{return JSON.parse(s)}catch{return}};var Gl=s=>new Promise(e=>setTimeout(e,s));var at="0.71.0";var Jl=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Zp(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var em=()=>{let s=Zp();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":zl(Deno.build.os),"X-Stainless-Arch":Wl(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":zl(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Wl(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=tm();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":at,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function tm(){if(typeof navigator>"u"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let r=t.exec(navigator.userAgent);if(r){let n=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:e,version:`${n}.${i}.${o}`}}}return null}var Wl=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",zl=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),Kl,Xl=()=>Kl??(Kl=em());function Ql(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Wa(...s){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function Ii(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return Wa({start(){},async pull(t){let{done:r,value:n}=await e.next();r?t.close():t.enqueue(n)},async cancel(){await e.return?.()}})}function an(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Yl(s){if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await s[Symbol.asyncIterator]().return?.();return}let e=s.getReader(),t=e.cancel();e.releaseLock(),await t}var Zl=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function rd(s){let e=0;for(let n of s)e+=n.length;let t=new Uint8Array(e),r=0;for(let n of s)t.set(n,r),r+=n.length;return t}var ed;function cn(s){let e;return(ed??(e=new globalThis.TextEncoder,ed=e.encode.bind(e)))(s)}var td;function za(s){let e;return(td??(e=new globalThis.TextDecoder,td=e.decode.bind(e)))(s)}var me,he,Ve=class{constructor(){me.set(this,void 0),he.set(this,void 0),E(this,me,new Uint8Array,"f"),E(this,he,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?cn(e):e;E(this,me,rd([g(this,me,"f"),t]),"f");let r=[],n;for(;(n=nm(g(this,me,"f"),g(this,he,"f")))!=null;){if(n.carriage&&g(this,he,"f")==null){E(this,he,n.index,"f");continue}if(g(this,he,"f")!=null&&(n.index!==g(this,he,"f")+1||n.carriage)){r.push(za(g(this,me,"f").subarray(0,g(this,he,"f")-1))),E(this,me,g(this,me,"f").subarray(g(this,he,"f")),"f"),E(this,he,null,"f");continue}let i=g(this,he,"f")!==null?n.preceding-1:n.preceding,o=za(g(this,me,"f").subarray(0,i));r.push(o),E(this,me,g(this,me,"f").subarray(n.index),"f"),E(this,he,null,"f")}return r}flush(){return g(this,me,"f").length?this.decode(`
`):[]}};me=new WeakMap,he=new WeakMap;Ve.NEWLINE_CHARS=new Set([`
`,"\r"]);Ve.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function nm(s,e){for(let n=e??0;n<s.length;n++){if(s[n]===10)return{preceding:n,index:n+1,carriage:!1};if(s[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function sd(s){for(let r=0;r<s.length-1;r++){if(s[r]===10&&s[r+1]===10||s[r]===13&&s[r+1]===13)return r+2;if(s[r]===13&&s[r+1]===10&&r+3<s.length&&s[r+2]===13&&s[r+3]===10)return r+4}return-1}var Ei={off:0,error:200,warn:300,info:400,debug:500},Ka=(s,e,t)=>{if(s){if(Hl(Ei,s))return s;te(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(Ei))}`)}};function ln(){}function Si(s,e,t){return!e||Ei[s]>Ei[t]?ln:e[s].bind(e)}var im={error:ln,warn:ln,info:ln,debug:ln},nd=new WeakMap;function te(s){let e=s.logger,t=s.logLevel??"off";if(!e)return im;let r=nd.get(e);if(r&&r[0]===t)return r[1];let n={error:Si("error",e,t),warn:Si("warn",e,t),info:Si("info",e,t),debug:Si("debug",e,t)};return nd.set(e,[t,n]),n}var Ge=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var dn,ke=class s{constructor(e,t,r){this.iterator=e,dn.set(this,void 0),this.controller=t,E(this,dn,r,"f")}static fromSSEResponse(e,t,r){let n=!1,i=r?te(r):console;async function*o(){if(n)throw new C("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let c of om(e,t)){if(c.event==="completion")try{yield JSON.parse(c.data)}catch(l){throw i.error("Could not parse message into JSON:",c.data),i.error("From chunk:",c.raw),l}if(c.event==="message_start"||c.event==="message_delta"||c.event==="message_stop"||c.event==="content_block_start"||c.event==="content_block_delta"||c.event==="content_block_stop")try{yield JSON.parse(c.data)}catch(l){throw i.error("Could not parse message into JSON:",c.data),i.error("From chunk:",c.raw),l}if(c.event!=="ping"&&c.event==="error")throw new ee(void 0,xi(c.data)??c.data,void 0,e.headers)}a=!0}catch(c){if(He(c))return;throw c}finally{a||t.abort()}}return new s(o,t,r)}static fromReadableStream(e,t,r){let n=!1;async function*i(){let a=new Ve,c=an(e);for await(let l of c)for(let d of a.decode(l))yield d;for(let l of a.flush())yield l}async function*o(){if(n)throw new C("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let c of i())a||c&&(yield JSON.parse(c));a=!0}catch(c){if(He(c))return;throw c}finally{a||t.abort()}}return new s(o,t,r)}[(dn=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=i=>({next:()=>{if(i.length===0){let o=r.next();e.push(o),t.push(o)}return i.shift()}});return[new s(()=>n(e),this.controller,g(this,dn,"f")),new s(()=>n(t),this.controller,g(this,dn,"f"))]}toReadableStream(){let e=this,t;return Wa({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{let{value:n,done:i}=await t.next();if(i)return r.close();let o=cn(JSON.stringify(n)+`
`);r.enqueue(o)}catch(n){r.error(n)}},async cancel(){await t.return?.()}})}};async function*om(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new C("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new C("Attempted to iterate over a response with no body");let t=new Ja,r=new Ve,n=an(s.body);for await(let i of am(n))for(let o of r.decode(i)){let a=t.decode(o);a&&(yield a)}for(let i of r.flush()){let o=t.decode(i);o&&(yield o)}}async function*am(s){let e=new Uint8Array;for await(let t of s){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?cn(t):t,n=new Uint8Array(e.length+r.length);n.set(e),n.set(r,e.length),e=n;let i;for(;(i=sd(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var Ja=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=cm(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}};function cm(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function _i(s,e){let{response:t,requestLogID:r,retryOfRequestLogID:n,startTime:i}=e,o=await(async()=>{if(e.options.stream)return te(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):ke.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let c=t.headers.get("content-type")?.split(";")[0]?.trim();if(c?.includes("application/json")||c?.endsWith("+json")){let u=await t.json();return Xa(u,t)}return await t.text()})();return te(s).debug(`[${r}] response parsed`,Ge({retryOfRequestLogID:n,url:t.url,status:t.status,body:o,durationMs:Date.now()-i})),o}function Xa(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var un,Dt=class s extends Promise{constructor(e,t,r=_i){super(n=>{n(null)}),this.responsePromise=t,this.parseResponse=r,un.set(this,void 0),E(this,un,e,"f")}_thenUnwrap(e){return new s(g(this,un,"f"),this.responsePromise,async(t,r)=>Xa(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(g(this,un,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};un=new WeakMap;var Ci,Ri=class{constructor(e,t,r,n){Ci.set(this,void 0),E(this,Ci,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new C("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await g(this,Ci,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ci=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},pn=class extends Dt{constructor(e,t,r){super(e,t,async(n,i)=>new r(n,i.response,await _i(n,i),i.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},xe=class extends Ri{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let t=this.first_id;return t?{...this.options,query:{...Ai(this.options.query),before_id:t}}:null}let e=this.last_id;return e?{...this.options,query:{...Ai(this.options.query),after_id:e}}:null}};var Dr=class extends Ri{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1,this.next_page=r.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...Ai(this.options.query),page:e}}:null}};var Ya=()=>{if(typeof File>"u"){let{process:s}=globalThis,e=typeof s?.versions?.node=="string"&&parseInt(s.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function $t(s,e,t){return Ya(),new File(s,e??"unknown_file",t)}function mn(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}var Za=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function";var $r=async(s,e)=>({...s,body:await um(s.body,e)}),id=new WeakMap;function dm(s){let e=typeof s=="function"?s:s.fetch,t=id.get(e);if(t)return t;let r=(async()=>{try{let n="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new n(i).text()}catch{return!0}})();return id.set(e,r),r}var um=async(s,e)=>{if(!await dm(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(s||{}).map(([r,n])=>Qa(t,r,n))),t},pm=s=>s instanceof Blob&&"name"in s;var Qa=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response){let r={},n=t.headers.get("Content-Type");n&&(r={type:n}),s.append(e,$t([await t.blob()],mn(t),r))}else if(Za(t))s.append(e,$t([await new Response(Ii(t)).blob()],mn(t)));else if(pm(t))s.append(e,$t([t],mn(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(r=>Qa(s,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,n])=>Qa(s,`${e}[${r}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var od=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",mm=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&od(s),hm=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function Pi(s,e,t){if(Ya(),s=await s,e||(e=mn(s)),mm(s))return s instanceof File&&e==null&&t==null?s:$t([await s.arrayBuffer()],e??s.name,{type:s.type,lastModified:s.lastModified,...t});if(hm(s)){let n=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),$t(await ec(n),e,t)}let r=await ec(s);if(!t?.type){let n=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof n=="string"&&(t={...t,type:n})}return $t(r,e,t)}async function ec(s){let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(od(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(Za(s))for await(let t of s)e.push(...await ec(t));else{let t=s?.constructor?.name;throw new Error(`Unexpected data type: ${typeof s}${t?`; constructor: ${t}`:""}${fm(s)}`)}return e}function fm(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}var D=class{constructor(e){this._client=e}};var ad=Symbol.for("brand.privateNullableHeaders");function*ym(s){if(!s)return;if(ad in s){let{values:r,nulls:n}=s;yield*r.entries();for(let i of n)yield[i,null];return}let e=!1,t;s instanceof Headers?t=s.entries():Ga(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let r of t){let n=r[0];if(typeof n!="string")throw new TypeError("expected header name to be a string");let i=Ga(r[1])?r[1]:[r[1]],o=!1;for(let a of i)a!==void 0&&(e&&!o&&(o=!0,yield[n,null]),yield[n,a])}}var T=s=>{let e=new Headers,t=new Set;for(let r of s){let n=new Set;for(let[i,o]of ym(r)){let a=i.toLowerCase();n.has(a)||(e.delete(i),n.add(a)),o===null?(e.delete(i),t.add(a)):(e.append(i,o),t.delete(a))}}return{[ad]:!0,values:e,nulls:t}};function ld(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var cd=Object.freeze(Object.create(null)),bm=(s=ld)=>function(t,...r){if(t.length===1)return t[0];let n=!1,i=[],o=t.reduce((d,u,m)=>{/[?#]/.test(u)&&(n=!0);let p=r[m],w=(n?encodeURIComponent:s)(""+p);return m!==r.length&&(p==null||typeof p=="object"&&p.toString===Object.getPrototypeOf(Object.getPrototypeOf(p.hasOwnProperty??cd)??cd)?.toString)&&(w=p+"",i.push({start:d.length+u.length,length:w.length,error:`Value of type ${Object.prototype.toString.call(p).slice(8,-1)} is not a valid path parameter`})),d+u+(m===r.length?"":w)},""),a=o.split(/[?#]/,1)[0],c=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,l;for(;(l=c.exec(a))!==null;)i.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(i.sort((d,u)=>d.start-u.start),i.length>0){let d=0,u=i.reduce((m,p)=>{let w=" ".repeat(p.start-d),v="^".repeat(p.length);return d=p.start+p.length,m+w+v},"");throw new C(`Path parameters result in path with invalid segments:
${i.map(m=>m.error).join(`
`)}
${o}
${u}`)}return o},$=bm(ld);var Br=class extends D{list(e={},t){let{betas:r,...n}=e??{};return this._client.getAPIList("/v1/files",xe,{query:n,...t,headers:T([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},r){let{betas:n}=t??{};return this._client.delete($`/v1/files/${e}`,{...r,headers:T([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},r?.headers])})}download(e,t={},r){let{betas:n}=t??{};return this._client.get($`/v1/files/${e}/content`,{...r,headers:T([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},r){let{betas:n}=t??{};return this._client.get($`/v1/files/${e}`,{...r,headers:T([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},r?.headers])})}upload(e,t){let{betas:r,...n}=e;return this._client.post("/v1/files",$r({body:n,...t,headers:T([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}};var Ur=class extends D{retrieve(e,t={},r){let{betas:n}=t??{};return this._client.get($`/v1/models/${e}?beta=true`,{...r,headers:T([{...n?.toString()!=null?{"anthropic-beta":n?.toString()}:void 0},r?.headers])})}list(e={},t){let{betas:r,...n}=e??{};return this._client.getAPIList("/v1/models?beta=true",xe,{query:n,...t,headers:T([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},t?.headers])})}};var ki={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function tc(s,e){return!e||!("parse"in(e.output_format??{}))?{...s,content:s.content.map(t=>t.type==="text"?{...t,parsed:null}:t),parsed_output:null}:rc(s,e)}function rc(s,e){let t=null,r=s.content.map(n=>{if(n.type==="text"){let i=Am(e,n.text);return t===null&&(t=i),{...n,parsed:i}}return n});return{...s,content:r,parsed_output:t}}function Am(s,e){if(s.output_format?.type!=="json_schema")return null;try{return"parse"in s.output_format?s.output_format.parse(e):JSON.parse(e)}catch(t){throw new C(`Failed to parse structured output: ${t}`)}}var xm=s=>{let e=0,t=[];for(;e<s.length;){let r=s[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let a="",c=!1;for(r=s[++e];r!=='"';){if(e===s.length){c=!0;break}if(r==="\\"){if(e++,e===s.length){c=!0;break}a+=r+s[e],r=s[++e]}else a+=r,r=s[++e]}r=s[++e],c||t.push({type:"string",value:a});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let a="";for(r==="-"&&(a+=r,r=s[++e]);r&&i.test(r)||r===".";)a+=r,r=s[++e];t.push({type:"number",value:a});continue}let o=/[a-z]/i;if(r&&o.test(r)){let a="";for(;r&&o.test(r)&&e!==s.length;)a+=r,r=s[++e];if(a=="true"||a=="false"||a==="null")t.push({type:"name",value:a});else{e++;continue}continue}e++}return t},qr=s=>{if(s.length===0)return s;let e=s[s.length-1];switch(e.type){case"separator":return s=s.slice(0,s.length-1),qr(s);break;case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return s=s.slice(0,s.length-1),qr(s);case"string":let r=s[s.length-2];if(r?.type==="delimiter")return s=s.slice(0,s.length-1),qr(s);if(r?.type==="brace"&&r.value==="{")return s=s.slice(0,s.length-1),qr(s);break;case"delimiter":return s=s.slice(0,s.length-1),qr(s);break}return s},Im=s=>{let e=[];return s.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?s.push({type:"brace",value:"}"}):t==="]"&&s.push({type:"paren",value:"]"})}),s},Sm=s=>{let e="";return s.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},Ti=s=>JSON.parse(Sm(Im(qr(xm(s)))));var Ie,ct,jr,hn,Mi,fn,gn,Oi,yn,We,bn,Li,Fi,Hr,Ni,Di,sc,dd,$i,nc,ic,oc,ud,pd="__json_buf";function md(s){return s.type==="tool_use"||s.type==="server_tool_use"||s.type==="mcp_tool_use"}var Bi=class s{constructor(e){Ie.add(this),this.messages=[],this.receivedMessages=[],ct.set(this,void 0),jr.set(this,null),this.controller=new AbortController,hn.set(this,void 0),Mi.set(this,()=>{}),fn.set(this,()=>{}),gn.set(this,void 0),Oi.set(this,()=>{}),yn.set(this,()=>{}),We.set(this,{}),bn.set(this,!1),Li.set(this,!1),Fi.set(this,!1),Hr.set(this,!1),Ni.set(this,void 0),Di.set(this,void 0),$i.set(this,t=>{if(E(this,Li,!0,"f"),He(t)&&(t=new ie),t instanceof ie)return E(this,Fi,!0,"f"),this._emit("abort",t);if(t instanceof C)return this._emit("error",t);if(t instanceof Error){let r=new C(t.message);return r.cause=t,this._emit("error",r)}return this._emit("error",new C(String(t)))}),E(this,hn,new Promise((t,r)=>{E(this,Mi,t,"f"),E(this,fn,r,"f")}),"f"),E(this,gn,new Promise((t,r)=>{E(this,Oi,t,"f"),E(this,yn,r,"f")}),"f"),g(this,hn,"f").catch(()=>{}),g(this,gn,"f").catch(()=>{}),E(this,jr,e,"f")}get response(){return g(this,Ni,"f")}get request_id(){return g(this,Di,"f")}async withResponse(){let e=await g(this,hn,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new s(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let n=new s(t);for(let i of t.messages)n._addMessageParam(i);return E(n,jr,{...t,stream:!0},"f"),n._run(()=>n._createMessage(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},g(this,$i,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){let n=r?.signal,i;n&&(n.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),n.addEventListener("abort",i));try{g(this,Ie,"m",nc).call(this);let{response:o,data:a}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(o);for await(let c of a)g(this,Ie,"m",ic).call(this,c);if(a.controller.signal?.aborted)throw new ie;g(this,Ie,"m",oc).call(this)}finally{n&&i&&n.removeEventListener("abort",i)}}_connected(e){this.ended||(E(this,Ni,e,"f"),E(this,Di,e?.headers.get("request-id"),"f"),g(this,Mi,"f").call(this,e),this._emit("connect"))}get ended(){return g(this,bn,"f")}get errored(){return g(this,Li,"f")}get aborted(){return g(this,Fi,"f")}abort(){this.controller.abort()}on(e,t){return(g(this,We,"f")[e]||(g(this,We,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=g(this,We,"f")[e];if(!r)return this;let n=r.findIndex(i=>i.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(g(this,We,"f")[e]||(g(this,We,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{E(this,Hr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){E(this,Hr,!0,"f"),await g(this,gn,"f")}get currentMessage(){return g(this,ct,"f")}async finalMessage(){return await this.done(),g(this,Ie,"m",sc).call(this)}async finalText(){return await this.done(),g(this,Ie,"m",dd).call(this)}_emit(e,...t){if(g(this,bn,"f"))return;e==="end"&&(E(this,bn,!0,"f"),g(this,Oi,"f").call(this));let r=g(this,We,"f")[e];if(r&&(g(this,We,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!g(this,Hr,"f")&&!r?.length&&Promise.reject(n),g(this,fn,"f").call(this,n),g(this,yn,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!g(this,Hr,"f")&&!r?.length&&Promise.reject(n),g(this,fn,"f").call(this,n),g(this,yn,"f").call(this,n),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",g(this,Ie,"m",sc).call(this))}async _fromReadableStream(e,t){let r=t?.signal,n;r&&(r.aborted&&this.controller.abort(),n=this.controller.abort.bind(this.controller),r.addEventListener("abort",n));try{g(this,Ie,"m",nc).call(this),this._connected(null);let i=ke.fromReadableStream(e,this.controller);for await(let o of i)g(this,Ie,"m",ic).call(this,o);if(i.controller.signal?.aborted)throw new ie;g(this,Ie,"m",oc).call(this)}finally{r&&n&&r.removeEventListener("abort",n)}}[(ct=new WeakMap,jr=new WeakMap,hn=new WeakMap,Mi=new WeakMap,fn=new WeakMap,gn=new WeakMap,Oi=new WeakMap,yn=new WeakMap,We=new WeakMap,bn=new WeakMap,Li=new WeakMap,Fi=new WeakMap,Hr=new WeakMap,Ni=new WeakMap,Di=new WeakMap,$i=new WeakMap,Ie=new WeakSet,sc=function(){if(this.receivedMessages.length===0)throw new C("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},dd=function(){if(this.receivedMessages.length===0)throw new C("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new C("stream ended without producing a content block with type=text");return t.join(" ")},nc=function(){this.ended||E(this,ct,void 0,"f")},ic=function(t){if(this.ended)return;let r=g(this,Ie,"m",ud).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{let n=r.content.at(-1);switch(t.delta.type){case"text_delta":{n.type==="text"&&this._emit("text",t.delta.text,n.text||"");break}case"citations_delta":{n.type==="text"&&this._emit("citation",t.delta.citation,n.citations??[]);break}case"input_json_delta":{md(n)&&n.input&&this._emit("inputJson",t.delta.partial_json,n.input);break}case"thinking_delta":{n.type==="thinking"&&this._emit("thinking",t.delta.thinking,n.thinking);break}case"signature_delta":{n.type==="thinking"&&this._emit("signature",n.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(tc(r,g(this,jr,"f")),!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{E(this,ct,r,"f");break}case"content_block_start":case"message_delta":break}},oc=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=g(this,ct,"f");if(!t)throw new C("request ended without sending any chunks");return E(this,ct,void 0,"f"),tc(t,g(this,jr,"f"))},ud=function(t){let r=g(this,ct,"f");if(t.type==="message_start"){if(r)throw new C(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new C(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.container=t.delta.container,r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r.context_management=t.context_management,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{let n=r.content.at(t.index);switch(t.delta.type){case"text_delta":{n?.type==="text"&&(r.content[t.index]={...n,text:(n.text||"")+t.delta.text});break}case"citations_delta":{n?.type==="text"&&(r.content[t.index]={...n,citations:[...n.citations??[],t.delta.citation]});break}case"input_json_delta":{if(n&&md(n)){let i=n[pd]||"";i+=t.delta.partial_json;let o={...n};if(Object.defineProperty(o,pd,{value:i,enumerable:!1,writable:!0}),i)try{o.input=Ti(i)}catch(a){let c=new C(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${a}. JSON: ${i}`);g(this,$i,"f").call(this,c)}r.content[t.index]=o}break}case"thinking_delta":{n?.type==="thinking"&&(r.content[t.index]={...n,thinking:n.thinking+t.delta.thinking});break}case"signature_delta":{n?.type==="thinking"&&(r.content[t.index]={...n,signature:t.delta.signature});break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ke(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var hd=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but complete\u2014err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;var wn,Vr,Bt,X,vn,fe,ze,lt,An,fd,ac;function gd(){let s,e;return{promise:new Promise((r,n)=>{s=r,e=n}),resolve:s,reject:e}}var Gr=class{constructor(e,t,r){wn.add(this),this.client=e,Vr.set(this,!1),Bt.set(this,!1),X.set(this,void 0),vn.set(this,void 0),fe.set(this,void 0),ze.set(this,void 0),lt.set(this,void 0),An.set(this,0),E(this,X,{params:{...t,messages:structuredClone(t.messages)}},"f"),E(this,vn,{...r,headers:T([{"x-stainless-helper":"BetaToolRunner"},r?.headers])},"f"),E(this,lt,gd(),"f")}async*[(Vr=new WeakMap,Bt=new WeakMap,X=new WeakMap,vn=new WeakMap,fe=new WeakMap,ze=new WeakMap,lt=new WeakMap,An=new WeakMap,wn=new WeakSet,fd=async function(){let t=g(this,X,"f").params.compactionControl;if(!t||!t.enabled)return!1;let r=0;if(g(this,fe,"f")!==void 0)try{let l=await g(this,fe,"f");r=l.usage.input_tokens+(l.usage.cache_creation_input_tokens??0)+(l.usage.cache_read_input_tokens??0)+l.usage.output_tokens}catch{return!1}let n=t.contextTokenThreshold??1e5;if(r<n)return!1;let i=t.model??g(this,X,"f").params.model,o=t.summaryPrompt??hd,a=g(this,X,"f").params.messages;if(a[a.length-1].role==="assistant"){let l=a[a.length-1];if(Array.isArray(l.content)){let d=l.content.filter(u=>u.type!=="tool_use");d.length===0?a.pop():l.content=d}}let c=await this.client.beta.messages.create({model:i,messages:[...a,{role:"user",content:[{type:"text",text:o}]}],max_tokens:g(this,X,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(c.content[0]?.type!=="text")throw new C("Expected text response for compaction");return g(this,X,"f").params.messages=[{role:"user",content:c.content}],!0},Symbol.asyncIterator)](){var e;if(g(this,Vr,"f"))throw new C("Cannot iterate over a consumed stream");E(this,Vr,!0,"f"),E(this,Bt,!0,"f"),E(this,ze,void 0,"f");try{for(;;){let t;try{if(g(this,X,"f").params.max_iterations&&g(this,An,"f")>=g(this,X,"f").params.max_iterations)break;E(this,Bt,!1,"f"),E(this,ze,void 0,"f"),E(this,An,(e=g(this,An,"f"),e++,e),"f"),E(this,fe,void 0,"f");let{max_iterations:r,compactionControl:n,...i}=g(this,X,"f").params;if(i.stream?(t=this.client.beta.messages.stream({...i},g(this,vn,"f")),E(this,fe,t.finalMessage(),"f"),g(this,fe,"f").catch(()=>{}),yield t):(E(this,fe,this.client.beta.messages.create({...i,stream:!1},g(this,vn,"f")),"f"),yield g(this,fe,"f")),!await g(this,wn,"m",fd).call(this)){if(!g(this,Bt,"f")){let{role:c,content:l}=await g(this,fe,"f");g(this,X,"f").params.messages.push({role:c,content:l})}let a=await g(this,wn,"m",ac).call(this,g(this,X,"f").params.messages.at(-1));if(a)g(this,X,"f").params.messages.push(a);else if(!g(this,Bt,"f"))break}}finally{t&&t.abort()}}if(!g(this,fe,"f"))throw new C("ToolRunner concluded without a message from the server");g(this,lt,"f").resolve(await g(this,fe,"f"))}catch(t){throw E(this,Vr,!1,"f"),g(this,lt,"f").promise.catch(()=>{}),g(this,lt,"f").reject(t),E(this,lt,gd(),"f"),t}}setMessagesParams(e){typeof e=="function"?g(this,X,"f").params=e(g(this,X,"f").params):g(this,X,"f").params=e,E(this,Bt,!0,"f"),E(this,ze,void 0,"f")}async generateToolResponse(){let e=await g(this,fe,"f")??this.params.messages.at(-1);return e?g(this,wn,"m",ac).call(this,e):null}done(){return g(this,lt,"f").promise}async runUntilDone(){if(!g(this,Vr,"f"))for await(let e of this);return this.done()}get params(){return g(this,X,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}};ac=async function(e){return g(this,ze,"f")!==void 0?g(this,ze,"f"):(E(this,ze,_m(g(this,X,"f").params,e),"f"),g(this,ze,"f"))};async function _m(s,e=s.messages.at(-1)){if(!e||e.role!=="assistant"||!e.content||typeof e.content=="string")return null;let t=e.content.filter(n=>n.type==="tool_use");return t.length===0?null:{role:"user",content:await Promise.all(t.map(async n=>{let i=s.tools.find(o=>("name"in o?o.name:o.mcp_server_name)===n.name);if(!i||!("run"in i))return{type:"tool_result",tool_use_id:n.id,content:`Error: Tool '${n.name}' not found`,is_error:!0};try{let o=n.input;"parse"in i&&i.parse&&(o=i.parse(o));let a=await i.run(o);return{type:"tool_result",tool_use_id:n.id,content:a}}catch(o){return{type:"tool_result",tool_use_id:n.id,content:`Error: ${o instanceof Error?o.message:String(o)}`,is_error:!0}}}))}}var Wr=class s{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){let e=new Ve;for await(let t of this.iterator)for(let r of e.decode(t))yield JSON.parse(r);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new C("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new C("Attempted to iterate over a response with no body");return new s(an(e.body),t)}};var zr=class extends D{create(e,t){let{betas:r,...n}=e;return this._client.post("/v1/messages/batches?beta=true",{body:n,...t,headers:T([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},r){let{betas:n}=t??{};return this._client.get($`/v1/messages/batches/${e}?beta=true`,{...r,headers:T([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},r?.headers])})}list(e={},t){let{betas:r,...n}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",xe,{query:n,...t,headers:T([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},r){let{betas:n}=t??{};return this._client.delete($`/v1/messages/batches/${e}?beta=true`,{...r,headers:T([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},r?.headers])})}cancel(e,t={},r){let{betas:n}=t??{};return this._client.post($`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:T([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},r?.headers])})}async results(e,t={},r){let n=await this.retrieve(e);if(!n.results_url)throw new C(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);let{betas:i}=t??{};return this._client.get(n.results_url,{...r,headers:T([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},r?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((o,a)=>Wr.fromResponse(a.response,a.controller))}};var yd={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"},dt=class extends D{constructor(){super(...arguments),this.batches=new zr(this._client)}create(e,t){let{betas:r,...n}=e;n.model in yd&&console.warn(`The model '${n.model}' is deprecated and will reach end-of-life on ${yd[n.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let i=this._client._options.timeout;if(!n.stream&&i==null){let o=ki[n.model]??void 0;i=this._client.calculateNonstreamingTimeout(n.max_tokens,o)}return this._client.post("/v1/messages?beta=true",{body:n,timeout:i??6e5,...t,headers:T([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:T([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-11-13"].toString()},t?.headers])},this.create(e,t).then(r=>rc(r,e))}stream(e,t){return Bi.createMessage(this,e,t)}countTokens(e,t){let{betas:r,...n}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:n,...t,headers:T([{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new Gr(this._client,e,t)}};dt.Batches=zr;dt.BetaToolRunner=Gr;var Kr=class extends D{create(e,t={},r){let{betas:n,...i}=t??{};return this._client.post($`/v1/skills/${e}/versions?beta=true`,$r({body:i,...r,headers:T([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},r?.headers])},this._client))}retrieve(e,t,r){let{skill_id:n,betas:i}=t;return this._client.get($`/v1/skills/${n}/versions/${e}?beta=true`,{...r,headers:T([{"anthropic-beta":[...i??[],"skills-2025-10-02"].toString()},r?.headers])})}list(e,t={},r){let{betas:n,...i}=t??{};return this._client.getAPIList($`/v1/skills/${e}/versions?beta=true`,Dr,{query:i,...r,headers:T([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},r?.headers])})}delete(e,t,r){let{skill_id:n,betas:i}=t;return this._client.delete($`/v1/skills/${n}/versions/${e}?beta=true`,{...r,headers:T([{"anthropic-beta":[...i??[],"skills-2025-10-02"].toString()},r?.headers])})}};var Ut=class extends D{constructor(){super(...arguments),this.versions=new Kr(this._client)}create(e={},t){let{betas:r,...n}=e??{};return this._client.post("/v1/skills?beta=true",$r({body:n,...t,headers:T([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},t?.headers])},this._client))}retrieve(e,t={},r){let{betas:n}=t??{};return this._client.get($`/v1/skills/${e}?beta=true`,{...r,headers:T([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},r?.headers])})}list(e={},t){let{betas:r,...n}=e??{};return this._client.getAPIList("/v1/skills?beta=true",Dr,{query:n,...t,headers:T([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},t?.headers])})}delete(e,t={},r){let{betas:n}=t??{};return this._client.delete($`/v1/skills/${e}?beta=true`,{...r,headers:T([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},r?.headers])})}};Ut.Versions=Kr;var Ee=class extends D{constructor(){super(...arguments),this.models=new Ur(this._client),this.messages=new dt(this._client),this.files=new Br(this._client),this.skills=new Ut(this._client)}};Ee.Models=Ur;Ee.Messages=dt;Ee.Files=Br;Ee.Skills=Ut;var qt=class extends D{create(e,t){let{betas:r,...n}=e;return this._client.post("/v1/complete",{body:n,timeout:this._client._options.timeout??6e5,...t,headers:T([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}};var Se,ut,xn,Ui,In,Sn,qi,En,Ke,_n,ji,Hi,Jr,Vi,Gi,cc,bd,lc,dc,uc,pc,wd,vd="__json_buf";function Ad(s){return s.type==="tool_use"||s.type==="server_tool_use"}var Wi=class s{constructor(){Se.add(this),this.messages=[],this.receivedMessages=[],ut.set(this,void 0),this.controller=new AbortController,xn.set(this,void 0),Ui.set(this,()=>{}),In.set(this,()=>{}),Sn.set(this,void 0),qi.set(this,()=>{}),En.set(this,()=>{}),Ke.set(this,{}),_n.set(this,!1),ji.set(this,!1),Hi.set(this,!1),Jr.set(this,!1),Vi.set(this,void 0),Gi.set(this,void 0),lc.set(this,e=>{if(E(this,ji,!0,"f"),He(e)&&(e=new ie),e instanceof ie)return E(this,Hi,!0,"f"),this._emit("abort",e);if(e instanceof C)return this._emit("error",e);if(e instanceof Error){let t=new C(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new C(String(e)))}),E(this,xn,new Promise((e,t)=>{E(this,Ui,e,"f"),E(this,In,t,"f")}),"f"),E(this,Sn,new Promise((e,t)=>{E(this,qi,e,"f"),E(this,En,t,"f")}),"f"),g(this,xn,"f").catch(()=>{}),g(this,Sn,"f").catch(()=>{})}get response(){return g(this,Vi,"f")}get request_id(){return g(this,Gi,"f")}async withResponse(){let e=await g(this,xn,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new s;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let n=new s;for(let i of t.messages)n._addMessageParam(i);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},g(this,lc,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){let n=r?.signal,i;n&&(n.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),n.addEventListener("abort",i));try{g(this,Se,"m",dc).call(this);let{response:o,data:a}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(o);for await(let c of a)g(this,Se,"m",uc).call(this,c);if(a.controller.signal?.aborted)throw new ie;g(this,Se,"m",pc).call(this)}finally{n&&i&&n.removeEventListener("abort",i)}}_connected(e){this.ended||(E(this,Vi,e,"f"),E(this,Gi,e?.headers.get("request-id"),"f"),g(this,Ui,"f").call(this,e),this._emit("connect"))}get ended(){return g(this,_n,"f")}get errored(){return g(this,ji,"f")}get aborted(){return g(this,Hi,"f")}abort(){this.controller.abort()}on(e,t){return(g(this,Ke,"f")[e]||(g(this,Ke,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=g(this,Ke,"f")[e];if(!r)return this;let n=r.findIndex(i=>i.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(g(this,Ke,"f")[e]||(g(this,Ke,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{E(this,Jr,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){E(this,Jr,!0,"f"),await g(this,Sn,"f")}get currentMessage(){return g(this,ut,"f")}async finalMessage(){return await this.done(),g(this,Se,"m",cc).call(this)}async finalText(){return await this.done(),g(this,Se,"m",bd).call(this)}_emit(e,...t){if(g(this,_n,"f"))return;e==="end"&&(E(this,_n,!0,"f"),g(this,qi,"f").call(this));let r=g(this,Ke,"f")[e];if(r&&(g(this,Ke,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!g(this,Jr,"f")&&!r?.length&&Promise.reject(n),g(this,In,"f").call(this,n),g(this,En,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!g(this,Jr,"f")&&!r?.length&&Promise.reject(n),g(this,In,"f").call(this,n),g(this,En,"f").call(this,n),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",g(this,Se,"m",cc).call(this))}async _fromReadableStream(e,t){let r=t?.signal,n;r&&(r.aborted&&this.controller.abort(),n=this.controller.abort.bind(this.controller),r.addEventListener("abort",n));try{g(this,Se,"m",dc).call(this),this._connected(null);let i=ke.fromReadableStream(e,this.controller);for await(let o of i)g(this,Se,"m",uc).call(this,o);if(i.controller.signal?.aborted)throw new ie;g(this,Se,"m",pc).call(this)}finally{r&&n&&r.removeEventListener("abort",n)}}[(ut=new WeakMap,xn=new WeakMap,Ui=new WeakMap,In=new WeakMap,Sn=new WeakMap,qi=new WeakMap,En=new WeakMap,Ke=new WeakMap,_n=new WeakMap,ji=new WeakMap,Hi=new WeakMap,Jr=new WeakMap,Vi=new WeakMap,Gi=new WeakMap,lc=new WeakMap,Se=new WeakSet,cc=function(){if(this.receivedMessages.length===0)throw new C("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},bd=function(){if(this.receivedMessages.length===0)throw new C("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new C("stream ended without producing a content block with type=text");return t.join(" ")},dc=function(){this.ended||E(this,ut,void 0,"f")},uc=function(t){if(this.ended)return;let r=g(this,Se,"m",wd).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{let n=r.content.at(-1);switch(t.delta.type){case"text_delta":{n.type==="text"&&this._emit("text",t.delta.text,n.text||"");break}case"citations_delta":{n.type==="text"&&this._emit("citation",t.delta.citation,n.citations??[]);break}case"input_json_delta":{Ad(n)&&n.input&&this._emit("inputJson",t.delta.partial_json,n.input);break}case"thinking_delta":{n.type==="thinking"&&this._emit("thinking",t.delta.thinking,n.thinking);break}case"signature_delta":{n.type==="thinking"&&this._emit("signature",n.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{E(this,ut,r,"f");break}case"content_block_start":case"message_delta":break}},pc=function(){if(this.ended)throw new C("stream has ended, this shouldn't happen");let t=g(this,ut,"f");if(!t)throw new C("request ended without sending any chunks");return E(this,ut,void 0,"f"),t},wd=function(t){let r=g(this,ut,"f");if(t.type==="message_start"){if(r)throw new C(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new C(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push({...t.content_block}),r;case"content_block_delta":{let n=r.content.at(t.index);switch(t.delta.type){case"text_delta":{n?.type==="text"&&(r.content[t.index]={...n,text:(n.text||"")+t.delta.text});break}case"citations_delta":{n?.type==="text"&&(r.content[t.index]={...n,citations:[...n.citations??[],t.delta.citation]});break}case"input_json_delta":{if(n&&Ad(n)){let i=n[vd]||"";i+=t.delta.partial_json;let o={...n};Object.defineProperty(o,vd,{value:i,enumerable:!1,writable:!0}),i&&(o.input=Ti(i)),r.content[t.index]=o}break}case"thinking_delta":{n?.type==="thinking"&&(r.content[t.index]={...n,thinking:n.thinking+t.delta.thinking});break}case"signature_delta":{n?.type==="thinking"&&(r.content[t.index]={...n,signature:t.delta.signature});break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ke(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var Xr=class extends D{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get($`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",xe,{query:e,...t})}delete(e,t){return this._client.delete($`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post($`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let r=await this.retrieve(e);if(!r.results_url)throw new C(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,headers:T([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((n,i)=>Wr.fromResponse(i.response,i.controller))}};var pt=class extends D{constructor(){super(...arguments),this.batches=new Xr(this._client)}create(e,t){e.model in xd&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${xd[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let r=this._client._options.timeout;if(!e.stream&&r==null){let n=ki[e.model]??void 0;r=this._client.calculateNonstreamingTimeout(e.max_tokens,n)}return this._client.post("/v1/messages",{body:e,timeout:r??6e5,...t,stream:e.stream??!1})}stream(e,t){return Wi.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}},xd={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};pt.Batches=Xr;var jt=class extends D{retrieve(e,t={},r){let{betas:n}=t??{};return this._client.get($`/v1/models/${e}`,{...r,headers:T([{...n?.toString()!=null?{"anthropic-beta":n?.toString()}:void 0},r?.headers])})}list(e={},t){let{betas:r,...n}=e??{};return this._client.getAPIList("/v1/models",xe,{query:n,...t,headers:T([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},t?.headers])})}};var Cn=s=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[s]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(s)?.trim()};var mc,hc,zi,Id,Sd="\\n\\nHuman:",Ed="\\n\\nAssistant:",q=class{constructor({baseURL:e=Cn("ANTHROPIC_BASE_URL"),apiKey:t=Cn("ANTHROPIC_API_KEY")??null,authToken:r=Cn("ANTHROPIC_AUTH_TOKEN")??null,...n}={}){mc.add(this),zi.set(this,void 0);let i={apiKey:t,authToken:r,...n,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&Jl())throw new C(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=i.baseURL,this.timeout=i.timeout??hc.DEFAULT_TIMEOUT,this.logger=i.logger??console;let o="warn";this.logLevel=o,this.logLevel=Ka(i.logLevel,"ClientOptions.logLevel",this)??Ka(Cn("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??o,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??Ql(),E(this,zi,Zl,"f"),this._options=i,this.apiKey=typeof t=="string"?t:null,this.authToken=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization"))&&!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return T([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(this.apiKey!=null)return T([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(this.authToken!=null)return T([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new C(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${at}`}defaultIdempotencyKey(){return`stainless-node-retry-${Ha()}`}makeStatusError(e,t,r,n){return ee.generate(e,t,r,n)}buildURL(e,t,r){let n=!g(this,mc,"m",Id).call(this)&&r||this.baseURL,i=ql(e)?new URL(e):new URL(n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return jl(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new C("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new Dt(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let n=await e,i=n.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(n);let{req:o,url:a,timeout:c}=await this.buildRequest(n,{retryCount:i-t});await this.prepareRequest(o,{url:a,options:n});let l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,u=Date.now();if(te(this).debug(`[${l}] sending request`,Ge({retryOfRequestLogID:r,method:n.method,url:a,options:n,headers:o.headers})),n.signal?.aborted)throw new ie;let m=new AbortController,p=await this.fetchWithTimeout(a,o,c,m).catch(on),w=Date.now();if(p instanceof globalThis.Error){let I=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new ie;let A=He(p)||/timed? ?out/i.test(String(p)+("cause"in p?String(p.cause):""));if(t)return te(this).info(`[${l}] connection ${A?"timed out":"failed"} - ${I}`),te(this).debug(`[${l}] connection ${A?"timed out":"failed"} (${I})`,Ge({retryOfRequestLogID:r,url:a,durationMs:w-u,message:p.message})),this.retryRequest(n,t,r??l);throw te(this).info(`[${l}] connection ${A?"timed out":"failed"} - error; no more retries left`),te(this).debug(`[${l}] connection ${A?"timed out":"failed"} (error; no more retries left)`,Ge({retryOfRequestLogID:r,url:a,durationMs:w-u,message:p.message})),A?new Rr:new ot({cause:p})}let v=[...p.headers.entries()].filter(([I])=>I==="request-id").map(([I,A])=>", "+I+": "+JSON.stringify(A)).join(""),_=`[${l}${d}${v}] ${o.method} ${a} ${p.ok?"succeeded":"failed"} with status ${p.status} in ${w-u}ms`;if(!p.ok){let I=await this.shouldRetry(p);if(t&&I){let L=`retrying, ${t} attempts remaining`;return await Yl(p.body),te(this).info(`${_} - ${L}`),te(this).debug(`[${l}] response error (${L})`,Ge({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:w-u})),this.retryRequest(n,t,r??l,p.headers)}let A=I?"error; no more retries left":"error; not retryable";te(this).info(`${_} - ${A}`);let M=await p.text().catch(L=>on(L).message),k=xi(M),N=k?void 0:M;throw te(this).debug(`[${l}] response error (${A})`,Ge({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,message:N,durationMs:Date.now()-u})),this.makeStatusError(p.status,k,N,p.headers)}return te(this).info(_),te(this).debug(`[${l}] response start`,Ge({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:w-u})),{response:p,options:n,controller:m,requestLogID:l,retryOfRequestLogID:r,startTime:u}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){let r=this.makeRequest(t,null,void 0);return new pn(this,r,e)}async fetchWithTimeout(e,t,r,n){let{signal:i,method:o,...a}=t||{};i&&i.addEventListener("abort",()=>n.abort());let c=setTimeout(()=>n.abort(),r),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||typeof a.body=="object"&&a.body!==null&&Symbol.asyncIterator in a.body,d={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};o&&(d.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,n){let i,o=n?.get("retry-after-ms");if(o){let c=parseFloat(o);Number.isNaN(c)||(i=c)}let a=n?.get("retry-after");if(a&&!i){let c=parseFloat(a);Number.isNaN(c)?i=Date.parse(a)-Date.now():i=c*1e3}if(!(i&&0<=i&&i<60*1e3)){let c=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,c)}return await Gl(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,o=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return o*a*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new C("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:n,path:i,query:o,defaultBaseURL:a}=r,c=this.buildURL(i,o,a);"timeout"in r&&Vl("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:d}=this.buildBody({options:r}),u=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:u,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"},...d&&{body:d},...this.fetchOptions??{},...r.fetchOptions??{}},url:c,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:n}){let i={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let o=T([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Xl(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=T([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Ii(e)}:g(this,zi,"f").call(this,{body:e,headers:r})}};hc=q,zi=new WeakMap,mc=new WeakSet,Id=function(){return this.baseURL!=="https://api.anthropic.com"};q.Anthropic=hc;q.HUMAN_PROMPT=Sd;q.AI_PROMPT=Ed;q.DEFAULT_TIMEOUT=6e5;q.AnthropicError=C;q.APIError=ee;q.APIConnectionError=ot;q.APIConnectionTimeoutError=Rr;q.APIUserAbortError=ie;q.NotFoundError=Mr;q.ConflictError=Or;q.RateLimitError=Fr;q.BadRequestError=Pr;q.AuthenticationError=kr;q.InternalServerError=Nr;q.PermissionDeniedError=Tr;q.UnprocessableEntityError=Lr;q.toFile=Pi;var Te=class extends q{constructor(){super(...arguments),this.completions=new qt(this),this.messages=new pt(this),this.models=new jt(this),this.beta=new Ee(this)}};Te.Completions=qt;Te.Messages=pt;Te.Models=jt;Te.Beta=Ee;function Om(s){let e=s.trim();e=Lm(e),e=e.replace(/,\s*([}\]])/g,"$1"),e=e.replace(/,\s*$/,"");let t=0,r=0,n=!1,i=!1,o=-1;for(let a=0;a<e.length;a++){let c=e[a];if(/\s/.test(c)||(o=a),i){i=!1;continue}if(c==="\\"){i=!0;continue}if(c==='"'&&!i){n=!n;continue}n||(c==="{"?t++:c==="}"?t--:c==="["?r++:c==="]"&&r--)}for(e=e.trimEnd(),n&&o>=0&&(e+='"');t>0;)e+="}",t--;for(;r>0;)e+="]",r--;return e}function Lm(s){let e="",t=0,r=!1,n=!1;for(;t<s.length;){let i=s[t];if(n){e+=i,n=!1,t++;continue}if(i==="\\"){e+=i,n=!0,t++;continue}if(i==='"'&&!n){if(r=!r,e+=i,!r){let o=t+1;for(;o<s.length&&/\s/.test(s[o]);)o++;if(o<s.length){let a=s[o];if(!(s.substring(t+1,o).indexOf(",")!==-1)&&a==='"'){let d=t-1;for(;d>=0&&/\s/.test(s[d]);)d--;if(d>=0){let u=s[d];u!==":"&&(u===","||u==="{"||u==="["||u==='"'||u==="}"||u==="]")&&(e+=",")}else e+=","}}}t++;continue}if(r){e+=i,t++;continue}if((i==="}"||i==="]")&&t+1<s.length){e+=i;let o=t+1;for(;o<s.length&&/\s/.test(s[o]);)o++;if(o<s.length){let a=s[o];!(s.substring(t+1,o).indexOf(",")!==-1)&&(a==='"'||a==="{"||a==="[")&&(e+=",")}t++;continue}e+=i,t++}return e}function le(s,e=!1){let t=s.trim(),r=/```(?:json)?\s*([\s\S]*?)```/,n=t.match(r);n?.[1]&&(t=n[1].trim()),t=t.replace(/^(?:Here'?s?|Here is|Response:|Output:).*?:\s*\n?\s*/i,""),t=t.replace(/^(?:Example:|Example format:|Example response:).*?:\s*\n?\s*/i,""),t=t.replace(/^Here is.*?:\s*\n?\s*/i,"");let i=t.indexOf("["),o=t.indexOf("{"),a=-1;if(e&&i!==-1?a=i:!e&&o!==-1?a=o:i!==-1&&o!==-1?a=Math.min(i,o):!e&&o===-1?a=-1:i!==-1?a=i:o!==-1&&(a=o),a!==-1&&a>0&&(t=t.substring(a)),t=t.trim(),e&&!t.startsWith("[")?t.startsWith("{")?t=`[${t}]`:t=`[${t}`:!e&&!t.startsWith("{")&&(t=`{${t}`),e&&t.startsWith("[")){let c=0,l=!1,d=!1,u=-1;for(let m=0;m<t.length;m++){let p=t[m];if(d){d=!1;continue}if(p==="\\"){d=!0;continue}if(p==='"'&&!d){l=!l;continue}if(!l){if(p==="[")c++;else if(p==="]"&&(c--,c===0)){u=m+1;break}}}u!==-1&&c===0&&(t=t.substring(0,u))}else if(!e&&t.startsWith("{")){let c=0,l=!1,d=!1,u=-1;for(let m=0;m<t.length;m++){let p=t[m];if(d){d=!1;continue}if(p==="\\"){d=!0;continue}if(p==='"'&&!d){l=!l;continue}if(!l){if(p==="{")c++;else if(p==="}"&&(c--,c===0)){u=m+1;break}}}u!==-1&&c===0&&(t=t.substring(0,u))}return Om(t)}var Rn=class{name="Anthropic";client=null;apiKey;model;constructor(e,t){this.apiKey=e,this.model=t??"claude-3-5-haiku-20241022"}getClient(){if(!this.client&&this.apiKey&&this.apiKey.trim().length>0)try{this.client=new Te({apiKey:this.apiKey})}catch(e){throw h.warn("Failed to initialize Anthropic client:",e),new Error("Failed to initialize Anthropic client")}if(!this.client)throw new Error("Anthropic client not initialized");return this.client}authenticate(e){return Promise.resolve(e.trim().length>0&&e.startsWith("sk-"))}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("Anthropic provider is not available");let t=this.constructPrompt(e);try{let i=(await this.getClient().messages.create({model:this.model,max_tokens:256,messages:[{role:"user",content:t}]})).content[0];if(i.type!=="text")throw new Error("Unexpected response type from Anthropic API");return this.parseResponse(i.text)}catch(r){let n=r;if(n?.status===429||n?.response?.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(n?.status===401||n?.response?.status===401)throw new Error("Invalid API key. Please check your Anthropic API key.");let i="Unknown error";try{let o=String(r);o!=="[object Object]"?i=o:n?.name&&(i=`${n.name}: API request failed`)}catch{i="Unknown error"}throw new Error(`Anthropic API error: ${i}`)}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=le(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse Anthropic response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};function R(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t}function f(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)}var fc=function(){let{crypto:s}=globalThis;if(s?.randomUUID)return fc=s.randomUUID.bind(s),s.randomUUID();let e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function Pn(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}var kn=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){let e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};var S=class extends Error{},Q=class s extends S{constructor(e,t,r,n){super(`${s.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t;let i=t;this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,r){let n=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new mt({message:r,cause:kn(t)});let i=t?.error;return e===400?new Qr(e,i,r,n):e===401?new Yr(e,i,r,n):e===403?new Zr(e,i,r,n):e===404?new es(e,i,r,n):e===409?new ts(e,i,r,n):e===422?new rs(e,i,r,n):e===429?new ss(e,i,r,n):e>=500?new ns(e,i,r,n):new s(e,i,r,n)}},K=class extends Q{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},mt=class extends Q{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},ht=class extends mt{constructor({message:e}={}){super({message:e??"Request timed out."})}},Qr=class extends Q{},Yr=class extends Q{},Zr=class extends Q{},es=class extends Q{},ts=class extends Q{},rs=class extends Q{},ss=class extends Q{},ns=class extends Q{},is=class extends S{constructor(){super("Could not parse response content as the length limit was reached")}},os=class extends S{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},Me=class extends Error{constructor(e){super(e)}};var Nm=/^[a-z][a-z0-9+.-]*:/i,_d=s=>Nm.test(s),de=s=>(de=Array.isArray,de(s)),gc=de;function yc(s){return typeof s!="object"?{}:s??{}}function Cd(s){if(!s)return!0;for(let e in s)return!1;return!0}function Rd(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Tn(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}var Pd=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new S(`${s} must be an integer`);if(e<0)throw new S(`${s} must be a positive integer`);return e};var kd=s=>{try{return JSON.parse(s)}catch{return}};var Oe=s=>new Promise(e=>setTimeout(e,s));var ft="6.9.1";var Ld=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Dm(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var $m=()=>{let s=Dm();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":Md(Deno.build.os),"X-Stainless-Arch":Td(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":Md(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Td(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=Bm();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Bm(){if(typeof navigator>"u"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let r=t.exec(navigator.userAgent);if(r){let n=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:e,version:`${n}.${i}.${o}`}}}return null}var Td=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Md=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),Od,Fd=()=>Od??(Od=$m());function Nd(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function bc(...s){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function Ki(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return bc({start(){},async pull(t){let{done:r,value:n}=await e.next();r?t.close():t.enqueue(n)},async cancel(){await e.return?.()}})}function wc(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Dd(s){if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await s[Symbol.asyncIterator]().return?.();return}let e=s.getReader(),t=e.cancel();e.releaseLock(),await t}var $d=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var Ji="RFC3986",vc=s=>String(s),Xi={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:vc},Ac="RFC1738";var Qi=(s,e)=>(Qi=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Qi(s,e)),Le=(()=>{let s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})();var xc=1024,Bd=(s,e,t,r,n)=>{if(s.length===0)return s;let i=s;if(typeof s=="symbol"?i=Symbol.prototype.toString.call(s):typeof s!="string"&&(i=String(s)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let o="";for(let a=0;a<i.length;a+=xc){let c=i.length>=xc?i.slice(a,a+xc):i,l=[];for(let d=0;d<c.length;++d){let u=c.charCodeAt(d);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||n===Ac&&(u===40||u===41)){l[l.length]=c.charAt(d);continue}if(u<128){l[l.length]=Le[u];continue}if(u<2048){l[l.length]=Le[192|u>>6]+Le[128|u&63];continue}if(u<55296||u>=57344){l[l.length]=Le[224|u>>12]+Le[128|u>>6&63]+Le[128|u&63];continue}d+=1,u=65536+((u&1023)<<10|c.charCodeAt(d)&1023),l[l.length]=Le[240|u>>18]+Le[128|u>>12&63]+Le[128|u>>6&63]+Le[128|u&63]}o+=l.join("")}return o};function Ud(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function Ic(s,e){if(de(s)){let t=[];for(let r=0;r<s.length;r+=1)t.push(e(s[r]));return t}return e(s)}var jd={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},Hd=function(s,e){Array.prototype.push.apply(s,de(e)?e:[e])},qd,Y={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Bd,encodeValuesOnly:!1,format:Ji,formatter:vc,indices:!1,serializeDate(s){return(qd??(qd=Function.prototype.call.bind(Date.prototype.toISOString)))(s)},skipNulls:!1,strictNullHandling:!1};function jm(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}var Sc={};function Vd(s,e,t,r,n,i,o,a,c,l,d,u,m,p,w,v,_,I){let A=s,M=I,k=0,N=!1;for(;(M=M.get(Sc))!==void 0&&!N;){let j=M.get(s);if(k+=1,typeof j<"u"){if(j===k)throw new RangeError("Cyclic object value");N=!0}typeof M.get(Sc)>"u"&&(k=0)}if(typeof l=="function"?A=l(e,A):A instanceof Date?A=m?.(A):t==="comma"&&de(A)&&(A=Ic(A,function(j){return j instanceof Date?m?.(j):j})),A===null){if(i)return c&&!v?c(e,Y.encoder,_,"key",p):e;A=""}if(jm(A)||Ud(A)){if(c){let j=v?e:c(e,Y.encoder,_,"key",p);return[w?.(j)+"="+w?.(c(A,Y.encoder,_,"value",p))]}return[w?.(e)+"="+w?.(String(A))]}let V=[];if(typeof A>"u")return V;let L;if(t==="comma"&&de(A))v&&c&&(A=Ic(A,c)),L=[{value:A.length>0?A.join(",")||null:void 0}];else if(de(l))L=l;else{let j=Object.keys(A);L=d?j.sort(d):j}let U=a?String(e).replace(/\./g,"%2E"):String(e),z=r&&de(A)&&A.length===1?U+"[]":U;if(n&&de(A)&&A.length===0)return z+"[]";for(let j=0;j<L.length;++j){let G=L[j],hi=typeof G=="object"&&typeof G.value<"u"?G.value:A[G];if(o&&hi===null)continue;let Na=u&&a?G.replace(/\./g,"%2E"):G,Lp=de(A)?typeof t=="function"?t(z,Na):z:z+(u?"."+Na:"["+Na+"]");I.set(s,k);let xl=new WeakMap;xl.set(Sc,I),Hd(V,Vd(hi,Lp,t,r,n,i,o,a,t==="comma"&&v&&de(A)?null:c,l,d,u,m,p,w,v,_,xl))}return V}function Hm(s=Y){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=s.charset||Y.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Ji;if(typeof s.format<"u"){if(!Qi(Xi,s.format))throw new TypeError("Unknown format option provided.");t=s.format}let r=Xi[t],n=Y.filter;(typeof s.filter=="function"||de(s.filter))&&(n=s.filter);let i;if(s.arrayFormat&&s.arrayFormat in jd?i=s.arrayFormat:"indices"in s?i=s.indices?"indices":"repeat":i=Y.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let o=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:Y.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:Y.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:Y.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:Y.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?Y.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:Y.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:Y.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:Y.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:Y.encodeValuesOnly,filter:n,format:t,formatter:r,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:Y.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:Y.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:Y.strictNullHandling}}function Ec(s,e={}){let t=s,r=Hm(e),n,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):de(r.filter)&&(i=r.filter,n=i);let o=[];if(typeof t!="object"||t===null)return"";let a=jd[r.arrayFormat],c=a==="comma"&&r.commaRoundTrip;n||(n=Object.keys(t)),r.sort&&n.sort(r.sort);let l=new WeakMap;for(let m=0;m<n.length;++m){let p=n[m];r.skipNulls&&t[p]===null||Hd(o,Vd(t[p],p,a,c,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let d=o.join(r.delimiter),u=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),d.length>0?u+d:""}function zd(s){let e=0;for(let n of s)e+=n.length;let t=new Uint8Array(e),r=0;for(let n of s)t.set(n,r),r+=n.length;return t}var Gd;function as(s){let e;return(Gd??(e=new globalThis.TextEncoder,Gd=e.encode.bind(e)))(s)}var Wd;function _c(s){let e;return(Wd??(e=new globalThis.TextDecoder,Wd=e.decode.bind(e)))(s)}var ge,ye,Ht=class{constructor(){ge.set(this,void 0),ye.set(this,void 0),R(this,ge,new Uint8Array,"f"),R(this,ye,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?as(e):e;R(this,ge,zd([f(this,ge,"f"),t]),"f");let r=[],n;for(;(n=Gm(f(this,ge,"f"),f(this,ye,"f")))!=null;){if(n.carriage&&f(this,ye,"f")==null){R(this,ye,n.index,"f");continue}if(f(this,ye,"f")!=null&&(n.index!==f(this,ye,"f")+1||n.carriage)){r.push(_c(f(this,ge,"f").subarray(0,f(this,ye,"f")-1))),R(this,ge,f(this,ge,"f").subarray(f(this,ye,"f")),"f"),R(this,ye,null,"f");continue}let i=f(this,ye,"f")!==null?n.preceding-1:n.preceding,o=_c(f(this,ge,"f").subarray(0,i));r.push(o),R(this,ge,f(this,ge,"f").subarray(n.index),"f"),R(this,ye,null,"f")}return r}flush(){return f(this,ge,"f").length?this.decode(`
`):[]}};ge=new WeakMap,ye=new WeakMap;Ht.NEWLINE_CHARS=new Set([`
`,"\r"]);Ht.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Gm(s,e){for(let n=e??0;n<s.length;n++){if(s[n]===10)return{preceding:n,index:n+1,carriage:!1};if(s[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function Kd(s){for(let r=0;r<s.length-1;r++){if(s[r]===10&&s[r+1]===10||s[r]===13&&s[r+1]===13)return r+2;if(s[r]===13&&s[r+1]===10&&r+3<s.length&&s[r+2]===13&&s[r+3]===10)return r+4}return-1}var Zi={off:0,error:200,warn:300,info:400,debug:500},Cc=(s,e,t)=>{if(s){if(Rd(Zi,s))return s;W(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(Zi))}`)}};function Mn(){}function Yi(s,e,t){return!e||Zi[s]>Zi[t]?Mn:e[s].bind(e)}var Wm={error:Mn,warn:Mn,info:Mn,debug:Mn},Jd=new WeakMap;function W(s){let e=s.logger,t=s.logLevel??"off";if(!e)return Wm;let r=Jd.get(e);if(r&&r[0]===t)return r[1];let n={error:Yi("error",e,t),warn:Yi("warn",e,t),info:Yi("info",e,t),debug:Yi("debug",e,t)};return Jd.set(e,[t,n]),n}var Je=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var On,Fe=class s{constructor(e,t,r){this.iterator=e,On.set(this,void 0),this.controller=t,R(this,On,r,"f")}static fromSSEResponse(e,t,r){let n=!1,i=r?W(r):console;async function*o(){if(n)throw new S("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let c of zm(e,t))if(!a){if(c.data.startsWith("[DONE]")){a=!0;continue}if(c.event===null||!c.event.startsWith("thread.")){let l;try{l=JSON.parse(c.data)}catch(d){throw i.error("Could not parse message into JSON:",c.data),i.error("From chunk:",c.raw),d}if(l&&l.error)throw new Q(void 0,l.error,void 0,e.headers);yield l}else{let l;try{l=JSON.parse(c.data)}catch(d){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),d}if(c.event=="error")throw new Q(void 0,l.error,l.message,void 0);yield{event:c.event,data:l}}}a=!0}catch(c){if(Pn(c))return;throw c}finally{a||t.abort()}}return new s(o,t,r)}static fromReadableStream(e,t,r){let n=!1;async function*i(){let a=new Ht,c=wc(e);for await(let l of c)for(let d of a.decode(l))yield d;for(let l of a.flush())yield l}async function*o(){if(n)throw new S("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let c of i())a||c&&(yield JSON.parse(c));a=!0}catch(c){if(Pn(c))return;throw c}finally{a||t.abort()}}return new s(o,t,r)}[(On=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=i=>({next:()=>{if(i.length===0){let o=r.next();e.push(o),t.push(o)}return i.shift()}});return[new s(()=>n(e),this.controller,f(this,On,"f")),new s(()=>n(t),this.controller,f(this,On,"f"))]}toReadableStream(){let e=this,t;return bc({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{let{value:n,done:i}=await t.next();if(i)return r.close();let o=as(JSON.stringify(n)+`
`);r.enqueue(o)}catch(n){r.error(n)}},async cancel(){await t.return?.()}})}};async function*zm(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new S("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new S("Attempted to iterate over a response with no body");let t=new Rc,r=new Ht,n=wc(s.body);for await(let i of Km(n))for(let o of r.decode(i)){let a=t.decode(o);a&&(yield a)}for(let i of r.flush()){let o=t.decode(i);o&&(yield o)}}async function*Km(s){let e=new Uint8Array;for await(let t of s){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?as(t):t,n=new Uint8Array(e.length+r.length);n.set(e),n.set(r,e.length),e=n;let i;for(;(i=Kd(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var Rc=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=Jm(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}};function Jm(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function eo(s,e){let{response:t,requestLogID:r,retryOfRequestLogID:n,startTime:i}=e,o=await(async()=>{if(e.options.stream)return W(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,s):Fe.fromSSEResponse(t,e.controller,s);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let c=t.headers.get("content-type")?.split(";")[0]?.trim();if(c?.includes("application/json")||c?.endsWith("+json")){let u=await t.json();return Pc(u,t)}return await t.text()})();return W(s).debug(`[${r}] response parsed`,Je({retryOfRequestLogID:n,url:t.url,status:t.status,body:o,durationMs:Date.now()-i})),o}function Pc(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Ln,Vt=class s extends Promise{constructor(e,t,r=eo){super(n=>{n(null)}),this.responsePromise=t,this.parseResponse=r,Ln.set(this,void 0),R(this,Ln,e,"f")}_thenUnwrap(e){return new s(f(this,Ln,"f"),this.responsePromise,async(t,r)=>Pc(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(f(this,Ln,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Ln=new WeakMap;var to,Fn=class{constructor(e,t,r,n){to.set(this,void 0),R(this,to,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new S("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await f(this,to,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(to=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Nn=class extends Vt{constructor(e,t,r){super(e,t,async(n,i)=>new r(n,i.response,await eo(n,i),i.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Ne=class extends Fn{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},O=class extends Fn{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...yc(this.options.query),after:t}}:null}},Xe=class extends Fn{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...yc(this.options.query),after:e}}:null}};var Mc=()=>{if(typeof File>"u"){let{process:s}=globalThis,e=typeof s?.versions?.node=="string"&&parseInt(s.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function cs(s,e,t){return Mc(),new File(s,e??"unknown_file",t)}function Dn(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}var ro=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",Oc=async(s,e)=>kc(s.body)?{...s,body:await Qd(s.body,e)}:s,be=async(s,e)=>({...s,body:await Qd(s.body,e)}),Xd=new WeakMap;function Qm(s){let e=typeof s=="function"?s:s.fetch,t=Xd.get(e);if(t)return t;let r=(async()=>{try{let n="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new n(i).text()}catch{return!0}})();return Xd.set(e,r),r}var Qd=async(s,e)=>{if(!await Qm(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(s||{}).map(([r,n])=>Tc(t,r,n))),t},Yd=s=>s instanceof Blob&&"name"in s,Ym=s=>typeof s=="object"&&s!==null&&(s instanceof Response||ro(s)||Yd(s)),kc=s=>{if(Ym(s))return!0;if(Array.isArray(s))return s.some(kc);if(s&&typeof s=="object"){for(let e in s)if(kc(s[e]))return!0}return!1},Tc=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response)s.append(e,cs([await t.blob()],Dn(t)));else if(ro(t))s.append(e,cs([await new Response(Ki(t)).blob()],Dn(t)));else if(Yd(t))s.append(e,t,Dn(t));else if(Array.isArray(t))await Promise.all(t.map(r=>Tc(s,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,n])=>Tc(s,`${e}[${r}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Zd=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",Zm=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&Zd(s),eh=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function so(s,e,t){if(Mc(),s=await s,Zm(s))return s instanceof File?s:cs([await s.arrayBuffer()],s.name);if(eh(s)){let n=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),cs(await Lc(n),e,t)}let r=await Lc(s);if(e||(e=Dn(s)),!t?.type){let n=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof n=="string"&&(t={...t,type:n})}return cs(r,e,t)}async function Lc(s){let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(Zd(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(ro(s))for await(let t of s)e.push(...await Lc(t));else{let t=s?.constructor?.name;throw new Error(`Unexpected data type: ${typeof s}${t?`; constructor: ${t}`:""}${th(s)}`)}return e}function th(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}var b=class{constructor(e){this._client=e}};function tu(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var eu=Object.freeze(Object.create(null)),sh=(s=tu)=>function(t,...r){if(t.length===1)return t[0];let n=!1,i=[],o=t.reduce((d,u,m)=>{/[?#]/.test(u)&&(n=!0);let p=r[m],w=(n?encodeURIComponent:s)(""+p);return m!==r.length&&(p==null||typeof p=="object"&&p.toString===Object.getPrototypeOf(Object.getPrototypeOf(p.hasOwnProperty??eu)??eu)?.toString)&&(w=p+"",i.push({start:d.length+u.length,length:w.length,error:`Value of type ${Object.prototype.toString.call(p).slice(8,-1)} is not a valid path parameter`})),d+u+(m===r.length?"":w)},""),a=o.split(/[?#]/,1)[0],c=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,l;for(;(l=c.exec(a))!==null;)i.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(i.sort((d,u)=>d.start-u.start),i.length>0){let d=0,u=i.reduce((m,p)=>{let w=" ".repeat(p.start-d),v="^".repeat(p.length);return d=p.start+p.length,m+w+v},"");throw new S(`Path parameters result in path with invalid segments:
${i.map(m=>m.error).join(`
`)}
${o}
${u}`)}return o},y=sh(tu);var Gt=class extends b{list(e,t={},r){return this._client.getAPIList(y`/chat/completions/${e}/messages`,O,{query:t,...r})}};function $n(s){return s!==void 0&&"function"in s&&s.function!==void 0}function Bn(s){return s?.$brand==="auto-parseable-response-format"}function Wt(s){return s?.$brand==="auto-parseable-tool"}function ru(s,e){return!e||!Fc(e)?{...s,choices:s.choices.map(t=>(nu(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Un(s,e)}function Un(s,e){let t=s.choices.map(r=>{if(r.finish_reason==="length")throw new is;if(r.finish_reason==="content_filter")throw new os;return nu(r.message.tool_calls),{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:r.message.tool_calls?.map(n=>ah(e,n))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?oh(e,r.message.content):null}}});return{...s,choices:t}}function oh(s,e){return s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function ah(s,e){let t=s.tools?.find(r=>$n(r)&&r.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Wt(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function su(s,e){if(!s||!("tools"in s)||!s.tools)return!1;let t=s.tools?.find(r=>$n(r)&&r.function?.name===e.function.name);return $n(t)&&(Wt(t)||t?.function.strict||!1)}function Fc(s){return Bn(s.response_format)?!0:s.tools?.some(e=>Wt(e)||e.type==="function"&&e.function.strict===!0)??!1}function nu(s){for(let e of s||[])if(e.type!=="function")throw new S(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function iu(s){for(let e of s??[]){if(e.type!=="function")throw new S(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new S(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var ls=s=>s?.role==="assistant",Nc=s=>s?.role==="tool";var Dc,no,io,qn,jn,oo,Hn,Qe,Vn,ao,co,ds,ou,gt=class{constructor(){Dc.add(this),this.controller=new AbortController,no.set(this,void 0),io.set(this,()=>{}),qn.set(this,()=>{}),jn.set(this,void 0),oo.set(this,()=>{}),Hn.set(this,()=>{}),Qe.set(this,{}),Vn.set(this,!1),ao.set(this,!1),co.set(this,!1),ds.set(this,!1),R(this,no,new Promise((e,t)=>{R(this,io,e,"f"),R(this,qn,t,"f")}),"f"),R(this,jn,new Promise((e,t)=>{R(this,oo,e,"f"),R(this,Hn,t,"f")}),"f"),f(this,no,"f").catch(()=>{}),f(this,jn,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},f(this,Dc,"m",ou).bind(this))},0)}_connected(){this.ended||(f(this,io,"f").call(this),this._emit("connect"))}get ended(){return f(this,Vn,"f")}get errored(){return f(this,ao,"f")}get aborted(){return f(this,co,"f")}abort(){this.controller.abort()}on(e,t){return(f(this,Qe,"f")[e]||(f(this,Qe,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=f(this,Qe,"f")[e];if(!r)return this;let n=r.findIndex(i=>i.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(f(this,Qe,"f")[e]||(f(this,Qe,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{R(this,ds,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){R(this,ds,!0,"f"),await f(this,jn,"f")}_emit(e,...t){if(f(this,Vn,"f"))return;e==="end"&&(R(this,Vn,!0,"f"),f(this,oo,"f").call(this));let r=f(this,Qe,"f")[e];if(r&&(f(this,Qe,"f")[e]=r.filter(n=>!n.once),r.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!f(this,ds,"f")&&!r?.length&&Promise.reject(n),f(this,qn,"f").call(this,n),f(this,Hn,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!f(this,ds,"f")&&!r?.length&&Promise.reject(n),f(this,qn,"f").call(this,n),f(this,Hn,"f").call(this,n),this._emit("end")}}_emitFinal(){}};no=new WeakMap,io=new WeakMap,qn=new WeakMap,jn=new WeakMap,oo=new WeakMap,Hn=new WeakMap,Qe=new WeakMap,Vn=new WeakMap,ao=new WeakMap,co=new WeakMap,ds=new WeakMap,Dc=new WeakSet,ou=function(e){if(R(this,ao,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new K),e instanceof K)return R(this,co,!0,"f"),this._emit("abort",e);if(e instanceof S)return this._emit("error",e);if(e instanceof Error){let t=new S(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new S(String(e)))};function au(s){return typeof s.parse=="function"}var ue,$c,lo,Bc,Uc,qc,cu,lu,ch=10,us=class extends gt{constructor(){super(...arguments),ue.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),Nc(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(ls(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new S("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),f(this,ue,"m",$c).call(this)}async finalMessage(){return await this.done(),f(this,ue,"m",lo).call(this)}async finalFunctionToolCall(){return await this.done(),f(this,ue,"m",Bc).call(this)}async finalFunctionToolCallResult(){return await this.done(),f(this,ue,"m",Uc).call(this)}async totalUsage(){return await this.done(),f(this,ue,"m",qc).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=f(this,ue,"m",lo).call(this);t&&this._emit("finalMessage",t);let r=f(this,ue,"m",$c).call(this);r&&this._emit("finalContent",r);let n=f(this,ue,"m",Bc).call(this);n&&this._emit("finalFunctionToolCall",n);let i=f(this,ue,"m",Uc).call(this);i!=null&&this._emit("finalFunctionToolCallResult",i),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",f(this,ue,"m",qc).call(this))}async _createChatCompletion(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),f(this,ue,"m",cu).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Un(i,t))}async _runChatCompletion(e,t,r){for(let n of t.messages)this._addMessage(n,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){let n="tool",{tool_choice:i="auto",stream:o,...a}=t,c=typeof i!="string"&&i.type==="function"&&i?.function?.name,{maxChatCompletions:l=ch}=r||{},d=t.tools.map(p=>{if(Wt(p)){if(!p.$callback)throw new S("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:p.$callback,name:p.function.name,description:p.function.description||"",parameters:p.function.parameters,parse:p.$parseRaw,strict:!0}}}return p}),u={};for(let p of d)p.type==="function"&&(u[p.function.name||p.function.function.name]=p.function);let m="tools"in t?d.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description,strict:p.function.strict}}:p):void 0;for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){let v=(await this._createChatCompletion(e,{...a,tool_choice:i,tools:m,messages:[...this.messages]},r)).choices[0]?.message;if(!v)throw new S("missing message in ChatCompletion response");if(!v.tool_calls?.length)return;for(let _ of v.tool_calls){if(_.type!=="function")continue;let I=_.id,{name:A,arguments:M}=_.function,k=u[A];if(k){if(c&&c!==A){let U=`Invalid tool_call: ${JSON.stringify(A)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:n,tool_call_id:I,content:U});continue}}else{let U=`Invalid tool_call: ${JSON.stringify(A)}. Available options are: ${Object.keys(u).map(z=>JSON.stringify(z)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:I,content:U});continue}let N;try{N=au(k)?await k.parse(M):M}catch(U){let z=U instanceof Error?U.message:String(U);this._addMessage({role:n,tool_call_id:I,content:z});continue}let V=await k.function(N,this),L=f(this,ue,"m",lu).call(this,V);if(this._addMessage({role:n,tool_call_id:I,content:L}),c)return}}}};ue=new WeakSet,$c=function(){return f(this,ue,"m",lo).call(this).content??null},lo=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(ls(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new S("stream ended without producing a ChatCompletionMessage with role=assistant")},Bc=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ls(t)&&t?.tool_calls?.length)return t.tool_calls.filter(r=>r.type==="function").at(-1)?.function}},Uc=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Nc(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>r.role==="assistant"&&r.tool_calls?.some(n=>n.type==="function"&&n.id===t.tool_call_id)))return t.content}},qc=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},cu=function(e){if(e.n!=null&&e.n>1)throw new S("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},lu=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Gn=class s extends us{static runTools(e,t,r){let n=new s,i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}_addMessage(e,t=!0){super._addMessage(e,t),ls(e)&&e.content&&this._emit("content",e.content)}};var re={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},jc=class extends Error{},Hc=class extends Error{};function lh(s,e=re.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return dh(s.trim(),e)}var dh=(s,e)=>{let t=s.length,r=0,n=m=>{throw new jc(`${m} at position ${r}`)},i=m=>{throw new Hc(`${m} at position ${r}`)},o=()=>(u(),r>=t&&n("Unexpected end of input"),s[r]==='"'?a():s[r]==="{"?c():s[r]==="["?l():s.substring(r,r+4)==="null"||re.NULL&e&&t-r<4&&"null".startsWith(s.substring(r))?(r+=4,null):s.substring(r,r+4)==="true"||re.BOOL&e&&t-r<4&&"true".startsWith(s.substring(r))?(r+=4,!0):s.substring(r,r+5)==="false"||re.BOOL&e&&t-r<5&&"false".startsWith(s.substring(r))?(r+=5,!1):s.substring(r,r+8)==="Infinity"||re.INFINITY&e&&t-r<8&&"Infinity".startsWith(s.substring(r))?(r+=8,1/0):s.substring(r,r+9)==="-Infinity"||re.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(s.substring(r))?(r+=9,-1/0):s.substring(r,r+3)==="NaN"||re.NAN&e&&t-r<3&&"NaN".startsWith(s.substring(r))?(r+=3,NaN):d()),a=()=>{let m=r,p=!1;for(r++;r<t&&(s[r]!=='"'||p&&s[r-1]==="\\");)p=s[r]==="\\"?!p:!1,r++;if(s.charAt(r)=='"')try{return JSON.parse(s.substring(m,++r-Number(p)))}catch(w){i(String(w))}else if(re.STR&e)try{return JSON.parse(s.substring(m,r-Number(p))+'"')}catch{return JSON.parse(s.substring(m,s.lastIndexOf("\\"))+'"')}n("Unterminated string literal")},c=()=>{r++,u();let m={};try{for(;s[r]!=="}";){if(u(),r>=t&&re.OBJ&e)return m;let p=a();u(),r++;try{let w=o();Object.defineProperty(m,p,{value:w,writable:!0,enumerable:!0,configurable:!0})}catch(w){if(re.OBJ&e)return m;throw w}u(),s[r]===","&&r++}}catch{if(re.OBJ&e)return m;n("Expected '}' at end of object")}return r++,m},l=()=>{r++;let m=[];try{for(;s[r]!=="]";)m.push(o()),u(),s[r]===","&&r++}catch{if(re.ARR&e)return m;n("Expected ']' at end of array")}return r++,m},d=()=>{if(r===0){s==="-"&&re.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(s)}catch(p){if(re.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}i(String(p))}}let m=r;for(s[r]==="-"&&r++;s[r]&&!",]}".includes(s[r]);)r++;r==t&&!(re.NUM&e)&&n("Unterminated number literal");try{return JSON.parse(s.substring(m,r))}catch{s.substring(m,r)==="-"&&re.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(s.substring(m,s.lastIndexOf("e")))}catch(w){i(String(w))}}},u=()=>{for(;r<t&&` 
\r	`.includes(s[r]);)r++};return o()},Vc=s=>lh(s,re.ALL^re.NUM);var Z,Ye,ps,yt,Gc,uo,Wc,zc,Kc,po,Jc,du,zt=class s extends us{constructor(e){super(),Z.add(this),Ye.set(this,void 0),ps.set(this,void 0),yt.set(this,void 0),R(this,Ye,e,"f"),R(this,ps,[],"f")}get currentChatCompletionSnapshot(){return f(this,yt,"f")}static fromReadableStream(e){let t=new s(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let n=new s(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,r){super._createChatCompletion;let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),f(this,Z,"m",Gc).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let o of i)f(this,Z,"m",Wc).call(this,o);if(i.controller.signal?.aborted)throw new K;return this._addChatCompletion(f(this,Z,"m",po).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),f(this,Z,"m",Gc).call(this),this._connected();let n=Fe.fromReadableStream(e,this.controller),i;for await(let o of n)i&&i!==o.id&&this._addChatCompletion(f(this,Z,"m",po).call(this)),f(this,Z,"m",Wc).call(this,o),i=o.id;if(n.controller.signal?.aborted)throw new K;return this._addChatCompletion(f(this,Z,"m",po).call(this))}[(Ye=new WeakMap,ps=new WeakMap,yt=new WeakMap,Z=new WeakSet,Gc=function(){this.ended||R(this,yt,void 0,"f")},uo=function(t){let r=f(this,ps,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},f(this,ps,"f")[t.index]=r,r)},Wc=function(t){if(this.ended)return;let r=f(this,Z,"m",du).call(this,t);this._emit("chunk",t,r);for(let n of t.choices){let i=r.choices[n.index];n.delta.content!=null&&i.message?.role==="assistant"&&i.message?.content&&(this._emit("content",n.delta.content,i.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),n.delta.refusal!=null&&i.message?.role==="assistant"&&i.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:i.message.refusal}),n.logprobs?.content!=null&&i.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:i.logprobs?.content??[]}),n.logprobs?.refusal!=null&&i.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});let o=f(this,Z,"m",uo).call(this,i);i.finish_reason&&(f(this,Z,"m",Kc).call(this,i),o.current_tool_call_index!=null&&f(this,Z,"m",zc).call(this,i,o.current_tool_call_index));for(let a of n.delta.tool_calls??[])o.current_tool_call_index!==a.index&&(f(this,Z,"m",Kc).call(this,i),o.current_tool_call_index!=null&&f(this,Z,"m",zc).call(this,i,o.current_tool_call_index)),o.current_tool_call_index=a.index;for(let a of n.delta.tool_calls??[]){let c=i.message.tool_calls?.[a.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:a.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:a.function?.arguments??""}):(c?.type,void 0))}}},zc=function(t,r){if(f(this,Z,"m",uo).call(this,t).done_tool_calls.has(r))return;let i=t.message.tool_calls?.[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let o=f(this,Ye,"f")?.tools?.find(a=>$n(a)&&a.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:Wt(o)?o.$parseRaw(i.function.arguments):o?.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Kc=function(t){let r=f(this,Z,"m",uo).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let n=f(this,Z,"m",Jc).call(this);this._emit("content.done",{content:t.message.content,parsed:n?n.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},po=function(){if(this.ended)throw new S("stream has ended, this shouldn't happen");let t=f(this,yt,"f");if(!t)throw new S("request ended without sending any chunks");return R(this,yt,void 0,"f"),R(this,ps,[],"f"),uh(t,f(this,Ye,"f"))},Jc=function(){let t=f(this,Ye,"f")?.response_format;return Bn(t)?t:null},du=function(t){var r,n,i,o;let a=f(this,yt,"f"),{choices:c,...l}=t;a?Object.assign(a,l):a=R(this,yt,{...l,choices:[]},"f");for(let{delta:d,finish_reason:u,index:m,logprobs:p=null,...w}of t.choices){let v=a.choices[m];if(v||(v=a.choices[m]={finish_reason:u,index:m,message:{},logprobs:p,...w}),p)if(!v.logprobs)v.logprobs=Object.assign({},p);else{let{content:V,refusal:L,...U}=p;Object.assign(v.logprobs,U),V&&((r=v.logprobs).content??(r.content=[]),v.logprobs.content.push(...V)),L&&((n=v.logprobs).refusal??(n.refusal=[]),v.logprobs.refusal.push(...L))}if(u&&(v.finish_reason=u,f(this,Ye,"f")&&Fc(f(this,Ye,"f")))){if(u==="length")throw new is;if(u==="content_filter")throw new os}if(Object.assign(v,w),!d)continue;let{content:_,refusal:I,function_call:A,role:M,tool_calls:k,...N}=d;if(Object.assign(v.message,N),I&&(v.message.refusal=(v.message.refusal||"")+I),M&&(v.message.role=M),A&&(v.message.function_call?(A.name&&(v.message.function_call.name=A.name),A.arguments&&((i=v.message.function_call).arguments??(i.arguments=""),v.message.function_call.arguments+=A.arguments)):v.message.function_call=A),_&&(v.message.content=(v.message.content||"")+_,!v.message.refusal&&f(this,Z,"m",Jc).call(this)&&(v.message.parsed=Vc(v.message.content))),k){v.message.tool_calls||(v.message.tool_calls=[]);for(let{index:V,id:L,type:U,function:z,...j}of k){let G=(o=v.message.tool_calls)[V]??(o[V]={});Object.assign(G,j),L&&(G.id=L),U&&(G.type=U),z&&(G.function??(G.function={name:z.name??"",arguments:""})),z?.name&&(G.function.name=z.name),z?.arguments&&(G.function.arguments+=z.arguments,su(f(this,Ye,"f"),G)&&(G.function.parsed_arguments=Vc(G.function.arguments)))}}}return a},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Fe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function uh(s,e){let{id:t,choices:r,created:n,model:i,system_fingerprint:o,...a}=s,c={...a,id:t,choices:r.map(({message:l,finish_reason:d,index:u,logprobs:m,...p})=>{if(!d)throw new S(`missing finish_reason for choice ${u}`);let{content:w=null,function_call:v,tool_calls:_,...I}=l,A=l.role;if(!A)throw new S(`missing role for choice ${u}`);if(v){let{arguments:M,name:k}=v;if(M==null)throw new S(`missing function_call.arguments for choice ${u}`);if(!k)throw new S(`missing function_call.name for choice ${u}`);return{...p,message:{content:w,function_call:{arguments:M,name:k},role:A,refusal:l.refusal??null},finish_reason:d,index:u,logprobs:m}}return _?{...p,index:u,finish_reason:d,logprobs:m,message:{...I,role:A,content:w,refusal:l.refusal??null,tool_calls:_.map((M,k)=>{let{function:N,type:V,id:L,...U}=M,{arguments:z,name:j,...G}=N||{};if(L==null)throw new S(`missing choices[${u}].tool_calls[${k}].id
${mo(s)}`);if(V==null)throw new S(`missing choices[${u}].tool_calls[${k}].type
${mo(s)}`);if(j==null)throw new S(`missing choices[${u}].tool_calls[${k}].function.name
${mo(s)}`);if(z==null)throw new S(`missing choices[${u}].tool_calls[${k}].function.arguments
${mo(s)}`);return{...U,id:L,type:V,function:{...G,name:j,arguments:z}}})}}:{...p,message:{...I,content:w,role:A,refusal:l.refusal??null},finish_reason:d,index:u,logprobs:m}}),created:n,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}};return ru(c,e)}function mo(s){return JSON.stringify(s)}var Wn=class s extends zt{static fromReadableStream(e){let t=new s(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let n=new s(t),i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}};var Ze=class extends b{constructor(){super(...arguments),this.messages=new Gt(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(y`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(y`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",O,{query:e,...t})}delete(e,t){return this._client.delete(y`/chat/completions/${e}`,t)}parse(e,t){return iu(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>Un(r,e))}runTools(e,t){return e.stream?Wn.runTools(this._client,e,t):Gn.runTools(this._client,e,t)}stream(e,t){return zt.createChatCompletion(this._client,e,t)}};Ze.Messages=Gt;var bt=class extends b{constructor(){super(...arguments),this.completions=new Ze(this._client)}};bt.Completions=Ze;var uu=Symbol("brand.privateNullableHeaders");function*mh(s){if(!s)return;if(uu in s){let{values:r,nulls:n}=s;yield*r.entries();for(let i of n)yield[i,null];return}let e=!1,t;s instanceof Headers?t=s.entries():gc(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let r of t){let n=r[0];if(typeof n!="string")throw new TypeError("expected header name to be a string");let i=gc(r[1])?r[1]:[r[1]],o=!1;for(let a of i)a!==void 0&&(e&&!o&&(o=!0,yield[n,null]),yield[n,a])}}var x=s=>{let e=new Headers,t=new Set;for(let r of s){let n=new Set;for(let[i,o]of mh(r)){let a=i.toLowerCase();n.has(a)||(e.delete(i),n.add(a)),o===null?(e.delete(i),t.add(a)):(e.append(i,o),t.delete(a))}}return{[uu]:!0,values:e,nulls:t}};var ms=class extends b{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:x([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}};var hs=class extends b{create(e,t){return this._client.post("/audio/transcriptions",be({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var fs=class extends b{create(e,t){return this._client.post("/audio/translations",be({body:e,...t,__metadata:{model:e.model}},this._client))}};var De=class extends b{constructor(){super(...arguments),this.transcriptions=new hs(this._client),this.translations=new fs(this._client),this.speech=new ms(this._client)}};De.Transcriptions=hs;De.Translations=fs;De.Speech=ms;var Kt=class extends b{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(y`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",O,{query:e,...t})}cancel(e,t){return this._client.post(y`/batches/${e}/cancel`,t)}};var gs=class extends b{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(y`/assistants/${e}`,{...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(y`/assistants/${e}`,{body:t,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",O,{query:e,...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(y`/assistants/${e}`,{...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var ys=class extends b{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var bs=class extends b{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var wt=class extends b{constructor(){super(...arguments),this.sessions=new ys(this._client),this.transcriptionSessions=new bs(this._client)}};wt.Sessions=ys;wt.TranscriptionSessions=bs;var ws=class extends b{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:x([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(y`/chatkit/sessions/${e}/cancel`,{...t,headers:x([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}};var vs=class extends b{retrieve(e,t){return this._client.get(y`/chatkit/threads/${e}`,{...t,headers:x([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",Xe,{query:e,...t,headers:x([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(y`/chatkit/threads/${e}`,{...t,headers:x([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},r){return this._client.getAPIList(y`/chatkit/threads/${e}/items`,Xe,{query:t,...r,headers:x([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}};var vt=class extends b{constructor(){super(...arguments),this.sessions=new ws(this._client),this.threads=new vs(this._client)}};vt.Sessions=ws;vt.Threads=vs;var As=class extends b{create(e,t,r){return this._client.post(y`/threads/${e}/messages`,{body:t,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{thread_id:n}=t;return this._client.get(y`/threads/${n}/messages/${e}`,{...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:n,...i}=t;return this._client.post(y`/threads/${n}/messages/${e}`,{body:i,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(y`/threads/${e}/messages`,O,{query:t,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{thread_id:n}=t;return this._client.delete(y`/threads/${n}/messages/${e}`,{...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var xs=class extends b{retrieve(e,t,r){let{thread_id:n,run_id:i,...o}=t;return this._client.get(y`/threads/${n}/runs/${i}/steps/${e}`,{query:o,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t,r){let{thread_id:n,...i}=t;return this._client.getAPIList(y`/threads/${n}/runs/${e}/steps`,O,{query:i,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var pu=s=>{if(typeof Buffer<"u"){let e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(s),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return Array.from(new Float32Array(r.buffer))}};var At=s=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[s]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(s)?.trim()};var oe,Xt,Xc,$e,ho,_e,Qt,Is,Jt,yo,we,fo,go,Jn,zn,Kn,mu,hu,fu,gu,yu,bu,wu,et=class extends gt{constructor(){super(...arguments),oe.add(this),Xc.set(this,[]),$e.set(this,{}),ho.set(this,{}),_e.set(this,void 0),Qt.set(this,void 0),Is.set(this,void 0),Jt.set(this,void 0),yo.set(this,void 0),we.set(this,void 0),fo.set(this,void 0),go.set(this,void 0),Jn.set(this,void 0)}[(Xc=new WeakMap,$e=new WeakMap,ho=new WeakMap,_e=new WeakMap,Qt=new WeakMap,Is=new WeakMap,Jt=new WeakMap,yo=new WeakMap,we=new WeakMap,fo=new WeakMap,go=new WeakMap,Jn=new WeakMap,oe=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new Xt;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=Fe.fromReadableStream(e,this.controller);for await(let i of n)f(this,oe,"m",zn).call(this,i);if(n.controller.signal?.aborted)throw new K;return this._addRun(f(this,oe,"m",Kn).call(this))}toReadableStream(){return new Fe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,n){let i=new Xt;return i._run(()=>i._runToolAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...r,stream:!0},a=await e.submitToolOutputs(t,o,{...n,signal:this.controller.signal});this._connected();for await(let c of a)f(this,oe,"m",zn).call(this,c);if(a.controller.signal?.aborted)throw new K;return this._addRun(f(this,oe,"m",Kn).call(this))}static createThreadAssistantStream(e,t,r){let n=new Xt;return n._run(()=>n._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,r,n){let i=new Xt;return i._run(()=>i._runAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return f(this,fo,"f")}currentRun(){return f(this,go,"f")}currentMessageSnapshot(){return f(this,_e,"f")}currentRunStepSnapshot(){return f(this,Jn,"f")}async finalRunSteps(){return await this.done(),Object.values(f(this,$e,"f"))}async finalMessages(){return await this.done(),Object.values(f(this,ho,"f"))}async finalRun(){if(await this.done(),!f(this,Qt,"f"))throw Error("Final run was not received.");return f(this,Qt,"f")}async _createThreadAssistantStream(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},o=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(let a of o)f(this,oe,"m",zn).call(this,a);if(o.controller.signal?.aborted)throw new K;return this._addRun(f(this,oe,"m",Kn).call(this))}async _createAssistantStream(e,t,r,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...r,stream:!0},a=await e.create(t,o,{...n,signal:this.controller.signal});this._connected();for await(let c of a)f(this,oe,"m",zn).call(this,c);if(a.controller.signal?.aborted)throw new K;return this._addRun(f(this,oe,"m",Kn).call(this))}static accumulateDelta(e,t){for(let[r,n]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=n;continue}let i=e[r];if(i==null){e[r]=n;continue}if(r==="index"||r==="type"){e[r]=n;continue}if(typeof i=="string"&&typeof n=="string")i+=n;else if(typeof i=="number"&&typeof n=="number")i+=n;else if(Tn(i)&&Tn(n))i=this.accumulateDelta(i,n);else if(Array.isArray(i)&&Array.isArray(n)){if(i.every(o=>typeof o=="string"||typeof o=="number")){i.push(...n);continue}for(let o of n){if(!Tn(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);let a=o.index;if(a==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);let c=i[a];c==null?i.push(o):i[a]=this.accumulateDelta(c,o)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${n}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,n){return await this._createAssistantStream(t,e,r,n)}async _runToolAssistantStream(e,t,r,n){return await this._createToolAssistantStream(t,e,r,n)}};Xt=et,zn=function(e){if(!this.ended)switch(R(this,fo,e,"f"),f(this,oe,"m",fu).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":f(this,oe,"m",wu).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":f(this,oe,"m",hu).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":f(this,oe,"m",mu).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Kn=function(){if(this.ended)throw new S("stream has ended, this shouldn't happen");if(!f(this,Qt,"f"))throw Error("Final run has not been received");return f(this,Qt,"f")},mu=function(e){let[t,r]=f(this,oe,"m",yu).call(this,e,f(this,_e,"f"));R(this,_e,t,"f"),f(this,ho,"f")[t.id]=t;for(let n of r){let i=t.content[n.index];i?.type=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let n of e.data.delta.content){if(n.type=="text"&&n.text){let i=n.text,o=t.content[n.index];if(o&&o.type=="text")this._emit("textDelta",i,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(n.index!=f(this,Is,"f")){if(f(this,Jt,"f"))switch(f(this,Jt,"f").type){case"text":this._emit("textDone",f(this,Jt,"f").text,f(this,_e,"f"));break;case"image_file":this._emit("imageFileDone",f(this,Jt,"f").image_file,f(this,_e,"f"));break}R(this,Is,n.index,"f")}R(this,Jt,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(f(this,Is,"f")!==void 0){let n=e.data.content[f(this,Is,"f")];if(n)switch(n.type){case"image_file":this._emit("imageFileDone",n.image_file,f(this,_e,"f"));break;case"text":this._emit("textDone",n.text,f(this,_e,"f"));break}}f(this,_e,"f")&&this._emit("messageDone",e.data),R(this,_e,void 0,"f")}},hu=function(e){let t=f(this,oe,"m",gu).call(this,e);switch(R(this,Jn,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of r.step_details.tool_calls)i.index==f(this,yo,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(f(this,we,"f")&&this._emit("toolCallDone",f(this,we,"f")),R(this,yo,i.index,"f"),R(this,we,t.step_details.tool_calls[i.index],"f"),f(this,we,"f")&&this._emit("toolCallCreated",f(this,we,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":R(this,Jn,void 0,"f"),e.data.step_details.type=="tool_calls"&&f(this,we,"f")&&(this._emit("toolCallDone",f(this,we,"f")),R(this,we,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},fu=function(e){f(this,Xc,"f").push(e),this._emit("event",e)},gu=function(e){switch(e.event){case"thread.run.step.created":return f(this,$e,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=f(this,$e,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let n=Xt.accumulateDelta(t,r.delta);f(this,$e,"f")[e.data.id]=n}return f(this,$e,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":f(this,$e,"f")[e.data.id]=e.data;break}if(f(this,$e,"f")[e.data.id])return f(this,$e,"f")[e.data.id];throw new Error("No snapshot available")},yu=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let i of n.delta.content)if(i.index in t.content){let o=t.content[i.index];t.content[i.index]=f(this,oe,"m",bu).call(this,i,o)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},bu=function(e,t){return Xt.accumulateDelta(t,e)},wu=function(e){switch(R(this,go,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":R(this,Qt,e.data,"f"),f(this,we,"f")&&(this._emit("toolCallDone",f(this,we,"f")),R(this,we,void 0,"f"));break;case"thread.run.cancelling":break}};var Yt=class extends b{constructor(){super(...arguments),this.steps=new xs(this._client)}create(e,t,r){let{include:n,...i}=t;return this._client.post(y`/threads/${e}/runs`,{query:{include:n},body:i,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}retrieve(e,t,r){let{thread_id:n}=t;return this._client.get(y`/threads/${n}/runs/${e}`,{...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:n,...i}=t;return this._client.post(y`/threads/${n}/runs/${e}`,{body:i,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(y`/threads/${e}/runs`,O,{query:t,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{thread_id:n}=t;return this._client.post(y`/threads/${n}/runs/${e}/cancel`,{...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(n.id,{thread_id:e},r)}createAndStream(e,t,r){return et.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let n=x([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:o}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...n}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(r?.pollIntervalMs)a=r.pollIntervalMs;else{let c=o.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(a=l)}}await Oe(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return et.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){let{thread_id:n,...i}=t;return this._client.post(y`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:i,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){let n=await this.submitToolOutputs(e,t,r);return await this.poll(n.id,t,r)}submitToolOutputsStream(e,t,r){return et.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}};Yt.Steps=xs;var xt=class extends b{constructor(){super(...arguments),this.runs=new Yt(this._client),this.messages=new As(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(y`/threads/${e}`,{...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(y`/threads/${e}`,{body:t,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t){return this._client.delete(y`/threads/${e}`,{...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return et.createThreadAssistantStream(e,this._client.beta.threads,t)}};xt.Runs=Yt;xt.Messages=As;var Ce=class extends b{constructor(){super(...arguments),this.realtime=new wt(this._client),this.chatkit=new vt(this._client),this.assistants=new gs(this._client),this.threads=new xt(this._client)}};Ce.Realtime=wt;Ce.ChatKit=vt;Ce.Assistants=gs;Ce.Threads=xt;var Zt=class extends b{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var Ss=class extends b{retrieve(e,t,r){let{container_id:n}=t;return this._client.get(y`/containers/${n}/files/${e}/content`,{...r,headers:x([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}};var er=class extends b{constructor(){super(...arguments),this.content=new Ss(this._client)}create(e,t,r){return this._client.post(y`/containers/${e}/files`,be({body:t,...r},this._client))}retrieve(e,t,r){let{container_id:n}=t;return this._client.get(y`/containers/${n}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(y`/containers/${e}/files`,O,{query:t,...r})}delete(e,t,r){let{container_id:n}=t;return this._client.delete(y`/containers/${n}/files/${e}`,{...r,headers:x([{Accept:"*/*"},r?.headers])})}};er.Content=Ss;var It=class extends b{constructor(){super(...arguments),this.files=new er(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(y`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",O,{query:e,...t})}delete(e,t){return this._client.delete(y`/containers/${e}`,{...t,headers:x([{Accept:"*/*"},t?.headers])})}};It.Files=er;var Es=class extends b{create(e,t,r){let{include:n,...i}=t;return this._client.post(y`/conversations/${e}/items`,{query:{include:n},body:i,...r})}retrieve(e,t,r){let{conversation_id:n,...i}=t;return this._client.get(y`/conversations/${n}/items/${e}`,{query:i,...r})}list(e,t={},r){return this._client.getAPIList(y`/conversations/${e}/items`,Xe,{query:t,...r})}delete(e,t,r){let{conversation_id:n}=t;return this._client.delete(y`/conversations/${n}/items/${e}`,r)}};var St=class extends b{constructor(){super(...arguments),this.items=new Es(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(y`/conversations/${e}`,t)}update(e,t,r){return this._client.post(y`/conversations/${e}`,{body:t,...r})}delete(e,t){return this._client.delete(y`/conversations/${e}`,t)}};St.Items=Es;var tr=class extends b{create(e,t){let r=!!e.encoding_format,n=r?e.encoding_format:"base64";r&&W(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return r?i:(W(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(o=>(o&&o.data&&o.data.forEach(a=>{let c=a.embedding;a.embedding=pu(c)}),o)))}};var _s=class extends b{retrieve(e,t,r){let{eval_id:n,run_id:i}=t;return this._client.get(y`/evals/${n}/runs/${i}/output_items/${e}`,r)}list(e,t,r){let{eval_id:n,...i}=t;return this._client.getAPIList(y`/evals/${n}/runs/${e}/output_items`,O,{query:i,...r})}};var rr=class extends b{constructor(){super(...arguments),this.outputItems=new _s(this._client)}create(e,t,r){return this._client.post(y`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){let{eval_id:n}=t;return this._client.get(y`/evals/${n}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(y`/evals/${e}/runs`,O,{query:t,...r})}delete(e,t,r){let{eval_id:n}=t;return this._client.delete(y`/evals/${n}/runs/${e}`,r)}cancel(e,t,r){let{eval_id:n}=t;return this._client.post(y`/evals/${n}/runs/${e}`,r)}};rr.OutputItems=_s;var Et=class extends b{constructor(){super(...arguments),this.runs=new rr(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(y`/evals/${e}`,t)}update(e,t,r){return this._client.post(y`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",O,{query:e,...t})}delete(e,t){return this._client.delete(y`/evals/${e}`,t)}};Et.Runs=rr;var sr=class extends b{create(e,t){return this._client.post("/files",be({body:e,...t},this._client))}retrieve(e,t){return this._client.get(y`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",O,{query:e,...t})}delete(e,t){return this._client.delete(y`/files/${e}`,t)}content(e,t){return this._client.get(y`/files/${e}/content`,{...t,headers:x([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let n=new Set(["processed","error","deleted"]),i=Date.now(),o=await this.retrieve(e);for(;!o.status||!n.has(o.status);)if(await Oe(t),o=await this.retrieve(e),Date.now()-i>r)throw new ht({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return o}};var Cs=class extends b{};var Rs=class extends b{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var nr=class extends b{constructor(){super(...arguments),this.graders=new Rs(this._client)}};nr.Graders=Rs;var Ps=class extends b{create(e,t,r){return this._client.getAPIList(y`/fine_tuning/checkpoints/${e}/permissions`,Ne,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(y`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(y`/fine_tuning/checkpoints/${n}/permissions/${e}`,r)}};var ir=class extends b{constructor(){super(...arguments),this.permissions=new Ps(this._client)}};ir.Permissions=Ps;var ks=class extends b{list(e,t={},r){return this._client.getAPIList(y`/fine_tuning/jobs/${e}/checkpoints`,O,{query:t,...r})}};var or=class extends b{constructor(){super(...arguments),this.checkpoints=new ks(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(y`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",O,{query:e,...t})}cancel(e,t){return this._client.post(y`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(y`/fine_tuning/jobs/${e}/events`,O,{query:t,...r})}pause(e,t){return this._client.post(y`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(y`/fine_tuning/jobs/${e}/resume`,t)}};or.Checkpoints=ks;var Re=class extends b{constructor(){super(...arguments),this.methods=new Cs(this._client),this.jobs=new or(this._client),this.checkpoints=new ir(this._client),this.alpha=new nr(this._client)}};Re.Methods=Cs;Re.Jobs=or;Re.Checkpoints=ir;Re.Alpha=nr;var Ts=class extends b{};var _t=class extends b{constructor(){super(...arguments),this.graderModels=new Ts(this._client)}};_t.GraderModels=Ts;var ar=class extends b{createVariation(e,t){return this._client.post("/images/variations",be({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",be({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}};var cr=class extends b{retrieve(e,t){return this._client.get(y`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Ne,e)}delete(e,t){return this._client.delete(y`/models/${e}`,t)}};var lr=class extends b{create(e,t){return this._client.post("/moderations",{body:e,...t})}};var Ms=class extends b{accept(e,t,r){return this._client.post(y`/realtime/calls/${e}/accept`,{body:t,...r,headers:x([{Accept:"*/*"},r?.headers])})}hangup(e,t){return this._client.post(y`/realtime/calls/${e}/hangup`,{...t,headers:x([{Accept:"*/*"},t?.headers])})}refer(e,t,r){return this._client.post(y`/realtime/calls/${e}/refer`,{body:t,...r,headers:x([{Accept:"*/*"},r?.headers])})}reject(e,t={},r){return this._client.post(y`/realtime/calls/${e}/reject`,{body:t,...r,headers:x([{Accept:"*/*"},r?.headers])})}};var Os=class extends b{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}};var tt=class extends b{constructor(){super(...arguments),this.clientSecrets=new Os(this._client),this.calls=new Ms(this._client)}};tt.ClientSecrets=Os;tt.Calls=Ms;function vu(s,e){return!e||!Vh(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:Qc(s,e)}function Qc(s,e){let t=s.output.map(n=>{if(n.type==="function_call")return{...n,parsed_arguments:zh(e,n)};if(n.type==="message"){let i=n.content.map(o=>o.type==="output_text"?{...o,parsed:Hh(e,o.text)}:o);return{...n,content:i}}return n}),r=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||bo(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let n of r.output)if(n.type==="message"){for(let i of n.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),r}function Hh(s,e){return s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(e):JSON.parse(e)}function Vh(s){return!!Bn(s.text?.format)}function Gh(s){return s?.$brand==="auto-parseable-tool"}function Wh(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function zh(s,e){let t=Wh(s.tools??[],e.name);return{...e,...e,parsed_arguments:Gh(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function bo(s){let e=[];for(let t of s.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);s.output_text=e.join("")}var Ls,wo,Ct,vo,Au,xu,Iu,Su,Ao=class s extends gt{constructor(e){super(),Ls.add(this),wo.set(this,void 0),Ct.set(this,void 0),vo.set(this,void 0),R(this,wo,e,"f")}static createResponse(e,t,r){let n=new s(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),f(this,Ls,"m",Au).call(this);let i,o=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),o=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(let a of i)f(this,Ls,"m",xu).call(this,a,o);if(i.controller.signal?.aborted)throw new K;return f(this,Ls,"m",Iu).call(this)}[(wo=new WeakMap,Ct=new WeakMap,vo=new WeakMap,Ls=new WeakSet,Au=function(){this.ended||R(this,Ct,void 0,"f")},xu=function(t,r){if(this.ended)return;let n=(o,a)=>{(r==null||a.sequence_number>r)&&this._emit(o,a)},i=f(this,Ls,"m",Su).call(this,t);switch(n("event",t),t.type){case"response.output_text.delta":{let o=i.output[t.output_index];if(!o)throw new S(`missing output at index ${t.output_index}`);if(o.type==="message"){let a=o.content[t.content_index];if(!a)throw new S(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new S(`expected content to be 'output_text', got ${a.type}`);n("response.output_text.delta",{...t,snapshot:a.text})}break}case"response.function_call_arguments.delta":{let o=i.output[t.output_index];if(!o)throw new S(`missing output at index ${t.output_index}`);o.type==="function_call"&&n("response.function_call_arguments.delta",{...t,snapshot:o.arguments});break}default:n(t.type,t);break}},Iu=function(){if(this.ended)throw new S("stream has ended, this shouldn't happen");let t=f(this,Ct,"f");if(!t)throw new S("request ended without sending any events");R(this,Ct,void 0,"f");let r=Kh(t,f(this,wo,"f"));return R(this,vo,r,"f"),r},Su=function(t){let r=f(this,Ct,"f");if(!r){if(t.type!=="response.created")throw new S(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=R(this,Ct,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let n=r.output[t.output_index];if(!n)throw new S(`missing output at index ${t.output_index}`);let i=n.type,o=t.part;i==="message"&&o.type!=="reasoning_text"?n.content.push(o):i==="reasoning"&&o.type==="reasoning_text"&&(n.content||(n.content=[]),n.content.push(o));break}case"response.output_text.delta":{let n=r.output[t.output_index];if(!n)throw new S(`missing output at index ${t.output_index}`);if(n.type==="message"){let i=n.content[t.content_index];if(!i)throw new S(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new S(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{let n=r.output[t.output_index];if(!n)throw new S(`missing output at index ${t.output_index}`);n.type==="function_call"&&(n.arguments+=t.delta);break}case"response.reasoning_text.delta":{let n=r.output[t.output_index];if(!n)throw new S(`missing output at index ${t.output_index}`);if(n.type==="reasoning"){let i=n.content?.[t.content_index];if(!i)throw new S(`missing content at index ${t.content_index}`);if(i.type!=="reasoning_text")throw new S(`expected content to be 'reasoning_text', got ${i.type}`);i.text+=t.delta}break}case"response.completed":{R(this,Ct,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{r=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{r=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,o)=>t.push({resolve:i,reject:o})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=f(this,vo,"f");if(!e)throw new S("stream ended without producing a ChatCompletion");return e}};function Kh(s,e){return vu(s,e)}var Fs=class extends b{list(e,t={},r){return this._client.getAPIList(y`/responses/${e}/input_items`,O,{query:t,...r})}};var Ns=class extends b{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}};var rt=class extends b{constructor(){super(...arguments),this.inputItems=new Fs(this._client),this.inputTokens=new Ns(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&bo(r),r))}retrieve(e,t={},r){return this._client.get(y`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&bo(n),n))}delete(e,t){return this._client.delete(y`/responses/${e}`,{...t,headers:x([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>Qc(r,e))}stream(e,t){return Ao.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(y`/responses/${e}/cancel`,t)}};rt.InputItems=Fs;rt.InputTokens=Ns;var Ds=class extends b{create(e,t,r){return this._client.post(y`/uploads/${e}/parts`,be({body:t,...r},this._client))}};var Rt=class extends b{constructor(){super(...arguments),this.parts=new Ds(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(y`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(y`/uploads/${e}/complete`,{body:t,...r})}};Rt.Parts=Ds;var Eu=async s=>{let e=await Promise.allSettled(s),t=e.filter(n=>n.status==="rejected");if(t.length){for(let n of t)console.error(n.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let n of e)n.status==="fulfilled"&&r.push(n.value);return r};var $s=class extends b{create(e,t,r){return this._client.post(y`/vector_stores/${e}/file_batches`,{body:t,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:n}=t;return this._client.get(y`/vector_stores/${n}/file_batches/${e}`,{...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{vector_store_id:n}=t;return this._client.post(y`/vector_stores/${n}/file_batches/${e}/cancel`,{...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t);return await this.poll(e,n.id,r)}listFiles(e,t,r){let{vector_store_id:n,...i}=t;return this._client.getAPIList(y`/vector_stores/${n}/file_batches/${e}/files`,O,{query:i,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(e,t,r){let n=x([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:o}=await this.retrieve(t,{vector_store_id:e},{...r,headers:n}).withResponse();switch(i.status){case"in_progress":let a=5e3;if(r?.pollIntervalMs)a=r.pollIntervalMs;else{let c=o.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(a=l)}}await Oe(a);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},n){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=n?.maxConcurrency??5,o=Math.min(i,t.length),a=this._client,c=t.values(),l=[...r];async function d(m){for(let p of m){let w=await a.files.create({file:p,purpose:"assistants"},n);l.push(w.id)}}let u=Array(o).fill(c).map(d);return await Eu(u),await this.createAndPoll(e,{file_ids:l})}};var Bs=class extends b{create(e,t,r){return this._client.post(y`/vector_stores/${e}/files`,{body:t,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:n}=t;return this._client.get(y`/vector_stores/${n}/files/${e}`,{...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{vector_store_id:n,...i}=t;return this._client.post(y`/vector_stores/${n}/files/${e}`,{body:i,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(y`/vector_stores/${e}/files`,O,{query:t,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{vector_store_id:n}=t;return this._client.delete(y`/vector_stores/${n}/files/${e}`,{...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}async poll(e,t,r){let n=x([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(t,{vector_store_id:e},{...r,headers:n}).withResponse(),o=i.data;switch(o.status){case"in_progress":let a=5e3;if(r?.pollIntervalMs)a=r.pollIntervalMs;else{let c=i.response.headers.get("openai-poll-after-ms");if(c){let l=parseInt(c);isNaN(l)||(a=l)}}await Oe(a);break;case"failed":case"completed":return o}}}async upload(e,t,r){let n=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:n.id},r)}async uploadAndPoll(e,t,r){let n=await this.upload(e,t,r);return await this.poll(e,n.id,r)}content(e,t,r){let{vector_store_id:n}=t;return this._client.getAPIList(y`/vector_stores/${n}/files/${e}/content`,Ne,{...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var st=class extends b{constructor(){super(...arguments),this.files=new Bs(this._client),this.fileBatches=new $s(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(y`/vector_stores/${e}`,{...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(y`/vector_stores/${e}`,{body:t,...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",O,{query:e,...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(y`/vector_stores/${e}`,{...t,headers:x([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,r){return this._client.getAPIList(y`/vector_stores/${e}/search`,Ne,{body:t,method:"post",...r,headers:x([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};st.Files=Bs;st.FileBatches=$s;var dr=class extends b{create(e,t){return this._client.post("/videos",Oc({body:e,...t},this._client))}retrieve(e,t){return this._client.get(y`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",Xe,{query:e,...t})}delete(e,t){return this._client.delete(y`/videos/${e}`,t)}downloadContent(e,t={},r){return this._client.get(y`/videos/${e}/content`,{query:t,...r,headers:x([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}remix(e,t,r){return this._client.post(y`/videos/${e}/remix`,Oc({body:t,...r},this._client))}};var Us,_u,xo,ur=class extends b{constructor(){super(...arguments),Us.add(this)}async unwrap(e,t,r=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,r,n),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,n=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");f(this,Us,"m",_u).call(this,r);let i=x([t]).values,o=f(this,Us,"m",xo).call(this,i,"webhook-signature"),a=f(this,Us,"m",xo).call(this,i,"webhook-timestamp"),c=f(this,Us,"m",xo).call(this,i,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new Me("Invalid webhook timestamp format");let d=Math.floor(Date.now()/1e3);if(d-l>n)throw new Me("Webhook timestamp is too old");if(l>d+n)throw new Me("Webhook timestamp is too new");let u=o.split(" ").map(v=>v.startsWith("v1,")?v.substring(3):v),m=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),p=c?`${c}.${a}.${e}`:`${a}.${e}`,w=await crypto.subtle.importKey("raw",m,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let v of u)try{let _=Buffer.from(v,"base64");if(await crypto.subtle.verify("HMAC",w,_,new TextEncoder().encode(p)))return}catch{continue}throw new Me("The given webhook signature does not match the expected signature")}};Us=new WeakSet,_u=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},xo=function(e,t){if(!e)throw new Error("Headers are required");let r=e.get(t);if(r==null)throw new Error(`Missing required header: ${t}`);return r};var Yc,Zc,Io,Cu,P=class{constructor({baseURL:e=At("OPENAI_BASE_URL"),apiKey:t=At("OPENAI_API_KEY"),organization:r=At("OPENAI_ORG_ID")??null,project:n=At("OPENAI_PROJECT_ID")??null,webhookSecret:i=At("OPENAI_WEBHOOK_SECRET")??null,...o}={}){if(Yc.add(this),Io.set(this,void 0),this.completions=new Zt(this),this.chat=new bt(this),this.embeddings=new tr(this),this.files=new sr(this),this.images=new ar(this),this.audio=new De(this),this.moderations=new lr(this),this.models=new cr(this),this.fineTuning=new Re(this),this.graders=new _t(this),this.vectorStores=new st(this),this.webhooks=new ur(this),this.beta=new Ce(this),this.batches=new Kt(this),this.uploads=new Rt(this),this.responses=new rt(this),this.realtime=new tt(this),this.conversations=new St(this),this.evals=new Et(this),this.containers=new It(this),this.videos=new dr(this),t===void 0)throw new S("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let a={apiKey:t,organization:r,project:n,webhookSecret:i,...o,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Ld())throw new S(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=a.baseURL,this.timeout=a.timeout??Zc.DEFAULT_TIMEOUT,this.logger=a.logger??console;let c="warn";this.logLevel=c,this.logLevel=Cc(a.logLevel,"ClientOptions.logLevel",this)??Cc(At("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??c,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??Nd(),R(this,Io,$d,"f"),this._options=a,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=r,this.project=n,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return x([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Ec(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${ft}`}defaultIdempotencyKey(){return`stainless-node-retry-${fc()}`}makeStatusError(e,t,r,n){return Q.generate(e,t,r,n)}async _callApiKey(){let e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=await e()}catch(r){throw r instanceof S?r:new S(`Failed to get token from 'apiKey' function: ${r.message}`,{cause:r})}if(typeof t!="string"||!t)throw new S(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,r){let n=!f(this,Yc,"m",Cu).call(this)&&r||this.baseURL,i=_d(e)?new URL(e):new URL(n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return Cd(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new Vt(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let n=await e,i=n.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(n);let{req:o,url:a,timeout:c}=await this.buildRequest(n,{retryCount:i-t});await this.prepareRequest(o,{url:a,options:n});let l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,u=Date.now();if(W(this).debug(`[${l}] sending request`,Je({retryOfRequestLogID:r,method:n.method,url:a,options:n,headers:o.headers})),n.signal?.aborted)throw new K;let m=new AbortController,p=await this.fetchWithTimeout(a,o,c,m).catch(kn),w=Date.now();if(p instanceof globalThis.Error){let I=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new K;let A=Pn(p)||/timed? ?out/i.test(String(p)+("cause"in p?String(p.cause):""));if(t)return W(this).info(`[${l}] connection ${A?"timed out":"failed"} - ${I}`),W(this).debug(`[${l}] connection ${A?"timed out":"failed"} (${I})`,Je({retryOfRequestLogID:r,url:a,durationMs:w-u,message:p.message})),this.retryRequest(n,t,r??l);throw W(this).info(`[${l}] connection ${A?"timed out":"failed"} - error; no more retries left`),W(this).debug(`[${l}] connection ${A?"timed out":"failed"} (error; no more retries left)`,Je({retryOfRequestLogID:r,url:a,durationMs:w-u,message:p.message})),A?new ht:new mt({cause:p})}let v=[...p.headers.entries()].filter(([I])=>I==="x-request-id").map(([I,A])=>", "+I+": "+JSON.stringify(A)).join(""),_=`[${l}${d}${v}] ${o.method} ${a} ${p.ok?"succeeded":"failed"} with status ${p.status} in ${w-u}ms`;if(!p.ok){let I=await this.shouldRetry(p);if(t&&I){let L=`retrying, ${t} attempts remaining`;return await Dd(p.body),W(this).info(`${_} - ${L}`),W(this).debug(`[${l}] response error (${L})`,Je({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:w-u})),this.retryRequest(n,t,r??l,p.headers)}let A=I?"error; no more retries left":"error; not retryable";W(this).info(`${_} - ${A}`);let M=await p.text().catch(L=>kn(L).message),k=kd(M),N=k?void 0:M;throw W(this).debug(`[${l}] response error (${A})`,Je({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,message:N,durationMs:Date.now()-u})),this.makeStatusError(p.status,k,N,p.headers)}return W(this).info(_),W(this).debug(`[${l}] response start`,Je({retryOfRequestLogID:r,url:p.url,status:p.status,headers:p.headers,durationMs:w-u})),{response:p,options:n,controller:m,requestLogID:l,retryOfRequestLogID:r,startTime:u}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){let r=this.makeRequest(t,null,void 0);return new Nn(this,r,e)}async fetchWithTimeout(e,t,r,n){let{signal:i,method:o,...a}=t||{};i&&i.addEventListener("abort",()=>n.abort());let c=setTimeout(()=>n.abort(),r),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||typeof a.body=="object"&&a.body!==null&&Symbol.asyncIterator in a.body,d={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};o&&(d.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(c)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,n){let i,o=n?.get("retry-after-ms");if(o){let c=parseFloat(o);Number.isNaN(c)||(i=c)}let a=n?.get("retry-after");if(a&&!i){let c=parseFloat(a);Number.isNaN(c)?i=Date.parse(a)-Date.now():i=c*1e3}if(!(i&&0<=i&&i<60*1e3)){let c=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,c)}return await Oe(i),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,o=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:n,path:i,query:o,defaultBaseURL:a}=r,c=this.buildURL(i,o,a);"timeout"in r&&Pd("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:d}=this.buildBody({options:r}),u=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:u,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"},...d&&{body:d},...this.fetchOptions??{},...r.fetchOptions??{}},url:c,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:n}){let i={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let o=x([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Fd(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=x([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Ki(e)}:f(this,Io,"f").call(this,{body:e,headers:r})}};Zc=P,Io=new WeakMap,Yc=new WeakSet,Cu=function(){return this.baseURL!=="https://api.openai.com/v1"};P.OpenAI=Zc;P.DEFAULT_TIMEOUT=6e5;P.OpenAIError=S;P.APIError=Q;P.APIConnectionError=mt;P.APIConnectionTimeoutError=ht;P.APIUserAbortError=K;P.NotFoundError=es;P.ConflictError=ts;P.RateLimitError=ss;P.BadRequestError=Qr;P.AuthenticationError=Yr;P.InternalServerError=ns;P.PermissionDeniedError=Zr;P.UnprocessableEntityError=rs;P.InvalidWebhookSignatureError=Me;P.toFile=so;P.Completions=Zt;P.Chat=bt;P.Embeddings=tr;P.Files=sr;P.Images=ar;P.Audio=De;P.Moderations=lr;P.Models=cr;P.FineTuning=Re;P.Graders=_t;P.VectorStores=st;P.Webhooks=ur;P.Beta=Ce;P.Batches=Kt;P.Uploads=Rt;P.Responses=rt;P.Realtime=tt;P.Conversations=St;P.Evals=Et;P.Containers=It;P.Videos=dr;var Xn=class{name="OpenAI";client=null;apiKey;model;constructor(e,t){this.apiKey=e,this.model=t??"gpt-4o-mini"}getClient(){if(!this.client&&this.apiKey&&this.apiKey.trim().length>0)try{this.client=new P({apiKey:this.apiKey})}catch(e){throw h.warn("Failed to initialize OpenAI client:",e),new Error("Failed to initialize OpenAI client")}if(!this.client)throw new Error("OpenAI client not initialized");return this.client}authenticate(e){return Promise.resolve(e.trim().length>0&&e.startsWith("sk-"))}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("OpenAI provider is not available");let t=this.constructPrompt(e);try{let i=(await this.getClient().chat.completions.create({model:this.model,messages:[{role:"user",content:t}],max_tokens:256,temperature:.1})).choices[0]?.message?.content;if(!i)throw new Error("No content in OpenAI response");return this.parseResponse(i)}catch(r){let n=r;if(n?.status===429||n?.response?.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(n?.status===401||n?.response?.status===401)throw new Error("Invalid API key. Please check your OpenAI API key.");if(r instanceof Error){let i=r.message??"Unknown error";throw new Error(`OpenAI API error: ${i}`)}throw new Error("OpenAI API error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=le(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse OpenAI response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var Ru;(function(s){s.STRING="string",s.NUMBER="number",s.INTEGER="integer",s.BOOLEAN="boolean",s.ARRAY="array",s.OBJECT="object"})(Ru||(Ru={}));var Pu;(function(s){s.LANGUAGE_UNSPECIFIED="language_unspecified",s.PYTHON="python"})(Pu||(Pu={}));var ku;(function(s){s.OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(ku||(ku={}));var Tu=["user","model","function","system"],Mu;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Mu||(Mu={}));var Ou;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Ou||(Ou={}));var Lu;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(Lu||(Lu={}));var Fu;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER"})(Fu||(Fu={}));var Qn;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.OTHER="OTHER"})(Qn||(Qn={}));var Nu;(function(s){s.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",s.RETRIEVAL_QUERY="RETRIEVAL_QUERY",s.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",s.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",s.CLASSIFICATION="CLASSIFICATION",s.CLUSTERING="CLUSTERING"})(Nu||(Nu={}));var Du;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE"})(Du||(Du={}));var $u;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})($u||($u={}));var se=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},Pt=class extends se{constructor(e,t){super(e),this.response=t}},Eo=class extends se{constructor(e,t,r,n){super(e),this.status=t,this.statusText=r,this.errorDetails=n}},Be=class extends se{},_o=class extends se{};var tf="https://generativelanguage.googleapis.com",rf="v1beta",sf="0.24.1",nf="genai-js",pr;(function(s){s.GENERATE_CONTENT="generateContent",s.STREAM_GENERATE_CONTENT="streamGenerateContent",s.COUNT_TOKENS="countTokens",s.EMBED_CONTENT="embedContent",s.BATCH_EMBED_CONTENTS="batchEmbedContents"})(pr||(pr={}));var el=class{constructor(e,t,r,n,i){this.model=e,this.task=t,this.apiKey=r,this.stream=n,this.requestOptions=i}toString(){var e,t;let r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||rf,i=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||tf}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}};function of(s){let e=[];return s?.apiClient&&e.push(s.apiClient),e.push(`${nf}/${sf}`),e.join(" ")}async function af(s){var e;let t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",of(s.requestOptions)),t.append("x-goog-api-key",s.apiKey);let r=(e=s.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(n){throw new Be(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${n.message}`)}for(let[n,i]of r.entries()){if(n==="x-goog-api-key")throw new Be(`Cannot set reserved header name ${n}`);if(n==="x-goog-api-client")throw new Be(`Header name ${n} can only be set using the apiClient field`);t.append(n,i)}}return t}async function cf(s,e,t,r,n,i){let o=new el(s,e,t,r,i);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},pf(i)),{method:"POST",headers:await af(o),body:n})}}async function ei(s,e,t,r,n,i={},o=fetch){let{url:a,fetchOptions:c}=await cf(s,e,t,r,n,i);return lf(a,c,o)}async function lf(s,e,t=fetch){let r;try{r=await t(s,e)}catch(n){df(n,s)}return r.ok||await uf(r,s),r}function df(s,e){let t=s;throw t.name==="AbortError"?(t=new _o(`Request aborted when fetching ${e.toString()}: ${s.message}`),t.stack=s.stack):s instanceof Eo||s instanceof Be||(t=new se(`Error fetching from ${e.toString()}: ${s.message}`),t.stack=s.stack),t}async function uf(s,e){let t="",r;try{let n=await s.json();t=n.error.message,n.error.details&&(t+=` ${JSON.stringify(n.error.details)}`,r=n.error.details)}catch{}throw new Eo(`Error fetching from ${e.toString()}: [${s.status} ${s.statusText}] ${t}`,s.status,s.statusText,r)}function pf(s){let e={};if(s?.signal!==void 0||s?.timeout>=0){let t=new AbortController;s?.timeout>=0&&setTimeout(()=>t.abort(),s.timeout),s?.signal&&s.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}function rl(s){return s.text=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),So(s.candidates[0]))throw new Pt(`${kt(s)}`,s);return mf(s)}else if(s.promptFeedback)throw new Pt(`Text not available. ${kt(s)}`,s);return""},s.functionCall=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),So(s.candidates[0]))throw new Pt(`${kt(s)}`,s);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Bu(s)[0]}else if(s.promptFeedback)throw new Pt(`Function call not available. ${kt(s)}`,s)},s.functionCalls=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),So(s.candidates[0]))throw new Pt(`${kt(s)}`,s);return Bu(s)}else if(s.promptFeedback)throw new Pt(`Function call not available. ${kt(s)}`,s)},s}function mf(s){var e,t,r,n;let i=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let o of(n=(r=s.candidates)===null||r===void 0?void 0:r[0].content)===null||n===void 0?void 0:n.parts)o.text&&i.push(o.text),o.executableCode&&i.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&i.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function Bu(s){var e,t,r,n;let i=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let o of(n=(r=s.candidates)===null||r===void 0?void 0:r[0].content)===null||n===void 0?void 0:n.parts)o.functionCall&&i.push(o.functionCall);if(i.length>0)return i}var hf=[Qn.RECITATION,Qn.SAFETY,Qn.LANGUAGE];function So(s){return!!s.finishReason&&hf.includes(s.finishReason)}function kt(s){var e,t,r;let n="";if((!s.candidates||s.candidates.length===0)&&s.promptFeedback)n+="Response was blocked",!((e=s.promptFeedback)===null||e===void 0)&&e.blockReason&&(n+=` due to ${s.promptFeedback.blockReason}`),!((t=s.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(n+=`: ${s.promptFeedback.blockReasonMessage}`);else if(!((r=s.candidates)===null||r===void 0)&&r[0]){let i=s.candidates[0];So(i)&&(n+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(n+=`: ${i.finishMessage}`))}return n}function Yn(s){return this instanceof Yn?(this.v=s,this):new Yn(s)}function ff(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(s,e||[]),n,i=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(m){r[m]&&(n[m]=function(p){return new Promise(function(w,v){i.push([m,p,w,v])>1||a(m,p)})})}function a(m,p){try{c(r[m](p))}catch(w){u(i[0][3],w)}}function c(m){m.value instanceof Yn?Promise.resolve(m.value.v).then(l,d):u(i[0][2],m)}function l(m){a("next",m)}function d(m){a("throw",m)}function u(m,p){m(p),i.shift(),i.length&&a(i[0][0],i[0][1])}}var Uu=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function gf(s){let e=s.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=wf(e),[r,n]=t.tee();return{stream:bf(r),response:yf(n)}}async function yf(s){let e=[],t=s.getReader();for(;;){let{done:r,value:n}=await t.read();if(r)return rl(vf(e));e.push(n)}}function bf(s){return ff(this,arguments,function*(){let t=s.getReader();for(;;){let{value:r,done:n}=yield Yn(t.read());if(n)break;yield yield Yn(rl(r))}})}function wf(s){let e=s.getReader();return new ReadableStream({start(r){let n="";return i();function i(){return e.read().then(({value:o,done:a})=>{if(a){if(n.trim()){r.error(new se("Failed to parse stream"));return}r.close();return}n+=o;let c=n.match(Uu),l;for(;c;){try{l=JSON.parse(c[1])}catch{r.error(new se(`Error parsing JSON response: "${c[1]}"`));return}r.enqueue(l),n=n.substring(c[0].length),c=n.match(Uu)}return i()}).catch(o=>{let a=o;throw a.stack=o.stack,a.name==="AbortError"?a=new _o("Request aborted when reading from the stream"):a=new se("Error reading from the stream"),a})}}})}function vf(s){let e=s[s.length-1],t={promptFeedback:e?.promptFeedback};for(let r of s){if(r.candidates){let n=0;for(let i of r.candidates)if(t.candidates||(t.candidates=[]),t.candidates[n]||(t.candidates[n]={index:n}),t.candidates[n].citationMetadata=i.citationMetadata,t.candidates[n].groundingMetadata=i.groundingMetadata,t.candidates[n].finishReason=i.finishReason,t.candidates[n].finishMessage=i.finishMessage,t.candidates[n].safetyRatings=i.safetyRatings,i.content&&i.content.parts){t.candidates[n].content||(t.candidates[n].content={role:i.content.role||"user",parts:[]});let o={};for(let a of i.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),a.executableCode&&(o.executableCode=a.executableCode),a.codeExecutionResult&&(o.codeExecutionResult=a.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),t.candidates[n].content.parts.push(o)}n++}r.usageMetadata&&(t.usageMetadata=r.usageMetadata)}return t}async function Gu(s,e,t,r){let n=await ei(e,pr.STREAM_GENERATE_CONTENT,s,!0,JSON.stringify(t),r);return gf(n)}async function Wu(s,e,t,r){let i=await(await ei(e,pr.GENERATE_CONTENT,s,!1,JSON.stringify(t),r)).json();return{response:rl(i)}}function zu(s){if(s!=null){if(typeof s=="string")return{role:"system",parts:[{text:s}]};if(s.text)return{role:"system",parts:[s]};if(s.parts)return s.role?s:{role:"system",parts:s.parts}}}function Zn(s){let e=[];if(typeof s=="string")e=[{text:s}];else for(let t of s)typeof t=="string"?e.push({text:t}):e.push(t);return Af(e)}function Af(s){let e={role:"user",parts:[]},t={role:"function",parts:[]},r=!1,n=!1;for(let i of s)"functionResponse"in i?(t.parts.push(i),n=!0):(e.parts.push(i),r=!0);if(r&&n)throw new se("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!n)throw new se("No content is provided for sending chat message.");return r?e:t}function xf(s,e){var t;let r={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(t=e?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]},n=s.generateContentRequest!=null;if(s.contents){if(n)throw new Be("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=s.contents}else if(n)r=Object.assign(Object.assign({},r),s.generateContentRequest);else{let i=Zn(s);r.contents=[i]}return{generateContentRequest:r}}function qu(s){let e;return s.contents?e=s:e={contents:[Zn(s)]},s.systemInstruction&&(e.systemInstruction=zu(s.systemInstruction)),e}function If(s){return typeof s=="string"||Array.isArray(s)?{content:Zn(s)}:s}var ju=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Sf={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Ef(s){let e=!1;for(let t of s){let{role:r,parts:n}=t;if(!e&&r!=="user")throw new se(`First content should be with role 'user', got ${r}`);if(!Tu.includes(r))throw new se(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(Tu)}`);if(!Array.isArray(n))throw new se("Content should have 'parts' property with an array of Parts");if(n.length===0)throw new se("Each Content should have at least one part");let i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let a of n)for(let c of ju)c in a&&(i[c]+=1);let o=Sf[r];for(let a of ju)if(!o.includes(a)&&i[a]>0)throw new se(`Content with role '${r}' can't contain '${a}' part`);e=!0}}function Hu(s){var e;if(s.candidates===void 0||s.candidates.length===0)return!1;let t=(e=s.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(let r of t.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}var Vu="SILENT_ERROR",tl=class{constructor(e,t,r,n={}){this.model=t,this.params=r,this._requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r?.history&&(Ef(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,n,i,o,a,c;await this._sendPromise;let l=Zn(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t),m;return this._sendPromise=this._sendPromise.then(()=>Wu(this._apiKey,this.model,d,u)).then(p=>{var w;if(Hu(p.response)){this._history.push(l);let v=Object.assign({parts:[],role:"model"},(w=p.response.candidates)===null||w===void 0?void 0:w[0].content);this._history.push(v)}else{let v=kt(p.response);v&&console.warn(`sendMessage() was unsuccessful. ${v}. Inspect response object for details.`)}m=p}).catch(p=>{throw this._sendPromise=Promise.resolve(),p}),await this._sendPromise,m}async sendMessageStream(e,t={}){var r,n,i,o,a,c;await this._sendPromise;let l=Zn(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},u=Object.assign(Object.assign({},this._requestOptions),t),m=Gu(this._apiKey,this.model,d,u);return this._sendPromise=this._sendPromise.then(()=>m).catch(p=>{throw new Error(Vu)}).then(p=>p.response).then(p=>{if(Hu(p)){this._history.push(l);let w=Object.assign({},p.candidates[0].content);w.role||(w.role="model"),this._history.push(w)}else{let w=kt(p);w&&console.warn(`sendMessageStream() was unsuccessful. ${w}. Inspect response object for details.`)}}).catch(p=>{p.message!==Vu&&console.error(p)}),m}};async function _f(s,e,t,r){return(await ei(e,pr.COUNT_TOKENS,s,!1,JSON.stringify(t),r)).json()}async function Cf(s,e,t,r){return(await ei(e,pr.EMBED_CONTENT,s,!1,JSON.stringify(t),r)).json()}async function Rf(s,e,t,r){let n=t.requests.map(o=>Object.assign(Object.assign({},o),{model:e}));return(await ei(e,pr.BATCH_EMBED_CONTENTS,s,!1,JSON.stringify({requests:n}),r)).json()}var Co=class{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=zu(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;let n=qu(e),i=Object.assign(Object.assign({},this._requestOptions),t);return Wu(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},n),i)}async generateContentStream(e,t={}){var r;let n=qu(e),i=Object.assign(Object.assign({},this._requestOptions),t);return Gu(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},n),i)}startChat(e){var t;return new tl(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let r=xf(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),n=Object.assign(Object.assign({},this._requestOptions),t);return _f(this.apiKey,this.model,r,n)}async embedContent(e,t={}){let r=If(e),n=Object.assign(Object.assign({},this._requestOptions),t);return Cf(this.apiKey,this.model,r,n)}async batchEmbedContents(e,t={}){let r=Object.assign(Object.assign({},this._requestOptions),t);return Rf(this.apiKey,this.model,e,r)}};var Ro=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new se("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Co(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new Be("Cached content must contain a `name` field.");if(!e.model)throw new Be("Cached content must contain a `model` field.");let n=["model","systemInstruction"];for(let o of n)if(t?.[o]&&e[o]&&t?.[o]!==e[o]){if(o==="model"){let a=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(a===c)continue}throw new Be(`Different value for "${o}" specified in modelParams (${t[o]}) and cachedContent (${e[o]})`)}let i=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Co(this.apiKey,i,r)}};var ti=class{name="Gemini";client=null;apiKey;model;constructor(e,t){this.apiKey=e,this.model=t??"gemini-1.5-flash"}getClient(){if(!this.client&&this.apiKey&&this.apiKey.trim().length>0)try{this.client=new Ro(this.apiKey)}catch(e){throw h.warn("Failed to initialize Gemini client:",e),new Error("Failed to initialize Gemini client")}if(!this.client)throw new Error("Gemini client not initialized");return this.client}authenticate(e){return Promise.resolve(e.trim().length>0)}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("Gemini provider is not available");let t=this.constructPrompt(e);try{let a=(await this.getClient().getGenerativeModel({model:this.model}).generateContent(t)).response.text();return this.parseResponse(a)}catch(r){let n=r;if(n?.status===429||n?.response?.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(n?.status===401||n?.response?.status===401)throw new Error("Invalid API key. Please check your Gemini API key.");if(r instanceof Error){let i=r.message??"Unknown error";throw new Error(`Gemini API error: ${i}`)}throw new Error("Gemini API error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=le(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse Gemini response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var mr="0.37.0";var Ku=!1,hr,sl,Pf,kf,Tf,nl,Mf,Po,il,ol,al,ko,cl;function Ju(s,e={auto:!1}){if(Ku)throw new Error(`you must \`import 'groq-sdk/shims/${s.kind}'\` before importing anything else from groq-sdk`);if(hr)throw new Error(`can't \`import 'groq-sdk/shims/${s.kind}'\` after \`import 'groq-sdk/shims/${hr}'\``);Ku=e.auto,hr=s.kind,sl=s.fetch,Pf=s.Request,kf=s.Response,Tf=s.Headers,nl=s.FormData,Mf=s.Blob,Po=s.File,il=s.ReadableStream,ol=s.getMultipartRequestOptions,al=s.getDefaultAgent,ko=s.fileFromPath,cl=s.isFsReadStream}var To=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Xu({manuallyImported:s}={}){let e=s?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'groq-sdk'`:\n- `import 'groq-sdk/shims/node'` (if you're running on Node)\n- `import 'groq-sdk/shims/web'` (otherwise)\n",t,r,n,i;try{t=fetch,r=Request,n=Response,i=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:n,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(o,a)=>({...a,body:new To(o)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:o=>!1}}var ll=()=>{hr||Ju(Xu(),{auto:!0})};ll();var ae=class extends Error{},ne=class s extends ae{constructor(e,t,r,n){super(`${s.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.error=t}static makeMessage(e,t,r){let n=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new Tt({message:r,cause:Mo(t)});let i=t;return e===400?new ri(e,i,r,n):e===401?new si(e,i,r,n):e===403?new ni(e,i,r,n):e===404?new ii(e,i,r,n):e===409?new oi(e,i,r,n):e===422?new ai(e,i,r,n):e===429?new ci(e,i,r,n):e>=500?new li(e,i,r,n):new s(e,i,r,n)}},fr=class extends ne{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Tt=class extends ne{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},qs=class extends Tt{constructor({message:e}={}){super({message:e??"Request timed out."})}},ri=class extends ne{},si=class extends ne{},ni=class extends ne{},ii=class extends ne{},oi=class extends ne{},ai=class extends ne{},ci=class extends ne{},li=class extends ne{};var Oo=class s{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1,n=new dl;async function*i(){if(!e.body)throw t.abort(),new ae("Attempted to iterate over a response with no body");let a=new js,c=Qu(e.body);for await(let l of c)for(let d of a.decode(l)){let u=n.decode(d);u&&(yield u)}for(let l of a.flush()){let d=n.decode(l);d&&(yield d)}}async function*o(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let c of i())if(!a){if(c.data.startsWith("[DONE]")){a=!0;continue}if(c.event===null||c.event==="error"){let l;try{l=JSON.parse(c.data)}catch(d){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),d}if(l&&l.error)throw new ne(l.error.status_code,l.error,l.error.message,void 0);yield l}}a=!0}catch(c){if(c instanceof Error&&c.name==="AbortError")return;throw c}finally{a||t.abort()}}return new s(o,t)}static fromReadableStream(e,t){let r=!1;async function*n(){let o=new js,a=Qu(e);for await(let c of a)for(let l of o.decode(c))yield l;for(let c of o.flush())yield c}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(let a of n())o||a&&(yield JSON.parse(a));o=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{o||t.abort()}}return new s(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=i=>({next:()=>{if(i.length===0){let o=r.next();e.push(o),t.push(o)}return i.shift()}});return[new s(()=>n(e),this.controller),new s(()=>n(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new il({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:i,done:o}=await t.next();if(o)return n.close();let a=r.encode(JSON.stringify(i)+`
`);n.enqueue(a)}catch(i){n.error(i)}},async cancel(){await t.return?.()}})}},dl=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=Ff(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}},js=class s{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=s.NEWLINE_CHARS.has(t[t.length-1]||""),n=t.split(s.NEWLINE_REGEXP);return n.length===1&&!r?(this.buffer.push(n[0]),[]):(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),r||(this.buffer=[n.pop()||""]),n)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ae(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ae(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ae("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};js.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","\x85","\u2028","\u2029"]);js.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function Ff(s,e){let t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}function Qu(s){if(s[Symbol.asyncIterator])return s;let e=s.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Yu=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",Zu=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&di(s),di=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",Nf=s=>Zu(s)||Yu(s)||cl(s);async function ml(s,e,t){if(s=await s,Zu(s))return s;if(Yu(s)){let n=await s.blob();e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()??"unknown_file");let i=di(n)?[await n.arrayBuffer()]:[n];return new Po(i,e,t)}let r=await Df(s);if(e||(e=Bf(s)??"unknown_file"),!t?.type){let n=r[0]?.type;typeof n=="string"&&(t={...t,type:n})}return new Po(r,e,t)}async function Df(s){let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(di(s))e.push(await s.arrayBuffer());else if(Uf(s))for await(let t of s)e.push(t);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${s?.constructor?.name}; props: ${$f(s)}`);return e}function $f(s){return`[${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}function Bf(s){return ul(s.name)||ul(s.filename)||ul(s.path)?.split(/[\\/]/).pop()}var ul=s=>{if(typeof s=="string")return s;if(typeof Buffer<"u"&&s instanceof Buffer)return String(s)},Uf=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",hl=s=>s&&typeof s=="object"&&s.body&&s[Symbol.toStringTag]==="MultipartBody";var gr=async s=>{let e=await ep(s.body);return ol(e,s)},ep=async s=>{let e=new nl;return await Promise.all(Object.entries(s||{}).map(([t,r])=>pl(e,t,r))),e};var pl=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(Nf(t)){let r=await ml(t);s.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>pl(s,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,n])=>pl(s,`${e}[${r}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var op=function(s,e,t,r,n){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?n.call(s,t):n?n.value=t:e.set(s,t),t},ap=function(s,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(s):r?r.value:e.get(s)},No,Lo;ll();async function cp(s){let{response:e}=s;if(s.options.stream)return Hs("response",e.status,e.url,e.headers,e.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(e,s.controller):Oo.fromSSEResponse(e,s.controller);if(e.status===204)return null;if(s.options.__binaryResponse)return e;let r=e.headers.get("content-type")?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){let o=await e.json();return Hs("response",e.status,e.url,e.headers,o),o}let i=await e.text();return Hs("response",e.status,e.url,e.headers,i),i}var Do=class s extends Promise{constructor(e,t=cp){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new s(this.responsePromise,async t=>e(await this.parseResponse(t),t))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},$o=class{constructor({baseURL:e,baseURLOverridden:t,maxRetries:r=2,timeout:n=6e4,httpAgent:i,fetch:o}){No.set(this,void 0),this.baseURL=e,op(this,No,t,"f"),this.maxRetries=fl("maxRetries",r),this.timeout=fl("timeout",n),this.httpAgent=i,this.fetch=o??sl}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json",...["head","get"].includes(e.method)?{}:{"Content-Type":"application/json"},"User-Agent":this.getUserAgent(),...Gf(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Yf()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async n=>{let i=n&&di(n?.body)?new DataView(await n.body.arrayBuffer()):n?.body instanceof DataView?n.body:n?.body instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n?.body)?new DataView(n.body.buffer):n?.body;return{method:e,path:t,...n,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:n,path:i,query:o,defaultBaseURL:a,headers:c={}}=r,l=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:hl(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,d=this.calculateContentLength(l),u=this.buildURL(i,o,a);"timeout"in r&&fl("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let m=r.httpAgent??this.httpAgent??al(u),p=r.timeout+1e3;typeof m?.options?.timeout=="number"&&p>(m.options.timeout??0)&&(m.options.timeout=p),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),c[this.idempotencyHeader]=e.idempotencyKey);let w=this.buildHeaders({options:r,headers:c,contentLength:d,retryCount:t});return{req:{method:n,...l&&{body:l},headers:w,...m&&{agent:m},signal:r.signal??null},url:u,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:n}){let i={};r&&(i["content-length"]=r);let o=this.defaultHeaders(e);return ip(i,o),ip(i,t),hl(e.body)&&hr!=="node"&&delete i["content-type"],Fo(o,"x-stainless-retry-count")===void 0&&Fo(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(n)),Fo(o,"x-stainless-timeout")===void 0&&Fo(t,"x-stainless-timeout")===void 0&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,n){return ne.generate(e,t,r,n)}request(e,t=null){return new Do(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,n=r.maxRetries??this.maxRetries;t==null&&(t=n),await this.prepareOptions(r);let{req:i,url:o,timeout:a}=await this.buildRequest(r,{retryCount:n-t});if(await this.prepareRequest(i,{url:o,options:r}),Hs("request",o,r,i.headers),r.signal?.aborted)throw new fr;let c=new AbortController,l=await this.fetchWithTimeout(o,i,a,c).catch(Mo);if(l instanceof Error){if(r.signal?.aborted)throw new fr;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new qs:new Tt({cause:l})}let d=jf(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let _=`retrying, ${t} attempts remaining`;return Hs(`response (error; ${_})`,l.status,o,d),this.retryRequest(r,t,d)}let u=await l.text().catch(_=>Mo(_).message),m=Wf(u),p=m?void 0:u;throw Hs(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,o,d,p),this.makeStatusError(l.status,m,p,d)}return{response:l,options:r,controller:c}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new gl(this,r,e)}buildURL(e,t,r){let n=!ap(this,No,"f")&&r||this.baseURL,i=Kf(e)?new URL(e):new URL(n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return Xf(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new ae(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){let{signal:i,...o}=t||{};i&&i.addEventListener("abort",()=>n.abort());let a=setTimeout(()=>n.abort(),r),c={signal:n.signal,...o};return c.method&&(c.method=c.method.toUpperCase()),this.fetch.call(void 0,e,c).finally(()=>{clearTimeout(a)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let n,i=r?.["retry-after-ms"];if(i){let a=parseFloat(i);Number.isNaN(a)||(n=a)}let o=r?.["retry-after"];if(o&&!n){let a=parseFloat(o);Number.isNaN(a)?n=Date.parse(o)-Date.now():n=a*1e3}if(!(n&&0<=n&&n<60*1e3)){let a=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,a)}return await Jf(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,o=Math.min(.5*Math.pow(2,i),8),a=1-Math.random()*.25;return o*a*1e3}getUserAgent(){return`${this.constructor.name}/JS ${mr}`}};No=new WeakMap;var tp=class{constructor(e,t,r,n){Lo.set(this,void 0),op(this,Lo,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new ae("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[n,i]of r)e.url.searchParams.set(n,i);t.query=void 0,t.path=e.url.toString()}return await ap(this,Lo,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Lo=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},gl=class extends Do{constructor(e,t,r){super(t,async n=>new r(e,n.response,await cp(n),n.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},jf=s=>new Proxy(Object.fromEntries(s.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}});var Hf=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mr,"X-Stainless-OS":sp(Deno.build.os),"X-Stainless-Arch":rp(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mr,"X-Stainless-OS":sp(process.platform),"X-Stainless-Arch":rp(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let s=Vf();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":mr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Vf(){if(typeof navigator>"u"||!navigator)return null;let s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of s){let r=t.exec(navigator.userAgent);if(r){let n=r[1]||0,i=r[2]||0,o=r[3]||0;return{browser:e,version:`${n}.${i}.${o}`}}}return null}var rp=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",sp=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown"),np,Gf=()=>np??(np=Hf()),Wf=s=>{try{return JSON.parse(s)}catch{return}},zf=/^[a-z][a-z0-9+.-]*:/i,Kf=s=>zf.test(s),Jf=s=>new Promise(e=>setTimeout(e,s)),fl=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ae(`${s} must be an integer`);if(e<0)throw new ae(`${s} must be a positive integer`);return e},Mo=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null)try{return new Error(JSON.stringify(s))}catch{}return new Error(s)};var yl=s=>{if(typeof process<"u")return process.env?.[s]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(s)?.trim()};function Xf(s){if(!s)return!0;for(let e in s)return!1;return!0}function Qf(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function ip(s,e){for(let t in e){if(!Qf(e,t))continue;let r=t.toLowerCase();if(!r)continue;let n=e[t];n===null?delete s[r]:n!==void 0&&(s[r]=n)}}function Hs(s,...e){typeof process<"u"&&process?.env?.DEBUG==="true"&&console.log(`Groq:DEBUG:${s}`,...e)}var Yf=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{let e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)}),lp=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Zf=s=>typeof s?.get=="function";var Fo=(s,e)=>{let t=e.toLowerCase();if(Zf(s)){let r=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(n,i,o)=>i+o.toUpperCase());for(let n of[e,t,e.toUpperCase(),r]){let i=s.get(n);if(i)return i}}for(let[r,n]of Object.entries(s))if(r.toLowerCase()===t)return Array.isArray(n)?(n.length<=1||console.warn(`Received ${n.length} entries for the ${e} header, using the first entry.`),n[0]):n};var B=class{constructor(e){this._client=e}};var Vs=class extends B{create(e,t){return this._client.post("/openai/v1/audio/speech",{body:e,...t,headers:{Accept:"audio/wav",...t?.headers},__binaryResponse:!0})}};var Gs=class extends B{create(e,t){return this._client.post("/openai/v1/audio/transcriptions",gr({body:e,...t}))}};var Ws=class extends B{create(e,t){return this._client.post("/openai/v1/audio/translations",gr({body:e,...t}))}};var Ue=class extends B{constructor(){super(...arguments),this.speech=new Vs(this._client),this.transcriptions=new Gs(this._client),this.translations=new Ws(this._client)}};Ue.Speech=Vs;Ue.Transcriptions=Gs;Ue.Translations=Ws;var yr=class extends B{create(e,t){return this._client.post("/openai/v1/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/openai/v1/batches/${e}`,t)}list(e){return this._client.get("/openai/v1/batches",e)}cancel(e,t){return this._client.post(`/openai/v1/batches/${e}/cancel`,t)}};var zs=class extends B{create(e,t){return this._client.post("/openai/v1/chat/completions",{body:e,...t,stream:e.stream??!1})}};var Mt=class extends B{constructor(){super(...arguments),this.completions=new zs(this._client)}};Mt.Completions=zs;var br=class extends B{};var wr=class extends B{create(e,t){return this._client.post("/openai/v1/embeddings",{body:e,...t})}};var vr=class extends B{create(e,t){return this._client.post("/openai/v1/files",gr({body:e,...t}))}list(e){return this._client.get("/openai/v1/files",e)}delete(e,t){return this._client.delete(`/openai/v1/files/${e}`,t)}content(e,t){return this._client.get(`/openai/v1/files/${e}/content`,{...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}info(e,t){return this._client.get(`/openai/v1/files/${e}`,t)}};var Ar=class extends B{retrieve(e,t){return this._client.get(`/openai/v1/models/${e}`,t)}list(e){return this._client.get("/openai/v1/models",e)}delete(e,t){return this._client.delete(`/openai/v1/models/${e}`,t)}};var dp,up,ig,F=class extends $o{constructor({baseURL:e=yl("GROQ_BASE_URL"),apiKey:t=yl("GROQ_API_KEY"),...r}={}){if(t===void 0)throw new ae("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");let n={apiKey:t,...r,baseURL:e||"https://api.groq.com"};if(!n.dangerouslyAllowBrowser&&lp())throw new ae(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Groq({ apiKey, dangerouslyAllowBrowser: true })`);super({baseURL:n.baseURL,baseURLOverridden:e?e!=="https://api.groq.com":!1,timeout:n.timeout??6e4,httpAgent:n.httpAgent,maxRetries:n.maxRetries,fetch:n.fetch}),dp.add(this),this.completions=new br(this),this.chat=new Mt(this),this.embeddings=new wr(this),this.audio=new Ue(this),this.models=new Ar(this),this.batches=new yr(this),this.files=new vr(this),this._options=n,this.apiKey=t}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};up=F,dp=new WeakSet,ig=function(){return this.baseURL!=="https://api.groq.com"};F.Groq=up;F.DEFAULT_TIMEOUT=6e4;F.GroqError=ae;F.APIError=ne;F.APIConnectionError=Tt;F.APIConnectionTimeoutError=qs;F.APIUserAbortError=fr;F.NotFoundError=ii;F.ConflictError=oi;F.RateLimitError=ci;F.BadRequestError=ri;F.AuthenticationError=si;F.InternalServerError=li;F.PermissionDeniedError=ni;F.UnprocessableEntityError=ai;F.toFile=ml;F.fileFromPath=ko;F.Completions=br;F.Chat=Mt;F.Embeddings=wr;F.Audio=Ue;F.Models=Ar;F.Batches=yr;F.Files=vr;var pp=F;var ui=class{name="Groq";client=null;apiKey;model;constructor(e,t){this.apiKey=e,this.model=t??"llama-3.3-70b-versatile"}getClient(){if(!this.client&&this.apiKey&&this.apiKey.trim().length>0)try{this.client=new pp({apiKey:this.apiKey,dangerouslyAllowBrowser:!0})}catch(e){throw h.warn("Failed to initialize Groq client:",e),new Error("Failed to initialize Groq client")}if(!this.client)throw new Error("Groq client not initialized");return this.client}authenticate(e){return Promise.resolve(e.trim().length>0)}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("Groq provider is not available");let t=this.constructPrompt(e);try{let i=(await this.getClient().chat.completions.create({model:this.model,messages:[{role:"user",content:t}],max_tokens:256,temperature:.1})).choices[0]?.message?.content;if(!i)throw new Error("No content in Groq response");return this.parseResponse(i)}catch(r){let n=r;if(n?.status===429||n?.response?.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(n?.status===401||n?.response?.status===401)throw new Error("Invalid API key. Please check your Groq API key.");if(r instanceof Error){let i=r.message??"Unknown error";throw new Error(`Groq API error: ${i}`)}throw new Error("Groq API error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=le(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse Groq response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var mp=require("obsidian");var Uo=class{name="OpenRouter";apiKey;model;baseUrl="https://openrouter.ai/api/v1/chat/completions";constructor(e,t){this.apiKey=e,this.model=t??"openai/gpt-4o-mini"}authenticate(e){return Promise.resolve(e.trim().length>0)}isAvailable(){return this.apiKey.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("OpenRouter provider is not available");let t=this.constructPrompt(e);try{let r=await(0,mp.requestUrl)({url:this.baseUrl,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":"https://github.com/FallingWithStyle/obsidian-ideatr","X-Title":"Ideatr"},body:JSON.stringify({model:this.model,messages:[{role:"user",content:t}],max_tokens:256,temperature:.1}),throw:!1});if(r.status<200||r.status>=300){if(r.status===429)throw new Error("Rate limit exceeded. Please try again later.");if(r.status===401)throw new Error("Invalid API key. Please check your OpenRouter API key.");let c=(typeof r.json=="function"?await r.json():r.json)??{};throw new Error(`OpenRouter API error: ${typeof c.error=="string"?c.error:"Request failed"}`)}let o=(typeof r.json=="function"?await r.json():r.json).choices?.[0]?.message?.content;if(!o)throw new Error("No content in OpenRouter response");return this.parseResponse(o)}catch(r){throw r instanceof Error?r.message.includes("Rate limit")||r.message.includes("Invalid API key")?r:new Error(`OpenRouter API error: ${r.message}`):new Error("OpenRouter API error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=le(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse OpenRouter response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var hp=require("obsidian");var qo=class{name="Custom Endpoint";endpointUrl;format;constructor(e,t="ollama"){this.endpointUrl=e,this.format=t}authenticate(e){try{return new URL(e),Promise.resolve(e.trim().length>0)}catch{return Promise.resolve(!1)}}isAvailable(){return this.endpointUrl.trim().length>0}async classify(e){if(!this.isAvailable())throw new Error("Custom endpoint provider is not available");let t=this.constructPrompt(e);try{let r,n;this.format==="ollama"?(r={model:"llama3.2",messages:[{role:"user",content:t}],stream:!1},n="message.content"):(r={model:"gpt-4o-mini",messages:[{role:"user",content:t}],max_tokens:256,temperature:.1},n="choices[0].message.content");let i=await(0,hp.requestUrl)({url:this.endpointUrl,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),throw:!1});if(i.status<200||i.status>=300){let d=(typeof i.json=="function"?await i.json():i.json)??{};throw new Error(`Custom endpoint error: ${typeof d.error=="string"?d.error:"Request failed"}`)}let a=typeof i.json=="function"?await i.json():i.json,c;if(n==="message.content"?c=typeof a.message?.content=="string"?a.message.content:"":c=typeof a.choices?.[0]?.message?.content=="string"?a.choices[0].message.content:"",!c)throw new Error("No content in custom endpoint response");return this.parseResponse(c)}catch(r){throw r instanceof Error?new Error(`Custom endpoint error: ${r.message}`):new Error("Custom endpoint error: Request failed")}}constructPrompt(e){return`Classify this idea into one category and suggest 2-4 relevant tags.

Idea: "${e}"

Categories: game, saas, tool, story, mechanic, hardware, ip, brand, ux, personal

Rules:
- Choose the single best category
- Tags should be specific and relevant (2-4 tags)
- Use lowercase for category and tags

Example response:
{
  "category": "game",
  "tags": ["rpg", "fantasy", "multiplayer"]
}

Response:`}parseResponse(e){try{let t=le(e,!1),r=JSON.parse(t);return{category:this.validateCategory(typeof r.category=="string"?r.category:""),tags:Array.isArray(r.tags)?r.tags.slice(0,5):[],confidence:typeof r.confidence=="number"?r.confidence:.8}}catch(t){return h.warn("Failed to parse custom endpoint response:",e,t),{category:"",tags:[],confidence:0}}}validateCategory(e){let t=["game","saas","tool","story","mechanic","hardware","ip","brand","ux","personal"],r=e?.toLowerCase().trim();return t.includes(r)?r:""}};var nt=class{static createProvider(e,t,r){switch(e){case"anthropic":return new Rn(t,r?.customModel);case"openai":return new Xn(t,r?.customModel);case"gemini":return new ti(t,r?.customModel);case"groq":return new ui(t,r?.customModel);case"openrouter":return new Uo(t,r?.openRouterModel);case"custom":{if(!r?.customEndpointUrl)throw new Error("Custom endpoint URL is required for custom provider");let n=r.customEndpointUrl.includes("/v1/chat/completions")?"openai":"ollama";return new qo(r.customEndpointUrl,n)}case"custom-model":{if(!r?.customModelProvider||!r?.customModel)throw new Error("Custom model provider and model are required for custom-model provider");let n=r.customModelProvider;switch(n){case"anthropic":return new Rn(t,r.customModel);case"openai":return new Xn(t,r.customModel);case"gemini":return new ti(t,r.customModel);case"groq":return new ui(t,r.customModel);default:throw new Error(`Unsupported custom model provider: ${String(n)}`)}}case"none":throw new Error('Cannot create provider for type "none"');default:throw new Error(`Unknown provider type: ${String(e)}`)}}};var og={"anthropic-haiku":{key:"anthropic-haiku",name:"Claude 3.5 Haiku",badge:"EFFICIENT",provider:"anthropic",modelId:"claude-3-5-haiku-20241022",description:"Fast, cost-effective model ideal for classification tasks. Excellent at structured work like categorization and tagging.",quality:4,speed:5,cost:"low",costEstimate:"~$0.002 per idea",pros:["Fast","Cost-effective","Good accuracy","Low latency"],cons:["Less nuanced than larger models"],bestFor:"Most users"},"anthropic-sonnet":{key:"anthropic-sonnet",name:"Claude 3.5 Sonnet",badge:"BALANCED",provider:"anthropic",modelId:"claude-3-5-sonnet-20241022",description:"Balanced performance with better reasoning and accuracy. Great for complex or nuanced classification tasks.",quality:4.5,speed:4,cost:"medium",costEstimate:"~$0.015 per idea",pros:["Better reasoning","Higher accuracy","Handles complexity well"],cons:["More expensive","Slightly slower"],bestFor:"Users who want better quality"},"anthropic-opus":{key:"anthropic-opus",name:"Claude 3 Opus",badge:"PREMIUM",provider:"anthropic",modelId:"claude-3-opus-20240229",description:"Highest quality model for complex or nuanced classification. Best for edge cases and ambiguous ideas.",quality:5,speed:2,cost:"high",costEstimate:"~$0.15 per idea",pros:["Best quality","Excellent reasoning","Handles edge cases"],cons:["Expensive","Slower","Overkill for simple tasks"],bestFor:"Power users with complex ideas"},"openai-mini":{key:"openai-mini",name:"GPT-4o Mini",badge:"EFFICIENT",provider:"openai",modelId:"gpt-4o-mini",description:"Fast, cost-effective model ideal for classification tasks. Excellent at structured work like categorization and tagging.",quality:4,speed:5,cost:"low",costEstimate:"~$0.001 per idea",pros:["Very fast","Most cost-effective","Good accuracy","Low latency"],cons:["Less nuanced than GPT-4o"],bestFor:"Most users"},"openai-4o":{key:"openai-4o",name:"GPT-4o",badge:"BALANCED",provider:"openai",modelId:"gpt-4o",description:"High-quality model with excellent reasoning capabilities. Great for complex or nuanced classification tasks.",quality:4.5,speed:4,cost:"medium",costEstimate:"~$0.01 per idea",pros:["Better reasoning","Higher accuracy","Handles complexity well"],cons:["More expensive","Slightly slower"],bestFor:"Users who want better quality"},"gemini-flash":{key:"gemini-flash",name:"Gemini 1.5 Flash",badge:"EFFICIENT",provider:"gemini",modelId:"gemini-1.5-flash",description:"Fast, cost-effective model ideal for classification tasks. Excellent at structured work like categorization and tagging.",quality:4,speed:5,cost:"low",costEstimate:"~$0.0005 per idea",pros:["Very fast","Most cost-effective","Good accuracy","Low latency"],cons:["Less nuanced than Pro"],bestFor:"Most users"},"gemini-pro":{key:"gemini-pro",name:"Gemini 1.5 Pro",badge:"BALANCED",provider:"gemini",modelId:"gemini-1.5-pro",description:"High-quality model with better reasoning and accuracy. Great for complex or nuanced classification tasks.",quality:4.5,speed:4,cost:"medium",costEstimate:"~$0.005 per idea",pros:["Better reasoning","Higher accuracy","Handles complexity well"],cons:["More expensive","Slightly slower"],bestFor:"Users who want better quality"},"groq-llama-70b":{key:"groq-llama-70b",name:"Llama 3.3 70B Versatile",badge:"BALANCED",provider:"groq",modelId:"llama-3.3-70b-versatile",description:"High-quality model with excellent reasoning. Fast inference via Groq's infrastructure.",quality:4.5,speed:5,cost:"low",costEstimate:"Free (via Groq)",pros:["Free","Very fast","High quality","Excellent reasoning"],cons:["Requires Groq API key"],bestFor:"Users who want free high-quality AI"},"groq-mixtral":{key:"groq-mixtral",name:"Mixtral 8x7B",badge:"VERSATILE",provider:"groq",modelId:"mixtral-8x7b-32768",description:"High-quality mixture-of-experts model. Fast inference via Groq's infrastructure.",quality:4.5,speed:5,cost:"low",costEstimate:"Free (via Groq)",pros:["Free","Very fast","High quality","Mixture-of-experts"],cons:["Requires Groq API key"],bestFor:"Users who want free high-quality AI"}};function pi(s){return Object.values(og).filter(e=>e.provider===s)}function fp(s){return{name:s.name,badge:s.badge,description:s.description,quality:s.quality,speed:s.speed,pros:s.pros,cons:s.cons,bestFor:s.bestFor,cost:s.cost,costEstimate:s.costEstimate}}function ag(s,e,t=!1){let r=s.createDiv({cls:"model-comparison-card"});r.setCssProps({border:"1px solid var(--background-modifier-border)","border-radius":"6px",padding:"0.75em","margin-bottom":"0.75em"});let n=r.createDiv({cls:"model-comparison-header"});n.setCssProps({display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"0.5em"}),n.createEl("strong",{text:e.name}).setCssProps({"font-size":"0.95em"}),n.createEl("span",{text:e.badge,cls:"model-comparison-badge"}).setCssProps({background:"var(--text-accent)",color:"var(--text-on-accent)",padding:"0.15em 0.4em","border-radius":"3px","font-size":"0.7em","font-weight":"bold"});let a=r.createDiv({cls:"model-comparison-stats"});if(a.setCssProps({display:"grid","grid-template-columns":"repeat(2, 1fr)",gap:"0.4em 1em","margin-bottom":"0.5em","font-size":"0.85em"}),a.createEl("div",{text:`\u2B50 ${e.quality}/5`}),a.createEl("div",{text:`\u26A1 ${e.speed}/5`}),t&&e.sizeMB)a.createEl("div",{text:`\u{1F4E6} ${(e.sizeMB/1e3).toFixed(1)}GB`}),e.ram&&a.createEl("div",{text:`\u{1F4BE} ${e.ram}`});else if(!t&&e.costEstimate&&(a.createEl("div",{text:`\u{1F4B0} ${e.costEstimate}`}),e.cost)){let u=e.cost.charAt(0).toUpperCase()+e.cost.slice(1);a.createEl("div",{text:`\u{1F4B5} ${u}`})}r.createEl("p",{text:e.description,cls:"model-comparison-description"}).setCssProps({margin:"0.4em 0",color:"var(--text-muted)","font-size":"0.85em","line-height":"1.4"});let l=r.createDiv({cls:"model-comparison-details"});if(l.setCssProps({display:"flex",gap:"1em","margin-top":"0.4em","font-size":"0.8em"}),e.pros.length>0){let u=l.createDiv({cls:"model-comparison-pros"});u.setCssProps({flex:"1"}),u.createEl("strong",{text:"\u2713 "}),u.appendText(e.pros.join(", "))}if(e.cons.length>0){let u=l.createDiv({cls:"model-comparison-cons"});u.setCssProps({flex:"1",color:"var(--text-muted)"}),u.createEl("strong",{text:"\u2717 "}),u.appendText(e.cons.join(", "))}let d=r.createDiv({cls:"model-comparison-best-for"});return d.setCssProps({"margin-top":"0.4em","padding-top":"0.4em","border-top":"1px solid var(--background-modifier-border)","font-size":"0.8em",color:"var(--text-muted)"}),d.createEl("strong",{text:"Best for: "}),d.appendText(e.bestFor),r}function gp(s,e,t,r=!1){if(t.length===0)return;let n=s.createDiv({cls:"model-comparison-group"});n.setCssProps({"margin-bottom":"1.5em"}),n.createEl("h5",{text:e}).setCssProps({margin:"0 0 0.75em 0","font-size":"0.95em","font-weight":"600"});for(let o of t)ag(n,o,r)}var jo=class extends Ae{showComparison=!1;display(e){e.createEl("h3",{text:"Cloud AI"});let r=e.createDiv({cls:"cloud-model-comparison-container"}).createEl("button",{text:this.showComparison?"\u25BC Hide model comparison":"\u25B6 Show model comparison",cls:"mod-link"});r.setCssProps({"margin-bottom":"1em"}),r.addEventListener("click",()=>{this.showComparison=!this.showComparison,r.textContent=this.showComparison?"\u25BC Hide model comparison":"\u25B6 Show model comparison";let o=e.querySelector(".cloud-model-comparison-section");o&&o.setCssProps({display:this.showComparison?"block":"none"})});let n=e.createDiv({cls:"cloud-model-comparison-section"});n.setCssProps({display:"none"}),this.renderModelComparison(n),new J.Setting(e).setName("Enable cloud AI").setDesc("Use cloud AI providers for better quality and faster responses (requires API key)").addToggle(o=>o.setValue(this.plugin.settings.cloudProvider!=="none").onChange(async a=>{a?(this.plugin.settings.cloudProvider==="none"&&(this.plugin.settings.cloudProvider="anthropic"),this.plugin.settings.preferCloud=!0):(this.plugin.settings.cloudProvider="none",this.plugin.settings.preferCloud=!1),await this.saveSettings(),this.refresh()}));let i=this.plugin.settings.cloudApiKeys&&Object.values(this.plugin.settings.cloudApiKeys).some(o=>o&&o.length>0)||this.plugin.settings.cloudApiKey&&this.plugin.settings.cloudApiKey.length>0;if((this.plugin.settings.cloudProvider!=="none"||i)&&(new J.Setting(e).setName("Cloud provider").setDesc("Select the cloud AI provider").addDropdown(o=>{o.addOption("anthropic","anthropic (Claude 3.5 Haiku)").addOption("openai","openai (GPT-4o Mini)").addOption("gemini","google Gemini (Gemini 1.5 Flash)").addOption("groq","groq (Llama 3.3 70B)").addOption("openrouter","openRouter (multiple models)").addOption("custom","Custom endpoint (Ollama/LM Studio)").addOption("none","none").setValue(this.plugin.settings.cloudProvider==="none"?"none":this.plugin.settings.cloudProvider).onChange(async a=>{this.plugin.settings.cloudProvider=a,await this.saveSettings(),this.refresh()})}),this.plugin.settings.cloudProvider!=="none")){if(this.plugin.settings.cloudProvider!=="custom"){let o={anthropic:"Anthropic",openai:"OpenAI",gemini:"Google Gemini",groq:"Groq",openrouter:"OpenRouter"},a={anthropic:"https://console.anthropic.com/",openai:"https://platform.openai.com/api-keys",gemini:"https://makersuite.google.com/app/apikey",groq:"https://console.groq.com/keys",openrouter:"https://openrouter.ai/keys"},c=this.plugin.settings.cloudProvider,l="";this.plugin.settings.cloudApiKeys&&c in this.plugin.settings.cloudApiKeys&&(l=this.plugin.settings.cloudApiKeys[c]||""),!l&&this.plugin.settings.cloudApiKey&&this.plugin.settings.cloudProvider===c&&(l=this.plugin.settings.cloudApiKey),new J.Setting(e).setName("API key").setDesc(`Enter your ${o[this.plugin.settings.cloudProvider]||"provider"} API key`).addText(_=>{_.setPlaceholder("sk-...").setValue(l),_.inputEl.setAttribute("type","password"),_.onChange(async I=>{this.plugin.settings.cloudApiKeys||(this.plugin.settings.cloudApiKeys={anthropic:"",openai:"",gemini:"",groq:"",openrouter:""}),c in this.plugin.settings.cloudApiKeys&&(this.plugin.settings.cloudApiKeys[c]=I),await this.saveSettings()})});let d=e.createDiv("setting-item-description");d.setCssProps({"margin-top":"5px"});let u=o[this.plugin.settings.cloudProvider]||"provider",m=a[this.plugin.settings.cloudProvider]||"#";d.createEl("a",{href:m,text:`get your ${u} API key`,attr:{target:"_blank"}});let w={anthropic:"~$0.002 per idea (Claude 3.5 Haiku)",openai:"~$0.001 per idea (GPT-4o Mini)",gemini:"~$0.0005 per idea (Gemini 1.5 Flash)",groq:"Free (Llama 3.3 70B)",openrouter:"Varies by model (see OpenRouter pricing)"}[this.plugin.settings.cloudProvider]||"Varies",v=e.createDiv("setting-item-description");v.setCssProps({"margin-top":"5px",color:"var(--text-muted)"}),v.textContent=`cost estimate: ${w}`,new J.Setting(e).setName("Test connection").setDesc("Verify your API key is valid").addButton(_=>_.setButtonText("Test connection").onClick(async()=>{let I=this.plugin.settings.cloudProvider,A=this.plugin.settings.cloudApiKeys&&I in this.plugin.settings.cloudApiKeys?(this.plugin.settings.cloudApiKeys[I]||"").trim():"";if(!A){new J.Notice("Please enter an API key first");return}_.setButtonText("Testing..."),_.setDisabled(!0);try{let M=nt.createProvider(this.plugin.settings.cloudProvider,A,{openRouterModel:this.plugin.settings.openRouterModel,customEndpointUrl:this.plugin.settings.customEndpointUrl});if(!await M.authenticate(A)){new J.Notice("Authentication failed: invalid API key format");return}let N=await M.classify("test idea for connection verification");N&&(N.category||N.tags.length>0)?new J.Notice(`\u2713 Connection successful! Provider: ${M.name}`):new J.Notice("Connection test completed, but got unexpected response")}catch(M){console.error("Connection test failed:",M);let k=M instanceof Error?M.message:"Unknown error";new J.Notice(`Connection failed: ${k}`)}finally{_.setButtonText("Test connection"),_.setDisabled(!1)}}))}if(this.plugin.settings.cloudProvider==="openrouter"&&new J.Setting(e).setName("Model").setDesc("Select the model to use via OpenRouter").addText(o=>o.setPlaceholder("openai/gpt-4o-mini").setValue(this.plugin.settings.openRouterModel||"openai/gpt-4o-mini").onChange(async a=>{this.plugin.settings.openRouterModel=a,await this.saveSettings()})),this.plugin.settings.cloudProvider==="custom"){new J.Setting(e).setName("Endpoint URL").setDesc("Enter your custom endpoint URL (e.g., http://localhost:11434/api/chat for Ollama)").addText(a=>a.setPlaceholder("http://localhost:11434/api/chat").setValue(this.plugin.settings.customEndpointUrl||"").onChange(async c=>{this.plugin.settings.customEndpointUrl=c,await this.saveSettings()}));let o=e.createDiv("setting-item-description");o.setCssProps({"margin-top":"5px",color:"var(--text-muted)"}),o.textContent="Cost estimate: free (self-hosted)",new J.Setting(e).setName("Test connection").setDesc("Verify your custom endpoint is accessible").addButton(a=>a.setButtonText("Test connection").onClick(async()=>{let c=this.plugin.settings.customEndpointUrl.trim();if(!c){new J.Notice("Please enter an endpoint URL first");return}a.setButtonText("Testing..."),a.setDisabled(!0);try{let l=nt.createProvider("custom","",{customEndpointUrl:c});if(!await l.authenticate(c)){new J.Notice("Authentication failed: invalid endpoint URL");return}let u=await l.classify("test idea for connection verification");u&&(u.category||u.tags.length>0)?new J.Notice(`\u2713 Connection successful! Provider: ${l.name}`):new J.Notice("Connection test completed, but got unexpected response")}catch(l){console.error("Connection test failed:",l);let d=l instanceof Error?l.message:"Unknown error";new J.Notice(`Connection failed: ${d}`)}finally{a.setButtonText("Test connection"),a.setDisabled(!1)}}))}new J.Setting(e).setName("Prefer cloud AI").setDesc("Use cloud AI when available, fallback to local AI on failure").addToggle(o=>o.setValue(this.plugin.settings.preferCloud).onChange(async a=>{this.plugin.settings.preferCloud=a,await this.saveSettings()}))}}renderModelComparison(e){e.empty(),e.createEl("h4",{text:"Cloud AI model comparison"}),e.createEl("p",{text:"Compare default cloud AI models to find the best fit for your needs. All models are validated for ideatr's classification and tagging tasks.",cls:"cloud-model-comparison-intro"}).setCssProps({"margin-bottom":"1em",color:"var(--text-muted)","font-size":"0.9em"});let r={Anthropic:pi("anthropic"),OpenAI:pi("openai"),"Google Gemini":pi("gemini"),Groq:pi("groq")};for(let[n,i]of Object.entries(r)){if(i.length===0)continue;let o=i.map(fp);gp(e,n,o,!1)}}};var xr=require("obsidian");var Ho=class extends Ae{display(e){new xr.Setting(e).setName("Enable error logging").setDesc("Collect error logs for bug reports. Logs are stored locally and only sent if you choose to include them.").addToggle(t=>t.setValue(this.plugin.settings.errorLoggingEnabled).onChange(async r=>{this.plugin.settings.errorLoggingEnabled=r,await this.saveSettings(),this.plugin.errorLogService&&this.plugin.errorLogService.updateSettings({enabled:r,maxEntries:this.plugin.settings.errorLogMaxEntries,retentionDays:this.plugin.settings.errorLogRetentionDays})})),new xr.Setting(e).setName("Maximum log entries").setDesc("Maximum number of error log entries to keep in memory (default: 50)").addText(t=>t.setPlaceholder("50").setValue(String(this.plugin.settings.errorLogMaxEntries)).onChange(async r=>{let n=Number(r);!isNaN(n)&&n>0&&n<=500&&(this.plugin.settings.errorLogMaxEntries=n,await this.saveSettings(),this.plugin.errorLogService&&this.plugin.errorLogService.updateSettings({enabled:this.plugin.settings.errorLoggingEnabled,maxEntries:n,retentionDays:this.plugin.settings.errorLogRetentionDays}))})),new xr.Setting(e).setName("Log retention (days)").setDesc("Number of days to retain error logs (default: 7)").addText(t=>t.setPlaceholder("7").setValue(String(this.plugin.settings.errorLogRetentionDays)).onChange(async r=>{let n=Number(r);!isNaN(n)&&n>0&&n<=30&&(this.plugin.settings.errorLogRetentionDays=n,await this.saveSettings(),this.plugin.errorLogService&&this.plugin.errorLogService.updateSettings({enabled:this.plugin.settings.errorLoggingEnabled,maxEntries:this.plugin.settings.errorLogMaxEntries,retentionDays:n}))})),new xr.Setting(e).setName("Clear error logs").setDesc("Clear all stored error logs").addButton(t=>t.setButtonText("Clear logs").onClick(()=>{this.plugin.errorLogService&&(this.plugin.errorLogService.clearLogs(),new xr.Notice("Error logs cleared"))}))}};var Ot=require("obsidian");var qe=require("obsidian");var Vo=class extends qe.Modal{errorLogService;systemInfo;requestType="feature";description="";includeErrorLogs=!1;includeSystemInfo=!0;constructor(e,t,r){super(e),this.systemInfo=t,this.errorLogService=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ideatr-feedback-modal"),e.createEl("h2",{text:"Submit feedback"}),e.createEl("p",{text:"Help improve Ideatr by submitting a feature request or bug report.",cls:"ideatr-feedback-description"});let t=e.createEl("div",{cls:"ideatr-setting-item"});t.createEl("label",{text:"Type:",attr:{for:"ideatr-request-type"},cls:"ideatr-label"});let r=t.createEl("select",{attr:{id:"ideatr-request-type"},cls:"ideatr-select"});r.createEl("option",{text:"Feature request",attr:{value:"feature"}}),r.createEl("option",{text:"Bug report",attr:{value:"bug"}}),r.createEl("option",{text:"Performance issue",attr:{value:"performance"}}),r.value=this.requestType,r.addEventListener("change",I=>{this.requestType=I.target.value,this.updateDescriptionPlaceholder()});let n=e.createEl("div",{cls:"ideatr-setting-item"});n.createEl("label",{text:"Description:",attr:{for:"ideatr-description"},cls:"ideatr-label"});let i=n.createEl("textarea",{attr:{id:"ideatr-description",rows:"8",placeholder:this.getDescriptionPlaceholder()},cls:"ideatr-textarea"});i.value=this.description,i.addEventListener("input",I=>{this.description=I.target.value});let o=e.createEl("div",{cls:"ideatr-feedback-options"});o.createEl("h3",{text:"Additional information (optional)"});let a=o.createEl("div",{cls:"ideatr-checkbox-item"}),c=a.createEl("input",{attr:{type:"checkbox",id:"ideatr-include-system-info",checked:this.includeSystemInfo}});if(a.createEl("label",{text:"Include system information (Obsidian version, plugin version, OS)",attr:{for:"ideatr-include-system-info"}}),c.addEventListener("change",I=>{this.includeSystemInfo=I.target.checked}),this.errorLogService){let I=o.createEl("div",{cls:"ideatr-checkbox-item"}),A=I.createEl("input",{attr:{type:"checkbox",id:"ideatr-include-error-logs",checked:this.includeErrorLogs}});I.createEl("label",{text:"Include recent error logs (last 7 days, sanitized)",attr:{for:"ideatr-include-error-logs"}}),A.addEventListener("change",k=>{this.includeErrorLogs=k.target.checked});let M=this.errorLogService.getRecentLogs();M.length>0&&o.createEl("p",{text:`${M.length} error log${M.length>1?"s":""} available`,cls:"ideatr-help-text"}).addClass("ideatr-log-count")}let l=e.createEl("div",{cls:"ideatr-feedback-preview"});l.createEl("h3",{text:"Preview"});let d=l.createEl("textarea",{attr:{id:"ideatr-preview",rows:"12",readonly:"true"},cls:"ideatr-textarea"});d.addClass("ideatr-preview-textarea");let u=()=>{d.value=this.generateIssueContent()};if(r.addEventListener("change",u),i.addEventListener("input",u),c.addEventListener("change",u),this.errorLogService){let I=e.querySelector("#ideatr-include-error-logs");I&&I.addEventListener("change",u)}u();let m=e.createEl("div",{cls:"ideatr-button-container"});m.createEl("button",{text:"Copy to clipboard",cls:"mod-cta"}).addEventListener("click",()=>void this.handleCopyToClipboard()),m.createEl("button",{text:"Open email",cls:"mod-cta"}).addEventListener("click",()=>this.handleOpenEmail()),m.createEl("button",{text:"Open GitHub issue",cls:"mod-cta"}).addEventListener("click",()=>this.handleOpenGitHub()),m.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close())}getDescriptionPlaceholder(){return this.requestType==="bug"?`Describe the bug:

1. What happened?
2. What did you expect to happen?
3. Steps to reproduce:
   - Step 1
   - Step 2
   - Step 3`:this.requestType==="performance"?`Describe the performance issue:

- What operation is slow?
- How long does it take?
- When did you first notice this?
- Any patterns (specific features, large vaults, etc.)?`:`Describe your feature request:

- What problem does this solve?
- How would you like it to work?
- Any additional context or examples?`}updateDescriptionPlaceholder(){let e=this.contentEl.querySelector("#ideatr-description");e&&(e.placeholder=this.getDescriptionPlaceholder())}generateIssueContent(){let t=`## ${this.requestType==="bug"?"Bug Report":this.requestType==="performance"?"Performance Issue":"Feature Request"}

`;if(this.description.trim()?t+=`${this.description}

`:t+=`[Please describe your ${this.requestType==="bug"?"bug":"feature request"} here]

`,this.includeSystemInfo&&(t+=`## System Information

`,t+=`- **Obsidian Version:** ${this.systemInfo.obsidianVersion}
`,t+=`- **Ideatr Version:** ${this.systemInfo.pluginVersion}
`,t+=`- **Platform:** ${this.systemInfo.platform}
`,t+=`- **OS:** ${this.systemInfo.os}

`),this.includeErrorLogs&&this.errorLogService){let r=this.errorLogService.getRecentLogs();r.length>0&&(t+=this.errorLogService.formatLogsForIssue(r),t+=`

`)}return t.trim()}generateIssueTitle(){let e=this.requestType==="bug"?"[Bug]":this.requestType==="performance"?"[Performance]":"[Feature]",t=this.description.trim();if(t){let n=t.split(`
`)[0].trim(),i=n.length>50?n.substring(0,47)+"...":n;return`${e} ${i}`}let r=this.requestType==="bug"?"Bug report":this.requestType==="performance"?"Performance issue":"Feature request";return`${e} ${r}`}async handleCopyToClipboard(){if(!this.description.trim()){new qe.Notice("Please enter a description first");return}let e=this.generateIssueContent();try{if(navigator.clipboard)await navigator.clipboard.writeText(e);else throw new Error("Clipboard API not available");new qe.Notice("Content copied to clipboard! Paste it into a GitHub issue.")}catch(t){h.error("Failed to copy to clipboard:",t),new qe.Notice("Failed to copy to clipboard. Please copy manually from the preview.")}}handleOpenEmail(){if(!this.description.trim()){new qe.Notice("Please enter a description first");return}let e=this.generateEmailSubject(),t=this.generateIssueContent(),r=encodeURIComponent(e),n=encodeURIComponent(t),i=`mailto:ideatr@paraphlabs.com?subject=${r}&body=${n}`;window.location.href=i,new qe.Notice("Opening email client...")}generateEmailSubject(){let e=this.requestType==="bug"?"[Bug]":this.requestType==="performance"?"[Performance]":"[Feature]",t=this.description.trim();if(t){let n=t.split(`
`)[0].trim(),i=n.length>60?n.substring(0,57)+"...":n;return`${e} ${i}`}let r=this.requestType==="bug"?"Bug report":this.requestType==="performance"?"Performance issue":"Feature request";return`${e} ${r}`}handleOpenGitHub(){if(!this.description.trim()){new qe.Notice("Please enter a description first");return}let e=encodeURIComponent(this.generateIssueTitle()),t=encodeURIComponent(this.generateIssueContent()),r=this.requestType==="bug"?"bug":this.requestType==="performance"?"performance":"enhancement",n=`https://github.com/FallingWithStyle/obsidian-ideatr/issues/new?title=${e}&body=${t}&labels=${r}`;window.open(n,"_blank"),new qe.Notice("Opening GitHub issue page...")}onClose(){let{contentEl:e}=this;e.empty()}};var Go=class extends Ae{display(e){new Ot.Setting(e).setName("View existing issues").setDesc("Browse and search existing bug reports and feature requests on GitHub").addButton(t=>t.setButtonText("View issues").onClick(()=>{window.open("https://github.com/FallingWithStyle/obsidian-ideatr/issues","_blank")})),new Ot.Setting(e).setName("Submit feedback").setDesc("Report bugs, suggest features, or report performance issues. Error logs can be included to help diagnose issues.").addButton(t=>t.setButtonText("Submit feedback").setCta().onClick(()=>{let r="Unknown";try{let o=this.app.appVersion,a=this.app.version;r=o??a??"Unknown"}catch{r="Unknown"}let n={obsidianVersion:r,pluginVersion:this.plugin.manifest.version,platform:Ot.Platform.isMobile?"mobile":"desktop",os:Ot.Platform.isMacOS?"Mac":Ot.Platform.isWin?"Windows":Ot.Platform.isLinux?"Linux":"Unknown"};new Vo(this.app,n,this.plugin.errorLogService).open()}))}};var zo=require("obsidian");function cg(s){let e=[];s.metaKey&&e.push("cmd"),s.ctrlKey&&e.push("ctrl"),s.altKey&&e.push("alt"),s.shiftKey&&e.push("shift");let t=s.key.toLowerCase();return t===" "?e.push("space"):t==="enter"?e.push("enter"):t==="escape"?e.push("escape"):t==="tab"?e.push("tab"):t==="backspace"?e.push("backspace"):t==="delete"?e.push("delete"):t==="arrowup"?e.push("arrowup"):t==="arrowdown"?e.push("arrowdown"):t==="arrowleft"?e.push("arrowleft"):t==="arrowright"?e.push("arrowright"):(t.length,e.push(t)),e.join("+")}function mi(s){return s?s.split("+").map(e=>{let t=e.trim().toLowerCase();return t==="cmd"||t==="meta"?"\u2318":t==="ctrl"?"\u2303":t==="alt"?"\u2325":t==="shift"?"\u21E7":t==="space"?"Space":t==="enter"?"Enter":t==="escape"?"Esc":t==="tab"?"Tab":t==="backspace"?"Backspace":t==="delete"?"Delete":t==="arrowup"?"\u2191":t==="arrowdown"?"\u2193":t==="arrowleft"?"\u2190":t==="arrowright"?"\u2192":t.charAt(0).toUpperCase()+t.slice(1)}).join(" "):""}function Wo(s,e,t){let r=!1,n=e||"";e?(s.value=mi(e),n=e):s.value="",s.placeholder="Click and press keys...",s.setCssProps({cursor:"text","font-family":"monospace"}),s.addEventListener("focus",()=>{r=!0,s.value="",s.placeholder="Press keys...",s.setCssProps({"background-color":"var(--background-modifier-active-hover)"})}),s.addEventListener("blur",()=>{r=!1,s.setCssProps({"background-color":""}),n?s.value=mi(n):(s.value=e?mi(e):"",s.placeholder="Click and press keys...")}),s.addEventListener("keydown",i=>{if(!r||(i.preventDefault(),i.stopPropagation(),["Meta","Control","Alt","Shift"].includes(i.key)))return;let o=cg(i);n=o,s.value=mi(o),t(o)}),s.addEventListener("keyup",i=>{r&&!i.metaKey&&!i.ctrlKey&&!i.altKey&&!i.shiftKey&&n&&(s.value=mi(n))})}var Ko=class extends Ae{display(e){e.createEl("h3",{text:"Capture modal shortcuts"}),new zo.Setting(e).setName("Capture idea hotkey").setDesc(`Keyboard shortcut for opening the Capture idea modal. Click the field and press your desired key combination. Note: This setting stores your preference. To actually bind the hotkey, you must also set it in Obsidian's Hotkeys settings (Settings \u2192 Hotkeys \u2192 search for "Capture idea").`).addText(t=>{Wo(t.inputEl,this.plugin.settings.captureIdeaHotkey,r=>{(async()=>(this.plugin.settings.captureIdeaHotkey=r,await this.saveSettings()))()})}),new zo.Setting(e).setName("Save shortcut").setDesc("Keyboard shortcut for the Save button in the Capture idea modal. Click the field and press your desired key combination.").addText(t=>{Wo(t.inputEl,this.plugin.settings.captureSaveShortcut,r=>{(async()=>(this.plugin.settings.captureSaveShortcut=r,await this.saveSettings()))()})}),new zo.Setting(e).setName("Ideate shortcut").setDesc("Keyboard shortcut for the Ideate button in the Capture idea modal. Click the field and press your desired key combination.").addText(t=>{Wo(t.inputEl,this.plugin.settings.captureIdeateShortcut,r=>{(async()=>(this.plugin.settings.captureIdeateShortcut=r,await this.saveSettings()))()})})}};var yp={llmProvider:"llama",llamaServerUrl:"http://127.0.0.1:8080",llamaBinaryPath:"",modelPath:"",llamaServerPort:8080,concurrency:1,llmTimeout:1e4,autoClassify:!0,enableDomainCheck:!0,autoCheckDomains:!1,enableProspectr:!1,prospectrUrl:"http://localhost:3000",domainCheckTimeout:1e4,enableWebSearch:!0,autoSearchExistence:!1,webSearchProvider:"google",googleSearchApiKey:"",googleSearchEngineId:"",webSearchTimeout:15e3,maxSearchResults:5,enableNameVariants:!0,autoGenerateVariants:!1,maxVariants:8,useLLMForNameExtraction:!1,variantCacheMaxSize:100,variantCachePersist:!0,enableScaffolds:!0,scaffoldDefaultAction:"append",dashboardDefaultView:"table",dashboardItemsPerPage:50,dashboardAutoRefresh:!0,dashboardPersistFilters:!0,enableClustering:!0,clusteringAlgorithm:"hierarchical",maxClusters:0,clusterColorScheme:"category",clusteringSimilarityThreshold:.3,enableResurfacing:!0,resurfacingThresholdDays:7,resurfacingFrequency:"manual",resurfacingTime:"09:00",autoGenerateDigest:!1,digestIncludeSummary:!0,digestMaxIdeas:0,enableElevation:!0,elevationProjectsDirectory:"Projects",elevationCreateDevraMetadata:!0,elevationDefaultFolders:"docs,notes,assets",setupCompleted:!1,modelDownloaded:!1,keepModelLoaded:!1,preloadOnStartup:!1,localModel:"phi-3.5-mini",preferCloud:!1,cloudProvider:"none",cloudApiKeys:{anthropic:"",openai:"",gemini:"",groq:"",openrouter:""},customEndpointUrl:"",openRouterModel:"",customModelProvider:void 0,customModel:void 0,moveArchivedToFolder:!1,errorLoggingEnabled:!0,errorLogMaxEntries:50,errorLogRetentionDays:7,debugMode:!1,captureIdeaHotkey:"cmd+i",captureSaveShortcut:"alt+enter",captureIdeateShortcut:"cmd+enter"},Jo=class extends Ks.PluginSettingTab{plugin;constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=e.createDiv({cls:"ideatr-beta-notice"});t.setCssProps({background:"var(--background-modifier-border)",padding:"1em","border-radius":"4px","margin-bottom":"1.5em","border-left":"3px solid var(--text-warning)"}),t.createEl("strong",{text:"\u26A0\uFE0F local AI version - no updates"}).setCssProps({display:"block","margin-bottom":"0.5em",color:"var(--text-warning)"}),t.createEl("p",{text:"This version (v0.8.6) includes local AI functionality but will not receive updates or bug fixes. This is a one-time snapshot release for users who want to try local AI in the Obsidian plugin."}).setCssProps({margin:"0.5em 0","line-height":"1.5"}),t.createEl("p",{text:"We recommend keeping an eye out for the upcoming ideatr desktop app, which will include local AI with ongoing support and updates."}).setCssProps({margin:"0.5em 0","line-height":"1.5"}),t.createEl("a",{text:"Learn more about desktop app \u2192",href:"https://ideatr.app/desktop",attr:{target:"_blank",rel:"noopener"}}).setCssProps({color:"var(--text-accent)","text-decoration":"none",display:"inline-block","margin-top":"0.5em"});let a=t.createDiv();a.setCssProps({"margin-top":"0.75em",display:"flex",gap:"0.5em","flex-wrap":"wrap"});let c=a.createEl("a",{text:"\u{1F4DD} report bug or request a feature",href:"#ideatr-feedback-section"});c.setCssProps({color:"var(--text-accent)","text-decoration":"none",cursor:"pointer"}),c.addEventListener("click",M=>{M.preventDefault(),setTimeout(()=>{let k=e.querySelector("#ideatr-feedback-section");k&&k.scrollIntoView({behavior:"smooth",block:"start"})},100)}),a.createEl("a",{text:"\u{1F5FA}\uFE0F view planned features",href:"https://github.com/FallingWithStyle/obsidian-ideatr#roadmap",attr:{target:"_blank",rel:"noopener"}}).setCssProps({color:"var(--text-accent)","text-decoration":"none"}),a.createEl("a",{text:"\u{1F41B} GitHub issues",href:"https://github.com/FallingWithStyle/obsidian-ideatr/issues",attr:{target:"_blank",rel:"noopener"}}).setCssProps({color:"var(--text-accent)","text-decoration":"none"});let u=new vi(this.app,this.plugin,this),m=new jo(this.app,this.plugin,this),p=new Ho(this.app,this.plugin,this),w=new Go(this.app,this.plugin,this),v=new Ko(this.app,this.plugin,this);u.display(e),m.display(e);let _=e.createDiv({cls:"settings-section-title",attr:{id:"ideatr-feedback-section"}});new Ks.Setting(_).setName("Feedback & support").setHeading(),w.display(e),new Ks.Setting(e).setName("Error logging").setHeading(),p.display(e);let I=e.createDiv({cls:"settings-section-title"});new Ks.Setting(I).setName("Capture modal").setHeading();let A=Ft(this.app,"capture-workflows","Learn about Capture Modal");I.appendChild(A),v.display(e)}};var Ea=require("obsidian");function Xo(s,e){return`${lg(s)}.md`}function lg(s){let e=s.trim().replace(/[:*?"<>|/\\]/g,"").replace(/\s+/g," ").trim();return e.length>100&&(e=e.substring(0,100).trim()),e.length===0&&(e="Untitled"),e}function bp(s,e){return`${s.replace(/\.md$/,"")}-${e}.md`}function bl(){let s=Date.now(),e=Math.floor(Math.random()*1e4);return s*1e4+e}function wp(s){return s.length===0?1:Math.max(...s)+1}function Qo(s){let e=bl(),t=0,r=10;for(;s.includes(e)&&t<r;)e=wp(s),t++;return s.includes(e)?wp(s):e}function Zo(s,e){let t=e?Qo(e):bl();return{type:"idea",status:"captured",created:dg(s.timestamp),id:t,category:"",tags:[],related:[],domains:[],"existence-check":[]}}function Js(s){let e=["---",`type: ${s.type}`,`status: ${s.status}`,`created: ${s.created}`,`id: ${s.id??0}`,`category: ${typeof s.category=="string"?s.category:""}`,`tags: ${Yo(s.tags)}`,`related: ${Yo(s.related)}`,`domains: ${Yo(s.domains)}`,`existence-check: ${Yo(s["existence-check"])}`];return s.elevated&&e.push(`elevated: ${s.elevated}`),s.projectPath&&e.push(`projectPath: ${s.projectPath}`),s.codename&&e.push(`codename: ${s.codename}`),e.push("---"),e.join(`
`)}function dg(s){let e=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0");return`${e}-${t}-${r}`}function Yo(s){return s.length===0?"[]":`[${s.join(", ")}]`}var ea="Ideas",Ir=class{vault;constructor(e){this.vault=e}async createIdeaFile(e){await this.ensureIdeasDirectory();let t=Xo(e.text,e.timestamp),r=`${ea}/${t}`;r=this.resolveCollision(r);let n=Zo(e),o=`${Js(n)}

${e.text}`;return await this.vault.create(r,o)}async ensureIdeasDirectory(){this.vault.getAbstractFileByPath(ea)||await this.vault.createFolder(ea)}resolveCollision(e){let t=e,r=2;for(;this.vault.getAbstractFileByPath(t);){let n=e.split("/").pop()??"",i=bp(n,r);t=`${ea}/${i}`,r++}return t}fileExists(e){return this.vault.getAbstractFileByPath(e)!==null}async updateIdeaFrontmatter(e,t){await this.vault.process(e,r=>{let n=/^---\n([\s\S]*?)\n---/,i=r.match(n);if(!i)return h.warn("No frontmatter found in file:",e.path),r;let o=i[1],a=(c,l)=>{let d=Array.isArray(l)?`[${l.join(", ")}]`:l,u=new RegExp(`^${c}:.*$`,"m");u.test(o)?o=o.replace(u,`${c}: ${d}`):o+=`
${c}: ${d}`};return Object.entries(t).forEach(([c,l])=>{a(c,l)}),r.replace(n,`---
${o}
---`)})}async appendToFileBody(e,t,r,n=!0){await this.vault.process(e,i=>{let o=this.findSectionInContent(i,t);if(o&&n){let a=i.substring(0,o.start),c=i.substring(o.end);return this.ensureSpacing(a,"before")+r+this.ensureSpacing(c,"after")}else if(o&&!n){let a=i.substring(0,o.end),c=i.substring(o.end);return this.ensureSpacing(a,"before")+`

`+r+this.ensureSpacing(c,"after")}else return this.ensureSpacing(i,"before")+`

`+r})}findSectionInContent(e,t){let r=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`^##\\s+${r}\\s*$`,"im"),i=e.match(n);if(i?.index===void 0)return null;let o=i.index,a=o+i[0].length,c=e.substring(a),l=c.match(/^##\s+/m);if(l?.index!==void 0)return{start:o,end:a+l.index};let d=/\n\n(?![\s]*[-*|])/,u=c.match(d);if(u?.index!==void 0){let m=c.substring(u.index+2);if(m.trim()&&!m.match(/^\s*[-*|]/))return{start:o,end:a+u.index}}return{start:o,end:e.length}}ensureSpacing(e,t="before"){return t==="before"?e.endsWith(`
`)?e:e+`
`:e.startsWith(`
`)?e:`
`+e}};var ta=class{vault;IDEAS_DIR="Ideas/";MIN_SIMILARITY_THRESHOLD=.15;constructor(e){this.vault=e}async findRelatedNotes(e,t=5){let n=this.vault.getMarkdownFiles().filter(a=>a.path.startsWith(this.IDEAS_DIR));if(n.length===0)return[];let i=[];for(let a of n)try{let c=await this.vault.cachedRead(a),l=this.extractBodyText(c),d=this.calculateSimilarity(e,l);d>=this.MIN_SIMILARITY_THRESHOLD&&i.push({file:a,similarity:d})}catch(c){h.warn(`Failed to read file ${a.path}:`,c)}return i.sort((a,c)=>c.similarity-a.similarity),i.slice(0,t).map(({file:a,similarity:c})=>({path:a.path,title:a.basename,similarity:c}))}extractBodyText(e){let t=/^---\n[\s\S]*?\n---(\n\n?|\n?)/,r=e.match(t);return(r?e.substring(r[0].length):e).trim()}calculateSimilarity(e,t){if(!e||!t)return 0;let r=this.tokenize(e),n=this.tokenize(t);if(r.size===0||n.size===0)return 0;let i=new Set([...r].filter(l=>n.has(l))),o=new Set([...r,...n]);if(o.size===0)return 0;let a=i.size/o.size,c=i.size/Math.min(r.size,n.size);return Math.min(a*(1+c*.3),1)}tokenize(e){let t=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","by","from","as","is","are","was","were","been","be","have","has","had","do","does","did","will","would","could","should","may","might","must","can","this","that","these","those","i","you","he","she","it","we","they","what","which","who","when","where","why","how","all","each","every","some","any","no","other","another","such","only","just","more","most","very","much","many","few","little","own","same","so","than","too","also"]),o=e.toLowerCase().replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/#{1,6}\s+/g,"").replace(/\*\*([^*]+)\*\*/g,"$1").replace(/\*([^*]+)\*/g,"$1").replace(/`([^`]+)`/g,"$1").replace(/[^\w\s]/g," ").split(/\s+/).map(a=>a.trim()).filter(a=>a.length>3&&!t.has(a));return new Set(o)}};var ra=class{llmService;searchService;constructor(e,t){this.llmService=e,this.searchService=t}isAvailable(){return this.llmService.isAvailable()}async classifyIdea(e){let t={category:"",tags:[],related:[]},r=[];return this.llmService.isAvailable()&&r.push(this.llmService.classify(e).then(n=>{t.category=n.category,t.tags=[...new Set(n.tags)]}).catch(n=>{h.warn("LLM classification failed:",n)})),r.push(this.searchService.findRelatedNotes(e,3).then(n=>{t.related=n.map(i=>i.path)}).catch(n=>{h.warn("Related note search failed:",n)})),await Promise.all(r),t}};var sa=class{searchService;DEFAULT_THRESHOLD=.75;constructor(e){this.searchService=e}async checkDuplicate(e,t){let r=t??this.DEFAULT_THRESHOLD;if(!e||e.trim().length===0)return{isDuplicate:!1,duplicates:[],threshold:r};let i=(await this.searchService.findRelatedNotes(e,10)).filter(o=>o.similarity!==void 0&&o.similarity>=r);return{isDuplicate:i.length>0,duplicates:i,threshold:r}}};var na=class{prospectrService;constructor(e){this.prospectrService=e}extractDomains(e){let t=/\b([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.(?:[a-zA-Z]{2,}))\b/g,r=e.match(t);if(!r)return[];let n=/["']([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})["']/g,i=e.match(n);i&&i.forEach(c=>{let l=c.replace(/["']/g,"");r.includes(l)||r.push(l)});let o=/domain(?:s)?:\s*([a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/gi,a=e.match(o);return a&&a.forEach(c=>{let l=c.replace(/domain(?:s)?:\s*/i,"").trim();l&&!r.includes(l)&&r.push(l)}),[...new Set(r.map(c=>c.toLowerCase().trim()))]}async checkDomains(e,t){let r=this.extractDomains(e);if(r.length===0)return[];if(!this.prospectrService.isAvailable())return r.map(n=>({domain:n,available:!1,error:"Prospectr service is not available",checkedAt:new Date().toISOString()}));try{return await this.prospectrService.checkDomainsAvailability(r)}catch(n){return h.warn("Domain checking failed:",n),r.map(i=>({domain:i,available:!1,error:n instanceof Error?n.message:"Unknown error",checkedAt:new Date().toISOString()}))}}};var ia=class{prospectrUrl;isEnabled;timeout;constructor(e="http://localhost:3000",t=1e4){this.prospectrUrl=e,this.timeout=t,this.isEnabled=!1}isAvailable(){return this.prospectrUrl,this.timeout,this.isEnabled}checkDomainAvailability(e){return this.isAvailable()?Promise.resolve({domain:e,available:!1,error:"Domain checking service is not yet implemented",checkedAt:new Date().toISOString()}):Promise.resolve({domain:e,available:!1,error:"Prospectr service is not available",checkedAt:new Date().toISOString()})}async checkDomainsAvailability(e){return await Promise.all(e.map(r=>this.checkDomainAvailability(r)))}};var vp=require("obsidian");var oa=class{settings;constructor(e){this.settings=e}isAvailable(){return this.settings.webSearchProvider==="none"?!1:this.settings.webSearchProvider==="google"?!!(this.settings.googleSearchApiKey&&this.settings.googleSearchEngineId):!1}async search(e,t,r){if(!this.isAvailable()||!e||e.trim().length===0)return[];let n=r??this.settings.maxSearchResults??5;try{let i=await this.performSearch(e,n);return this.processResults(i,e)}catch(i){return h.warn("Web search failed:",i),[]}}async performSearch(e,t){if(this.settings.webSearchProvider!=="google")throw new Error("Only Google Custom Search is currently supported");let r=this.settings.googleSearchApiKey,n=this.settings.googleSearchEngineId,i=`https://www.googleapis.com/customsearch/v1?key=${r}&cx=${n}&q=${encodeURIComponent(e)}&num=${Math.min(t,10)}`,o=new Promise((a,c)=>{setTimeout(()=>c(new Error(`Timeout: Request exceeded ${this.settings.webSearchTimeout}ms`)),this.settings.webSearchTimeout)});try{let a=await Promise.race([(0,vp.requestUrl)({url:i,method:"GET",throw:!1}),o]);if(a.status<200||a.status>=300)throw a.status===429?new Error("API rate limit exceeded"):new Error(`HTTP ${a.status}: Request failed`);return(typeof a.json=="function"?await a.json():a.json).items??[]}catch(a){throw a instanceof Error&&a.message.includes("Timeout")||a instanceof Error?a:new Error(String(a))}}processResults(e,t){if(!e||e.length===0)return[];let n=t.toLowerCase().split(/\s+/),i=e.map(o=>{let a=o.title??"",c=o.snippet??"",l=o.link??"",d;if(o.pagemap?.metatags){for(let m of o.pagemap.metatags)if(m["article:published_time"]){d=m["article:published_time"].split("T")[0];break}}let u=this.calculateRelevance(a,c,n);return{title:a,url:l,snippet:c,date:d,relevance:u}});return i.sort((o,a)=>(a.relevance??0)-(o.relevance??0)),i.filter(o=>(o.relevance??0)>=.3)}calculateRelevance(e,t,r){let n=e.toLowerCase(),i=t.toLowerCase(),o=`${n} ${i}`,a=0,c=0;for(let d of r)o.includes(d)&&(c++,n.includes(d)?a+=.3:a+=.1);let l=c/r.length;return a=Math.min(a+l*.2,1),Math.round(a*100)/100}};var aa=class{cache;ttl;maxSize;statistics;constructor(e=24*60*60*1e3,t=0){this.cache=new Map,this.ttl=e,this.maxSize=t,this.statistics={hits:0,misses:0}}get(e){let t=this.normalizeKey(e),r=this.cache.get(t);return r?Date.now()-r.timestamp>this.ttl?(this.cache.delete(t),this.statistics.misses++,null):(this.statistics.hits++,r.variants):(this.statistics.misses++,null)}set(e,t,r){let n=this.normalizeKey(e);this.maxSize>0&&this.cache.size>=this.maxSize&&!this.cache.has(n)&&this.evictOldest(),this.cache.set(n,{variants:t,timestamp:Date.now(),quality:r})}clearExpired(){let e=Date.now(),t=0;for(let[r,n]of this.cache.entries())e-n.timestamp>this.ttl&&(this.cache.delete(r),t++);return t}clear(){this.cache.clear(),this.statistics={hits:0,misses:0}}size(){return this.cache.size}getStatistics(){let e=this.statistics.hits+this.statistics.misses,t=e>0?this.statistics.hits/e:0,r=null,n=null;for(let i of this.cache.values())(r===null||i.timestamp<r)&&(r=i.timestamp),(n===null||i.timestamp>n)&&(n=i.timestamp);return{totalEntries:this.cache.size,totalHits:this.statistics.hits,totalMisses:this.statistics.misses,hitRate:Math.round(t*100)/100,oldestEntry:r,newestEntry:n}}resetStatistics(){this.statistics={hits:0,misses:0}}loadFromData(e){this.cache.clear();let t=Date.now();for(let[r,n]of Object.entries(e))t-n.timestamp<=this.ttl&&this.cache.set(r,n)}toData(){let e={};for(let[t,r]of this.cache.entries())e[t]=r;return e}evictOldest(){let e=null,t=Date.now();for(let[r,n]of this.cache.entries())n.timestamp<t&&(t=n.timestamp,e=r);e&&this.cache.delete(e)}normalizeKey(e){return e.toLowerCase().trim()}};function ug(s){return{synonym:"synonym",short:"short","domain-hack":"domain name",phonetic:"phonetic",portmanteau:"portmanteau","made-up":"made-up"}[s]||s}function Ap(s,e=10){if(s.length===0)return`## Name Variants

(No variants generated)`;let t=new Map;for(let i of s){let o=i.text.toLowerCase();t.has(o)||t.set(o,i)}return`## Name Variants

${Array.from(t.values()).sort((i,o)=>i.text.localeCompare(o.text)).slice(0,e).map(i=>`- ${i.text} (${ug(i.type)})`).join(`
`)}`}async function pg(s,e,t=!1){return!s||s.trim().length===0?"":t&&e?await Sl(s,e):ce(s)}function xp(s){return ce(s)}var ca=class{llmService;settings;cache;loadCacheData;saveCacheData;constructor(e,t,r,n){this.llmService=e,this.settings=t,this.cache=new aa(24*60*60*1e3,t.variantCacheMaxSize??0),this.loadCacheData=r,this.saveCacheData=n,t.variantCachePersist&&r&&this.loadCache().catch(i=>{h.warn("Failed to load variant cache:",i)})}async loadCache(){if(this.loadCacheData)try{let e=await this.loadCacheData();e&&typeof e=="object"&&this.cache.loadFromData(e)}catch(e){h.warn("Failed to load variant cache:",e)}}async saveCache(){if(!(!this.settings.variantCachePersist||!this.saveCacheData))try{let e=this.cache.toData();await this.saveCacheData(e)}catch(e){h.warn("Failed to save variant cache:",e)}}getCacheStatistics(){return this.cache.getStatistics()}clearCache(){this.cache.clear(),this.saveCache().catch(e=>{h.warn("Failed to save cache after clear:",e)})}async generateVariants(e,t){let r=t??await pg(e,this.llmService,this.settings.useLLMForNameExtraction||!1);if(!r||r.trim().length===0)return[];let n=this.cache.get(r);if(n)return n;if(this.llmService.isAvailable())try{let a=await this.generateVariantsWithLLM(r);if(a.length>0){let c=this.calculateAverageQuality(a);return this.cache.set(r,a,c),this.settings.variantCachePersist&&this.saveCache().catch(l=>h.warn("Cache save failed:",l)),a}}catch(a){h.warn("LLM variant generation failed, using fallback:",a)}let i=this.generateFallbackVariants(r),o=this.calculateAverageQuality(i,!1);return this.cache.set(r,i,o),this.settings.variantCachePersist&&this.saveCache().catch(a=>h.warn("Cache save failed:",a)),i}isAvailable(){return!0}async generateVariantsWithLLM(e){let t=this.constructPrompt(e);if(this.llmService.complete&&typeof this.llmService.complete=="function")try{let r=await this.llmService.complete(t,{temperature:.8,n_predict:512,stop:["}"]}),n=this.parseVariantResponse(r);if(n.length>0)return n}catch(r){h.warn("LLM completion failed, using fallback:",r)}return[]}parseVariantResponse(e){try{let t=le(e,!1),r=JSON.parse(t);return!r.variants||!Array.isArray(r.variants)?[]:r.variants.filter(n=>typeof n=="object"&&n!==null&&"text"in n&&"type"in n).map(n=>{let i;typeof n.text=="string"?i=n.text:n.text!=null&&typeof n.text!="object"&&typeof n.text!="function"&&(typeof n.text=="number"||typeof n.text=="boolean")?i=n.text.toString():i="";let o;return typeof n.type=="string"?o=n.type:n.type!=null&&typeof n.type!="object"&&typeof n.type!="function"&&(typeof n.type=="number"||typeof n.type=="boolean")?o=n.type.toString():o="",{text:i.trim(),type:this.validateVariantType(o),quality:this.calculateVariantQuality(i.trim(),this.validateVariantType(o))}}).slice(0,this.settings.maxVariants||10)}catch(t){return h.warn("Failed to parse variant response:",e,t),[]}}validateVariantType(e){return["synonym","short","domain-hack","phonetic","portmanteau","made-up"].includes(e)?e:"made-up"}constructPrompt(e){return`Generate creative, brandable name variants for: "${e}"

CRITICAL REQUIREMENTS:
- Extract the CORE CONCEPT, not just use the literal text
- Focus on what makes the idea unique and memorable
- Generate names that could actually be used as product/brand names
- Prioritize creativity and memorability over literal translation

Generate 8-12 high-quality, brandable name variants. Each variant must be:
- Memorable and easy to pronounce (test: can you say it out loud naturally?)
- Distinct and creative (avoid generic words like "AI", "App", "Tool")
- Brandable (could you see this as a real product name?)
- 2-15 characters for most variants (domain hacks can be slightly longer if clever)

Variant types (use diverse mix):
1. synonym - Words capturing the idea's essence (e.g., "puzzle game" \u2192 "Riddle", "Enigma")
2. short - Concise, punchy names 3-8 chars (e.g., "notification" \u2192 "Ping", "Buzz")
3. domain-hack - TLD completes word naturally, MUST be short and clever (e.g., "find.it", "read.ly", NOT "longphrase.io")
4. phonetic - Similar sound, different spelling (e.g., "notify" \u2192 "Notifai")
5. portmanteau - Blend two relevant words (e.g., "net" + "flicks" \u2192 "Netflix")
6. made-up - Invented but pronounceable words (e.g., "Zapier", "Slack", "Figma")

STRICT RULES:
- NEVER create unpronounceable acronyms (e.g., "AGPFOIM" is BAD)
- If using acronyms, they must be 6 chars or fewer AND pronounceable (e.g., "ACME", "NASA")
- Domain hacks: Must be SHORT (under 12 chars total) and clever, not just appending .io to long phrases
- Avoid overly generic terms (e.g., "AI", "App", "Tool" alone are too generic)
- Short names: Must be meaningful words or pronounceable invented words, not random letters
- Extract the essence: For "AI puzzle with monkeys like Where's Waldo" \u2192 focus on "puzzle", "find", "monkey", "hidden", not the full description

Examples:

Input: "notification app"
Output: {
  "variants": [
    {"text": "Alert", "type": "synonym"},
    {"text": "Ping", "type": "short"},
    {"text": "Buzz", "type": "short"},
    {"text": "notif.io", "type": "domain-hack"},
    {"text": "Notifai", "type": "phonetic"},
    {"text": "Alertify", "type": "made-up"},
    {"text": "Signal", "type": "synonym"},
    {"text": "Chime", "type": "short"}
  ]
}

Input: "AI generated puzzle full of interlinked monkeys that look similar, sort of a where's waldo of monkeys"
Output: {
  "variants": [
    {"text": "MonkeyFind", "type": "portmanteau"},
    {"text": "PrimateSeek", "type": "portmanteau"},
    {"text": "FindMonkey", "type": "portmanteau"},
    {"text": "WaldoMonkey", "type": "portmanteau"},
    {"text": "SpotTheApe", "type": "portmanteau"},
    {"text": "MonkeyHunt", "type": "portmanteau"},
    {"text": "PrimatePuzzle", "type": "portmanteau"},
    {"text": "ApeSpot", "type": "short"},
    {"text": "MonkeySee", "type": "portmanteau"},
    {"text": "find.ape", "type": "domain-hack"},
    {"text": "Spotly", "type": "made-up"},
    {"text": "Primate", "type": "synonym"}
  ]
}

Input: "meditation tracker"
Output: {
  "variants": [
    {"text": "Mindful", "type": "synonym"},
    {"text": "Zen", "type": "short"},
    {"text": "Breathe", "type": "synonym"},
    {"text": "Mindspace", "type": "portmanteau"},
    {"text": "Breathly", "type": "made-up"},
    {"text": "Calmly", "type": "made-up"},
    {"text": "Zenly", "type": "made-up"}
  ]
}

Input: "task manager"
Output: {
  "variants": [
    {"text": "Organize", "type": "synonym"},
    {"text": "Tasker", "type": "short"},
    {"text": "Doable", "type": "made-up"},
    {"text": "get.done", "type": "domain-hack"},
    {"text": "Taskly", "type": "phonetic"},
    {"text": "Tackle", "type": "synonym"},
    {"text": "Action", "type": "synonym"}
  ]
}

Input: "${e}"
Output: {`}formatVariantsForMarkdown(e){return Ap(e,this.settings.maxVariants||10)}calculateVariantQuality(e,t){let r=.5;return e.length>=3&&e.length<=15?r+=.2:e.length>15&&e.length<=25?r+=.1:(e.length<3||e.length>30)&&(r-=.2),r+={synonym:.15,portmanteau:.15,phonetic:.1,short:.05,"domain-hack":.05,"made-up":0}[t]||0,/^[a-z]+$/i.test(e)&&(r+=.1),e.split(/\s+/).length<=2&&(r+=.05),Math.max(0,Math.min(1,r))}calculateAverageQuality(e,t=!0){if(e.length===0)return 0;let r=e.map(i=>i.quality!==void 0?i.quality:this.calculateVariantQuality(i.text,i.type)),n=r.reduce((i,o)=>i+o,0)/r.length;return t?Math.min(1,n+.1):n}generateFallbackVariants(e){let t=[],r=e.split(/\s+/).filter(c=>c.length>0&&c.length<=15),n=e.replace(/\s+/g,"").toLowerCase(),i=r.filter(c=>{let l=c.toLowerCase();return!["the","a","an","of","for","with","that","this","is","are","was","were"].includes(l)}),o=i.length>0?i:r;if(o.length>0){let c=o[0];if(c.length>=3&&c.length<=12){let l=c.charAt(0).toUpperCase()+c.slice(1).toLowerCase();t.push({text:l,type:"short"})}}if(n.length>0&&n.length<=12&&(t.push({text:`${n}.io`,type:"domain-hack"}),n.length<=10&&t.push({text:`${n}.app`,type:"domain-hack"})),o.length>=2){let c=o[0].toLowerCase(),l=o[1].toLowerCase();if(c.length<=8&&l.length<=8){let d=c+l,u=c.substring(0,Math.min(4,c.length))+l;if(d.length<=12){let m=d.charAt(0).toUpperCase()+d.slice(1);t.push({text:m,type:"portmanteau"})}if(u.length<=12&&u!==d){let m=u.charAt(0).toUpperCase()+u.slice(1);t.push({text:m,type:"portmanteau"})}}}if(o.length>=2&&o.length<=4){let c=o.map(l=>l[0]?.toUpperCase()||"").join("");c.length>=2&&c.length<=4&&t.push({text:c,type:"short"})}return t.map(c=>({...c,quality:this.calculateVariantQuality(c.text,c.type)})).slice(0,this.settings.maxVariants||8)}};var mg={saas:"project",tool:"project",ux:"project",game:"game-mechanic",mechanic:"game-mechanic",story:"narrative-seed",ip:"narrative-seed",hardware:"hardware-concept",brand:"hardware-concept",personal:"generic-idea","":"generic-idea"},hg={id:"project",name:"Project Scaffold",categories:["saas","tool","ux"],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Core Features",content:`## Core Features

- [ ] Feature 1
- [ ] Feature 2
- [ ] Feature 3`,questions:["What are the core features of this project?","What problems does it solve?","Who is the target audience?"]},{title:"Technical Considerations",content:`## Technical Considerations

- Technology stack
- Architecture decisions
- Scalability requirements`,questions:["What technologies are needed?","What are the technical challenges?","What infrastructure is required?"]},{title:"Next Steps",content:`## Next Steps

- [ ] Research existing solutions
- [ ] Validate market need
- [ ] Create prototype
- [ ] Gather feedback`}]},fg={id:"game-mechanic",name:"Game Mechanic Scaffold",categories:["game","mechanic"],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Mechanic Description",content:`## Mechanic Description

Describe how the mechanic works:

- Core gameplay loop
- Player interactions
- Progression systems`,questions:["How does this mechanic work?","What makes it engaging?","How does it fit into the larger game?"]},{title:"Implementation Considerations",content:`## Implementation Considerations

- Technical requirements
- Balance and tuning
- Player feedback systems`,questions:["What technical challenges exist?","How will this be balanced?","What metrics will measure success?"]},{title:"Next Steps",content:`## Next Steps

- [ ] Create prototype
- [ ] Playtest mechanic
- [ ] Iterate based on feedback
- [ ] Document design decisions`}]},gg={id:"narrative-seed",name:"Narrative Seed Scaffold",categories:["story","ip"],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Core Concept",content:`## Core Concept

- Main premise
- Key themes
- Unique elements`,questions:["What is the central premise?","What themes does this explore?","What makes this story unique?"]},{title:"Characters and World",content:`## Characters and World

- Main characters
- Setting details
- World-building elements`,questions:["Who are the main characters?","Where does this take place?","What are the key world-building elements?"]},{title:"Development",content:`## Development

- Plot structure
- Key scenes
- Resolution`,questions:["What is the story structure?","What are the key turning points?","How does it resolve?"]}]},yg={id:"hardware-concept",name:"Hardware Concept Scaffold",categories:["hardware","brand"],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Product Description",content:`## Product Description

- Physical specifications
- Key features
- Design considerations`,questions:["What does this product do?","What are the key features?","What is the target market?"]},{title:"Technical Requirements",content:`## Technical Requirements

- Components needed
- Manufacturing considerations
- Technical challenges`,questions:["What components are required?","What are the manufacturing challenges?","What technical expertise is needed?"]},{title:"Next Steps",content:`## Next Steps

- [ ] Create detailed specifications
- [ ] Research manufacturing options
- [ ] Build prototype
- [ ] Test and iterate`}]},Ip={id:"generic-idea",name:"Idea Scaffold",categories:["personal",""],sections:[{title:"Overview",content:`## Overview

**Name**: {{ideaName}}

{{ideaText}}

**Category**: {{category}}

**Created**: {{created}}`},{title:"Key Points",content:`## Key Points

- Main concept
- Important details
- Related ideas`,questions:["What is the core idea?","What are the key elements?","What should be explored further?"]},{title:"Next Steps",content:`## Next Steps

- [ ] Research
- [ ] Develop further
- [ ] Take action`}]},la=[hg,fg,gg,yg,Ip];function Sp(s){let e=mg[s]??"generic-idea";return la.find(t=>t.id===e)??Ip}var wl=require("obsidian");var Xs=".ideatr/templates",da=class{vault;app;customTemplates=[];allTemplates=[];constructor(e,t){this.vault=e,this.app=t,this.allTemplates=[...la],e&&this.loadCustomTemplates().catch(r=>{h.warn("Failed to load custom templates:",r)})}async loadCustomTemplates(){if(this.vault)try{if(!this.vault.getAbstractFileByPath(Xs)){this.updateAllTemplates();return}let t=this.vault.getFiles().filter(n=>n.path.startsWith(Xs+"/")&&n.extension==="json"),r=[];for(let n of t)try{let i=await this.vault.read(n),o=JSON.parse(i);this.validateTemplate(o)?r.push(o):h.warn(`Invalid template structure in ${n.path}`)}catch(i){h.warn(`Failed to load template from ${n.path}:`,i)}this.customTemplates=r,this.updateAllTemplates()}catch(e){h.warn("Failed to load custom templates:",e),this.updateAllTemplates()}}updateAllTemplates(){let e=new Map;for(let t of la)e.set(t.id,t);for(let t of this.customTemplates)e.set(t.id,t);this.allTemplates=Array.from(e.values())}validateTemplate(e){if(!e||typeof e!="object")return!1;let t=e;return typeof t.id=="string"&&typeof t.name=="string"&&Array.isArray(t.categories)&&Array.isArray(t.sections)&&t.sections.every(r=>{if(!r||typeof r!="object")return!1;let n=r;return typeof n.title=="string"&&typeof n.content=="string"})}async saveCustomTemplate(e){if(!this.vault)throw new Error("Vault not available for saving templates");this.vault.getAbstractFileByPath(Xs)||await this.vault.createFolder(Xs);let r=`${e.id}.json`,n=`${Xs}/${r}`,i=JSON.stringify(e,null,2),o=this.vault.getAbstractFileByPath(n);o&&o instanceof wl.TFile?await this.vault.modify(o,i):await this.vault.create(n,i),await this.loadCustomTemplates()}async deleteCustomTemplate(e){if(!this.vault)throw new Error("Vault not available for deleting templates");let t=`${Xs}/${e}.json`,r=this.vault.getAbstractFileByPath(t);r&&r instanceof wl.TFile&&(this.app?await this.app.fileManager.trashFile(r):this.vault&&await this.vault.delete(r),await this.loadCustomTemplates())}getAvailableTemplates(){return this.allTemplates}isAvailable(){return!0}generateScaffold(e,t,r){let n=r??xp(e),i=this.selectTemplate(t),o={ideaName:n,ideaText:e||"",category:t||"uncategorized",created:new Date().toISOString().split("T")[0],tags:""};return i.sections.map(c=>{let l=this.substituteVariables(c.content,o);if(c.questions&&c.questions.length>0){let d=c.questions.map(u=>`- ${u}`).join(`
`);l+=`

### Questions to Consider

${d}`}return l}).join(`

`)}selectTemplate(e){let t=Sp(e).id;return this.allTemplates.find(r=>r.id===t)??this.allTemplates.find(r=>r.id==="generic-idea")??this.allTemplates[0]}substituteVariables(e,t){let r=e;for(let[n,i]of Object.entries(t)){let o=new RegExp(`\\{\\{${n}\\}\\}`,"g");r=r.replace(o,i||"")}return r}};var je=class{parseFrontmatter(e){let t=/^---\n([\s\S]*?)\n---/,r=e.match(t);if(!r?.[1])return null;let n=r[1],i={},o=n.split(`
`),a=null,c=null,l=null,d=0,u="";for(let I of o){let A=I.trim();if(A.startsWith("type:"))a=A.substring(5).trim();else if(A.startsWith("status:"))c=A.substring(7).trim();else if(A.startsWith("created:"))l=A.substring(8).trim();else if(A.startsWith("id:")){let M=A.substring(3).trim(),k=parseInt(M,10);isNaN(k)||(d=k)}else A.startsWith("category:")&&(u=A.substring(9).trim())}if(!a||!c||!l)return null;i.type=a,i.status=c,i.created=l,i.id=d,i.category=u,i.tags=this.parseArrayField(n,"tags"),i.related=this.parseNumberArrayField(n,"related"),i.domains=this.parseArrayField(n,"domains"),i["existence-check"]=this.parseArrayField(n,"existence-check");let m=n.match(/^elevated:\s*(.+)$/m),p=n.match(/^projectPath:\s*(.+)$/m),w=n.match(/^codename:\s*(.+)$/m);m&&(i.elevated=m[1].trim()),p&&(i.projectPath=p[1].trim()),w&&(i.codename=w[1].trim());let v=n.match(/^dismissed:\s*(.+)$/m),_=n.match(/^actedUpon:\s*(.+)$/m);return v&&(i.dismissed=v[1].trim().toLowerCase()==="true"),_&&(i.actedUpon=_[1].trim().toLowerCase()==="true"),this.validateFrontmatter(i)?i:null}parseArrayField(e,t){let r=new RegExp(`^${t}:\\s*(.+)$`,"m"),n=e.match(r);if(!n)return[];let i=n[1].trim();if(i==="[]")return[];let o=i.match(/^\[(.+)\]$/);return o?o[1].split(",").map(c=>c.trim()).filter(c=>c.length>0):[]}parseNumberArrayField(e,t){let r=new RegExp(`^${t}:\\s*(.+)$`,"m"),n=e.match(r);if(!n)return[];let i=n[1].trim();if(i==="[]")return[];let o=i.match(/^\[(.+)\]$/);return o?o[1].split(",").map(c=>{let l=c.trim().replace(/^["']|["']$/g,""),d=parseInt(l,10);return isNaN(d)?0:d}).filter(c=>c!==0):[]}parseIdeaFile(e,t){let r=this.parseFrontmatter(t);return r?{frontmatter:r,body:this.extractBody(t),filename:e.name}:{frontmatter:{type:"idea",status:"captured",created:new Date().toISOString().split("T")[0],id:0,category:"",tags:[],related:[],domains:[],"existence-check":[]},body:this.extractBody(t),filename:e.name}}parse(e){let t=this.parseFrontmatter(e),r=this.extractBody(e);return t?{frontmatter:t,body:r}:{frontmatter:{type:"idea",status:"captured",created:new Date().toISOString().split("T")[0],id:0,category:"",tags:[],related:[],domains:[],"existence-check":[]},body:r}}build(e,t){return`${Js(e)}

${t}`}extractBody(e){let t=/^---\n[\s\S]*?\n---(\n\n?|\n?)/;return e.replace(t,"").trim()}validateFrontmatter(e){if(!e.type||e.type!=="idea")return!1;let t=["captured","elevated","archived","validated","promoted"];if(!e.status||!t.includes(e.status)||!e.created||typeof e.created!="string"||!/^\d{4}-\d{2}-\d{2}$/.test(e.created)||((e.id===void 0||typeof e.id!="number")&&(e.id=0),e.category!==void 0&&typeof e.category!="string"))return!1;let n=["tags","related","domains","existence-check"];for(let i of n)if(e[i]!==void 0&&!Array.isArray(e[i]))return!1;return!0}};var Ep=require("obsidian");var Qs=class extends Error{constructor(t,r){super(t);this.code=r;this.name="ManagementError"}};var ua=class{constructor(e,t){this.vault=e;this.parser=t??new je}cache=new Map;watchers=new Set;parser;MAX_CACHE_SIZE=1e4;async getAllIdeas(){let t=this.vault.getMarkdownFiles().filter(n=>n.path.startsWith("Ideas/")),r=[];for(let n of t)try{let i=await this.vault.read(n),o=this.parser.parseIdeaFile(n,i);if(r.push(o),this.cache.set(n.path,o),this.cache.size>this.MAX_CACHE_SIZE){let a=this.cache.keys().next().value;a&&typeof a=="string"&&this.cache.delete(a)}}catch{let i=new Qs(`Failed to read idea file: ${n.path}`,"FILE_READ_ERROR");h.warn(i.message,i)}return r}async getIdeasByFilter(e){let r=this.cache.size>0?Array.from(this.cache.values()):await this.getAllIdeas();if(e.categories&&e.categories.length>0&&(r=r.filter(n=>e.categories.includes(n.frontmatter.category))),e.tags&&e.tags.length>0&&(r=r.filter(n=>e.tags.some(i=>n.frontmatter.tags.includes(i)))),e.status&&(r=r.filter(n=>n.frontmatter.status===e.status)),e.uncategorized&&(r=r.filter(n=>n.frontmatter.category==="")),e.searchText){let n=e.searchText.toLowerCase();r=r.filter(i=>{let o=i.filename.toLowerCase(),a=i.body.toLowerCase(),c=i.frontmatter.tags.join(" ").toLowerCase();return o.includes(n)||a.includes(n)||c.includes(n)})}return e.dateRange&&(r=r.filter(n=>{let i=new Date(n.frontmatter.created);return i>=e.dateRange.start&&i<=e.dateRange.end})),r}async getIdeaByPath(e){if(!e.startsWith("Ideas/"))return null;let t=this.vault.getAbstractFileByPath(e),r=t instanceof Ep.TFile?t:null;if(!r)return null;try{let n=await this.vault.read(r),i=this.parser.parseIdeaFile(r,n);if(this.cache.set(e,i),this.cache.size>this.MAX_CACHE_SIZE){let o=this.cache.keys().next().value;o&&typeof o=="string"&&this.cache.delete(o)}return i}catch(n){return h.warn(`Failed to read idea file: ${e}`,n),null}}watchIdeas(e){let t=c=>{c.path.startsWith("Ideas/")&&(async()=>{try{let d=await this.vault.read(c),u=this.parser.parseIdeaFile(c,d);this.cache.set(c.path,u)}catch{this.cache.delete(c.path)}let l=Array.from(this.cache.values());e(l)})()},r=c=>{if(c.path.startsWith("Ideas/")){this.cache.delete(c.path);let l=Array.from(this.cache.values());e(l)}},n=this.vault.on.bind(this.vault),i=n("modify",t),o=n("create",t),a=n("delete",r);return this.watchers.add(i),this.watchers.add(o),this.watchers.add(a),()=>{i(),o(),a(),this.watchers.delete(i),this.watchers.delete(o),this.watchers.delete(a)}}async refresh(){this.cache.clear(),await this.getAllIdeas()}};var Ys=class{isAvailable(){return!0}generateEmbedding(e){let t=this.tokenize(e),r=this.calculateWordFrequencies(t),n=[],i=Array.from(new Set(t));for(let o=0;o<50;o++){let a=0;for(let c of i){let l=this.simpleHash(c+o);a+=l%100/100*r[c]}n.push(a/i.length)}return n}generateEmbeddings(e){return e.map(t=>this.generateEmbedding(t))}calculateSimilarityMatrix(e){let t=[];for(let r=0;r<e.length;r++){let n=[],i=this.getIdeaText(e[r]);for(let o=0;o<e.length;o++)if(r===o)n.push(1);else{let a=this.getIdeaText(e[o]),c=this.calculateSimilarity(i,a);n.push(c)}t.push(n)}return t}calculateSimilarity(e,t){let r=new Set(this.tokenize(e.toLowerCase())),n=new Set(this.tokenize(t.toLowerCase()));if(r.size===0&&n.size===0)return 1;if(r.size===0||n.size===0)return 0;let i=new Set([...r].filter(a=>n.has(a))),o=new Set([...r,...n]);return i.size/o.size}tokenize(e){return e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(t=>t.length>0)}calculateWordFrequencies(e){let t={};for(let r of e)t[r]=(t[r]||0)+1;return t}simpleHash(e){let t=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);t=(t<<5)-t+n,t=t&t}return Math.abs(t)}getIdeaText(e){let t=[];return e.frontmatter.category&&t.push(e.frontmatter.category),t.push(...e.frontmatter.tags),t.push(e.body),t.join(" ")}};var pa=class{constructor(e,t=.3){this.embeddingService=e;this.similarityThreshold=t}clusterIdeas(e,t){if(e.length===0)return Promise.resolve([]);if(e.length===1)return Promise.resolve([{id:"cluster-0",ideas:[e[0]],label:"Single Idea"}]);let r;if(t)r=this.calculateSimilarityMatrixFromEmbeddings(t);else if(this.embeddingService instanceof Ys)r=this.embeddingService.calculateSimilarityMatrix(e);else{let i=e.map(a=>this.getIdeaText(a)),o=this.embeddingService.generateEmbeddings(i);r=this.calculateSimilarityMatrixFromEmbeddings(o)}let n=this.hierarchicalClustering(e,r);return Promise.resolve(n)}calculateSimilarity(e,t){if(e.length!==t.length)return 0;let r=0,n=0,i=0;for(let c=0;c<e.length;c++)r+=e[c]*t[c],n+=e[c]*e[c],i+=t[c]*t[c];let o=Math.sqrt(n)*Math.sqrt(i);return o===0?0:(r/o+1)/2}calculateSimilarityMatrixFromEmbeddings(e){let t=[];for(let r=0;r<e.length;r++){let n=[];for(let i=0;i<e.length;i++)if(r===i)n.push(1);else{let o=this.calculateSimilarity(e[r],e[i]);n.push(o)}t.push(n)}return t}hierarchicalClustering(e,t){let r=e.map((n,i)=>({id:`cluster-${i}`,ideas:[n],label:this.generateClusterLabel([n])}));for(;r.length>1;){let n=-1,i=-1,o=-1;for(let c=0;c<r.length;c++)for(let l=c+1;l<r.length;l++){let d=this.calculateClusterSimilarity(r[c],r[l],t,e);d>n&&(n=d,i=c,o=l)}if(n<this.similarityThreshold)break;let a={id:`cluster-${r.length}`,ideas:[...r[i].ideas,...r[o].ideas],label:this.generateClusterLabel([...r[i].ideas,...r[o].ideas])};r=r.filter((c,l)=>l!==i&&l!==o),r.push(a)}return r.map((n,i)=>({...n,id:`cluster-${i}`}))}calculateClusterSimilarity(e,t,r,n){let i=e.ideas.map(l=>n.findIndex(d=>d.filename===l.filename)),o=t.ideas.map(l=>n.findIndex(d=>d.filename===l.filename)),a=0,c=0;for(let l of i)for(let d of o)l>=0&&d>=0&&l<r.length&&d<r[l].length&&(a+=r[l][d],c++);return c>0?a/c:0}generateClusterLabel(e){if(e.length===0)return"Empty Cluster";if(e.length===1)return e[0].frontmatter.category||"Uncategorized";let t=e.map(i=>i.frontmatter.category).filter(i=>i);if(t.length===0)return"Mixed Ideas";let r={};for(let i of t)r[i]=(r[i]||0)+1;let n=Object.entries(r).sort((i,o)=>o[1]-i[1])[0];return n?`${n[0]} (${e.length})`:"Mixed Ideas"}getIdeaText(e){let t=[];return e.frontmatter.category&&t.push(e.frontmatter.category),t.push(...e.frontmatter.tags),t.push(e.body),t.join(" ")}};var ma=class{layoutGraph(e,t,r){if(e.length===0)return{nodes:[],edges:[],width:t,height:r};let n=[],i=[],o=t/2,a=r/2,c=Math.min(t,r)*.3,l=0;for(let d of e){let u=2*Math.PI*e.indexOf(d)/e.length,m=o+c*Math.cos(u),p=a+c*Math.sin(u),w=Math.ceil(Math.sqrt(d.ideas.length)),v=50;d.ideas.forEach((_,I)=>{let A=Math.floor(I/w),k=(I%w-w/2)*v,N=(A-w/2)*v;n.push({id:`node-${l++}`,idea:_,x:m+k,y:p+N,clusterId:d.id})})}for(let d=0;d<n.length;d++)for(let u=d+1;u<n.length;u++)if(n[d].clusterId===n[u].clusterId){let m=this.calculateNodeSimilarity(n[d].idea,n[u].idea);m>.1&&i.push({from:n[d].id,to:n[u].id,weight:m})}return{nodes:n,edges:i,width:t,height:r}}updateLayout(e,t){if(!t.length||!e.nodes.length)return e;let r=new Map;for(let d of e.nodes)r.set(d.idea.filename,d);let n=[...e.nodes],i=[...e.edges],o=e.nodes.reduce((d,u)=>d+u.x,0)/e.nodes.length,a=e.nodes.reduce((d,u)=>d+u.y,0)/e.nodes.length,c=e.nodes[0]?.clusterId??"cluster-0",l=0;for(let d of t){let u=r.get(d.filename);if(u){u.idea=d;continue}let m=30+l*20,p=l%2===0?1:-1,w={id:`node-${n.length+l}`,idea:d,x:Math.min(Math.max(o+p*m,0),e.width),y:Math.min(Math.max(a+p*m,0),e.height),clusterId:c};n.push(w);for(let v of e.nodes){if(v.clusterId!==w.clusterId)continue;let _=this.calculateNodeSimilarity(v.idea,d);_>.1&&i.push({from:v.id,to:w.id,weight:_})}l++}return{...e,nodes:n,edges:i}}calculateNodeSimilarity(e,t){let r=0;e.frontmatter.category===t.frontmatter.category&&e.frontmatter.category&&(r+=.3);let n=new Set(e.frontmatter.tags),i=new Set(t.frontmatter.tags),o=new Set([...n].filter(m=>i.has(m))),a=new Set([...n,...i]);a.size>0&&(r+=.2*(o.size/a.size));let c=new Set(this.tokenize(e.body)),l=new Set(this.tokenize(t.body)),d=new Set([...c].filter(m=>l.has(m))),u=new Set([...c,...l]);return u.size>0&&(r+=.5*(d.size/u.size)),Math.min(r,1)}tokenize(e){return e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(t=>t.length>2)}};var vl=require("obsidian");var ha=class{constructor(e,t,r){this.ideaRepository=e;this.settings=t;this.vault=r}async identifyOldIdeas(e){let t=e??this.settings.resurfacingThresholdDays??7,r=await this.ideaRepository.getAllIdeas(),n=new Date,i=new Date(n.getTime()-t*24*60*60*1e3),o=[];for(let a of r){let c=new Date(a.frontmatter.created);if(isNaN(c.getTime())){let l=new Qs(`Failed to parse date for idea ${a.filename}`,"DATE_PARSE_ERROR");h.warn(l.message,l);continue}c<i&&(await this.isDismissedOrActedUpon(`Ideas/${a.filename}`)||o.push(a))}return o}async generateDigest(e){let t=e??await this.identifyOldIdeas();t.sort((n,i)=>{let o=new Date(n.frontmatter.created).getTime(),a=new Date(i.frontmatter.created).getTime();return o-a});let r=this.generateDigestMarkdown(t);return{id:`digest-${Date.now()}`,generatedAt:new Date,ideas:t,summary:r}}async markAsDismissed(e){if(!this.vault){h.warn("Vault not available, cannot mark as dismissed");return}let t=this.vault.getAbstractFileByPath(e),r=t instanceof vl.TFile?t:null;if(!r){h.warn(`File not found: ${e}`);return}await new Ir(this.vault).updateIdeaFrontmatter(r,{dismissed:!0,dismissedAt:new Date().toISOString().split("T")[0]})}async markAsActedUpon(e){if(!this.vault){h.warn("Vault not available, cannot mark as acted upon");return}let t=this.vault.getAbstractFileByPath(e),r=t instanceof vl.TFile?t:null;if(!r){h.warn(`File not found: ${e}`);return}await new Ir(this.vault).updateIdeaFrontmatter(r,{actedUpon:!0,actedUponAt:new Date().toISOString().split("T")[0]})}async isDismissedOrActedUpon(e){let t=await this.ideaRepository.getIdeaByPath(e);if(!t)return!1;let r=t.frontmatter;return!!((r.dismissed??!1)||(r.actedUpon??!1))}generateDigestMarkdown(e){if(e.length===0)return`# Weekly Idea Digest

No old ideas found.`;let t=["# Weekly Idea Digest","",`Generated on: ${new Date().toLocaleDateString()}`,"","## Old Ideas Needing Attention",""];for(let i of e){let o=this.calculateAge(i.frontmatter.created),a=i.body.substring(0,200),c=i.body.length>200;t.push(`### ${i.filename.replace(".md","")}`),t.push(""),t.push(`**Category**: ${i.frontmatter.category??"Uncategorized"}`),t.push(`**Created**: ${i.frontmatter.created}`),t.push(`**Age**: ${o} days`),i.frontmatter.tags.length>0&&t.push(`**Tags**: ${i.frontmatter.tags.join(", ")}`),t.push(""),t.push(a+(c?"...":"")),t.push(""),t.push(`[Open Idea](Ideas/${i.filename})`),t.push(""),t.push("---"),t.push("")}t.push("## Summary"),t.push(""),t.push(`- **Total Ideas**: ${e.length}`);let r={};for(let i of e){let o=i.frontmatter.category??"Uncategorized";r[o]=(r[o]??0)+1}let n=Object.entries(r).map(([i,o])=>`${i}: ${o}`).join(", ");return t.push(`- **By Category**: ${n}`),t.push(""),t.join(`
`)}calculateAge(e){try{let t=new Date(e),n=Math.abs(new Date().getTime()-t.getTime());return Math.ceil(n/(1e3*60*60*24))}catch{return 0}}};var Al=require("obsidian");var fa=class{vault;app;frontmatterParser;settings;constructor(e,t,r,n){this.vault=e,this.app=n,this.frontmatterParser=t,this.settings=r}getProjectsDirectory(){return this.settings.elevationProjectsDirectory??"Projects"}getDefaultFolders(){return(this.settings.elevationDefaultFolders??"docs,notes,assets").split(",").map(t=>t.trim()).filter(t=>t.length>0)}canElevate(e){return!(!e.frontmatter?.type||!e.frontmatter.status||e.frontmatter.status==="elevated"||e.frontmatter.type!=="idea")}generateProjectName(e){let t=ce(e.body);if(!t||t.trim().length===0){let r=e.filename.replace(/\.md$/,""),n=r.match(/^\d{4}-\d{2}-\d{2}\s+(.+)$/);n?t=n[1]:t=r}return this.sanitizeProjectName(t)}sanitizeProjectName(e){let t=e.toLowerCase();return t=t.replace(/[^a-z0-9-]/g,"-"),t=t.replace(/-+/g,"-"),t=t.replace(/^-+|-+$/g,""),t.length>50&&(t=t.substring(0,50),t=t.replace(/-+$/,"")),t.length<1&&(t="project"),t}isProjectNameAvailable(e){let t=`${this.getProjectsDirectory()}/${e}`;return this.vault.getAbstractFileByPath(t)===null}async elevateIdea(e,t){if(!this.canElevate(e))return{success:!1,error:"Idea cannot be elevated. It may already be elevated or have invalid frontmatter."};let r=`Ideas/${e.filename}`,n=this.vault.getAbstractFileByPath(r),i=n instanceof Al.TFile?n:null;if(!i)return{success:!1,error:`Idea file not found: ${r}`};let o=t??this.generateProjectName(e),a=await this.resolveProjectNameCollision(o),c=`${this.getProjectsDirectory()}/${a}`,l=[],d=[];try{let u=await this.vault.read(i);await this.ensureProjectsDirectory(),await this.createProjectStructure(c,l);let m=this.prepareElevatedContent(u,c);await this.vault.create(`${c}/README.md`,m),l.push(`${c}/README.md`);try{await this.handleDevraIntegration(c,e),l.push(`${c}/.devra.json`)}catch(p){d.push("Failed to create project metadata file (non-fatal)"),h.warn("Project metadata integration failed:",p)}try{this.app?await this.app.fileManager.trashFile(i):await this.vault.delete(i)}catch(p){d.push("Failed to delete original idea file (project created successfully)"),h.warn("Failed to delete original file:",p)}return{success:!0,projectPath:c,warnings:d.length>0?d:void 0}}catch(u){return await this.rollback(l),{success:!1,error:u instanceof Error?u.message:"Unknown error during elevation"}}}resolveProjectNameCollision(e){let t=e,r=2;for(;!this.isProjectNameAvailable(t);)t=`${e}-${r}`,r++;return Promise.resolve(t)}async ensureProjectsDirectory(){let e=this.getProjectsDirectory();this.vault.getAbstractFileByPath(e)||await this.vault.createFolder(e)}async createProjectStructure(e,t){let r=this.getDefaultFolders();await this.vault.createFolder(e),t.push(e);for(let n of r){let i=`${e}/${n}`;await this.vault.createFolder(i),t.push(i)}}prepareElevatedContent(e,t){let r=this.frontmatterParser.parseFrontmatter(e);if(!r)throw new Error("Failed to parse frontmatter from original file");let n=e.match(/^---\n[\s\S]*?\n---(\n\n?|\n?)([\s\S]*)$/),i=n?n[2].trim():"",o={...r,status:"elevated",elevated:new Date().toISOString().split("T")[0],projectPath:t};return`${Js(o)}

${i}`}async handleDevraIntegration(e,t){if(!this.settings.elevationCreateDevraMetadata)return;let r={name:this.generateProjectName(t),type:"project",source:"ideatr",elevated:new Date().toISOString().split("T")[0],ideaPath:t.filename,ideaCategory:t.frontmatter.category??"",ideaTags:t.frontmatter.tags??[],devraReady:!1,devraProjectPath:null},n=`${e}/.devra.json`;await this.vault.adapter.write(n,JSON.stringify(r,null,2))}async rollback(e){for(let t of[...e].reverse())try{let r=this.vault.getAbstractFileByPath(t);r&&(r instanceof Al.TFile?this.app?await this.app.fileManager.trashFile(r):await this.vault.delete(r):await this.vault.adapter.rmdir(t,!0))}catch(r){h.warn(`Failed to rollback ${t}:`,r)}}};var ga=class{vault;embeddingService;llmService;MIN_SIMILARITY=.3;MAX_SIMILARITY=.5;constructor(e,t,r){this.vault=e,this.embeddingService=t,this.llmService=r}async findTenuousLinks(e,t,r,n){let o=this.vault.getMarkdownFiles().filter(l=>l.path.startsWith("Ideas/")&&!l.path.startsWith("Ideas/Archived/")),a=[];for(let l of o)if(!n.includes(l.path))try{let d=await this.vault.cachedRead(l),u=d.match(/^---\n[\s\S]*?\n---\n\n?([\s\S]*)$/),m=u?u[1].trim():d.trim();if(m.length===0)continue;let p=this.calculateSimilarity(e,m);if(p>=this.MIN_SIMILARITY&&p<=this.MAX_SIMILARITY){let w=d.match(/^---\n([\s\S]*?)\n---/);if(w){let _=w[1].match(/^category:\s*(.+)$/m);if((_?_[1].trim():"")===t)continue;a.push({file:l,similarity:p,content:m})}}}catch(d){h.warn(`Failed to process ${l.path} for tenuous links:`,d)}let c=[];for(let l of a.slice(0,10))try{let d=await this.analyzeConnection(e,t,r,l.content,l.similarity);d.relevance>.5&&c.push({idea:{path:l.file.path,title:l.file.basename,similarity:l.similarity},similarity:l.similarity,explanation:d.explanation,synergy:d.synergy,relevance:d.relevance})}catch(d){h.warn(`Failed to analyze connection with ${l.file.path}:`,d)}return c.sort((l,d)=>d.relevance-l.relevance),c}calculateSimilarity(e,t){let r=this.embeddingService.generateEmbedding(e),n=this.embeddingService.generateEmbedding(t);return this.cosineSimilarity(r,n)}cosineSimilarity(e,t){if(e.length!==t.length)return 0;let r=0,n=0,i=0;for(let a=0;a<e.length;a++)r+=e[a]*t[a],n+=e[a]*e[a],i+=t[a]*t[a];let o=Math.sqrt(n)*Math.sqrt(i);return o===0?0:r/o}async analyzeConnection(e,t,r,n,i){let o=`Analyze the connection between these two ideas, focusing on unexpected or creative connections.

Original Idea:
${e}
Category: ${t}
Tags: ${r.join(", ")}

Related Idea:
${n}
Similarity: ${i.toFixed(2)}

CRITICAL REQUIREMENTS:
- Look beyond surface-level similarities to find deeper, more interesting connections
- Focus on unexpected or creative connections that might not be immediately obvious
- Consider how these ideas could enhance or transform each other
- Think about novel applications or combinations

Analyze and identify:

1. Unexpected Connection
   - What is the non-obvious link between these ideas?
   - What hidden relationships exist beyond the similarity score?
   - How do they relate in ways that might not be immediately apparent?
   - What shared principles, approaches, or underlying concepts connect them?

2. Combination Potential
   - How could these ideas be meaningfully combined?
   - What would a merged or hybrid version look like?
   - How could elements from one idea enhance the other?
   - What complementary strengths do they have?

3. New Possibilities
   - What novel applications emerge from this connection?
   - What new ideas or directions does this relationship suggest?
   - How could combining these ideas solve problems neither could solve alone?
   - What unique value would a combination create?

Output format (JSON only, no markdown, no code blocks):
{
  "explanation": "Clear explanation of the unexpected connection between these ideas...",
  "synergy": "Specific description of how these ideas could be combined and what the result would be...",
  "relevance": 0.0-1.0
}

Response:`;if(!this.llmService.complete)return{explanation:`Similarity: ${i.toFixed(2)}`,relevance:i};try{let a=await this.llmService.complete(o,{temperature:.7,n_predict:500}),c=le(a,!1),l=JSON.parse(c);return{explanation:typeof l.explanation=="string"?l.explanation:"",synergy:typeof l.synergy=="string"?l.synergy:void 0,relevance:typeof l.relevance=="number"?l.relevance:.5}}catch(a){h.warn("Failed to parse LLM analysis:",a)}return{explanation:`Similarity: ${i.toFixed(2)}`,relevance:i}}};var ya=class{vault;frontmatterParser;ideaRepository;constructor(e,t){this.vault=e,this.frontmatterParser=new je,this.ideaRepository=t}async exportIdeas(e){let r=this.vault.getMarkdownFiles().filter(a=>a.path.startsWith("Ideas/")&&!a.path.startsWith("Ideas/Archived/")),n=[],i=new it(this.ideaRepository);for(let a of r)try{let c=await this.vault.read(a),l=this.frontmatterParser.parse(c),d=a.basename.replace(/^\d{4}-\d{2}-\d{2}-/,"").replace(/-/g," "),u=Array.isArray(l.frontmatter.related)?l.frontmatter.related.filter(p=>typeof p=="number"&&p!==0):[],m=await i.idsToPaths(u);n.push({...l.frontmatter,related:m,title:d,body:l.body,filename:a.name,path:a.path})}catch(c){h.warn(`Failed to export ${a.path}:`,c)}let o={version:"1.0",exportedAt:new Date().toISOString(),totalIdeas:n.length,ideas:n};switch(e){case"json":return this.exportJSON(o);case"csv":return this.exportCSV(o);case"markdown":return this.exportMarkdown(o);default:throw new Error(`Unsupported export format: ${String(e)}`)}}exportJSON(e){return JSON.stringify(e,null,2)}exportCSV(e){let t=[];t.push("title,created,category,tags,status,body,related,domains,existence-check");for(let r of e.ideas){let n=[this.escapeCSV(r.title),r.created,r.category||"",r.tags.join(";"),r.status,this.escapeCSV(r.body.replace(/\n/g," ")),r.related.join(";"),r.domains.join(";"),r["existence-check"].join(";")];t.push(n.join(","))}return t.join(`
`)}exportMarkdown(e){let t=[];t.push("# Ideas Export"),t.push(`Exported: ${e.exportedAt}`),t.push(`Total Ideas: ${e.totalIdeas}`),t.push("");for(let r of e.ideas)t.push(`## ${r.title}`),t.push(`- Created: ${r.created}`),t.push(`- Category: ${r.category||"none"}`),t.push(`- Status: ${r.status}`),t.push(`- Tags: ${r.tags.join(", ")||"none"}`),t.push(""),t.push(r.body),t.push(""),t.push("---"),t.push("");return t.join(`
`)}escapeCSV(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}};var ba=class{vault;frontmatterParser;ideaRepository;constructor(e,t){this.vault=e,this.frontmatterParser=new je,this.ideaRepository=t}async importIdeas(e,t){let r={total:0,imported:0,failed:0,errors:[]},n=[];try{switch(t){case"json":n=this.parseJSON(e);break;case"csv":n=this.parseCSV(e);break;case"markdown":n=this.parseMarkdown(e);break;default:throw new Error(`Unsupported import format: ${String(t)}`)}}catch(i){return r.errors.push({item:"parse",error:i instanceof Error?i.message:"Unknown error"}),r}r.total=n.length;for(let i of n)try{await this.importIdea(i),r.imported++}catch(o){r.failed++,r.errors.push({item:i.title||"unknown",error:o instanceof Error?o.message:"Unknown error"})}return r}async importIdea(e){let t=Zo({text:e.body,timestamp:e.created?new Date(e.created):new Date}),r=[];if(e.related&&Array.isArray(e.related)){let d=e.related[0];if(e.related.length>0&&typeof d=="string"){let u=new it(this.ideaRepository),m=e.related.filter(p=>typeof p=="string");r=await u.pathsToIds(m)}else e.related.length>0&&typeof d=="number"&&(r=e.related.filter(u=>typeof u=="number"&&u!==0))}let n={...t,...e,type:"idea",status:e.status??"captured",created:e.created??new Date().toISOString().split("T")[0],id:typeof e.id=="number"?e.id:0,category:e.category??"",tags:e.tags??[],related:r,domains:e.domains??[],"existence-check":e["existence-check"]??[]},i=e.created?new Date(e.created):new Date,o=Xo(e.title||e.body,i),c=`${this.frontmatterParser.build(n,e.body)}

${e.body}`,l=`Ideas/${o}`;await this.vault.create(l,c)}parseJSON(e){let t=JSON.parse(e);if(t.ideas&&Array.isArray(t.ideas))return t.ideas;throw new Error("Invalid JSON format: missing ideas array")}parseCSV(e){let t=e.split(`
`);if(t.length<2)throw new Error("Invalid CSV: no data rows");t[0].split(",");let r=[];for(let n=1;n<t.length;n++){let i=this.parseCSVLine(t[n]),o={title:i[0]||"Untitled",created:i[1]||new Date().toISOString().split("T")[0],category:i[2]||"",tags:i[3]?i[3].split(";").filter(a=>a):[],status:i[4]||"captured",body:i[5]||"",related:i[6]?i[6].split(";").filter(a=>a):[],domains:i[7]?i[7].split(";").filter(a=>a):[],"existence-check":i[8]?i[8].split(";").filter(a=>a):[]};r.push(o)}return r}parseCSVLine(e){let t=[],r="",n=!1;for(let i=0;i<e.length;i++){let o=e[i];o==='"'?n&&e[i+1]==='"'?(r+='"',i++):n=!n:o===","&&!n?(t.push(r),r=""):r+=o}return t.push(r),t}parseMarkdown(e){let t=[],r=e.split(/^## /m);for(let n=1;n<r.length;n++){let o=r[n].split(`
`),a=o[0].trim(),c={},l=0;for(let u=1;u<o.length;u++){let m=o[u];if(m.match(/^- /)){let p=m.match(/^- (\w+): (.+)$/);p&&(c[p[1].toLowerCase()]=p[2])}else if(m.trim()===""){l=u+1;break}}let d=o.slice(l).join(`
`).trim();t.push({title:a,body:d,created:c.created||new Date().toISOString().split("T")[0],category:c.category||"",status:c.status||"captured",tags:c.tags?c.tags.split(",").map(u=>u.trim()):[]})}return t}};var Zs=class{provider;constructor(e){this.provider=e}async classify(e){return await this.provider.classify(e)}isAvailable(){return this.provider.isAvailable()}ensureReady(){return this.provider.isAvailable()?Promise.resolve(!0):Promise.resolve(!1)}async complete(e,t){let r=this.provider;if(r.complete&&typeof r.complete=="function")return await r.complete(e,t);throw new Error("Provider does not support generic completions. Use local LLM or a provider with complete() method.")}getProvider(){return this.provider}};var wg={enabled:!0,maxEntries:50,retentionDays:7},wa=class{logs=[];settings;constructor(e){this.settings={...wg,...e}}logError(e,t,r,n){if(!this.settings.enabled)return;let i=e instanceof Error?e.message:e,o=e instanceof Error?e.stack:void 0,a={timestamp:new Date,error:i,stack:o,context:t,userAction:r,metadata:n};this.logs.push(a),this.logs.length>this.settings.maxEntries&&(this.logs=this.logs.slice(-this.settings.maxEntries)),this.cleanOldEntries()}getRecentLogs(e){let t=new Date;t.setDate(t.getDate()-this.settings.retentionDays);let r=this.logs.filter(n=>n.timestamp>=t);return e?r.slice(-e):r}getAllLogs(){return[...this.logs]}clearLogs(){this.logs=[]}sanitizeLogs(e){let t=e.map(r=>{let n=this.sanitizeString(r.error),i=r.stack?this.sanitizeString(r.stack):void 0,o=r.metadata?this.sanitizeMetadata(r.metadata):void 0;return{...r,error:n,stack:i,metadata:o}});return JSON.stringify(t,null,2)}formatLogsForIssue(e){return e.length===0?"No error logs available.":`## Error Logs

${e.map(r=>{let n=this.sanitizeString(r.error),i=r.stack?this.sanitizeString(r.stack):void 0,o=`**${r.timestamp.toISOString()}**`;if(r.context&&(o+=` - Context: ${this.sanitizeString(r.context)}`),r.userAction&&(o+=` - Action: ${this.sanitizeString(r.userAction)}`),o+=`
\`\`\`
${n}
\`\`\``,i){let c=i.split(`
`).slice(-20).join(`
`);o+=`

Stack trace (last 20 lines):
\`\`\`
${c}
\`\`\``}return o}).join(`

---

`)}`}sanitizeString(e){return e=e.replace(new RegExp("/Users/[^/]+","g"),"[USER_HOME]"),e=e.replace(new RegExp("/home/[^/]+","g"),"[USER_HOME]"),e=e.replace(/C:\\Users\\[^\\]+/gi,"[USER_HOME]"),e=e.replace(/[A-Z]:\\[^:]+/g,"[DRIVE_PATH]"),e=e.replace(/sk-[a-zA-Z0-9]{20,}/g,"[API_KEY_REDACTED]"),e=e.replace(/[a-zA-Z0-9]{32,}/g,t=>t.length>40?"[API_KEY_REDACTED]":t),e=e.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,"[EMAIL_REDACTED]"),e=e.replace(/\.obsidian[^"'\s]*/g,"[OBSIDIAN_CONFIG]"),e=e.replace(/[^"'\s]*\/plugins\/[^"'\s]*/g,"[PLUGIN_PATH]"),e=e.replace(/Ideas\/[^"'\s]*/g,"[IDEA_FILE]"),e=e.replace(/Projects\/[^"'\s]*/g,"[PROJECT_FILE]"),e}sanitizeMetadata(e){let t={};for(let[r,n]of Object.entries(e))typeof n=="string"?t[r]=this.sanitizeString(n):typeof n=="object"&&n!==null?t[r]=this.sanitizeMetadata(n):t[r]=n;return t}cleanOldEntries(){let e=new Date;e.setDate(e.getDate()-this.settings.retentionDays),this.logs=this.logs.filter(t=>t.timestamp>=e)}updateSettings(e){this.settings={...this.settings,...e},this.cleanOldEntries()}getSettings(){return{...this.settings}}};var va=class{vault;settings;ARCHIVE_DIR="Ideas/Archived/";constructor(e,t){this.vault=e,this.settings=t}async moveToArchive(e){if(!this.settings.moveArchivedToFolder||(await this.ensureDirectoryExists(this.ARCHIVE_DIR),e.path.startsWith(this.ARCHIVE_DIR)))return;let t=`${this.ARCHIVE_DIR}${e.name}`;if(this.vault.getAbstractFileByPath(t)){let n=Date.now(),i=e.basename,o=e.extension,a=`${i}-${n}.${o}`;await this.vault.rename(e,`${this.ARCHIVE_DIR}${a}`)}else await this.vault.rename(e,t)}async moveFromArchive(e){if(!e.path.startsWith(this.ARCHIVE_DIR))return;let t=`Ideas/${e.name}`;if(this.vault.getAbstractFileByPath(t)){let n=Date.now(),i=e.basename,o=e.extension,a=`${i}-${n}.${o}`;await this.vault.rename(e,`Ideas/${a}`)}else await this.vault.rename(e,t)}async ensureDirectoryExists(e){this.vault.getAbstractFileByPath(e)||await this.vault.createFolder(e)}};var Aa=class{constructor(e,t,r,n,i,o,a,c,l,d,u,m,p,w,v,_,I,A,M,k,N,V,L,U){this.app=e;this.plugin=t;this.settings=r;this.fileManager=n;this.classificationService=i;this.duplicateDetector=o;this.domainService=a;this.webSearchService=c;this.nameVariantService=l;this.scaffoldService=d;this.frontmatterParser=u;this.ideaRepository=m;this.embeddingService=p;this.clusteringService=w;this.graphLayoutService=v;this.resurfacingService=_;this.projectElevationService=I;this.tenuousLinkService=A;this.exportService=M;this.importService=k;this.searchService=N;this.llmService=V;this.errorLogService=L;this.fileOrganizer=U}};var xa=class{constructor(e,t,r,n,i,o,a,c,l,d,u,m,p,w,v,_,I,A,M,k,N,V,L,U){this.app=e;this.plugin=t;this.settings=r;this.fileManager=n;this.classificationService=i;this.duplicateDetector=o;this.domainService=a;this.webSearchService=c;this.nameVariantService=l;this.scaffoldService=d;this.frontmatterParser=u;this.ideaRepository=m;this.embeddingService=p;this.clusteringService=w;this.graphLayoutService=v;this.resurfacingService=_;this.projectElevationService=I;this.tenuousLinkService=A;this.exportService=M;this.importService=k;this.searchService=N;this.llmService=V;this.errorLogService=L;this.fileOrganizer=U;this.commandContext=new Aa(e,t,r,n,i,o,a,c,l,d,u,m,p,w,v,_,I,A,M,k,N,V,L,U)}commandContext};var _p=require("obsidian");var Ia=class{vault;ideaRepository;fileManager;isProcessing=!1;idleTimeoutId;constructor(e,t,r){this.vault=e,this.ideaRepository=t,this.fileManager=r}async assignMissingIds(){if(this.isProcessing)return h.debug("ID assignment already in progress, skipping"),{assigned:0,errors:0};this.isProcessing=!0;let e=0,t=0;try{let r=await this.ideaRepository.getAllIdeas(),n=r.map(o=>o.frontmatter.id).filter(o=>o!==0&&o!==void 0),i=r.filter(o=>!o.frontmatter.id||o.frontmatter.id===0);h.debug(`Found ${i.length} ideas needing IDs`);for(let o of i)try{let a=this.vault.getAbstractFileByPath(`Ideas/${o.filename}`);if(!a||!(a instanceof _p.TFile)){h.warn(`File not found for idea: ${o.filename}`),t++;continue}let c=a,l=Qo(n);n.push(l),await this.fileManager.updateIdeaFrontmatter(c,{id:l}),e++,h.debug(`Assigned ID ${l} to idea: ${o.filename}`)}catch(a){h.warn(`Failed to assign ID to idea ${o.filename}:`,a),t++}e>0&&h.info(`Auto-assigned ${e} idea IDs`)}catch(r){h.error("Error during ID assignment:",r),t++}finally{this.isProcessing=!1}return{assigned:e,errors:t}}scheduleIdleAssignment(e=2e3){if(this.idleTimeoutId&&clearTimeout(this.idleTimeoutId),typeof window>"u")return;let t=window;t.requestIdleCallback&&typeof t.requestIdleCallback=="function"?this.idleTimeoutId=t.requestIdleCallback(()=>{this.assignMissingIds().catch(r=>{h.warn("Idle ID assignment failed:",r)})},{timeout:e}):typeof t.setTimeout=="function"&&(this.idleTimeoutId=t.setTimeout(()=>{this.assignMissingIds().catch(r=>{h.warn("Idle ID assignment failed:",r)})},e))}cancelScheduledAssignment(){this.idleTimeoutId&&(clearTimeout(this.idleTimeoutId),this.idleTimeoutId=void 0)}};var Cp=require("obsidian");var Sa=class{vault;ideaRepository;fileManager;constructor(e,t,r){this.vault=e,this.ideaRepository=t,this.fileManager=r}async migrateRelatedToIds(){let e=0,t=0,r=0;try{let n=await this.ideaRepository.getAllIdeas(),i=new Map;for(let o of n){let a=`Ideas/${o.filename}`;o.frontmatter.id&&o.frontmatter.id!==0&&i.set(a,o.frontmatter.id)}h.debug(`Created path-to-ID map with ${i.size} entries`);for(let o of n)try{let a=o.frontmatter.related||[];if(!a.some(u=>typeof u=="string"||u===0||typeof u=="number"&&!i.has(`Ideas/${u}`)&&!n.find(m=>m.frontmatter.id===u))){r++;continue}let l=[];for(let u of a)if(typeof u=="string"){let m=i.get(u);m?l.push(m):h.warn(`Could not find ID for path: ${String(u)}`)}else typeof u=="number"&&u!==0&&(n.some(p=>p.frontmatter.id===u)?l.push(u):h.warn(`Invalid ID found: ${u}`));let d=Array.from(new Set(l));if(d.length!==a.length||!d.every((u,m)=>a[m]===u)){let u=this.vault.getAbstractFileByPath(`Ideas/${o.filename}`);u instanceof Cp.TFile?(await this.fileManager.updateIdeaFrontmatter(u,{related:d}),e++,h.debug(`Migrated related for idea: ${o.filename}`)):(h.warn(`File not found for idea: ${o.filename}`),t++)}else r++}catch(a){h.warn(`Failed to migrate related for idea ${o.filename}:`,a),t++}e>0&&h.info(`Migrated ${e} ideas' related fields from paths to IDs`)}catch(n){h.error("Error during related migration:",n),t++}return{migrated:e,errors:t,skipped:r}}};var _a=class{static async initialize(e,t,r){let{fileManager:n,fileOrganizer:i,errorLogService:o}=this.initializeCoreServices(e,r),a=await this.initializeLLMServices(e,t,r),{searchService:c,classificationService:l,duplicateDetector:d}=this.initializeSearchServices(e,a),{domainService:u,webSearchService:m}=this.initializeValidationServices(r),{nameVariantService:p,scaffoldService:w}=this.initializeTransformationServices(e,t,r,a),{frontmatterParser:v,ideaRepository:_,embeddingService:I,clusteringService:A,graphLayoutService:M,resurfacingService:k,projectElevationService:N}=this.initializeManagementServices(e,r),{tenuousLinkService:V,exportService:L,importService:U}=this.initializeAnalysisServices(e,a,I,_),z=new xa(e,t,r,n,l,d,u,m,p,w,v,_,I,A,M,k,N,V,L,U,c,a,o,i),j=new Ia(e.vault,_,n),G=new Sa(e.vault,_,n);return j.scheduleIdleAssignment(3e3),setTimeout(()=>{(async()=>{try{await G.migrateRelatedToIds()}catch(hi){h.warn("Related migration failed:",hi)}})()},5e3),{context:z}}static initializeCoreServices(e,t){let r=new Ir(e.vault),n=new va(e.vault,t),i=new wa({enabled:t.errorLoggingEnabled,maxEntries:t.errorLogMaxEntries,retentionDays:t.errorLogRetentionDays});return{fileManager:r,fileOrganizer:n,errorLogService:i}}static initializeSearchServices(e,t){let r=new ta(e.vault),n=new ra(t,r),i=new sa(r);return{searchService:r,classificationService:n,duplicateDetector:i}}static initializeValidationServices(e){let t=new ia(e.prospectrUrl,e.domainCheckTimeout),r=new na(t),n=new oa(e);return{domainService:r,webSearchService:n}}static initializeTransformationServices(e,t,r,n){let i=new ca(n,r,async()=>{let a=await t.loadData();return a?.variantCache&&typeof a.variantCache=="object"?a.variantCache:{}},async a=>{let c=await t.loadData();await t.saveData({...c??{},variantCache:a})}),o=new da(e.vault,e);return{nameVariantService:i,scaffoldService:o}}static initializeManagementServices(e,t){let r=new je,n=new ua(e.vault,r),i=new Ys,o=new pa(i,t.clusteringSimilarityThreshold??.3),a=new ma,c=new ha(n,t,e.vault),l=new fa(e.vault,r,t,e);return{frontmatterParser:r,ideaRepository:n,embeddingService:i,clusteringService:o,graphLayoutService:a,resurfacingService:c,projectElevationService:l}}static initializeAnalysisServices(e,t,r,n){let i=new ga(e.vault,r,t),o=new ya(e.vault,n),a=new ba(e.vault,n);return{tenuousLinkService:i,exportService:o,importService:a}}static initializeLLMServices(e,t,r){let n=null;if(r.cloudProvider!=="none"&&r.cloudProvider!=="custom"&&r.cloudProvider!=="custom-model"){let i=r.cloudApiKeys&&r.cloudProvider in r.cloudApiKeys?(r.cloudApiKeys[r.cloudProvider]??"").trim():"";if(i.length>0)try{let o=nt.createProvider(r.cloudProvider,i,{openRouterModel:r.openRouterModel,customEndpointUrl:r.customEndpointUrl});n=new Zs(o),h.info("Cloud AI provider initialized:",o.name)}catch(o){h.warn("Failed to initialize cloud provider:",o),new Ea.Notice("Failed to initialize cloud AI provider. Using local AI only.")}}else if(r.cloudProvider==="custom-model"){if(r.customModelProvider&&r.customModel){let i=r.cloudApiKeys&&r.customModelProvider in r.cloudApiKeys?(r.cloudApiKeys[r.customModelProvider]??"").trim():"";if(i.length>0)try{let o=nt.createProvider("custom-model",i,{customModelProvider:r.customModelProvider,customModel:r.customModel});n=new Zs(o),h.info("Custom model provider initialized:",o.name,r.customModel)}catch(o){h.warn("Failed to initialize custom model provider:",o),new Ea.Notice("Failed to initialize custom model provider. Using local AI only.")}}}else if(r.cloudProvider==="custom"&&r.customEndpointUrl&&r.customEndpointUrl.trim().length>0)try{let i=nt.createProvider("custom","",{customEndpointUrl:r.customEndpointUrl});n=new Zs(i),h.info("Cloud AI provider initialized:",i.name)}catch(i){h.warn("Failed to initialize custom endpoint:",i),new Ea.Notice("Failed to initialize custom endpoint. Using local AI only.")}return n?(r.preloadOnStartup&&n.isAvailable()&&n.ensureReady?.().then(i=>{h.debug("LLM preloaded on startup")}).catch(i=>{h.warn("Failed to preload LLM on startup:",i)}),Promise.resolve(n)):Promise.reject(new Error("No LLM service configured. Please configure a cloud AI provider in settings."))}};var Ta=require("obsidian");var Ra=require("obsidian");var Ca=class extends Error{userMessage;constructor(e,t){super(e),this.name="UserFacingError",this.userMessage=t}};var Pa=class{constructor(e){this.context=e}handleError(e,t,r){if(h.error(`Failed to ${t??"execute command"}:`,e),this.context.errorLogService){let n=e instanceof Error?e:new Error(String(e));this.context.errorLogService.logError(n,t,r)}if(e instanceof Ca)new Ra.Notice(e.userMessage);else{let n=t?`Failed to ${t}. Please try again or check console for details.`:"Failed to execute command. Please try again or check console for details.";new Ra.Notice(n)}}showNotice(e){new Ra.Notice(e)}debug(e,...t){h.debug(e,...t)}info(e,...t){h.info(e,...t)}warn(e,...t){h.warn(e,...t)}};var ka=class extends Pa{constructor(e){super(e)}execute(){try{return new Er(this.context.app,this.context.fileManager,this.context.classificationService,this.context.duplicateDetector,this.context.settings,this.context.domainService,this.context.webSearchService,this.context.nameVariantService,this.context.llmService).open(),Promise.resolve()}catch(e){return this.handleError(e,"open capture modal","capture-idea"),Promise.resolve()}}};var Ma=class s{static createCommandCallback(e,t){let r=async()=>{h.info(`Callback invoked for: ${e}`),h.debug("Callback stack trace:",new Error().stack);try{h.debug(`About to call operation for: ${e}`),await s.safeExecute(e,t),h.debug(`Operation completed for: ${e}`)}catch(n){console.error(`[Ideatr] Callback error for ${e}:`,n),h.error(`Callback error for ${e}:`,n)}};return typeof r!="function"&&(console.error(`[Ideatr] ERROR: Callback for ${e} is not a function! Type: ${typeof r}`),h.error(`Callback for ${e} is not a function! Type: ${typeof r}`)),r}static async safeExecute(e,t){h.info(`Starting command: ${e}`);let r=null;try{r=new Ta.Notice(`\u23F3 Processing ${e}...`,0),h.debug(`Created loading notice for: ${e}`);try{let n=r.noticeEl;if(n){let i=n.createSpan({cls:"ideatr-loading-spinner"});i.textContent="\u23F3",i.addClass("ideatr-loading-spinner")}}catch(n){h.debug("Could not add spinner to notice (non-critical):",n)}}catch(n){console.error(`[Ideatr] Failed to create loading notice for ${e}:`,n),h.error(`Failed to create loading notice for ${e}:`,n)}try{h.debug(`Executing operation for: ${e}`),await t(),h.info(`Finished command: ${e}`),r&&r.hide(),new Ta.Notice(`\u2713 ${e} completed`,2e3)}catch(n){console.error(`[Ideatr] Command '${e}' failed:`,n),h.error(`Command '${e}' failed:`,n),r&&r.hide()}}static registerAll(e,t){h.debug("Registering commands (MVP mode - core capture only)...");let r=s.createCommandCallback("Capture idea",async()=>await new ka(t).execute());if(e.addCommand({id:"capture-idea",name:"Capture idea",callback:r}),h.debug("Registered: Capture idea"),h.isDebugEnabled()){let n=s.createCommandCallback("Ideatr Debug (Registry)",()=>(h.debug("[Ideatr DEBUG REGISTRY] Command operation executed!"),h.info("DEBUG REGISTRY: Command executed successfully"),new Ta.Notice("Ideatr debug (registry) command executed - check console"),Promise.resolve()));h.debug("Debug registry callback type:",typeof n),e.addCommand({id:"debug-registry",name:"Debug (registry)",callback:n}),h.debug("Registered debug command via CommandRegistry")}h.info("Command registration complete - MVP mode (only Capture idea enabled)")}};var H=require("obsidian"),Lt=qp(require("fs"));function Sr(...s){return s.filter(e=>e.length>0).map(e=>e.replace(/\\/g,"/").replace(/\/+/g,"/")).join("/").replace(/\/$/,"")}function Rp(...s){let e=Sr(...s);return e.startsWith("/")||/^[A-Za-z]:/.test(e)?e.replace(/\/+/g,"/"):e.replace(/\/+/g,"/")}function Pp(s){return s.startsWith("/")||/^[A-Za-z]:/.test(s)}var Oa=class{constructor(e,t){this.app=e;this.pluginDir=t}getTutorialVaultPath(){return"Tutorials"}findTutorialFolder(){let e="Tutorials",t="tutorials",r=this.app.vault.getAbstractFileByPath(e);if(r instanceof H.TFolder)return r;let n=this.app.vault.getAbstractFileByPath(t);return n instanceof H.TFolder?n:null}async getBundledTutorialFiles(){let e=new Map;if(this.pluginDir){let t=Sr(this.pluginDir,"tutorials");try{if(Lt.existsSync(t)&&Lt.statSync(t).isDirectory()){let r=Lt.readdirSync(t);for(let n of r)if(n.endsWith(".md")){let i=Sr(t,n);try{let o=Lt.readFileSync(i,"utf-8");e.set(n,o)}catch(o){console.warn(`Error reading tutorial file ${n}:`,o)}}}}catch(r){console.warn("Error reading tutorial directory from plugin:",r)}}if(e.size===0)try{let t=this.findTutorialFolder();if(t instanceof H.TFolder&&t.children){for(let r of t.children)if(r instanceof H.TFile&&r.name.endsWith(".md"))try{let n=await this.app.vault.read(r);e.set(r.name,n)}catch(n){console.warn(`Error reading tutorial file ${r.name}:`,n)}}}catch(t){console.warn("Error reading tutorial directory from vault:",t)}return e}async resetTutorials(e=!1){try{let t=await this.getBundledTutorialFiles();if(t.size===0)return new H.Notice("Tutorial files not found in plugin directory. They may need to be manually restored."),!1;let r=this.getTutorialVaultPath();if(!this.app.vault.getAbstractFileByPath(r))try{await this.app.vault.createFolder(r)}catch(o){let a=o instanceof Error?o.message:String(o);if(a.includes("already exists")||a.includes("Folder already exists")){let c=this.app.vault.getAbstractFileByPath(r)}else if(!this.app.vault.getAbstractFileByPath(r))throw o}let i=0;for(let[o,a]of t.entries()){let c=`${r}/${o}`,l=this.app.vault.getAbstractFileByPath(c);if(l&&l instanceof H.TFile)e&&(await this.app.vault.modify(l,a),i++);else try{await this.app.vault.create(c,a),i++}catch(d){let u=d instanceof Error?d.message:String(d);if(u.includes("already exists")||u.includes("File already exists")){if(e){let m=this.app.vault.getAbstractFileByPath(c);m&&m instanceof H.TFile&&(await this.app.vault.modify(m,a),i++)}}else throw d}}return i>0?new H.Notice(`Tutorials reset successfully! ${i} files restored.`):e&&new H.Notice("All tutorial files already exist. No changes made."),!0}catch(t){let r=t instanceof Error?t.message:String(t);return!r.includes("already exists")&&!r.includes("File already exists")&&(console.error("Error resetting tutorials:",t),e&&new H.Notice(`Failed to reset tutorials: ${r}`)),!1}}async deleteTutorials(){try{let e=this.findTutorialFolder();if(!e)return new H.Notice("No tutorial files found to delete."),!1;let t=e.path,r=[],n=i=>{i instanceof H.TFile&&i.path.startsWith(t)&&r.push(i),i instanceof H.TFolder&&i.children&&i.children.forEach(o=>n(o))};if(n(e),r.length===0)return new H.Notice("No tutorial files found to delete."),!1;for(let i of r)await this.app.fileManager.trashFile(i);try{e instanceof H.TFolder&&(!e.children||e.children.length===0)&&await this.app.vault.delete(e,!0)}catch{}return new H.Notice(`Tutorials deleted successfully! ${r.length} files removed.`),!0}catch(e){return console.error("Error deleting tutorials:",e),new H.Notice(`Failed to delete tutorials: ${e instanceof Error?e.message:"Unknown error"}`),!1}}tutorialsExistInVault(){let e="Tutorials/00-Index.md",t="tutorials/00-Index.md";return this.app.vault.getAbstractFileByPath(e)instanceof H.TFile?!0:this.app.vault.getAbstractFileByPath(t)instanceof H.TFile}async bundledTutorialsAvailable(){return(await this.getBundledTutorialFiles()).size>0}};var La=class{snapshots=[];maxSnapshots=100;monitoringInterval=null;startMonitoring(e=3e4){if(this.monitoringInterval){h.warn("Memory monitoring already started");return}h.debug("Starting memory monitoring"),this.takeSnapshot(),this.monitoringInterval=setInterval(()=>{this.takeSnapshot(),this.checkForLeaks()},e)}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null,h.debug("Stopped memory monitoring"))}takeSnapshot(){let e=process.memoryUsage(),t={timestamp:Date.now(),heapUsedMB:e.heapUsed/1024/1024,heapTotalMB:e.heapTotal/1024/1024,externalMB:e.external/1024/1024,arrayBuffersMB:e.arrayBuffers/1024/1024};return this.snapshots.push(t),this.snapshots.length>this.maxSnapshots&&this.snapshots.shift(),t}checkForLeaks(){if(this.snapshots.length<10)return;let e=this.snapshots.slice(-10),t=e[0],r=e[e.length-1],n=r.heapUsedMB-t.heapUsedMB,i=(r.timestamp-t.timestamp)/1e3/60,o=n/i;o>1&&h.warn("Potential memory leak detected:",{heapGrowthMB:n.toFixed(2),timeElapsedMinutes:i.toFixed(2),growthRateMBPerMinute:o.toFixed(2)})}getReport(){if(this.snapshots.length===0)return"No memory snapshots available";let e=this.snapshots[this.snapshots.length-1],t=this.snapshots[0],r=e.heapUsedMB-t.heapUsedMB;return`Memory Report:
  Current Heap: ${e.heapUsedMB.toFixed(2)} MB
  Total Heap: ${e.heapTotalMB.toFixed(2)} MB
  External: ${e.externalMB.toFixed(2)} MB
  Growth since monitoring started: ${r.toFixed(2)} MB
  Snapshots collected: ${this.snapshots.length}`}getCurrentUsage(){return this.snapshots.length===0?null:this.snapshots[this.snapshots.length-1]}clearSnapshots(){this.snapshots=[]}isMonitoring(){return this.monitoringInterval!==null}};var kp="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABigAwAEAAAAAQAAABgAAAAAPuetXQAAAAlwSFlzAAAOxAAADsQBlSsOGwAABDNJREFUSA2lVN9rHFUU/ubeuXdm9kc2v1pJGmkloLEUH1QKkipGQVHqi/rSp7740Aeh4pNQCksV/AcqgiISbZWiPkTUJiC2WKHGGoi1IWkam7T53U12d3Y3uzM7s/d6Rgism01S8b7MvXfO+b5zvnPuAe5zXb24fOCPXwqPaK1j9+nyj5mxm/EH6YmEs9F5uq1LnIjv4ZKbWNBQU5YlJtxifuTo8Z5LO2Hw7X6m02l2fOD8UZVLDlazidfbH9SWjBmmoVg7lPlwzZdH3Ezl2D7xQnb01rlr2+Fsm8HwudUT2fnYh76r4RerOHiEQ0gOTUhBtQbP09DKwJ2pVTCBdxfl8pl0eiBsJGKNF9FZ6zSrVtgxaZrgdoj4XgOxVgYR17CSGnbMgGMbkFIj3iYwM5k7vXg5ONQMy2x2efP6W/sDL3yC2T6kApwYg5UADFPDIFGrAmDgyGQKuDL8F5TvwGkV/YQ13ojXNIPl2eB5S8Tj0laItQC1oIYrX3oYHwmxMKHgbxCBXcPvl++AhRyphESqRbyoib+RYEsGkdHwebzCuYYgGbjQuDmlUMwwlLIaKzM1mEIh1aWgqgba2+IwTUFyscNjY0sdQPdaPckWgunpQkfoV/stGSCRZFhbCFDKkN6kOyN5WORBlS6vmeju2YvCukdhGwirwQPXhzK99PdfBFskmhstV4r3SgsqCOGVfSxMUcQWwKmgpqNgUqF5jArDa1SFBFr3SSiusF4ozo7dyMzURx/tt2gWXX7+/uRrlbz1dTFbhmAOTEaFoOi5pcGkQe1JBAHDRjGPGxO3EfqUFq++MfjbS59E/vVrSwbRz553LgxJx//eCCVy2XWImEcZAMJikMIgzRnshMLS8gqMqqQ79atV2/NZPfDmvinBgJEOex+TbyujnC1lQ9zLrFK/k0SSmjMCdzj8MI9y3kc8birL4emPxp4MNkHrv00JIoOnX+2d1sw7SRUN795ykXfXIIQPi9oz0Rpi+XYWqWQLYjH27dlLz43Ug9bvm9Zg04Amp3Hy2Z8mgsB6VIuAoi5TBhz7H0oBpUgaG6HyXz514fGLmz6N320ziAyj9gug5pkhKXKGcpFadt3H2lIZrZ1J2C2ikkhZE42g9ecdCQhf11j4Y8hKNCo0Eo5AW4sNTkPOdGgeteKHrtzBxXrAxv2Wh9ZoUOn95jt3Vb136JkB6f45idm5efiej3zuADzkhr746uNao0/9eVeCvOt6brlQnpodl5niCrLeIo3rKjIFo1athcv1YM32O0tEHgYsThMJwpS0Z1ChIt00NkplOnN6fjuvXQkssArnjAkpqE0FGIveAoe0JN3qHbswot6VoFRKrVm28+nc3F24bgG27SBJ/U/Igzz0ft45/m1mUTOnw0/1v8kZTuWyLk+2JM9eG716ppnd/7rr6+vr6O7u7vwvIH8DwCqf0vItrMwAAAAASUVORK5CYII=",Tp="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABigAwAEAAAAAQAAABgAAAAAPuetXQAAAAlwSFlzAAAOxAAADsQBlSsOGwAABDZJREFUSA2tVV1oHFUU/u7cO3dmdme2u8nmv5SmiD5EKoEgVlpiCfokkfpQ7KsoaH2sT6LpVkEffKt/KFp8EIQ2iFKFKmnaUqnakpoYSA02Jm2TbP72L7ubzM7f9U4wEJJNNoIzD/fOme+e75zvnnsusKtHkIvZT/ddKZx/SAhh7GrJvyBSC3z2r1RsNjbWl2TJl5qCNq5AeQBCxhhjY5ncyk8n2/uu7eRjW4KUSCk0fbc3y5bOLPPswceCJ1EvmgEq4FMHPnMxv5hxB4ZvnhroHfpgOxK23Y/2Be2VGVP5SPc4XDuGBG+ERqQ6PuB4FJ4doD4aVx9tf/js4ZEnmruzDaePHk15m/0pmw3h95WnBLNJ8YQqODQvigbahLjSgAhiMEkcUSUGg0TXCOMsjqH5kTf6st8crOaragbmt5f32W65k7sGAiJgUBNREgMjHAoomCQWNEC+WMKl8UE4agUGjzwuCW5vJqmawT1/rEeVIerChEUScAIH/aXPcNnpxx3/FsqkAFXoGJz8GT53YFoGEmbimRTEFn9bMghBK8F7varQoMMCJQzjlUHkxSKKXhZT/p9QZSZJtMFlFdTH6sBUJqUzjjw9dyOZasbCxiy2MJ5YHqpzSPkQ9wxYNI5MsICsWICmGNCpIeWKSqlUFJUM2hvb0KK3ooEn4auV5Hdz5/ZvdB7OtxCM2N/bi6X8olMBik4Z496wdMigKgxcRq7JVye6XKhAjbpoYS0IbIHSkjOTLmenNhNUPQfvj731Qo6kv16w5yFiRTDTkxurrhGEGw0hpJABChkXo6PTqJAKzCBx8vrxoU82E2zJIAS8fv7tfinRD2F1LC2uQnctmYG6VpacaGsS6cLCzIMCXL0CTtWbzR0HvtjsPPyuSkBSxOuMHjkFl+ZyTgHp6RXEZP1zhcsNVmGwCCo5BXkvj0hUDwxLO32h44Kza4IQ+NyB4+N70X6GKUz8vXgfhbQAc+UOBPK4+Q2YzMzASkQQ5ZGLV3v++LGa89C2pUw3Ap/3X/z4WnHgVcbZI6P3J1C+U5atSMX+xr0Qpo96Xg9SoZ+DQGxct3FeVaJ1QFdXl1tx/LucSWkoRdEvyZJdQtpOI6knQ9nsuGqOruOrjTsShAsSouFGUCbQZHuI6ByWqSOgLqIwkVDqLnV30ulqjtdtdH2y3di951jGvU1f7ml8luJ3C6XrBJVfOfSJJuSuinf7jn01vN3a0L7jHoSApdm51bI8cRPDM3w5bcOeDuA6Anms+K7tzoaYnZ6aEhFdo7KBEqbKZMPLRnjySvBRXilB9o+aAdYEaFBWqaIoXFOhqrJdU9mwBQXXuDTTqp1gY0Y1MyiV9izpunFuavIeCvkCdM1AzIqFJ/TLKPN2vI9DopoRrEfTdejwa6qCN3O5vGJZ1oe3fvvlnfV//9vY0dFR19ramvwvDv8BxwGDgevhw4MAAAAASUVORK5CYII=",Mp="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABigAwAEAAAAAQAAABgAAAAAPuetXQAAAAlwSFlzAAAOxAAADsQBlSsOGwAABBBJREFUSA2VVVtonEUU/mbmv+19001MabpIpIqiEYrVFjEQib4Wn/qiPuiDoeAFS9GXSoXqg8+VUpRSX0SsDxEkiBWRUoxaqJDGapJaa7pJzOa21/z733bG87emTeKf7HqWYWcO3/m+OWfOzA+0ZYrZfxzJ24U3e5RSvK2Qf0GsFXjh+4FkzKy9pWd2v9Y0coASfwLBuOByvLJsj3bv/+LH7Ti2FFAKrDbef1DzVo7rsr43SB8ASEBwDo0HYMxGbaXmzY9PHn3ghd9ObiWypUB56o2hJK6cDpwqvIYD0fkswC3ioQpJB6pZBmc+grIDmch/kHkofYyxd4PNQtpmR7geGFAaky8/DyHgKxPMStPud1J5AEY/xciHJi1rcMlX//2Ht6cvzp+j0F8280UKDH/25W5eqe71JO2YEEzrAhMdd2KZtMnZhFPxsTT2LWK8gaRmPhElENkRrDH2TCIukorvADe66UwV/OunEMwNQ1bGoAIbknWgPnWZyF0kEnFY8Vj/nR2sm0RkoDhXRw4qFqPdd95qu1w8D+UViXgRsv4rZWMA1n3QNapPljCaoJMx+gtXz+3IP3xoZR1/eGIbrTw9kuGo7/dVBky/B2qViJ0ZIqW6h0OjsjFBWc3B2tkDkckD8Rwsk+VF+cIjG9lutcRGl1P+3POr1TkVxNB0XMjSJUIRIR04BCUs9NuDKQijChXfBc8XWF7xZuzitYmNbGFTRFhx9NXnLKM67NaL0OQ8EdVIhMg5kZNY2ElMcNhVHcXJBcK4aASpVx57ferjzXT/KVEIeGf85Ijr6iNms0SdoqB4JxHqNAywUITmSmRR/9tGXHi0Nn9WZuqTzeThOlLgoyHmB6mnjjq2Voa9BHuR7o9JIhoJhMOIw6snwNwarGRSWdmu9/cNXfbbFgiBux59acI3Hzyh0YE6xQLqpQRdrSQkz9Du74W3tIhkOkbz1Ne9hy6NRJGHvog2vQv173/xlJw5f1izrD3V2VnMT9ChKoF0d4CUFkBL5SAD8zRjTN6N2jiLLNEapLf3aSeAmhBWgh45Bi2oQPcWwVYL0NM5BHrKMTPZK2v4qP9tBcIAj3ddbDQUNY+BmKEjETco7QaUloAUuW+ys2IminjNt22JQtDx7/Z9ZfgLJwYHB42JyasoTN+A6znI9+ZQXuXDZ8982lwji/pvKVAqV5x6xV2NjxWMhQUXN2eb8DwJR7ObsunPRZGu97UsUZy+MEIwGBqn6yVpNKm3JezVOj1B9Ai1sJYC0mINzhm34hZMywSnL5rQNeiGLrbvwdvKLQX8SmXZMq0zN67/hdJyiR41C+lkGroQZ00EF1okQBm3aY8fePIwlelYaaUs0tn0hz+Njr7XZmj7sL6+vo6eHrpd/8P+AaolgMPx0J5bAAAAAElFTkSuQmCC",Op="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAABgAAAAAQAAAGAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAABigAwAEAAAAAQAAABgAAAAAPuetXQAAAAlwSFlzAAAOxAAADsQBlSsOGwAABCpJREFUSA2tVVtoHFUY/s7cd7LXxIQ0iQk0MYEsBSstJeqLGlGKAV+LBN/0wRuiIuiDC14QhYJQEATBiqAYvNWE2lCxXmirJfQhSrw0Kblt0nbNbDK7c9mZneM/kdJ1d+JGcOAw55z5zvf93/+fcwbY5VM4+kq3M/nJ3mXOY7tcsg1jzcD5sTFdM1aeYAcOPusPDukQpRVa85ssS3ObRmm675nnv/43DnGnjzyXEx7vax9TreJxzbbHq8NZPUinZJGhTfYrQ4pp3uFcvXLkPiZsfLC0cmEnHmmnD4Wk+ogeU98OWnRYQQB0doLHdPjk2XcEuJUK9Na03HPbvmOz9492FXzxpbtyOb+eT6if2B5zLsLcPBKoKtyWOIQ9XWDtHWDxOLUEEDaaRywGlkjg6tmzL9iTH++L4op0kD892c3s8q0VIuCcA4k0hEQSkAguCuDlMsADmGUL86dOQXEcBJJ6kAQu1otECii/X7pbU5RkWaMIKVpe3ELw5usQenrAbhkC6+2DT26Wvv8BStVHPJWEB3Y7kb9TL9C4izhnhaOvfapWrAetZAaCrIB9/hn48iIYOWACZVVREOztxx9mGYFt0VCG73pzRTmx//DJk26tSEMNjDNnUnCsEU+n3Le1QVxZBsuvQNDJDRUcScq/pkJcX0PHnk6ovT2QCCfJ0mArKv215GG/QcCdmvLMza28S5F7tgP+4/ntiMOoQUXfbmFtyE28XILY2QUXDEXLXSxVzCv1Ao0pIsTF5548rAh8yikUkFlfR9rcAqc0QCEBWQanNIWRXSPiX1bXAEqT7fOHH5qbf79eoMFBCPjijbemA0GelE0T67SJnJvawcgRYtrfW5OcVDOtWKUaqK4LUZbPl/T0h/Xk4ThSIMeYHxve/7Tr84JvFLHkB+AddA5oV4UiLBHHhhpDhZzF4nqgpxK5R2dmvF0LhMCB8fFLnig8JXieZywuIq/pcFMp+OkMvJ5eFNbySJGQ2BL/cvSbn6ajyMO5yBrUgNnp4YFZ1qJlnUwGtmHQCgGZ/gHolglV0+Ax9sChj05M1az5RzfyoNUgeIWxhZiuZ0VGsfxpgFerqFAN2gb7w2LbIpNma/AN3cga1KL8ZPI72/UgiTJaqNBpItcsK0wNpHTrVwuGvVqLr+83c4CJ7KEpby3/6ui99yi/zv6MpfkFuK6Dm02GUsk/8d7ERLWetHbcVGDDKLqbtmvNXF5S1ssOlv0qvCpHdatcpSdfSxbVb5oi2vki/WSYIooQ6AYFCYDqYJVMyNsXUxTtjbmmDgRBshgRKZoCma4Lga5riUt0c6giF4NmuzD6oN3QB+X5WkFVY+9eXlhEkQ6dpmpI0E+GXB2Ha31bi43qN43g+qIDI3c+porsRWPDEFtSiWMXzp17+fq3/+09ks22dnd3t/0Xwr8AlfeB0c709XMAAAAASUVORK5CYII=";var Fa=class extends ve.Plugin{settings;pluginContext;statusBarItem;statusUpdateInterval;memoryMonitor;unhandledRejectionHandler;uncaughtExceptionHandler;exitHandler;sigintHandler;sigtermHandler;get nameVariantService(){return this.pluginContext.nameVariantService}get errorLogService(){return this.pluginContext.errorLogService}async onload(){await this.loadSettings(),this.unhandledRejectionHandler=(t,r)=>{console.error("Ideatr: Unhandled Rejection at:",r,"reason:",t),h.error("Unhandled Rejection:",t)},process.on("unhandledRejection",this.unhandledRejectionHandler),this.uncaughtExceptionHandler=t=>{console.error("Ideatr: Uncaught Exception:",t),h.error("Uncaught Exception:",t)},process.on("uncaughtException",this.uncaughtExceptionHandler),await h.initialize(this.app,this.settings.debugMode),Ml(this.settings)&&setTimeout(()=>{new Cr(this.app,null,this.settings,()=>{(async()=>await this.saveSettings())()}).open()},100);let{context:e}=await _a.initialize(this.app,this,this.settings);this.pluginContext=e,this.addStatusBarIndicator(),await this.ensureTutorialsAvailable(),this.addSettingTab(new Jo(this.app,this)),h.debug("Starting command registration...");try{if(!this.pluginContext)throw new Error("PluginContext is not initialized");if(!this.pluginContext.commandContext)throw new Error("CommandContext is not initialized");if(Ma.registerAll(this,this.pluginContext.commandContext),h.isDebugEnabled()){let t=()=>(h.debug("[Ideatr DEBUG MAIN] Command callback invoked!"),h.debug("[Ideatr DEBUG MAIN] Stack trace:",new Error().stack),h.info("DEBUG MAIN: Command executed successfully"),new ve.Notice("Ideatr debug (main) command executed - check console"),Promise.resolve());h.debug("Debug main callback type:",typeof t),this.addCommand({id:"debug-main",name:"Debug (main)",callback:t}),h.debug("Registered debug command directly in main.ts")}(0,ve.addIcon)(tn,rn(`data:image/png;base64,${kp}`)),(0,ve.addIcon)($a,rn(`data:image/png;base64,${Tp}`)),(0,ve.addIcon)(Ba,rn(`data:image/png;base64,${Mp}`)),(0,ve.addIcon)(Ua,rn(`data:image/png;base64,${Op}`)),this.addRibbonIcon(tn,"Capture idea",()=>{this.openCaptureModal()}),this.addCommand({id:"show-memory-report",name:"Show memory report",callback:()=>{if(this.memoryMonitor){let t=this.memoryMonitor.getReport();h.debug("Memory report:",t);let r=this.memoryMonitor.getCurrentUsage();r?new ve.Notice(`Heap: ${r.heapUsedMB.toFixed(0)}MB | Ext: ${r.externalMB.toFixed(0)}MB`):new ve.Notice("Memory report logged to console")}else new ve.Notice("Memory monitoring is not enabled (requires debug mode)")}}),h.info("All commands registered successfully")}catch(t){console.error("[Ideatr] Error registering commands:",t),console.error("[Ideatr] Error details:",t instanceof Error?t.stack:t),new ve.Notice("Failed to register ideatr commands. Check console for details")}this.settings.debugMode&&(this.memoryMonitor=new La,this.memoryMonitor.startMonitoring(6e4),h.debug("Memory monitoring started"))}openCaptureModal(){new Er(this.app,this.pluginContext.fileManager,this.pluginContext.classificationService,this.pluginContext.duplicateDetector,this.settings,this.pluginContext.domainService,this.pluginContext.webSearchService,this.pluginContext.nameVariantService,this.pluginContext.llmService,this.pluginContext.ideaRepository).open()}async ensureLLMReady(){this.pluginContext.llmService?.ensureReady&&await this.pluginContext.llmService.ensureReady()}onunload(){h.debug("Unloading Ideatr plugin"),this.unhandledRejectionHandler&&(process.removeListener("unhandledRejection",this.unhandledRejectionHandler),this.unhandledRejectionHandler=void 0),this.uncaughtExceptionHandler&&(process.removeListener("uncaughtException",this.uncaughtExceptionHandler),this.uncaughtExceptionHandler=void 0),this.exitHandler&&(process.removeListener("exit",this.exitHandler),this.exitHandler=void 0),this.sigintHandler&&(process.removeListener("SIGINT",this.sigintHandler),this.sigintHandler=void 0),this.sigtermHandler&&(process.removeListener("SIGTERM",this.sigtermHandler),this.sigtermHandler=void 0),this.statusUpdateInterval&&(clearInterval(this.statusUpdateInterval),this.statusUpdateInterval=void 0),this.memoryMonitor&&(h.debug("Memory report before unload:"),h.debug(this.memoryMonitor.getReport()),this.memoryMonitor.stopMonitoring(),this.memoryMonitor=void 0),this.pluginContext?.llmService&&this.pluginContext.llmService.cleanup?.(),h.debug("Ideatr plugin unloaded successfully")}async loadSettings(){let e=await this.loadData();if(this.settings=Object.assign({},yp,e),e&&"cloudApiKey"in e&&e.cloudApiKey&&(!this.settings.cloudApiKeys||Object.values(this.settings.cloudApiKeys).every(t=>!t))){let t=typeof e.cloudApiKey=="string"?e.cloudApiKey:"",r=typeof e.cloudProvider=="string"?e.cloudProvider:"none";t&&r!=="none"&&r!=="custom"&&(this.settings.cloudApiKeys||(this.settings.cloudApiKeys={anthropic:"",openai:"",gemini:"",groq:"",openrouter:""}),(r==="anthropic"||r==="openai"||r==="gemini"||r==="groq"||r==="openrouter")&&(this.settings.cloudApiKeys[r]=t),await this.saveSettings())}this.settings.cloudApiKeys||(this.settings.cloudApiKeys={anthropic:"",openai:"",gemini:"",groq:"",openrouter:""})}async saveSettings(){await this.saveData(this.settings)}addStatusBarIndicator(){this.statusBarItem=this.addStatusBarItem(),this.updateStatusBarIndicator(),this.statusUpdateInterval=window.setInterval(()=>{this.updateStatusBarIndicator()},5e3)}updateStatusBarIndicator(){if(!this.statusBarItem)return;this.statusBarItem.empty();let e=wi(this.pluginContext.llmService,this.settings,this.app);this.statusBarItem.appendChild(e)}async ensureTutorialsAvailable(){try{let t=this.app.vault.adapter.basePath??this.app.vault.configDir,r=Pp(this.app.vault.configDir)?this.app.vault.configDir:Sr(t,this.app.vault.configDir),n=Rp(Sr(r,"plugins",this.manifest.id)),i=new Oa(this.app,n);i.tutorialsExistInVault()||(await i.bundledTutorialsAvailable()?(h.info("Tutorials not found in vault, copying from plugin directory..."),await i.resetTutorials()):h.warn("Tutorial files not found in plugin directory. They may need to be manually restored."))}catch(e){h.warn("Error ensuring tutorials are available:",e)}}};
/*! Bundled license information:

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
